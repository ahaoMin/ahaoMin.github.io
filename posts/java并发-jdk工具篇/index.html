<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Á∫øÁ®ãÊ±†ÂéüÁêÜ ‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®Á∫øÁ®ãÊ±† ‰ΩøÁî®Á∫øÁ®ãÊ±†‰∏ªË¶ÅÊúâ‰ª•‰∏ã‰∏â‰∏™ÂéüÂõ†Ôºö
 ÂàõÂª∫/ÈîÄÊØÅÁ∫øÁ®ãÈúÄË¶ÅÊ∂àËÄóÁ≥ªÁªüËµÑÊ∫êÔºåÁ∫øÁ®ãÊ±†ÂèØ‰ª•Â§çÁî®Â∑≤ÂàõÂª∫ÁöÑÁ∫øÁ®ã„ÄÇ ÊéßÂà∂Âπ∂ÂèëÁöÑÊï∞Èáè„ÄÇÂπ∂ÂèëÊï∞ÈáèËøáÂ§öÔºåÂèØËÉΩ‰ºöÂØºËá¥ËµÑÊ∫êÊ∂àËÄóËøáÂ§öÔºå‰ªéËÄåÈÄ†ÊàêÊúçÂä°Âô®Â¥©Ê∫É„ÄÇÔºà‰∏ªË¶ÅÂéüÂõ†Ôºâ ÂèØ‰ª•ÂØπÁ∫øÁ®ãÂÅöÁªü‰∏ÄÁÆ°ÁêÜ„ÄÇ  Á∫øÁ®ãÊ±†ÁöÑÂéüÁêÜ Java‰∏≠ÁöÑÁ∫øÁ®ãÊ±†È°∂Â±ÇÊé•Âè£ÊòØExecutorÊé•Âè£ÔºåThreadPoolExecutorÊòØËøô‰∏™Êé•Âè£ÁöÑÂÆûÁé∞Á±ª„ÄÇ
Êàë‰ª¨ÂÖàÁúãÁúãThreadPoolExecutorÁ±ª„ÄÇ
ThreadPoolExecutorÊèê‰æõÁöÑÊûÑÈÄ†ÊñπÊ≥ï ‰∏ÄÂÖ±ÊúâÂõõ‰∏™ÊûÑÈÄ†ÊñπÊ≥ïÔºö
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  // ‰∫î‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞ public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue) // ÂÖ≠‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞-1 public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue, ThreadFactory threadFactory) // ÂÖ≠‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞-2 public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue, RejectedExecutionHandler handler) // ‰∏É‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞ public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler)   Ê∂âÂèäÂà∞5~7‰∏™ÂèÇÊï∞ÔºåÊàë‰ª¨ÂÖàÁúãÁúãÂøÖÈ°ªÁöÑ5‰∏™ÂèÇÊï∞ÊòØ‰ªÄ‰πàÊÑèÊÄùÔºö'><title>JavaÂπ∂Âèë JDKÂ∑•ÂÖ∑ÁØá</title>

<link rel='canonical' href='https://ahao.ink/posts/java%E5%B9%B6%E5%8F%91-jdk%E5%B7%A5%E5%85%B7%E7%AF%87/'>

<link rel="stylesheet" href="/scss/style.min.baba905ab2d1209de74a1930c487a8a663c37860af6aa1c26588d298bf620306.css"><meta property='og:title' content='JavaÂπ∂Âèë JDKÂ∑•ÂÖ∑ÁØá'>
<meta property='og:description' content='Á∫øÁ®ãÊ±†ÂéüÁêÜ ‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®Á∫øÁ®ãÊ±† ‰ΩøÁî®Á∫øÁ®ãÊ±†‰∏ªË¶ÅÊúâ‰ª•‰∏ã‰∏â‰∏™ÂéüÂõ†Ôºö
 ÂàõÂª∫/ÈîÄÊØÅÁ∫øÁ®ãÈúÄË¶ÅÊ∂àËÄóÁ≥ªÁªüËµÑÊ∫êÔºåÁ∫øÁ®ãÊ±†ÂèØ‰ª•Â§çÁî®Â∑≤ÂàõÂª∫ÁöÑÁ∫øÁ®ã„ÄÇ ÊéßÂà∂Âπ∂ÂèëÁöÑÊï∞Èáè„ÄÇÂπ∂ÂèëÊï∞ÈáèËøáÂ§öÔºåÂèØËÉΩ‰ºöÂØºËá¥ËµÑÊ∫êÊ∂àËÄóËøáÂ§öÔºå‰ªéËÄåÈÄ†ÊàêÊúçÂä°Âô®Â¥©Ê∫É„ÄÇÔºà‰∏ªË¶ÅÂéüÂõ†Ôºâ ÂèØ‰ª•ÂØπÁ∫øÁ®ãÂÅöÁªü‰∏ÄÁÆ°ÁêÜ„ÄÇ  Á∫øÁ®ãÊ±†ÁöÑÂéüÁêÜ Java‰∏≠ÁöÑÁ∫øÁ®ãÊ±†È°∂Â±ÇÊé•Âè£ÊòØExecutorÊé•Âè£ÔºåThreadPoolExecutorÊòØËøô‰∏™Êé•Âè£ÁöÑÂÆûÁé∞Á±ª„ÄÇ
Êàë‰ª¨ÂÖàÁúãÁúãThreadPoolExecutorÁ±ª„ÄÇ
ThreadPoolExecutorÊèê‰æõÁöÑÊûÑÈÄ†ÊñπÊ≥ï ‰∏ÄÂÖ±ÊúâÂõõ‰∏™ÊûÑÈÄ†ÊñπÊ≥ïÔºö
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  // ‰∫î‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞ public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue) // ÂÖ≠‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞-1 public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue, ThreadFactory threadFactory) // ÂÖ≠‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞-2 public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue, RejectedExecutionHandler handler) // ‰∏É‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞ public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler)   Ê∂âÂèäÂà∞5~7‰∏™ÂèÇÊï∞ÔºåÊàë‰ª¨ÂÖàÁúãÁúãÂøÖÈ°ªÁöÑ5‰∏™ÂèÇÊï∞ÊòØ‰ªÄ‰πàÊÑèÊÄùÔºö'>
<meta property='og:url' content='https://ahao.ink/posts/java%E5%B9%B6%E5%8F%91-jdk%E5%B7%A5%E5%85%B7%E7%AF%87/'>
<meta property='og:site_name' content='ahao&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Âπ∂Âèë' /><meta property='article:published_time' content='2021-04-07T13:36:41&#43;00:00'/><meta property='article:modified_time' content='2022-03-18T08:28:31&#43;00:00'/><meta property='og:image' content='https://ahao.ink/14.jpg' />
<meta name="twitter:title" content="JavaÂπ∂Âèë JDKÂ∑•ÂÖ∑ÁØá">
<meta name="twitter:description" content="Á∫øÁ®ãÊ±†ÂéüÁêÜ ‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®Á∫øÁ®ãÊ±† ‰ΩøÁî®Á∫øÁ®ãÊ±†‰∏ªË¶ÅÊúâ‰ª•‰∏ã‰∏â‰∏™ÂéüÂõ†Ôºö
 ÂàõÂª∫/ÈîÄÊØÅÁ∫øÁ®ãÈúÄË¶ÅÊ∂àËÄóÁ≥ªÁªüËµÑÊ∫êÔºåÁ∫øÁ®ãÊ±†ÂèØ‰ª•Â§çÁî®Â∑≤ÂàõÂª∫ÁöÑÁ∫øÁ®ã„ÄÇ ÊéßÂà∂Âπ∂ÂèëÁöÑÊï∞Èáè„ÄÇÂπ∂ÂèëÊï∞ÈáèËøáÂ§öÔºåÂèØËÉΩ‰ºöÂØºËá¥ËµÑÊ∫êÊ∂àËÄóËøáÂ§öÔºå‰ªéËÄåÈÄ†ÊàêÊúçÂä°Âô®Â¥©Ê∫É„ÄÇÔºà‰∏ªË¶ÅÂéüÂõ†Ôºâ ÂèØ‰ª•ÂØπÁ∫øÁ®ãÂÅöÁªü‰∏ÄÁÆ°ÁêÜ„ÄÇ  Á∫øÁ®ãÊ±†ÁöÑÂéüÁêÜ Java‰∏≠ÁöÑÁ∫øÁ®ãÊ±†È°∂Â±ÇÊé•Âè£ÊòØExecutorÊé•Âè£ÔºåThreadPoolExecutorÊòØËøô‰∏™Êé•Âè£ÁöÑÂÆûÁé∞Á±ª„ÄÇ
Êàë‰ª¨ÂÖàÁúãÁúãThreadPoolExecutorÁ±ª„ÄÇ
ThreadPoolExecutorÊèê‰æõÁöÑÊûÑÈÄ†ÊñπÊ≥ï ‰∏ÄÂÖ±ÊúâÂõõ‰∏™ÊûÑÈÄ†ÊñπÊ≥ïÔºö
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31  // ‰∫î‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞ public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue) // ÂÖ≠‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞-1 public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue, ThreadFactory threadFactory) // ÂÖ≠‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞-2 public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue, RejectedExecutionHandler handler) // ‰∏É‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞ public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&amp;lt;Runnable&amp;gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler)   Ê∂âÂèäÂà∞5~7‰∏™ÂèÇÊï∞ÔºåÊàë‰ª¨ÂÖàÁúãÁúãÂøÖÈ°ªÁöÑ5‰∏™ÂèÇÊï∞ÊòØ‰ªÄ‰πàÊÑèÊÄùÔºö"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://ahao.ink/14.jpg' />
    <link rel="shortcut icon" href="img/avatar_hua8acc2063f8134c9d13980a8a63800c2_11114_300x0_resize_box_3.png" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hua8acc2063f8134c9d13980a8a63800c2_11114_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üê∑</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ahao&#39;s Blog</a></h1>
            <h2 class="site-description">ÈÅìÈòª‰∏îÈïøÔºåË°åÂàôÂ∞ÜËá≥</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/'
                        target="_blank"
                        title="GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ / Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>ÂΩíÊ°£ / Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>ÊêúÁ¥¢ / Search</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é / About</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>ÊöóËâ≤Ê®°Âºè</span>
                </li>
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/posts/java%E5%B9%B6%E5%8F%91-jdk%E5%B7%A5%E5%85%B7%E7%AF%87/">
                
                    <img src="/14.jpg" loading="lazy" alt="Featured image of post JavaÂπ∂Âèë JDKÂ∑•ÂÖ∑ÁØá" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/java/" >
                Java
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/posts/java%E5%B9%B6%E5%8F%91-jdk%E5%B7%A5%E5%85%B7%E7%AF%87/">JavaÂπ∂Âèë JDKÂ∑•ÂÖ∑ÁØá</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2021Âπ¥4Êúà7Êó•</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 33 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <h2 id="Á∫øÁ®ãÊ±†ÂéüÁêÜ">Á∫øÁ®ãÊ±†ÂéüÁêÜ</h2>
<h3 id="‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®Á∫øÁ®ãÊ±†">‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®Á∫øÁ®ãÊ±†</h3>
<p>‰ΩøÁî®Á∫øÁ®ãÊ±†‰∏ªË¶ÅÊúâ‰ª•‰∏ã‰∏â‰∏™ÂéüÂõ†Ôºö</p>
<ol>
<li>ÂàõÂª∫/ÈîÄÊØÅÁ∫øÁ®ãÈúÄË¶ÅÊ∂àËÄóÁ≥ªÁªüËµÑÊ∫êÔºåÁ∫øÁ®ãÊ±†ÂèØ‰ª•<strong>Â§çÁî®Â∑≤ÂàõÂª∫ÁöÑÁ∫øÁ®ã</strong>„ÄÇ</li>
<li><strong>ÊéßÂà∂Âπ∂ÂèëÁöÑÊï∞Èáè</strong>„ÄÇÂπ∂ÂèëÊï∞ÈáèËøáÂ§öÔºåÂèØËÉΩ‰ºöÂØºËá¥ËµÑÊ∫êÊ∂àËÄóËøáÂ§öÔºå‰ªéËÄåÈÄ†ÊàêÊúçÂä°Âô®Â¥©Ê∫É„ÄÇÔºà‰∏ªË¶ÅÂéüÂõ†Ôºâ</li>
<li><strong>ÂèØ‰ª•ÂØπÁ∫øÁ®ãÂÅöÁªü‰∏ÄÁÆ°ÁêÜ</strong>„ÄÇ</li>
</ol>
<h3 id="Á∫øÁ®ãÊ±†ÁöÑÂéüÁêÜ">Á∫øÁ®ãÊ±†ÁöÑÂéüÁêÜ</h3>
<p>Java‰∏≠ÁöÑÁ∫øÁ®ãÊ±†È°∂Â±ÇÊé•Âè£ÊòØ<code>Executor</code>Êé•Âè£Ôºå<code>ThreadPoolExecutor</code>ÊòØËøô‰∏™Êé•Âè£ÁöÑÂÆûÁé∞Á±ª„ÄÇ</p>
<p>Êàë‰ª¨ÂÖàÁúãÁúã<code>ThreadPoolExecutor</code>Á±ª„ÄÇ</p>
<h4 id="threadpoolexecutorÊèê‰æõÁöÑÊûÑÈÄ†ÊñπÊ≥ï">ThreadPoolExecutorÊèê‰æõÁöÑÊûÑÈÄ†ÊñπÊ≥ï</h4>
<p>‰∏ÄÂÖ±ÊúâÂõõ‰∏™ÊûÑÈÄ†ÊñπÊ≥ïÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ‰∫î‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÂÖ≠‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞-1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">ThreadFactory</span> <span class="n">threadFactory</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÂÖ≠‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞-2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">RejectedExecutionHandler</span> <span class="n">handler</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ‰∏É‰∏™ÂèÇÊï∞ÁöÑÊûÑÈÄ†ÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">ThreadFactory</span> <span class="n">threadFactory</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">RejectedExecutionHandler</span> <span class="n">handler</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê∂âÂèäÂà∞5~7‰∏™ÂèÇÊï∞ÔºåÊàë‰ª¨ÂÖàÁúãÁúãÂøÖÈ°ªÁöÑ5‰∏™ÂèÇÊï∞ÊòØ‰ªÄ‰πàÊÑèÊÄùÔºö</p>
<ul>
<li>
<p><strong>int corePoolSize</strong>ÔºöËØ•Á∫øÁ®ãÊ±†‰∏≠<strong>Ê†∏ÂøÉÁ∫øÁ®ãÊï∞ÊúÄÂ§ßÂÄº</strong></p>
<blockquote>
<p>Ê†∏ÂøÉÁ∫øÁ®ãÔºöÁ∫øÁ®ãÊ±†‰∏≠Êúâ‰∏§Á±ªÁ∫øÁ®ãÔºåÊ†∏ÂøÉÁ∫øÁ®ãÂíåÈùûÊ†∏ÂøÉÁ∫øÁ®ã„ÄÇÊ†∏ÂøÉÁ∫øÁ®ãÈªòËÆ§ÊÉÖÂÜµ‰∏ã‰ºö‰∏ÄÁõ¥Â≠òÂú®‰∫éÁ∫øÁ®ãÊ±†‰∏≠ÔºåÂç≥‰ΩøËøô‰∏™Ê†∏ÂøÉÁ∫øÁ®ã‰ªÄ‰πàÈÉΩ‰∏çÂπ≤ÔºàÈìÅÈ•≠Á¢óÔºâÔºåËÄåÈùûÊ†∏ÂøÉÁ∫øÁ®ãÂ¶ÇÊûúÈïøÊó∂Èó¥ÁöÑÈó≤ÁΩÆÔºåÂ∞±‰ºöË¢´ÈîÄÊØÅÔºà‰∏¥Êó∂Â∑•Ôºâ„ÄÇ</p>
</blockquote>
</li>
<li>
<p><strong>int maximumPoolSize</strong>ÔºöËØ•Á∫øÁ®ãÊ±†‰∏≠<strong>Á∫øÁ®ãÊÄªÊï∞ÊúÄÂ§ßÂÄº</strong> „ÄÇ</p>
<blockquote>
<p>ËØ•ÂÄºÁ≠â‰∫éÊ†∏ÂøÉÁ∫øÁ®ãÊï∞Èáè + ÈùûÊ†∏ÂøÉÁ∫øÁ®ãÊï∞Èáè„ÄÇ</p>
</blockquote>
</li>
<li>
<p><strong>long keepAliveTime</strong>Ôºö<strong>ÈùûÊ†∏ÂøÉÁ∫øÁ®ãÈó≤ÁΩÆË∂ÖÊó∂Êó∂Èïø</strong>„ÄÇ</p>
<blockquote>
<p>ÈùûÊ†∏ÂøÉÁ∫øÁ®ãÂ¶ÇÊûúÂ§Ñ‰∫éÈó≤ÁΩÆÁä∂ÊÄÅË∂ÖËøáËØ•ÂÄºÔºåÂ∞±‰ºöË¢´ÈîÄÊØÅ„ÄÇÂ¶ÇÊûúËÆæÁΩÆallowCoreThreadTimeOut(true)ÔºåÂàô‰ºö‰πü‰ΩúÁî®‰∫éÊ†∏ÂøÉÁ∫øÁ®ã„ÄÇ</p>
</blockquote>
</li>
<li>
<p><strong>TimeUnit unit</strong>ÔºökeepAliveTimeÁöÑÂçï‰Ωç„ÄÇ</p>
</li>
</ul>
<p>TimeUnitÊòØ‰∏Ä‰∏™Êûö‰∏æÁ±ªÂûã ÔºåÂåÖÊã¨‰ª•‰∏ãÂ±ûÊÄßÔºö</p>
<blockquote>
<p>NANOSECONDS Ôºö 1ÂæÆÊØ´Áßí = 1ÂæÆÁßí / 1000 MICROSECONDS Ôºö 1ÂæÆÁßí = 1ÊØ´Áßí / 1000 MILLISECONDS Ôºö 1ÊØ´Áßí = 1Áßí /1000 SECONDS Ôºö Áßí MINUTES Ôºö ÂàÜ HOURS Ôºö Â∞èÊó∂ DAYS Ôºö Â§©</p>
</blockquote>
<ul>
<li>
<p><strong>BlockingQueue workQueue</strong>ÔºöÈòªÂ°ûÈòüÂàóÔºåÁª¥Êä§ÁùÄ<strong>Á≠âÂæÖÊâßË°åÁöÑRunnable‰ªªÂä°ÂØπË±°</strong>„ÄÇ</p>
<p>Â∏∏Áî®ÁöÑÂá†‰∏™ÈòªÂ°ûÈòüÂàóÔºö</p>
<ol>
<li>
<p><strong>LinkedBlockingQueue</strong></p>
<p>ÈìæÂºèÈòªÂ°ûÈòüÂàóÔºåÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÊòØÈìæË°®ÔºåÈªòËÆ§Â§ßÂ∞èÊòØ<code>Integer.MAX_VALUE</code>Ôºå‰πüÂèØ‰ª•ÊåáÂÆöÂ§ßÂ∞è„ÄÇ</p>
</li>
<li>
<p><strong>ArrayBlockingQueue</strong></p>
<p>Êï∞ÁªÑÈòªÂ°ûÈòüÂàóÔºåÂ∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÊòØÊï∞ÁªÑÔºåÈúÄË¶ÅÊåáÂÆöÈòüÂàóÁöÑÂ§ßÂ∞è„ÄÇ</p>
</li>
<li>
<p><strong>SynchronousQueue</strong></p>
<p>ÂêåÊ≠•ÈòüÂàóÔºåÂÜÖÈÉ®ÂÆπÈáè‰∏∫0ÔºåÊØè‰∏™putÊìç‰ΩúÂøÖÈ°ªÁ≠âÂæÖ‰∏Ä‰∏™takeÊìç‰ΩúÔºåÂèç‰πã‰∫¶ÁÑ∂„ÄÇ</p>
</li>
<li>
<p><strong>DelayQueue</strong></p>
<p>Âª∂ËøüÈòüÂàóÔºåËØ•ÈòüÂàó‰∏≠ÁöÑÂÖÉÁ¥†Âè™ÊúâÂΩìÂÖ∂ÊåáÂÆöÁöÑÂª∂ËøüÊó∂Èó¥Âà∞‰∫ÜÔºåÊâçËÉΩÂ§ü‰ªéÈòüÂàó‰∏≠Ëé∑ÂèñÂà∞ËØ•ÂÖÉÁ¥† „ÄÇ</p>
</li>
</ol>
</li>
</ul>
<blockquote>
<p>Êàë‰ª¨Â∞ÜÂú®‰∏ã‰∏ÄÁ´†‰∏≠ÈáçÁÇπ‰ªãÁªçÂêÑÁßçÈòªÂ°ûÈòüÂàó</p>
</blockquote>
<p>Â•Ω‰∫ÜÔºå‰ªãÁªçÂÆå5‰∏™ÂøÖÈ°ªÁöÑÂèÇÊï∞‰πãÂêéÔºåËøòÊúâ‰∏§‰∏™ÈùûÂøÖÈ°ªÁöÑÂèÇÊï∞„ÄÇ</p>
<ul>
<li>
<p><strong>ThreadFactory threadFactory</strong></p>
<p>ÂàõÂª∫Á∫øÁ®ãÁöÑÂ∑•ÂéÇ ÔºåÁî®‰∫éÊâπÈáèÂàõÂª∫Á∫øÁ®ãÔºåÁªü‰∏ÄÂú®ÂàõÂª∫Á∫øÁ®ãÊó∂ËÆæÁΩÆ‰∏Ä‰∫õÂèÇÊï∞ÔºåÂ¶ÇÊòØÂê¶ÂÆàÊä§Á∫øÁ®ã„ÄÅÁ∫øÁ®ãÁöÑ‰ºòÂÖàÁ∫ßÁ≠â„ÄÇÂ¶ÇÊûú‰∏çÊåáÂÆöÔºå‰ºöÊñ∞Âª∫‰∏Ä‰∏™ÈªòËÆ§ÁöÑÁ∫øÁ®ãÂ∑•ÂéÇ„ÄÇ</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">static</span> <span class="kd">class</span> <span class="nc">DefaultThreadFactory</span> <span class="kd">implements</span> <span class="n">ThreadFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÁúÅÁï•Â±ûÊÄß
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ÊûÑÈÄ†ÂáΩÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">DefaultThreadFactory</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">SecurityManager</span> <span class="n">s</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getSecurityManager</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">group</span> <span class="o">=</span> <span class="o">(</span><span class="n">s</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">s</span><span class="o">.</span><span class="na">getThreadGroup</span><span class="o">()</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getThreadGroup</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">namePrefix</span> <span class="o">=</span> <span class="s">&#34;pool-&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">            <span class="n">poolNumber</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">()</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;-thread-&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ÁúÅÁï•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><strong>RejectedExecutionHandler handler</strong></p>
<p><strong>ÊãíÁªùÂ§ÑÁêÜÁ≠ñÁï•</strong>ÔºåÁ∫øÁ®ãÊï∞ÈáèÂ§ß‰∫éÊúÄÂ§ßÁ∫øÁ®ãÊï∞Â∞±‰ºöÈááÁî®ÊãíÁªùÂ§ÑÁêÜÁ≠ñÁï•ÔºåÂõõÁßçÊãíÁªùÂ§ÑÁêÜÁöÑÁ≠ñÁï•‰∏∫ Ôºö</p>
<ol>
<li><strong>ThreadPoolExecutor.AbortPolicy</strong>Ôºö<strong>ÈªòËÆ§ÊãíÁªùÂ§ÑÁêÜÁ≠ñÁï•</strong>Ôºå‰∏¢ÂºÉ‰ªªÂä°Âπ∂ÊäõÂá∫RejectedExecutionExceptionÂºÇÂ∏∏„ÄÇ</li>
<li><strong>ThreadPoolExecutor.DiscardPolicy</strong>Ôºö‰∏¢ÂºÉÊñ∞Êù•ÁöÑ‰ªªÂä°Ôºå‰ΩÜÊòØ‰∏çÊäõÂá∫ÂºÇÂ∏∏„ÄÇ</li>
<li><strong>ThreadPoolExecutor.DiscardOldestPolicy</strong>Ôºö‰∏¢ÂºÉÈòüÂàóÂ§¥ÈÉ®ÔºàÊúÄÊóßÁöÑÔºâÁöÑ‰ªªÂä°ÔºåÁÑ∂ÂêéÈáçÊñ∞Â∞ùËØïÊâßË°åÁ®ãÂ∫èÔºàÂ¶ÇÊûúÂÜçÊ¨°Â§±Ë¥•ÔºåÈáçÂ§çÊ≠§ËøáÁ®ãÔºâ„ÄÇ</li>
<li><strong>ThreadPoolExecutor.CallerRunsPolicy</strong>ÔºöÁî±Ë∞ÉÁî®Á∫øÁ®ãÂ§ÑÁêÜËØ•‰ªªÂä°„ÄÇ</li>
</ol>
</li>
</ul>
<h4 id="threadpoolexecutorÁöÑÁ≠ñÁï•">ThreadPoolExecutorÁöÑÁ≠ñÁï•</h4>
<p>Á∫øÁ®ãÊ±†Êú¨Ë∫´Êúâ‰∏Ä‰∏™Ë∞ÉÂ∫¶Á∫øÁ®ãÔºåËøô‰∏™Á∫øÁ®ãÂ∞±ÊòØÁî®‰∫éÁÆ°ÁêÜÂ∏ÉÊéßÊï¥‰∏™Á∫øÁ®ãÊ±†ÈáåÁöÑÂêÑÁßç‰ªªÂä°Âíå‰∫ãÂä°Ôºå‰æãÂ¶ÇÂàõÂª∫Á∫øÁ®ã„ÄÅÈîÄÊØÅÁ∫øÁ®ã„ÄÅ‰ªªÂä°ÈòüÂàóÁÆ°ÁêÜ„ÄÅÁ∫øÁ®ãÈòüÂàóÁÆ°ÁêÜÁ≠âÁ≠â„ÄÇ</p>
<p>ÊïÖÁ∫øÁ®ãÊ±†‰πüÊúâËá™Â∑±ÁöÑÁä∂ÊÄÅ„ÄÇ<code>ThreadPoolExecutor</code>Á±ª‰∏≠‰ΩøÁî®‰∫Ü‰∏Ä‰∫õ<code>final int</code>Â∏∏ÈáèÂèòÈáèÊù•Ë°®Á§∫Á∫øÁ®ãÊ±†ÁöÑÁä∂ÊÄÅ ÔºåÂàÜÂà´‰∏∫RUNNING„ÄÅSHUTDOWN„ÄÅSTOP„ÄÅTIDYING „ÄÅTERMINATED„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// runState is stored in the high-order bits
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">RUNNING</span>    <span class="o">=</span> <span class="o">-</span><span class="n">1</span> <span class="o">&lt;&lt;</span> <span class="n">COUNT_BITS</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SHUTDOWN</span>   <span class="o">=</span>  <span class="n">0</span> <span class="o">&lt;&lt;</span> <span class="n">COUNT_BITS</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">STOP</span>       <span class="o">=</span>  <span class="n">1</span> <span class="o">&lt;&lt;</span> <span class="n">COUNT_BITS</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TIDYING</span>    <span class="o">=</span>  <span class="n">2</span> <span class="o">&lt;&lt;</span> <span class="n">COUNT_BITS</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TERMINATED</span> <span class="o">=</span>  <span class="n">3</span> <span class="o">&lt;&lt;</span> <span class="n">COUNT_BITS</span><span class="o">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Á∫øÁ®ãÊ±†ÂàõÂª∫ÂêéÂ§Ñ‰∫é<strong>RUNNING</strong>Áä∂ÊÄÅ„ÄÇ</p>
</li>
<li>
<p>Ë∞ÉÁî®shutdown()ÊñπÊ≥ïÂêéÂ§Ñ‰∫é<strong>SHUTDOWN</strong>Áä∂ÊÄÅÔºåÁ∫øÁ®ãÊ±†‰∏çËÉΩÊé•ÂèóÊñ∞ÁöÑ‰ªªÂä°ÔºåÊ∏ÖÈô§‰∏Ä‰∫õÁ©∫Èó≤worker,‰ºöÁ≠âÂæÖÈòªÂ°ûÈòüÂàóÁöÑ‰ªªÂä°ÂÆåÊàê„ÄÇ</p>
</li>
<li>
<p>Ë∞ÉÁî®shutdownNow()ÊñπÊ≥ïÂêéÂ§Ñ‰∫é<strong>STOP</strong>Áä∂ÊÄÅÔºåÁ∫øÁ®ãÊ±†‰∏çËÉΩÊé•ÂèóÊñ∞ÁöÑ‰ªªÂä°Ôºå‰∏≠Êñ≠ÊâÄÊúâÁ∫øÁ®ãÔºåÈòªÂ°ûÈòüÂàó‰∏≠Ê≤°ÊúâË¢´ÊâßË°åÁöÑ‰ªªÂä°ÂÖ®ÈÉ®‰∏¢ÂºÉ„ÄÇÊ≠§Êó∂Ôºåpoolsize=0,ÈòªÂ°ûÈòüÂàóÁöÑsize‰πü‰∏∫0„ÄÇ</p>
</li>
<li>
<p>ÂΩìÊâÄÊúâÁöÑ‰ªªÂä°Â∑≤ÁªàÊ≠¢ÔºåctlËÆ∞ÂΩïÁöÑ‚Äù‰ªªÂä°Êï∞Èáè‚Äù‰∏∫0ÔºåÁ∫øÁ®ãÊ±†‰ºöÂèò‰∏∫<strong>TIDYING</strong>Áä∂ÊÄÅ„ÄÇÊé•ÁùÄ‰ºöÊâßË°återminated()ÂáΩÊï∞„ÄÇ</p>
<blockquote>
<p>ThreadPoolExecutor‰∏≠Êúâ‰∏Ä‰∏™ÊéßÂà∂Áä∂ÊÄÅÁöÑÂ±ûÊÄßÂè´<code>ctl</code>ÔºåÂÆÉÊòØ‰∏Ä‰∏™AtomicIntegerÁ±ªÂûãÁöÑÂèòÈáè„ÄÇÁ∫øÁ®ãÊ±†Áä∂ÊÄÅÂ∞±ÊòØÈÄöËøáAtomicIntegerÁ±ªÂûãÁöÑÊàêÂëòÂèòÈáè<code>ctl</code>Êù•Ëé∑ÂèñÁöÑ„ÄÇ</p>
<p>Ëé∑ÂèñÁöÑ<code>ctl</code>ÂÄº‰º†ÂÖ•<code>runStateOf</code>ÊñπÊ≥ïÔºå‰∏é<code>~CAPACITY</code>‰Ωç‰∏éËøêÁÆó(<code>CAPACITY</code>ÊòØ‰Ωé29‰ΩçÂÖ®1ÁöÑintÂèòÈáè)„ÄÇ</p>
<p><code>~CAPACITY</code>Âú®ËøôÈáåÁõ∏ÂΩì‰∫éÊé©Á†ÅÔºåÁî®Êù•Ëé∑ÂèñctlÁöÑÈ´ò3‰ΩçÔºåË°®Á§∫Á∫øÁ®ãÊ±†Áä∂ÊÄÅÔºõËÄåÂè¶Â§ñÁöÑ‰Ωé29‰ΩçÁî®‰∫éË°®Á§∫Â∑•‰ΩúÁ∫øÁ®ãÊï∞</p>
</blockquote>
</li>
<li>
<p>Á∫øÁ®ãÊ±†Â§ÑÂú®TIDYINGÁä∂ÊÄÅÊó∂Ôºå<strong>ÊâßË°åÂÆåterminated()ÊñπÊ≥ï‰πãÂêé</strong>ÔºåÂ∞±‰ºöÁî± <strong>TIDYING -&gt; TERMINATED</strong>Ôºå Á∫øÁ®ãÊ±†Ë¢´ËÆæÁΩÆ‰∏∫TERMINATEDÁä∂ÊÄÅ„ÄÇ</p>
</li>
</ul>
<h4 id="Á∫øÁ®ãÊ±†‰∏ªË¶ÅÁöÑ‰ªªÂä°Â§ÑÁêÜÊµÅÁ®ã">Á∫øÁ®ãÊ±†‰∏ªË¶ÅÁöÑ‰ªªÂä°Â§ÑÁêÜÊµÅÁ®ã</h4>
<p>Â§ÑÁêÜ‰ªªÂä°ÁöÑÊ†∏ÂøÉÊñπÊ≥ïÊòØ<code>execute</code>ÔºåÊàë‰ª¨ÁúãÁúã JDK 1.8 Ê∫êÁ†Å‰∏≠<code>ThreadPoolExecutor</code>ÊòØÂ¶Ç‰ΩïÂ§ÑÁêÜÁ∫øÁ®ã‰ªªÂä°ÁöÑÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// JDK 1.8 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">command</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">NullPointerException</span><span class="o">();</span>   
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1.ÂΩìÂâçÁ∫øÁ®ãÊï∞Â∞è‰∫écorePoolSize,ÂàôË∞ÉÁî®addWorkerÂàõÂª∫Ê†∏ÂøÉÁ∫øÁ®ãÊâßË°å‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">workerCountOf</span><span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">corePoolSize</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">if</span> <span class="o">(</span><span class="n">addWorker</span><span class="o">(</span><span class="n">command</span><span class="o">,</span> <span class="kc">true</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">           <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">c</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 2.Â¶ÇÊûú‰∏çÂ∞è‰∫écorePoolSizeÔºåÂàôÂ∞Ü‰ªªÂä°Ê∑ªÂä†Âà∞workQueueÈòüÂàó„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">isRunning</span><span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">workQueue</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="n">command</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">recheck</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 2.1 Â¶ÇÊûúisRunningËøîÂõûfalse(Áä∂ÊÄÅÊ£ÄÊü•)ÔºåÂàôremoveËøô‰∏™‰ªªÂä°ÔºåÁÑ∂ÂêéÊâßË°åÊãíÁªùÁ≠ñÁï•„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span> <span class="n">isRunning</span><span class="o">(</span><span class="n">recheck</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">remove</span><span class="o">(</span><span class="n">command</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">reject</span><span class="o">(</span><span class="n">command</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 2.2 Á∫øÁ®ãÊ±†Â§Ñ‰∫érunningÁä∂ÊÄÅÔºå‰ΩÜÊòØÊ≤°ÊúâÁ∫øÁ®ãÔºåÂàôÂàõÂª∫Á∫øÁ®ã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">workerCountOf</span><span class="o">(</span><span class="n">recheck</span><span class="o">)</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">addWorker</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 3.Â¶ÇÊûúÊîæÂÖ•workQueueÂ§±Ë¥•ÔºåÂàôÂàõÂª∫ÈùûÊ†∏ÂøÉÁ∫øÁ®ãÊâßË°å‰ªªÂä°Ôºå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Â¶ÇÊûúËøôÊó∂ÂàõÂª∫ÈùûÊ†∏ÂøÉÁ∫øÁ®ãÂ§±Ë¥•(ÂΩìÂâçÁ∫øÁ®ãÊÄªÊï∞‰∏çÂ∞è‰∫émaximumPoolSizeÊó∂)ÔºåÂ∞±‰ºöÊâßË°åÊãíÁªùÁ≠ñÁï•„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">addWorker</span><span class="o">(</span><span class="n">command</span><span class="o">,</span> <span class="kc">false</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">         <span class="n">reject</span><span class="o">(</span><span class="n">command</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ctl.get()</code>ÊòØËé∑ÂèñÁ∫øÁ®ãÊ±†Áä∂ÊÄÅÔºåÁî®<code>int</code>Á±ªÂûãË°®Á§∫„ÄÇÁ¨¨‰∫åÊ≠•‰∏≠ÔºåÂÖ•ÈòüÂâçËøõË°å‰∫Ü‰∏ÄÊ¨°<code>isRunning</code>Âà§Êñ≠ÔºåÂÖ•Èòü‰πãÂêéÔºåÂèàËøõË°å‰∫Ü‰∏ÄÊ¨°<code>isRunning</code>Âà§Êñ≠„ÄÇ</p>
<p><strong>‰∏∫‰ªÄ‰πàË¶Å‰∫åÊ¨°Ê£ÄÊü•Á∫øÁ®ãÊ±†ÁöÑÁä∂ÊÄÅ?</strong></p>
<p>Âú®Â§öÁ∫øÁ®ãÁöÑÁéØÂ¢É‰∏ãÔºåÁ∫øÁ®ãÊ±†ÁöÑÁä∂ÊÄÅÊòØÊó∂ÂàªÂèëÁîüÂèòÂåñÁöÑ„ÄÇÂæàÊúâÂèØËÉΩÂàöËé∑ÂèñÁ∫øÁ®ãÊ±†Áä∂ÊÄÅÂêéÁ∫øÁ®ãÊ±†Áä∂ÊÄÅÂ∞±ÊîπÂèò‰∫Ü„ÄÇÂà§Êñ≠ÊòØÂê¶Â∞Ü<code>command</code>Âä†ÂÖ•<code>workqueue</code>ÊòØÁ∫øÁ®ãÊ±†‰πãÂâçÁöÑÁä∂ÊÄÅ„ÄÇÂÄòËã•Ê≤°Êúâ‰∫åÊ¨°Ê£ÄÊü•Ôºå‰∏á‰∏ÄÁ∫øÁ®ãÊ±†Â§Ñ‰∫éÈùû<strong>RUNNING</strong>Áä∂ÊÄÅÔºàÂú®Â§öÁ∫øÁ®ãÁéØÂ¢É‰∏ãÂæàÊúâÂèØËÉΩÂèëÁîüÔºâÔºåÈÇ£‰πà<code>command</code>Ê∞∏Ëøú‰∏ç‰ºöÊâßË°å„ÄÇ</p>
<p><strong>ÊÄªÁªì‰∏Ä‰∏ãÂ§ÑÁêÜÊµÅÁ®ã</strong></p>
<ol>
<li>Á∫øÁ®ãÊÄªÊï∞Èáè &lt; corePoolSizeÔºåÊó†ËÆ∫Á∫øÁ®ãÊòØÂê¶Á©∫Èó≤ÔºåÈÉΩ‰ºöÊñ∞Âª∫‰∏Ä‰∏™Ê†∏ÂøÉÁ∫øÁ®ãÊâßË°å‰ªªÂä°ÔºàËÆ©Ê†∏ÂøÉÁ∫øÁ®ãÊï∞ÈáèÂø´ÈÄüËææÂà∞corePoolSizeÔºåÂú®Ê†∏ÂøÉÁ∫øÁ®ãÊï∞Èáè &lt; corePoolSizeÊó∂Ôºâ„ÄÇ<strong>Ê≥®ÊÑèÔºåËøô‰∏ÄÊ≠•ÈúÄË¶ÅËé∑ÂæóÂÖ®Â±ÄÈîÅ„ÄÇ</strong></li>
<li>Á∫øÁ®ãÊÄªÊï∞Èáè &gt;= corePoolSizeÊó∂ÔºåÊñ∞Êù•ÁöÑÁ∫øÁ®ã‰ªªÂä°‰ºöËøõÂÖ•‰ªªÂä°ÈòüÂàó‰∏≠Á≠âÂæÖÔºåÁÑ∂ÂêéÁ©∫Èó≤ÁöÑÊ†∏ÂøÉÁ∫øÁ®ã‰ºö‰æùÊ¨°ÂéªÁºìÂ≠òÈòüÂàó‰∏≠Âèñ‰ªªÂä°Êù•ÊâßË°åÔºà‰ΩìÁé∞‰∫Ü<strong>Á∫øÁ®ãÂ§çÁî®</strong>Ôºâ„ÄÇ</li>
<li>ÂΩìÁºìÂ≠òÈòüÂàóÊª°‰∫ÜÔºåËØ¥ÊòéËøô‰∏™Êó∂ÂÄô‰ªªÂä°Â∑≤ÁªèÂ§öÂà∞ÁàÜÊ£öÔºåÈúÄË¶Å‰∏Ä‰∫õ‚Äú‰∏¥Êó∂Â∑•‚ÄùÊù•ÊâßË°åËøô‰∫õ‰ªªÂä°‰∫Ü„ÄÇ‰∫éÊòØ‰ºöÂàõÂª∫ÈùûÊ†∏ÂøÉÁ∫øÁ®ãÂéªÊâßË°åËøô‰∏™‰ªªÂä°„ÄÇ<strong>Ê≥®ÊÑèÔºåËøô‰∏ÄÊ≠•ÈúÄË¶ÅËé∑ÂæóÂÖ®Â±ÄÈîÅ„ÄÇ</strong></li>
<li>ÁºìÂ≠òÈòüÂàóÊª°‰∫ÜÔºå ‰∏îÊÄªÁ∫øÁ®ãÊï∞ËææÂà∞‰∫ÜmaximumPoolSizeÔºåÂàô‰ºöÈááÂèñ‰∏äÈù¢ÊèêÂà∞ÁöÑÊãíÁªùÁ≠ñÁï•ËøõË°åÂ§ÑÁêÜ„ÄÇ</li>
</ol>
<p>Êï¥‰∏™ËøáÁ®ãÂ¶ÇÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="http://concurrent.redspider.group/article/03/imgs/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%BB%E8%A6%81%E7%9A%84%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.png"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<h4 id="threadpoolexecutorÂ¶Ç‰ΩïÂÅöÂà∞Á∫øÁ®ãÂ§çÁî®ÁöÑ">ThreadPoolExecutorÂ¶Ç‰ΩïÂÅöÂà∞Á∫øÁ®ãÂ§çÁî®ÁöÑÔºü</h4>
<p>Êàë‰ª¨Áü•ÈÅìÔºå‰∏Ä‰∏™Á∫øÁ®ãÂú®ÂàõÂª∫ÁöÑÊó∂ÂÄô‰ºöÊåáÂÆö‰∏Ä‰∏™Á∫øÁ®ã‰ªªÂä°ÔºåÂΩìÊâßË°åÂÆåËøô‰∏™Á∫øÁ®ã‰ªªÂä°‰πãÂêéÔºåÁ∫øÁ®ãËá™Âä®ÈîÄÊØÅ„ÄÇ‰ΩÜÊòØÁ∫øÁ®ãÊ±†Âç¥ÂèØ‰ª•Â§çÁî®Á∫øÁ®ãÔºåÂç≥‰∏Ä‰∏™Á∫øÁ®ãÊâßË°åÂÆåÁ∫øÁ®ã‰ªªÂä°Âêé‰∏çÈîÄÊØÅÔºåÁªßÁª≠ÊâßË°åÂè¶Â§ñÁöÑÁ∫øÁ®ã‰ªªÂä°„ÄÇ<strong>ÈÇ£‰πàÔºåÁ∫øÁ®ãÊ±†Â¶Ç‰ΩïÂÅöÂà∞Á∫øÁ®ãÂ§çÁî®Âë¢Ôºü</strong></p>
<p>ÂéüÊù•ÔºåThreadPoolExecutorÂú®ÂàõÂª∫Á∫øÁ®ãÊó∂Ôºå‰ºöÂ∞ÜÁ∫øÁ®ãÂ∞ÅË£ÖÊàê<strong>Â∑•‰ΩúÁ∫øÁ®ãworker</strong>,Âπ∂ÊîæÂÖ•<strong>Â∑•‰ΩúÁ∫øÁ®ãÁªÑ</strong>‰∏≠ÔºåÁÑ∂ÂêéËøô‰∏™workerÂèçÂ§ç‰ªéÈòªÂ°ûÈòüÂàó‰∏≠Êãø‰ªªÂä°ÂéªÊâßË°å„ÄÇËØù‰∏çÂ§öËØ¥ÔºåÊàë‰ª¨ÁªßÁª≠ÁúãÁúãÊ∫êÁ†ÅÔºà‰∏ÄÂÆöË¶Å‰ªîÁªÜÁúãÔºåÂâçÂêéÊúâËÅîÁ≥ªÔºâ</p>
<p>ËøôÈáåÁöÑ<code>addWorker</code>ÊñπÊ≥ïÊòØÂú®‰∏äÈù¢ÊèêÂà∞ÁöÑ<code>execute</code>ÊñπÊ≥ïÈáåÈù¢Ë∞ÉÁî®ÁöÑÔºåÂÖàÁúãÁúã‰∏äÂçäÈÉ®ÂàÜÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ThreadPoolExecutor.addWorkerÊñπÊ≥ïÊ∫êÁ†Å‰∏äÂçäÈÉ®ÂàÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">addWorker</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">firstTask</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">core</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">retry</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(;;)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">runStateOf</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Check if queue empty only if necessary.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">rs</span> <span class="o">&gt;=</span> <span class="n">SHUTDOWN</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">            <span class="o">!</span> <span class="o">(</span><span class="n">rs</span> <span class="o">==</span> <span class="n">SHUTDOWN</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">               <span class="n">firstTask</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">               <span class="o">!</span> <span class="n">workQueue</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()))</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(;;)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">wc</span> <span class="o">=</span> <span class="n">workerCountOf</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">wc</span> <span class="o">&gt;=</span> <span class="n">CAPACITY</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 1.Â¶ÇÊûúcoreÊòØture,ËØÅÊòéÈúÄË¶ÅÂàõÂª∫ÁöÑÁ∫øÁ®ã‰∏∫Ê†∏ÂøÉÁ∫øÁ®ãÔºåÂàôÂÖàÂà§Êñ≠ÂΩìÂâçÁ∫øÁ®ãÊòØÂê¶Â§ß‰∫éÊ†∏ÂøÉÁ∫øÁ®ã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// Â¶ÇÊûúcoreÊòØfalse,ËØÅÊòéÈúÄË¶ÅÂàõÂª∫ÁöÑÊòØÈùûÊ†∏ÂøÉÁ∫øÁ®ãÔºåÂàôÂÖàÂà§Êñ≠ÂΩìÂâçÁ∫øÁ®ãÊï∞ÊòØÂê¶Â§ß‰∫éÊÄªÁ∫øÁ®ãÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// Â¶ÇÊûú‰∏çÂ∞è‰∫éÔºåÂàôËøîÂõûfalse
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">wc</span> <span class="o">&gt;=</span> <span class="o">(</span><span class="n">core</span> <span class="o">?</span> <span class="n">corePoolSize</span> <span class="o">:</span> <span class="n">maximumPoolSize</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">compareAndIncrementWorkerCount</span><span class="o">(</span><span class="n">c</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span> <span class="n">retry</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">c</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>  <span class="c1">// Re-read ctl
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">runStateOf</span><span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="o">!=</span> <span class="n">rs</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span> <span class="n">retry</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// else CAS failed due to workerCount change; retry inner loop
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äÂçäÈÉ®ÂàÜ‰∏ªË¶ÅÊòØÂà§Êñ≠Á∫øÁ®ãÊï∞ÈáèÊòØÂê¶Ë∂ÖÂá∫ÈòàÂÄºÔºåË∂ÖËøá‰∫ÜÂ∞±ËøîÂõûfalse„ÄÇÊàë‰ª¨ÁªßÁª≠Áúã‰∏ãÂçäÈÉ®ÂàÜ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="c1">// ThreadPoolExecutor.addWorkerÊñπÊ≥ïÊ∫êÁ†Å‰∏ãÂçäÈÉ®ÂàÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">boolean</span> <span class="n">workerStarted</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">boolean</span> <span class="n">workerAdded</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Worker</span> <span class="n">w</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 1.ÂàõÂª∫‰∏Ä‰∏™workerÂØπË±°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">w</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Worker</span><span class="o">(</span><span class="n">firstTask</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 2.ÂÆû‰æãÂåñ‰∏Ä‰∏™ThreadÂØπË±°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">final</span> <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="na">thread</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">t</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 3.Á∫øÁ®ãÊ±†ÂÖ®Â±ÄÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kd">final</span> <span class="n">ReentrantLock</span> <span class="n">mainLock</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">mainLock</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">mainLock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Recheck while holding lock.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// Back out on ThreadFactory failure or if
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// shut down before lock acquired.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kt">int</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">runStateOf</span><span class="o">(</span><span class="n">ctl</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">rs</span> <span class="o">&lt;</span> <span class="n">SHUTDOWN</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                    <span class="o">(</span><span class="n">rs</span> <span class="o">==</span> <span class="n">SHUTDOWN</span> <span class="o">&amp;&amp;</span> <span class="n">firstTask</span> <span class="o">==</span> <span class="kc">null</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">isAlive</span><span class="o">())</span> <span class="c1">// precheck that t is startable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalThreadStateException</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">workers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">w</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">workers</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="o">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">largestPoolSize</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                        <span class="n">largestPoolSize</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">workerAdded</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">mainLock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">workerAdded</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 4.ÂêØÂä®Ëøô‰∏™Á∫øÁ®ã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">t</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">workerStarted</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span> <span class="n">workerStarted</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">addWorkerFailed</span><span class="o">(</span><span class="n">w</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">workerStarted</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂàõÂª∫<code>worker</code>ÂØπË±°ÔºåÂπ∂ÂàùÂßãÂåñ‰∏Ä‰∏™<code>Thread</code>ÂØπË±°ÔºåÁÑ∂ÂêéÂêØÂä®Ëøô‰∏™Á∫øÁ®ãÂØπË±°„ÄÇ</p>
<p>Êàë‰ª¨Êé•ÁùÄÁúãÁúã<code>Worker</code>Á±ªÔºå‰ªÖÂ±ïÁ§∫ÈÉ®ÂàÜÊ∫êÁ†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// WorkerÁ±ªÈÉ®ÂàÜÊ∫êÁ†Å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Worker</span> <span class="kd">extends</span> <span class="n">AbstractQueuedSynchronizer</span> <span class="kd">implements</span> <span class="n">Runnable</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="n">Thread</span> <span class="n">thread</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Runnable</span> <span class="n">firstTask</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Worker</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">firstTask</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">setState</span><span class="o">(-</span><span class="n">1</span><span class="o">);</span> <span class="c1">// inhibit interrupts until runWorker
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="o">.</span><span class="na">firstTask</span> <span class="o">=</span> <span class="n">firstTask</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">thread</span> <span class="o">=</span> <span class="n">getThreadFactory</span><span class="o">().</span><span class="na">newThread</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">runWorker</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ÂÖ∂‰Ωô‰ª£Á†ÅÁï•...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Worker</code>Á±ªÂÆûÁé∞‰∫Ü<code>Runnable</code>Êé•Âè£ÔºåÊâÄ‰ª•<code>Worker</code>‰πüÊòØ‰∏Ä‰∏™Á∫øÁ®ã‰ªªÂä°„ÄÇÂú®ÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ÔºåÂàõÂª∫‰∫Ü‰∏Ä‰∏™Á∫øÁ®ãÔºåÁ∫øÁ®ãÁöÑ‰ªªÂä°Â∞±ÊòØËá™Â∑±„ÄÇÊïÖ<code>addWorker</code>ÊñπÊ≥ïË∞ÉÁî®addWorkerÊñπÊ≥ïÊ∫êÁ†Å‰∏ãÂçäÈÉ®ÂàÜ‰∏≠ÁöÑÁ¨¨4Ê≠•<code>t.start</code>Ôºå‰ºöËß¶Âèë<code>Worker</code>Á±ªÁöÑ<code>run</code>ÊñπÊ≥ïË¢´JVMË∞ÉÁî®„ÄÇ</p>
<p>Êàë‰ª¨ÂÜçÁúãÁúã<code>runWorker</code>ÁöÑÈÄªËæëÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Worker.runWorkerÊñπÊ≥ïÊ∫ê‰ª£Á†Å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">final</span> <span class="kt">void</span> <span class="nf">runWorker</span><span class="o">(</span><span class="n">Worker</span> <span class="n">w</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Thread</span> <span class="n">wt</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Runnable</span> <span class="n">task</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="na">firstTask</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">w</span><span class="o">.</span><span class="na">firstTask</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1.Á∫øÁ®ãÂêØÂä®‰πãÂêéÔºåÈÄöËøáunlockÊñπÊ≥ïÈáäÊîæÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">w</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span> <span class="c1">// allow interrupts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">boolean</span> <span class="n">completedAbruptly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 2.WorkerÊâßË°åfirstTaskÊàñ‰ªéworkQueue‰∏≠Ëé∑Âèñ‰ªªÂä°ÔºåÂ¶ÇÊûúgetTaskÊñπÊ≥ï‰∏çËøîÂõûnull,Âæ™ÁéØ‰∏çÈÄÄÂá∫
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">while</span> <span class="o">(</span><span class="n">task</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">(</span><span class="n">task</span> <span class="o">=</span> <span class="n">getTask</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 2.1ËøõË°åÂä†ÈîÅÊìç‰ΩúÔºå‰øùËØÅthread‰∏çË¢´ÂÖ∂‰ªñÁ∫øÁ®ã‰∏≠Êñ≠ÔºàÈô§ÈùûÁ∫øÁ®ãÊ±†Ë¢´‰∏≠Êñ≠Ôºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">w</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// If pool is stopping, ensure thread is interrupted;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// if not, ensure thread is not interrupted.  This
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// requires a recheck in second case to deal with
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// shutdownNow race while clearing interrupt
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// 2.2Ê£ÄÊü•Á∫øÁ®ãÊ±†Áä∂ÊÄÅÔºåÂÄòËã•Á∫øÁ®ãÊ±†Â§Ñ‰∫é‰∏≠Êñ≠Áä∂ÊÄÅÔºåÂΩìÂâçÁ∫øÁ®ãÂ∞Ü‰∏≠Êñ≠„ÄÇ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">((</span><span class="n">runStateAtLeast</span><span class="o">(</span><span class="n">ctl</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">STOP</span><span class="o">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">                 <span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">interrupted</span><span class="o">()</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">                  <span class="n">runStateAtLeast</span><span class="o">(</span><span class="n">ctl</span><span class="o">.</span><span class="na">get</span><span class="o">(),</span> <span class="n">STOP</span><span class="o">)))</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">                <span class="o">!</span><span class="n">wt</span><span class="o">.</span><span class="na">isInterrupted</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">                <span class="n">wt</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 2.3ÊâßË°åbeforeExecute 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">beforeExecute</span><span class="o">(</span><span class="n">wt</span><span class="o">,</span> <span class="n">task</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">Throwable</span> <span class="n">thrown</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// 2.4ÊâßË°å‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">task</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RuntimeException</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">thrown</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="k">throw</span> <span class="n">x</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Error</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">thrown</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="k">throw</span> <span class="n">x</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">thrown</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">Error</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// 2.5ÊâßË°åafterExecuteÊñπÊ≥ï 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">afterExecute</span><span class="o">(</span><span class="n">task</span><span class="o">,</span> <span class="n">thrown</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">task</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">w</span><span class="o">.</span><span class="na">completedTasks</span><span class="o">++;</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 2.6Ëß£ÈîÅÊìç‰Ωú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">w</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">completedAbruptly</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">processWorkerExit</span><span class="o">(</span><span class="n">w</span><span class="o">,</span> <span class="n">completedAbruptly</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>È¶ñÂÖàÂéªÊâßË°åÂàõÂª∫Ëøô‰∏™workerÊó∂Â∞±ÊúâÁöÑ‰ªªÂä°ÔºåÂΩìÊâßË°åÂÆåËøô‰∏™‰ªªÂä°ÂêéÔºåworkerÁöÑÁîüÂëΩÂë®ÊúüÂπ∂Ê≤°ÊúâÁªìÊùüÔºåÂú®<code>while</code>Âæ™ÁéØ‰∏≠Ôºåworker‰ºö‰∏çÊñ≠Âú∞Ë∞ÉÁî®<code>getTask</code>ÊñπÊ≥ï‰ªé<strong>ÈòªÂ°ûÈòüÂàó</strong>‰∏≠Ëé∑Âèñ‰ªªÂä°ÁÑ∂ÂêéË∞ÉÁî®<code>task.run()</code>ÊâßË°å‰ªªÂä°,‰ªéËÄåËææÂà∞<strong>Â§çÁî®Á∫øÁ®ã</strong>ÁöÑÁõÆÁöÑ„ÄÇÂè™Ë¶Å<code>getTask</code>ÊñπÊ≥ï‰∏çËøîÂõû<code>null</code>,Ê≠§Á∫øÁ®ãÂ∞±‰∏ç‰ºöÈÄÄÂá∫„ÄÇ</p>
<p>ÂΩìÁÑ∂ÔºåÊ†∏ÂøÉÁ∫øÁ®ãÊ±†‰∏≠ÂàõÂª∫ÁöÑÁ∫øÁ®ãÊÉ≥Ë¶ÅÊãøÂà∞ÈòªÂ°ûÈòüÂàó‰∏≠ÁöÑ‰ªªÂä°ÔºåÂÖàË¶ÅÂà§Êñ≠Á∫øÁ®ãÊ±†ÁöÑÁä∂ÊÄÅÔºåÂ¶ÇÊûú<strong>STOP</strong>ÊàñËÄÖ<strong>TERMINATED</strong>ÔºåËøîÂõû<code>null</code>„ÄÇ</p>
<p>ÊúÄÂêéÁúãÁúã<code>getTask</code>ÊñπÊ≥ïÁöÑÂÆûÁé∞:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Worker.getTaskÊñπÊ≥ïÊ∫êÁ†Å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="n">Runnable</span> <span class="nf">getTask</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">boolean</span> <span class="n">timedOut</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">// Did the last poll() time out?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(;;)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">runStateOf</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Check if queue empty only if necessary.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">rs</span> <span class="o">&gt;=</span> <span class="n">SHUTDOWN</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">rs</span> <span class="o">&gt;=</span> <span class="n">STOP</span> <span class="o">||</span> <span class="n">workQueue</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">decrementWorkerCount</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">wc</span> <span class="o">=</span> <span class="n">workerCountOf</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Are workers subject to culling?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// 1.allowCoreThreadTimeOutÂèòÈáèÈªòËÆ§ÊòØfalse,Ê†∏ÂøÉÁ∫øÁ®ãÂç≥‰ΩøÁ©∫Èó≤‰πü‰∏ç‰ºöË¢´ÈîÄÊØÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Â¶ÇÊûú‰∏∫true,Ê†∏ÂøÉÁ∫øÁ®ãÂú®keepAliveTimeÂÜÖ‰ªçÁ©∫Èó≤Âàô‰ºöË¢´ÈîÄÊØÅ„ÄÇ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">boolean</span> <span class="n">timed</span> <span class="o">=</span> <span class="n">allowCoreThreadTimeOut</span> <span class="o">||</span> <span class="n">wc</span> <span class="o">&gt;</span> <span class="n">corePoolSize</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 2.Â¶ÇÊûúËøêË°åÁ∫øÁ®ãÊï∞Ë∂ÖËøá‰∫ÜÊúÄÂ§ßÁ∫øÁ®ãÊï∞Ôºå‰ΩÜÊòØÁºìÂ≠òÈòüÂàóÂ∑≤ÁªèÁ©∫‰∫ÜÔºåËøôÊó∂ÈÄíÂáèworkerÊï∞Èáè„ÄÇ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>„ÄÄ„ÄÄ„ÄÄ„ÄÄ <span class="c1">// Â¶ÇÊûúÊúâËÆæÁΩÆÂÖÅËÆ∏Á∫øÁ®ãË∂ÖÊó∂ÊàñËÄÖÁ∫øÁ®ãÊï∞ÈáèË∂ÖËøá‰∫ÜÊ†∏ÂøÉÁ∫øÁ®ãÊï∞ÈáèÔºå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Âπ∂‰∏îÁ∫øÁ®ãÂú®ËßÑÂÆöÊó∂Èó¥ÂÜÖÂùáÊú™pollÂà∞‰ªªÂä°‰∏îÈòüÂàó‰∏∫Á©∫ÂàôÈÄíÂáèworkerÊï∞Èáè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">((</span><span class="n">wc</span> <span class="o">&gt;</span> <span class="n">maximumPoolSize</span> <span class="o">||</span> <span class="o">(</span><span class="n">timed</span> <span class="o">&amp;&amp;</span> <span class="n">timedOut</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">            <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">wc</span> <span class="o">&gt;</span> <span class="n">1</span> <span class="o">||</span> <span class="n">workQueue</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">compareAndDecrementWorkerCount</span><span class="o">(</span><span class="n">c</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 3.Â¶ÇÊûútimed‰∏∫true(ÊÉ≥ÊÉ≥Âì™‰∫õÊÉÖÂÜµ‰∏ãtimed‰∏∫true),Âàô‰ºöË∞ÉÁî®workQueueÁöÑpollÊñπÊ≥ïËé∑Âèñ‰ªªÂä°.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// Ë∂ÖÊó∂Êó∂Èó¥ÊòØkeepAliveTime„ÄÇÂ¶ÇÊûúË∂ÖËøákeepAliveTimeÊó∂ÈïøÔºå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// pollËøîÂõû‰∫ÜnullÔºå‰∏äËæπÊèêÂà∞ÁöÑwhileÂæ™Â∫èÂ∞±‰ºöÈÄÄÂá∫ÔºåÁ∫øÁ®ã‰πüÂ∞±ÊâßË°åÂÆå‰∫Ü„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// Â¶ÇÊûútimed‰∏∫falseÔºàallowCoreThreadTimeOut‰∏∫falsefalse
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// ‰∏îwc &gt; corePoolSize‰∏∫falseÔºâÔºåÂàô‰ºöË∞ÉÁî®workQueueÁöÑtakeÊñπÊ≥ïÈòªÂ°ûÂú®ÂΩìÂâç„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// ÈòüÂàó‰∏≠Êúâ‰ªªÂä°Âä†ÂÖ•Êó∂ÔºåÁ∫øÁ®ãË¢´Âî§ÈÜíÔºåtakeÊñπÊ≥ïËøîÂõû‰ªªÂä°ÔºåÂπ∂ÊâßË°å„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Runnable</span> <span class="n">r</span> <span class="o">=</span> <span class="n">timed</span> <span class="o">?</span>
</span></span><span class="line"><span class="cl">                <span class="n">workQueue</span><span class="o">.</span><span class="na">poll</span><span class="o">(</span><span class="n">keepAliveTime</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">NANOSECONDS</span><span class="o">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">workQueue</span><span class="o">.</span><span class="na">take</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">r</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">r</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">timedOut</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">retry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">timedOut</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê†∏ÂøÉÁ∫øÁ®ãÁöÑ‰ºö‰∏ÄÁõ¥Âç°Âú®<code>workQueue.take</code>ÊñπÊ≥ïÔºåË¢´ÈòªÂ°ûÂπ∂ÊåÇËµ∑Ôºå‰∏ç‰ºöÂç†Áî®CPUËµÑÊ∫êÔºåÁõ¥Âà∞ÊãøÂà∞<code>Runnable</code> ÁÑ∂ÂêéËøîÂõûÔºàÂΩìÁÑ∂Â¶ÇÊûú<strong>allowCoreThreadTimeOut</strong>ËÆæÁΩÆ‰∏∫<code>true</code>,ÈÇ£‰πàÊ†∏ÂøÉÁ∫øÁ®ãÂ∞±‰ºöÂéªË∞ÉÁî®<code>poll</code>ÊñπÊ≥ïÔºåÂõ†‰∏∫<code>poll</code>ÂèØËÉΩ‰ºöËøîÂõû<code>null</code>,ÊâÄ‰ª•ËøôÊó∂ÂÄôÊ†∏ÂøÉÁ∫øÁ®ãÊª°Ë∂≥Ë∂ÖÊó∂Êù°‰ª∂‰πü‰ºöË¢´ÈîÄÊØÅÔºâ„ÄÇ</p>
<p>ÈùûÊ†∏ÂøÉÁ∫øÁ®ã‰ºöworkQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) ÔºåÂ¶ÇÊûúË∂ÖÊó∂ËøòÊ≤°ÊúâÊãøÂà∞Ôºå‰∏ã‰∏ÄÊ¨°Âæ™ÁéØÂà§Êñ≠<strong>compareAndDecrementWorkerCount</strong>Â∞±‰ºöËøîÂõû<code>null</code>,WorkerÂØπË±°ÁöÑ<code>run()</code>ÊñπÊ≥ïÂæ™ÁéØ‰ΩìÁöÑÂà§Êñ≠‰∏∫<code>null</code>,‰ªªÂä°ÁªìÊùüÔºåÁÑ∂ÂêéÁ∫øÁ®ãË¢´Á≥ªÁªüÂõûÊî∂ „ÄÇ</p>
<p>Ê∫êÁ†ÅËß£ÊûêÂÆåÊØïÔºå‰Ω†ÁêÜËß£ÁöÑÊ∫êÁ†ÅÊòØÂê¶ÂíåÂõæ‰∏≠ÁöÑÂ§ÑÁêÜÊµÅÁ®ã‰∏ÄËá¥ÔºüÂ¶ÇÊûú‰∏ç‰∏ÄËá¥ÔºåÈÇ£‰πàÂ∞±Â§öÁúã‰∏§ÈÅçÂêßÔºåÂä†Ê≤π„ÄÇ</p>
<h3 id="ÂõõÁßçÂ∏∏ËßÅÁöÑÁ∫øÁ®ãÊ±†">ÂõõÁßçÂ∏∏ËßÅÁöÑÁ∫øÁ®ãÊ±†</h3>
<p><code>Executors</code>Á±ª‰∏≠Êèê‰æõÁöÑÂá†‰∏™ÈùôÊÄÅÊñπÊ≥ïÊù•ÂàõÂª∫Á∫øÁ®ãÊ±†„ÄÇÂ§ßÂÆ∂Âà∞‰∫ÜËøô‰∏ÄÊ≠•ÔºåÂ¶ÇÊûúÁúãÊáÇ‰∫ÜÂâçÈù¢ËÆ≤ÁöÑ<code>ThreadPoolExecutor</code>ÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ÂêÑÁßçÂèÇÊï∞ÁöÑÊÑè‰πâÔºåÈÇ£‰πà‰∏ÄÁúãÂà∞<code>Executors</code>Á±ª‰∏≠Êèê‰æõÁöÑÁ∫øÁ®ãÊ±†ÁöÑÊ∫êÁ†ÅÂ∞±Â∫îËØ•Áü•ÈÅìËøô‰∏™Á∫øÁ®ãÊ±†ÊòØÂπ≤ÂòõÁöÑ„ÄÇ</p>
<h4 id="newcachedthreadpool">newCachedThreadPool</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="n">ExecutorService</span> <span class="nf">newCachedThreadPool</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">60L</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="k">new</span> <span class="n">SynchronousQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;());</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>CacheThreadPool</code>ÁöÑ<strong>ËøêË°åÊµÅÁ®ã</strong>Â¶Ç‰∏ãÔºö</p>
<ol>
<li>Êèê‰∫§‰ªªÂä°ËøõÁ∫øÁ®ãÊ±†„ÄÇ</li>
<li>Âõ†‰∏∫<strong>corePoolSize</strong>‰∏∫0ÁöÑÂÖ≥Á≥ªÔºå‰∏çÂàõÂª∫Ê†∏ÂøÉÁ∫øÁ®ãÔºåÁ∫øÁ®ãÊ±†ÊúÄÂ§ß‰∏∫Integer.MAX_VALUE„ÄÇ</li>
<li>Â∞ùËØïÂ∞Ü‰ªªÂä°Ê∑ªÂä†Âà∞<strong>SynchronousQueue</strong>ÈòüÂàó„ÄÇ</li>
<li>Â¶ÇÊûúSynchronousQueueÂÖ•ÂàóÊàêÂäüÔºåÁ≠âÂæÖË¢´ÂΩìÂâçËøêË°åÁöÑÁ∫øÁ®ãÁ©∫Èó≤ÂêéÊãâÂèñÊâßË°å„ÄÇÂ¶ÇÊûúÂΩìÂâçÊ≤°ÊúâÁ©∫Èó≤Á∫øÁ®ãÔºåÈÇ£‰πàÂ∞±ÂàõÂª∫‰∏Ä‰∏™ÈùûÊ†∏ÂøÉÁ∫øÁ®ãÔºåÁÑ∂Âêé‰ªéSynchronousQueueÊãâÂèñ‰ªªÂä°Âπ∂Âú®ÂΩìÂâçÁ∫øÁ®ãÊâßË°å„ÄÇ</li>
<li>Â¶ÇÊûúSynchronousQueueÂ∑≤Êúâ‰ªªÂä°Âú®Á≠âÂæÖÔºåÂÖ•ÂàóÊìç‰ΩúÂ∞Ü‰ºöÈòªÂ°û„ÄÇ</li>
</ol>
<p>ÂΩìÈúÄË¶ÅÊâßË°åÂæàÂ§ö<strong>Áü≠Êó∂Èó¥</strong>ÁöÑ‰ªªÂä°Êó∂ÔºåCacheThreadPoolÁöÑÁ∫øÁ®ãÂ§çÁî®ÁéáÊØîËæÉÈ´òÔºå ‰ºöÊòæËëóÁöÑ<strong>ÊèêÈ´òÊÄßËÉΩ</strong>„ÄÇËÄå‰∏îÁ∫øÁ®ã60sÂêé‰ºöÂõûÊî∂ÔºåÊÑèÂë≥ÁùÄÂç≥‰ΩøÊ≤°Êúâ‰ªªÂä°ËøõÊù•ÔºåCacheThreadPoolÂπ∂‰∏ç‰ºöÂç†Áî®ÂæàÂ§öËµÑÊ∫ê„ÄÇ</p>
<h4 id="newfixedthreadpool">newFixedThreadPool</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="n">ExecutorService</span> <span class="nf">newFixedThreadPool</span><span class="o">(</span><span class="kt">int</span> <span class="n">nThreads</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">(</span><span class="n">nThreads</span><span class="o">,</span> <span class="n">nThreads</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                      <span class="n">0L</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                      <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;());</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê†∏ÂøÉÁ∫øÁ®ãÊï∞ÈáèÂíåÊÄªÁ∫øÁ®ãÊï∞ÈáèÁõ∏Á≠âÔºåÈÉΩÊòØ‰º†ÂÖ•ÁöÑÂèÇÊï∞nThreadsÔºåÊâÄ‰ª•Âè™ËÉΩÂàõÂª∫Ê†∏ÂøÉÁ∫øÁ®ãÔºå‰∏çËÉΩÂàõÂª∫ÈùûÊ†∏ÂøÉÁ∫øÁ®ã„ÄÇÂõ†‰∏∫LinkedBlockingQueueÁöÑÈªòËÆ§Â§ßÂ∞èÊòØInteger.MAX_VALUEÔºåÊïÖÂ¶ÇÊûúÊ†∏ÂøÉÁ∫øÁ®ãÁ©∫Èó≤ÔºåÂàô‰∫§ÁªôÊ†∏ÂøÉÁ∫øÁ®ãÂ§ÑÁêÜÔºõÂ¶ÇÊûúÊ†∏ÂøÉÁ∫øÁ®ã‰∏çÁ©∫Èó≤ÔºåÂàôÂÖ•ÂàóÁ≠âÂæÖÔºåÁõ¥Âà∞Ê†∏ÂøÉÁ∫øÁ®ãÁ©∫Èó≤„ÄÇ</p>
<p><strong>‰∏éCachedThreadPoolÁöÑÂå∫Âà´</strong>Ôºö</p>
<ul>
<li>Âõ†‰∏∫ corePoolSize == maximumPoolSize ÔºåÊâÄ‰ª•FixedThreadPoolÂè™‰ºöÂàõÂª∫Ê†∏ÂøÉÁ∫øÁ®ã„ÄÇ ËÄåCachedThreadPoolÂõ†‰∏∫corePoolSize=0ÔºåÊâÄ‰ª•Âè™‰ºöÂàõÂª∫ÈùûÊ†∏ÂøÉÁ∫øÁ®ã„ÄÇ</li>
<li>Âú® getTask() ÊñπÊ≥ïÔºåÂ¶ÇÊûúÈòüÂàóÈáåÊ≤°Êúâ‰ªªÂä°ÂèØÂèñÔºåÁ∫øÁ®ã‰ºö‰∏ÄÁõ¥ÈòªÂ°ûÂú® LinkedBlockingQueue.take() ÔºåÁ∫øÁ®ã‰∏ç‰ºöË¢´ÂõûÊî∂„ÄÇ CachedThreadPool‰ºöÂú®60sÂêéÊî∂Âõû„ÄÇ</li>
<li>Áî±‰∫éÁ∫øÁ®ã‰∏ç‰ºöË¢´ÂõûÊî∂Ôºå‰ºö‰∏ÄÁõ¥Âç°Âú®ÈòªÂ°ûÔºåÊâÄ‰ª•<strong>Ê≤°Êúâ‰ªªÂä°ÁöÑÊÉÖÂÜµ‰∏ãÔºå FixedThreadPoolÂç†Áî®ËµÑÊ∫êÊõ¥Â§ö</strong>„ÄÇ</li>
<li>ÈÉΩÂá†‰πé‰∏ç‰ºöËß¶ÂèëÊãíÁªùÁ≠ñÁï•Ôºå‰ΩÜÊòØÂéüÁêÜ‰∏çÂêå„ÄÇFixedThreadPoolÊòØÂõ†‰∏∫ÈòªÂ°ûÈòüÂàóÂèØ‰ª•ÂæàÂ§ßÔºàÊúÄÂ§ß‰∏∫IntegerÊúÄÂ§ßÂÄºÔºâÔºåÊïÖÂá†‰πé‰∏ç‰ºöËß¶ÂèëÊãíÁªùÁ≠ñÁï•ÔºõCachedThreadPoolÊòØÂõ†‰∏∫Á∫øÁ®ãÊ±†ÂæàÂ§ßÔºàÊúÄÂ§ß‰∏∫IntegerÊúÄÂ§ßÂÄºÔºâÔºåÂá†‰πé‰∏ç‰ºöÂØºËá¥Á∫øÁ®ãÊï∞ÈáèÂ§ß‰∫éÊúÄÂ§ßÁ∫øÁ®ãÊï∞ÔºåÊïÖÂá†‰πé‰∏ç‰ºöËß¶ÂèëÊãíÁªùÁ≠ñÁï•„ÄÇ</li>
</ul>
<h4 id="newsinglethreadexecutor">newSingleThreadExecutor</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="n">ExecutorService</span> <span class="nf">newSingleThreadExecutor</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">FinalizableDelegatedExecutorService</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span><span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">0L</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;()));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êúâ‰∏î‰ªÖÊúâ‰∏Ä‰∏™Ê†∏ÂøÉÁ∫øÁ®ãÔºà corePoolSize == maximumPoolSize=1ÔºâÔºå‰ΩøÁî®‰∫ÜLinkedBlockingQueueÔºàÂÆπÈáèÂæàÂ§ßÔºâÔºåÊâÄ‰ª•Ôºå<strong>‰∏ç‰ºöÂàõÂª∫ÈùûÊ†∏ÂøÉÁ∫øÁ®ã</strong>„ÄÇÊâÄÊúâ‰ªªÂä°ÊåâÁÖß<strong>ÂÖàÊù•ÂÖàÊâßË°å</strong>ÁöÑÈ°∫Â∫èÊâßË°å„ÄÇÂ¶ÇÊûúËøô‰∏™ÂîØ‰∏ÄÁöÑÁ∫øÁ®ã‰∏çÁ©∫Èó≤ÔºåÈÇ£‰πàÊñ∞Êù•ÁöÑ‰ªªÂä°‰ºöÂ≠òÂÇ®Âú®‰ªªÂä°ÈòüÂàóÈáåÁ≠âÂæÖÊâßË°å„ÄÇ</p>
<h4 id="newscheduledthreadpool">newScheduledThreadPool</h4>
<p>ÂàõÂª∫‰∏Ä‰∏™ÂÆöÈïøÁ∫øÁ®ãÊ±†ÔºåÊîØÊåÅÂÆöÊó∂ÂèäÂë®ÊúüÊÄß‰ªªÂä°ÊâßË°å„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="n">ScheduledExecutorService</span> <span class="nf">newScheduledThreadPool</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">ScheduledThreadPoolExecutor</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ScheduledThreadPoolExecutor():
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="nf">ScheduledThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">          <span class="n">DEFAULT_KEEPALIVE_MILLIS</span><span class="o">,</span> <span class="n">MILLISECONDS</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">          <span class="k">new</span> <span class="n">DelayedWorkQueue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂõõÁßçÂ∏∏ËßÅÁöÑÁ∫øÁ®ãÊ±†Âü∫Êú¨Â§üÊàë‰ª¨‰ΩøÁî®‰∫ÜÔºå‰ΩÜÊòØ„ÄäÈòøÈáåÂ∑¥Â∑¥ÂºÄÂèëÊâãÂÜå„Äã‰∏çÂª∫ËÆÆÊàë‰ª¨Áõ¥Êé•‰ΩøÁî®ExecutorsÁ±ª‰∏≠ÁöÑÁ∫øÁ®ãÊ±†ÔºåËÄåÊòØÈÄöËøá<code>ThreadPoolExecutor</code>ÁöÑÊñπÂºèÔºåËøôÊ†∑ÁöÑÂ§ÑÁêÜÊñπÂºèËÆ©ÂÜôÁöÑÂêåÂ≠¶ÈúÄË¶ÅÊõ¥Âä†ÊòéÁ°ÆÁ∫øÁ®ãÊ±†ÁöÑËøêË°åËßÑÂàôÔºåËßÑÈÅøËµÑÊ∫êËÄóÂ∞ΩÁöÑÈ£éÈô©„ÄÇ</p>
<p>‰ΩÜÂ¶ÇÊûú‰Ω†ÂèäÂõ¢ÈòüÊú¨Ë∫´ÂØπÁ∫øÁ®ãÊ±†ÈùûÂ∏∏ÁÜüÊÇâÔºåÂèàÁ°ÆÂÆö‰∏öÂä°ËßÑÊ®°‰∏ç‰ºöÂ§ßÂà∞ËµÑÊ∫êËÄóÂ∞ΩÁöÑÁ®ãÂ∫¶ÔºàÊØîÂ¶ÇÁ∫øÁ®ãÊï∞ÈáèÊàñ‰ªªÂä°ÈòüÂàóÈïøÂ∫¶ÂèØËÉΩËææÂà∞Integer.MAX_VALUEÔºâÊó∂ÔºåÂÖ∂ÂÆûÊòØÂèØ‰ª•‰ΩøÁî®JDKÊèê‰æõÁöÑËøôÂá†‰∏™Êé•Âè£ÁöÑÔºåÂÆÉËÉΩËÆ©Êàë‰ª¨ÁöÑ‰ª£Á†ÅÂÖ∑ÊúâÊõ¥Âº∫ÁöÑÂèØËØªÊÄß„ÄÇ</p>
<h2 id="ÈòªÂ°ûÈòüÂàó">ÈòªÂ°ûÈòüÂàó</h2>
<h3 id="ÈòªÂ°ûÈòüÂàóÁöÑÁî±Êù•">ÈòªÂ°ûÈòüÂàóÁöÑÁî±Êù•</h3>
<p>Êàë‰ª¨ÂÅáËÆæ‰∏ÄÁßçÂú∫ÊôØÔºåÁîü‰∫ßËÄÖ‰∏ÄÁõ¥Áîü‰∫ßËµÑÊ∫êÔºåÊ∂àË¥πËÄÖ‰∏ÄÁõ¥Ê∂àË¥πËµÑÊ∫êÔºåËµÑÊ∫êÂ≠òÂÇ®Âú®‰∏Ä‰∏™ÁºìÂÜ≤Ê±†‰∏≠ÔºåÁîü‰∫ßËÄÖÂ∞ÜÁîü‰∫ßÁöÑËµÑÊ∫êÂ≠òËøõÁºìÂÜ≤Ê±†‰∏≠ÔºåÊ∂àË¥πËÄÖ‰ªéÁºìÂÜ≤Ê±†‰∏≠ÊãøÂà∞ËµÑÊ∫êËøõË°åÊ∂àË¥πÔºåËøôÂ∞±ÊòØÂ§ßÂêçÈºéÈºéÁöÑ<strong>Áîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖÊ®°Âºè</strong>„ÄÇ</p>
<p>ËØ•Ê®°ÂºèËÉΩÂ§üÁÆÄÂåñÂºÄÂèëËøáÁ®ãÔºå‰∏ÄÊñπÈù¢Ê∂àÈô§‰∫ÜÁîü‰∫ßËÄÖÁ±ª‰∏éÊ∂àË¥πËÄÖÁ±ª‰πãÈó¥ÁöÑ‰ª£Á†Å‰æùËµñÊÄßÔºåÂè¶‰∏ÄÊñπÈù¢Â∞ÜÁîü‰∫ßÊï∞ÊçÆÁöÑËøáÁ®ã‰∏é‰ΩøÁî®Êï∞ÊçÆÁöÑËøáÁ®ãËß£ËÄ¶ÁÆÄÂåñË¥üËΩΩ„ÄÇ</p>
<p>Êàë‰ª¨Ëá™Â∑±codingÂÆûÁé∞Ëøô‰∏™Ê®°ÂºèÁöÑÊó∂ÂÄôÔºåÂõ†‰∏∫ÈúÄË¶ÅËÆ©<strong>Â§ö‰∏™Á∫øÁ®ãÊìç‰ΩúÂÖ±‰∫´ÂèòÈáè</strong>ÔºàÂç≥ËµÑÊ∫êÔºâÔºåÊâÄ‰ª•ÂæàÂÆπÊòìÂºïÂèë<strong>Á∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢ò</strong>ÔºåÈÄ†Êàê<strong>ÈáçÂ§çÊ∂àË¥π</strong>Âíå<strong>Ê≠ªÈîÅ</strong>ÔºåÂ∞§ÂÖ∂ÊòØÁîü‰∫ßËÄÖÂíåÊ∂àË¥πËÄÖÂ≠òÂú®Â§ö‰∏™ÁöÑÊÉÖÂÜµ„ÄÇÂè¶Â§ñÔºåÂΩìÁºìÂÜ≤Ê±†Á©∫‰∫ÜÔºåÊàë‰ª¨ÈúÄË¶ÅÈòªÂ°ûÊ∂àË¥πËÄÖÔºåÂî§ÈÜíÁîü‰∫ßËÄÖÔºõÂΩìÁºìÂÜ≤Ê±†Êª°‰∫ÜÔºåÊàë‰ª¨ÈúÄË¶ÅÈòªÂ°ûÁîü‰∫ßËÄÖÔºåÂî§ÈÜíÊ∂àË¥πËÄÖÔºåËøô‰∫õ‰∏™<strong>Á≠âÂæÖ-Âî§ÈÜí</strong>ÈÄªËæëÈÉΩÈúÄË¶ÅËá™Â∑±ÂÆûÁé∞„ÄÇÔºàËøôÂùó‰∏çÊòéÁôΩÁöÑÂêåÂ≠¶ÔºåÂèØ‰ª•ÁúãÊúÄ‰∏ãÊñπÁªìËØ≠ÈÉ®ÂàÜÁöÑÈìæÊé•Ôºâ</p>
<p>Ëøô‰πàÂÆπÊòìÂá∫ÈîôÁöÑ‰∫ãÊÉÖÔºåJDKÂΩìÁÑ∂Â∏ÆÊàë‰ª¨ÂÅöÂï¶ÔºåËøôÂ∞±ÊòØÈòªÂ°ûÈòüÂàó(BlockingQueue)Ôºå<strong>‰Ω†Âè™ÁÆ°ÂæÄÈáåÈù¢Â≠ò„ÄÅÂèñÂ∞±Ë°åÔºåËÄå‰∏çÁî®ÊãÖÂøÉÂ§öÁ∫øÁ®ãÁéØÂ¢É‰∏ãÂ≠ò„ÄÅÂèñÂÖ±‰∫´ÂèòÈáèÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÈóÆÈ¢ò„ÄÇ</strong></p>
<blockquote>
<p>BlockingQueueÊòØJava util.concurrentÂåÖ‰∏ãÈáçË¶ÅÁöÑÊï∞ÊçÆÁªìÊûÑÔºåÂå∫Âà´‰∫éÊôÆÈÄöÁöÑÈòüÂàóÔºåBlockingQueueÊèê‰æõ‰∫Ü<strong>Á∫øÁ®ãÂÆâÂÖ®ÁöÑÈòüÂàóËÆøÈóÆÊñπÂºè</strong>ÔºåÂπ∂ÂèëÂåÖ‰∏ãÂæàÂ§öÈ´òÁ∫ßÂêåÊ≠•Á±ªÁöÑÂÆûÁé∞ÈÉΩÊòØÂü∫‰∫éBlockingQueueÂÆûÁé∞ÁöÑ„ÄÇ</p>
</blockquote>
<p>BlockingQueue‰∏ÄËà¨Áî®‰∫éÁîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖÊ®°ÂºèÔºåÁîü‰∫ßËÄÖÊòØÂæÄÈòüÂàóÈáåÊ∑ªÂä†ÂÖÉÁ¥†ÁöÑÁ∫øÁ®ãÔºåÊ∂àË¥πËÄÖÊòØ‰ªéÈòüÂàóÈáåÊãøÂÖÉÁ¥†ÁöÑÁ∫øÁ®ã„ÄÇ<strong>BlockingQueueÂ∞±ÊòØÂ≠òÊîæÂÖÉÁ¥†ÁöÑÂÆπÂô®</strong>„ÄÇ</p>
<h3 id="blockingqueueÁöÑÊìç‰ΩúÊñπÊ≥ï">BlockingQueueÁöÑÊìç‰ΩúÊñπÊ≥ï</h3>
<p>ÈòªÂ°ûÈòüÂàóÊèê‰æõ‰∫ÜÂõõÁªÑ‰∏çÂêåÁöÑÊñπÊ≥ïÁî®‰∫éÊèíÂÖ•„ÄÅÁßªÈô§„ÄÅÊ£ÄÊü•ÂÖÉÁ¥†Ôºö</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th style="text-align:center">ÊñπÊ≥ï\Â§ÑÁêÜÊñπÂºè</th>
<th style="text-align:center">ÊäõÂá∫ÂºÇÂ∏∏</th>
<th style="text-align:center">ËøîÂõûÁâπÊÆäÂÄº</th>
<th style="text-align:center">‰∏ÄÁõ¥ÈòªÂ°û</th>
<th style="text-align:center">Ë∂ÖÊó∂ÈÄÄÂá∫</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">ÊèíÂÖ•ÊñπÊ≥ï</td>
<td style="text-align:center">add(e)</td>
<td style="text-align:center">offer(e)</td>
<td style="text-align:center"><strong>put(e)</strong></td>
<td style="text-align:center">offer(e,time,unit)</td>
</tr>
<tr>
<td style="text-align:center">ÁßªÈô§ÊñπÊ≥ï</td>
<td style="text-align:center">remove()</td>
<td style="text-align:center">poll()</td>
<td style="text-align:center"><strong>take()</strong></td>
<td style="text-align:center">poll(time,unit)</td>
</tr>
<tr>
<td style="text-align:center">Ê£ÄÊü•ÊñπÊ≥ï</td>
<td style="text-align:center">element()</td>
<td style="text-align:center">peek()</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
</tbody>
</table></div>
<ul>
<li>ÊäõÂá∫ÂºÇÂ∏∏ÔºöÂ¶ÇÊûúËØïÂõæÁöÑÊìç‰ΩúÊó†Ê≥ïÁ´ãÂç≥ÊâßË°åÔºåÊäõÂºÇÂ∏∏„ÄÇÂΩìÈòªÂ°ûÈòüÂàóÊª°Êó∂ÂÄôÔºåÂÜçÂæÄÈòüÂàóÈáåÊèíÂÖ•ÂÖÉÁ¥†Ôºå‰ºöÊäõÂá∫IllegalStateException(‚ÄúQueue full‚Äù)ÂºÇÂ∏∏„ÄÇÂΩìÈòüÂàó‰∏∫Á©∫Êó∂Ôºå‰ªéÈòüÂàóÈáåËé∑ÂèñÂÖÉÁ¥†Êó∂‰ºöÊäõÂá∫NoSuchElementExceptionÂºÇÂ∏∏ „ÄÇ</li>
<li>ËøîÂõûÁâπÊÆäÂÄºÔºöÂ¶ÇÊûúËØïÂõæÁöÑÊìç‰ΩúÊó†Ê≥ïÁ´ãÂç≥ÊâßË°åÔºåËøîÂõû‰∏Ä‰∏™ÁâπÊÆäÂÄºÔºåÈÄöÂ∏∏ÊòØtrue / false„ÄÇ</li>
<li>‰∏ÄÁõ¥ÈòªÂ°ûÔºöÂ¶ÇÊûúËØïÂõæÁöÑÊìç‰ΩúÊó†Ê≥ïÁ´ãÂç≥ÊâßË°åÔºåÂàô‰∏ÄÁõ¥ÈòªÂ°ûÊàñËÄÖÂìçÂ∫î‰∏≠Êñ≠„ÄÇ</li>
<li>Ë∂ÖÊó∂ÈÄÄÂá∫ÔºöÂ¶ÇÊûúËØïÂõæÁöÑÊìç‰ΩúÊó†Ê≥ïÁ´ãÂç≥ÊâßË°åÔºåËØ•ÊñπÊ≥ïË∞ÉÁî®Â∞Ü‰ºöÂèëÁîüÈòªÂ°ûÔºåÁõ¥Âà∞ËÉΩÂ§üÊâßË°åÔºå‰ΩÜÁ≠âÂæÖÊó∂Èó¥‰∏ç‰ºöË∂ÖËøáÁªôÂÆöÂÄº„ÄÇËøîÂõû‰∏Ä‰∏™ÁâπÂÆöÂÄº‰ª•ÂëäÁü•ËØ•Êìç‰ΩúÊòØÂê¶ÊàêÂäüÔºåÈÄöÂ∏∏ÊòØ true / false„ÄÇ</li>
</ul>
<p><strong>Ê≥®ÊÑè‰πãÂ§Ñ</strong></p>
<ul>
<li>‰∏çËÉΩÂæÄÈòªÂ°ûÈòüÂàó‰∏≠ÊèíÂÖ•null,‰ºöÊäõÂá∫Á©∫ÊåáÈíàÂºÇÂ∏∏„ÄÇ</li>
<li>ÂèØ‰ª•ËÆøÈóÆÈòªÂ°ûÈòüÂàó‰∏≠ÁöÑ‰ªªÊÑèÂÖÉÁ¥†ÔºåË∞ÉÁî®remove(o)ÂèØ‰ª•Â∞ÜÈòüÂàó‰πã‰∏≠ÁöÑÁâπÂÆöÂØπË±°ÁßªÈô§Ôºå‰ΩÜÂπ∂‰∏çÈ´òÊïàÔºåÂ∞ΩÈáèÈÅøÂÖç‰ΩøÁî®„ÄÇ</li>
</ul>
<h3 id="blockingqueueÁöÑÂÆûÁé∞Á±ª">BlockingQueueÁöÑÂÆûÁé∞Á±ª</h3>
<h4 id="arrayblockingqueue"><strong>ArrayBlockingQueue</strong></h4>
<p>Áî±<strong>Êï∞ÁªÑ</strong>ÁªìÊûÑÁªÑÊàêÁöÑ<strong>ÊúâÁïå</strong>ÈòªÂ°ûÈòüÂàó„ÄÇÂÜÖÈÉ®ÁªìÊûÑÊòØÊï∞ÁªÑÔºåÊïÖÂÖ∑ÊúâÊï∞ÁªÑÁöÑÁâπÊÄß„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="nf">ArrayBlockingQueue</span><span class="o">(</span><span class="kt">int</span> <span class="n">capacity</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">fair</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//..ÁúÅÁï•‰ª£Á†Å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÂàùÂßãÂåñÈòüÂàóÂ§ßÂ∞èÔºå ‰∏î‰∏ÄÊó¶ÂàùÂßãÂåñ‰∏çËÉΩÊîπÂèò„ÄÇÊûÑÈÄ†ÊñπÊ≥ï‰∏≠ÁöÑfairË°®Á§∫ÊéßÂà∂ÂØπË±°ÁöÑÂÜÖÈÉ®ÈîÅÊòØÂê¶ÈááÁî®ÂÖ¨Âπ≥ÈîÅÔºåÈªòËÆ§ÊòØ<strong>ÈùûÂÖ¨Âπ≥ÈîÅ</strong>„ÄÇ</p>
<h4 id="linkedblockingqueue"><strong>LinkedBlockingQueue</strong></h4>
<p>Áî±<strong>ÈìæË°®</strong>ÁªìÊûÑÁªÑÊàêÁöÑ<strong>ÊúâÁïå</strong>ÈòªÂ°ûÈòüÂàó„ÄÇÂÜÖÈÉ®ÁªìÊûÑÊòØÈìæË°®ÔºåÂÖ∑ÊúâÈìæË°®ÁöÑÁâπÊÄß„ÄÇÈªòËÆ§ÈòüÂàóÁöÑÂ§ßÂ∞èÊòØ<code>Integer.MAX_VALUE</code>Ôºå‰πüÂèØ‰ª•ÊåáÂÆöÂ§ßÂ∞è„ÄÇÊ≠§ÈòüÂàóÊåâÁÖß<strong>ÂÖàËøõÂÖàÂá∫</strong>ÁöÑÂéüÂàôÂØπÂÖÉÁ¥†ËøõË°åÊéíÂ∫è„ÄÇ</p>
<h4 id="delayqueue"><strong>DelayQueue</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ËØ•ÈòüÂàó‰∏≠ÁöÑÂÖÉÁ¥†Âè™ÊúâÂΩìÂÖ∂ÊåáÂÆöÁöÑÂª∂ËøüÊó∂Èó¥Âà∞‰∫ÜÔºåÊâçËÉΩÂ§ü‰ªéÈòüÂàó‰∏≠Ëé∑ÂèñÂà∞ËØ•ÂÖÉÁ¥† „ÄÇÊ≥®ÂÖ•ÂÖ∂‰∏≠ÁöÑÂÖÉÁ¥†ÂøÖÈ°ªÂÆûÁé∞ java.util.concurrent.Delayed Êé•Âè£„ÄÇ 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">DelayQueueÊòØ‰∏Ä‰∏™Ê≤°ÊúâÂ§ßÂ∞èÈôêÂà∂ÁöÑÈòüÂàóÔºåÂõ†Ê≠§ÂæÄÈòüÂàó‰∏≠ÊèíÂÖ•Êï∞ÊçÆÁöÑÊìç‰ΩúÔºàÁîü‰∫ßËÄÖÔºâÊ∞∏Ëøú‰∏ç‰ºöË¢´ÈòªÂ°ûÔºåËÄåÂè™ÊúâËé∑ÂèñÊï∞ÊçÆÁöÑÊìç‰ΩúÔºàÊ∂àË¥πËÄÖÔºâÊâç‰ºöË¢´ÈòªÂ°û„ÄÇ 
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="priorityblockingqueue"><strong>PriorityBlockingQueue</strong></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Âü∫‰∫é‰ºòÂÖàÁ∫ßÁöÑÊó†ÁïåÈòªÂ°ûÈòüÂàóÔºà‰ºòÂÖàÁ∫ßÁöÑÂà§Êñ≠ÈÄöËøáÊûÑÈÄ†ÂáΩÊï∞‰º†ÂÖ•ÁöÑCompatorÂØπË±°Êù•ÂÜ≥ÂÆöÔºâÔºåÂÜÖÈÉ®ÊéßÂà∂Á∫øÁ®ãÂêåÊ≠•ÁöÑÈîÅÈááÁî®ÁöÑÊòØÈùûÂÖ¨Âπ≥ÈîÅ„ÄÇ
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ÁΩë‰∏äÂ§ßÈÉ®ÂàÜÂçöÂÆ¢‰∏ä<strong>PriorityBlockingQueue</strong>‰∏∫ÂÖ¨Âπ≥ÈîÅÔºåÂÖ∂ÂÆûÊòØ‰∏çÂØπÁöÑÔºåÊü•ÈòÖÊ∫êÁ†ÅÔºàÊÑüË∞¢github:<strong>ambition0802</strong>ÂêåÂ≠¶ÁöÑÊåáÂá∫ÔºâÔºö</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="nf">PriorityBlockingQueue</span><span class="o">(</span><span class="kt">int</span> <span class="n">initialCapacity</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">Comparator</span><span class="o">&lt;?</span> <span class="kd">super</span> <span class="n">E</span><span class="o">&gt;</span> <span class="n">comparator</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">         <span class="k">this</span><span class="o">.</span><span class="na">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">();</span> <span class="c1">//ÈªòËÆ§ÊûÑÈÄ†ÊñπÊ≥ï-ÈùûÂÖ¨Âπ≥ÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>         <span class="o">...</span><span class="c1">//ÂÖ∂‰Ωô‰ª£Á†ÅÁï•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="synchronousqueue"><strong>SynchronousQueue</strong></h4>
<p>Ëøô‰∏™ÈòüÂàóÊØîËæÉÁâπÊÆäÔºå<strong>Ê≤°Êúâ‰ªª‰ΩïÂÜÖÈÉ®ÂÆπÈáè</strong>ÔºåÁîöËá≥Ëøû‰∏Ä‰∏™ÈòüÂàóÁöÑÂÆπÈáèÈÉΩÊ≤°Êúâ„ÄÇÂπ∂‰∏îÊØè‰∏™ put ÂøÖÈ°ªÁ≠âÂæÖ‰∏Ä‰∏™ takeÔºåÂèç‰πã‰∫¶ÁÑ∂„ÄÇ</p>
<p>ÈúÄË¶ÅÂå∫Âà´ÂÆπÈáè‰∏∫1ÁöÑArrayBlockingQueue„ÄÅLinkedBlockingQueue„ÄÇ</p>
<p>‰ª•‰∏ãÊñπÊ≥ïÁöÑËøîÂõûÂÄºÔºåÂèØ‰ª•Â∏ÆÂä©ÁêÜËß£Ëøô‰∏™ÈòüÂàóÔºö</p>
<ul>
<li>iterator() Ê∞∏ËøúËøîÂõûÁ©∫ÔºåÂõ†‰∏∫ÈáåÈù¢Ê≤°Êúâ‰∏úË•ø</li>
<li>peek() Ê∞∏ËøúËøîÂõûnull</li>
<li>put() ÂæÄqueueÊîæËøõÂéª‰∏Ä‰∏™element‰ª•ÂêéÂ∞±‰∏ÄÁõ¥waitÁõ¥Âà∞ÊúâÂÖ∂‰ªñthreadËøõÊù•ÊääËøô‰∏™elementÂèñËµ∞„ÄÇ</li>
<li>offer() ÂæÄqueueÈáåÊîæ‰∏Ä‰∏™elementÂêéÁ´ãÂç≥ËøîÂõûÔºåÂ¶ÇÊûúÁ¢∞Â∑ßËøô‰∏™elementË¢´Âè¶‰∏Ä‰∏™threadÂèñËµ∞‰∫ÜÔºåofferÊñπÊ≥ïËøîÂõûtrueÔºåËÆ§‰∏∫offerÊàêÂäüÔºõÂê¶ÂàôËøîÂõûfalse„ÄÇ</li>
<li>take() ÂèñÂá∫Âπ∂‰∏îremoveÊéâqueueÈáåÁöÑelementÔºåÂèñ‰∏çÂà∞‰∏úË•ø‰ªñ‰ºö‰∏ÄÁõ¥Á≠â„ÄÇ</li>
<li>poll() ÂèñÂá∫Âπ∂‰∏îremoveÊéâqueueÈáåÁöÑelementÔºåÂè™ÊúâÂà∞Á¢∞Â∑ßÂè¶Â§ñ‰∏Ä‰∏™Á∫øÁ®ãÊ≠£Âú®ÂæÄqueueÈáåofferÊï∞ÊçÆÊàñËÄÖputÊï∞ÊçÆÁöÑÊó∂ÂÄôÔºåËØ•ÊñπÊ≥ïÊâç‰ºöÂèñÂà∞‰∏úË•ø„ÄÇÂê¶ÂàôÁ´ãÂç≥ËøîÂõûnull„ÄÇ</li>
<li>isEmpty() Ê∞∏ËøúËøîÂõûtrue</li>
<li>remove()&amp;removeAll() Ê∞∏ËøúËøîÂõûfalse</li>
</ul>
<p><strong>Ê≥®ÊÑè</strong></p>
<p><strong>PriorityBlockingQueue</strong>‰∏ç‰ºöÈòªÂ°ûÊï∞ÊçÆÁîü‰∫ßËÄÖÔºàÂõ†‰∏∫ÈòüÂàóÊòØÊó†ÁïåÁöÑÔºâÔºåËÄåÂè™‰ºöÂú®Ê≤°ÊúâÂèØÊ∂àË¥πÁöÑÊï∞ÊçÆÊó∂ÔºåÈòªÂ°ûÊï∞ÊçÆÁöÑÊ∂àË¥πËÄÖ„ÄÇÂõ†Ê≠§‰ΩøÁî®ÁöÑÊó∂ÂÄôË¶ÅÁâπÂà´Ê≥®ÊÑèÔºå<strong>Áîü‰∫ßËÄÖÁîü‰∫ßÊï∞ÊçÆÁöÑÈÄüÂ∫¶ÁªùÂØπ‰∏çËÉΩÂø´‰∫éÊ∂àË¥πËÄÖÊ∂àË¥πÊï∞ÊçÆÁöÑÈÄüÂ∫¶ÔºåÂê¶ÂàôÊó∂Èó¥‰∏ÄÈïøÔºå‰ºöÊúÄÁªàËÄóÂ∞ΩÊâÄÊúâÁöÑÂèØÁî®Â†ÜÂÜÖÂ≠òÁ©∫Èó¥„ÄÇ<strong>ÂØπ‰∫é‰ΩøÁî®ÈªòËÆ§Â§ßÂ∞èÁöÑ</strong>LinkedBlockingQueue</strong>‰πüÊòØ‰∏ÄÊ†∑ÁöÑ„ÄÇ</p>
<h3 id="ÈòªÂ°ûÈòüÂàóÁöÑÂéüÁêÜ">ÈòªÂ°ûÈòüÂàóÁöÑÂéüÁêÜ</h3>
<p>ÈòªÂ°ûÈòüÂàóÁöÑÂéüÁêÜÂæàÁÆÄÂçïÔºåÂà©Áî®‰∫ÜLockÈîÅÁöÑÂ§öÊù°‰ª∂ÔºàConditionÔºâÈòªÂ°ûÊéßÂà∂„ÄÇÊé•‰∏ãÊù•Êàë‰ª¨ÂàÜÊûêArrayBlockingQueue JDK 1.8 ÁöÑÊ∫êÁ†Å„ÄÇ</p>
<p>È¶ñÂÖàÊòØÊûÑÈÄ†Âô®ÔºåÈô§‰∫ÜÂàùÂßãÂåñÈòüÂàóÁöÑÂ§ßÂ∞èÂíåÊòØÂê¶ÊòØÂÖ¨Âπ≥ÈîÅ‰πãÂ§ñÔºåËøòÂØπÂêå‰∏Ä‰∏™ÈîÅÔºàlockÔºâÂàùÂßãÂåñ‰∫Ü‰∏§‰∏™ÁõëËßÜÂô®ÔºåÂàÜÂà´ÊòØnotEmptyÂíånotFull„ÄÇËøô‰∏§‰∏™ÁõëËßÜÂô®ÁöÑ‰ΩúÁî®ÁõÆÂâçÂèØ‰ª•ÁÆÄÂçïÁêÜËß£‰∏∫Ê†áËÆ∞ÂàÜÁªÑÔºåÂΩìËØ•Á∫øÁ®ãÊòØputÊìç‰ΩúÊó∂ÔºåÁªô‰ªñÂä†‰∏äÁõëËßÜÂô®notFull,Ê†áËÆ∞Ëøô‰∏™Á∫øÁ®ãÊòØ‰∏Ä‰∏™Áîü‰∫ßËÄÖÔºõÂΩìÁ∫øÁ®ãÊòØtakeÊìç‰ΩúÊó∂ÔºåÁªô‰ªñÂä†‰∏äÁõëËßÜÂô®notEmptyÔºåÊ†áËÆ∞Ëøô‰∏™Á∫øÁ®ãÊòØÊ∂àË¥πËÄÖ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//Êï∞ÊçÆÂÖÉÁ¥†Êï∞ÁªÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">final</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">items</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//‰∏ã‰∏Ä‰∏™ÂæÖÂèñÂá∫ÂÖÉÁ¥†Á¥¢Âºï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">takeIndex</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//‰∏ã‰∏Ä‰∏™ÂæÖÊ∑ªÂä†ÂÖÉÁ¥†Á¥¢Âºï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">putIndex</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ÂÖÉÁ¥†‰∏™Êï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">count</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ÂÜÖÈÉ®ÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">final</span> <span class="n">ReentrantLock</span> <span class="n">lock</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//Ê∂àË¥πËÄÖÁõëËßÜÂô®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">final</span> <span class="n">Condition</span> <span class="n">notEmpty</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//Áîü‰∫ßËÄÖÁõëËßÜÂô®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">final</span> <span class="n">Condition</span> <span class="n">notFull</span><span class="o">;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="nf">ArrayBlockingQueue</span><span class="o">(</span><span class="kt">int</span> <span class="n">capacity</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">fair</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//..ÁúÅÁï•ÂÖ∂‰ªñ‰ª£Á†Å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">(</span><span class="n">fair</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">notEmpty</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">notFull</span> <span class="o">=</span>  <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>putÊìç‰ΩúÁöÑÊ∫êÁ†Å</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">checkNotNull</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lock</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1.Ëá™ÊóãÊãøÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">lock</span><span class="o">.</span><span class="na">lockInterruptibly</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 2.Âà§Êñ≠ÈòüÂàóÊòØÂê¶Êª°‰∫Ü
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">while</span> <span class="o">(</span><span class="n">count</span> <span class="o">==</span> <span class="n">items</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 2.1Â¶ÇÊûúÊª°‰∫ÜÔºåÈòªÂ°ûËØ•Á∫øÁ®ãÔºåÂπ∂Ê†áËÆ∞‰∏∫notFullÁ∫øÁ®ãÔºå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// Á≠âÂæÖnotFullÁöÑÂî§ÈÜíÔºåÂî§ÈÜí‰πãÂêéÁªßÁª≠ÊâßË°åwhileÂæ™ÁéØ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">notFull</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 3.Â¶ÇÊûúÊ≤°ÊúâÊª°ÔºåÂàôËøõÂÖ•ÈòüÂàó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">enqueue</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">enqueue</span><span class="o">(</span><span class="n">E</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// assert lock.getHoldCount() == 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// assert items[putIndex] == null;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">final</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">items</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">items</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">items</span><span class="o">[</span><span class="n">putIndex</span><span class="o">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(++</span><span class="n">putIndex</span> <span class="o">==</span> <span class="n">items</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">putIndex</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span><span class="o">++;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 4 Âî§ÈÜí‰∏Ä‰∏™Á≠âÂæÖÁöÑÁ∫øÁ®ã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">notEmpty</span><span class="o">.</span><span class="na">signal</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊÄªÁªìputÁöÑÊµÅÁ®ãÔºö</p>
<ol>
<li>ÊâÄÊúâÊâßË°åputÊìç‰ΩúÁöÑÁ∫øÁ®ãÁ´û‰∫âlockÈîÅÔºåÊãøÂà∞‰∫ÜlockÈîÅÁöÑÁ∫øÁ®ãËøõÂÖ•‰∏ã‰∏ÄÊ≠•ÔºåÊ≤°ÊúâÊãøÂà∞lockÈîÅÁöÑÁ∫øÁ®ãËá™ÊóãÁ´û‰∫âÈîÅ„ÄÇ</li>
<li>Âà§Êñ≠ÈòªÂ°ûÈòüÂàóÊòØÂê¶Êª°‰∫ÜÔºåÂ¶ÇÊûúÊª°‰∫ÜÔºåÂàôË∞ÉÁî®awaitÊñπÊ≥ïÈòªÂ°ûËøô‰∏™Á∫øÁ®ãÔºåÂπ∂Ê†áËÆ∞‰∏∫notFullÔºàÁîü‰∫ßËÄÖÔºâÁ∫øÁ®ãÔºåÂêåÊó∂ÈáäÊîælockÈîÅ,Á≠âÂæÖË¢´Ê∂àË¥πËÄÖÁ∫øÁ®ãÂî§ÈÜí„ÄÇ</li>
<li>Â¶ÇÊûúÊ≤°ÊúâÊª°ÔºåÂàôË∞ÉÁî®enqueueÊñπÊ≥ïÂ∞ÜÂÖÉÁ¥†putËøõÈòªÂ°ûÈòüÂàó„ÄÇÊ≥®ÊÑèËøô‰∏ÄÊ≠•ÁöÑÁ∫øÁ®ãËøòÊúâ‰∏ÄÁßçÊÉÖÂÜµÊòØÁ¨¨‰∫åÊ≠•‰∏≠ÈòªÂ°ûÁöÑÁ∫øÁ®ãË¢´Âî§ÈÜí‰∏îÂèàÊãøÂà∞‰∫ÜlockÈîÅÁöÑÁ∫øÁ®ã„ÄÇ</li>
<li>Âî§ÈÜí‰∏Ä‰∏™Ê†áËÆ∞‰∏∫notEmptyÔºàÊ∂àË¥πËÄÖÔºâÁöÑÁ∫øÁ®ã„ÄÇ</li>
</ol>
<p><strong>takeÊìç‰ΩúÁöÑÊ∫êÁ†Å</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">E</span> <span class="nf">take</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lock</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">lock</span><span class="o">.</span><span class="na">lockInterruptibly</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="o">(</span><span class="n">count</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">notEmpty</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">dequeue</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">E</span> <span class="nf">dequeue</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// assert lock.getHoldCount() == 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// assert items[takeIndex] != null;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">final</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">items</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">items</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">E</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="n">E</span><span class="o">)</span> <span class="n">items</span><span class="o">[</span><span class="n">takeIndex</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">items</span><span class="o">[</span><span class="n">takeIndex</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(++</span><span class="n">takeIndex</span> <span class="o">==</span> <span class="n">items</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">takeIndex</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span><span class="o">--;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">itrs</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">itrs</span><span class="o">.</span><span class="na">elementDequeued</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">notFull</span><span class="o">.</span><span class="na">signal</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>takeÊìç‰ΩúÂíåputÊìç‰ΩúÁöÑÊµÅÁ®ãÊòØÁ±ª‰ººÁöÑÔºåÊÄªÁªì‰∏Ä‰∏ãtakeÊìç‰ΩúÁöÑÊµÅÁ®ãÔºö</p>
<ol>
<li>ÊâÄÊúâÊâßË°åtakeÊìç‰ΩúÁöÑÁ∫øÁ®ãÁ´û‰∫âlockÈîÅÔºåÊãøÂà∞‰∫ÜlockÈîÅÁöÑÁ∫øÁ®ãËøõÂÖ•‰∏ã‰∏ÄÊ≠•ÔºåÊ≤°ÊúâÊãøÂà∞lockÈîÅÁöÑÁ∫øÁ®ãËá™ÊóãÁ´û‰∫âÈîÅ„ÄÇ</li>
<li>Âà§Êñ≠ÈòªÂ°ûÈòüÂàóÊòØÂê¶‰∏∫Á©∫ÔºåÂ¶ÇÊûúÊòØÁ©∫ÔºåÂàôË∞ÉÁî®awaitÊñπÊ≥ïÈòªÂ°ûËøô‰∏™Á∫øÁ®ãÔºåÂπ∂Ê†áËÆ∞‰∏∫notEmptyÔºàÊ∂àË¥πËÄÖÔºâÁ∫øÁ®ãÔºåÂêåÊó∂ÈáäÊîælockÈîÅ,Á≠âÂæÖË¢´Áîü‰∫ßËÄÖÁ∫øÁ®ãÂî§ÈÜí„ÄÇ</li>
<li>Â¶ÇÊûúÊ≤°ÊúâÁ©∫ÔºåÂàôË∞ÉÁî®dequeueÊñπÊ≥ï„ÄÇÊ≥®ÊÑèËøô‰∏ÄÊ≠•ÁöÑÁ∫øÁ®ãËøòÊúâ‰∏ÄÁßçÊÉÖÂÜµÊòØÁ¨¨‰∫åÊ≠•‰∏≠ÈòªÂ°ûÁöÑÁ∫øÁ®ãË¢´Âî§ÈÜí‰∏îÂèàÊãøÂà∞‰∫ÜlockÈîÅÁöÑÁ∫øÁ®ã„ÄÇ</li>
<li>Âî§ÈÜí‰∏Ä‰∏™Ê†áËÆ∞‰∏∫notFullÔºàÁîü‰∫ßËÄÖÔºâÁöÑÁ∫øÁ®ã„ÄÇ</li>
</ol>
<p><strong>Ê≥®ÊÑè</strong></p>
<ol>
<li>putÂíåtakeÊìç‰ΩúÈÉΩÈúÄË¶Å<strong>ÂÖàËé∑ÂèñÈîÅ</strong>ÔºåÊ≤°ÊúâËé∑ÂèñÂà∞ÈîÅÁöÑÁ∫øÁ®ã‰ºöË¢´Êå°Âú®Á¨¨‰∏ÄÈÅìÂ§ßÈó®‰πãÂ§ñËá™ÊóãÊãøÈîÅÔºåÁõ¥Âà∞Ëé∑ÂèñÂà∞ÈîÅ„ÄÇ</li>
<li>Â∞±ÁÆóÊãøÂà∞ÈîÅ‰∫Ü‰πãÂêéÔºå‰πü<strong>‰∏ç‰∏ÄÂÆö</strong>‰ºöÈ°∫Âà©ËøõË°åput/takeÊìç‰ΩúÔºåÈúÄË¶ÅÂà§Êñ≠<strong>ÈòüÂàóÊòØÂê¶ÂèØÁî®</strong>ÔºàÊòØÂê¶Êª°/Á©∫ÔºâÔºåÂ¶ÇÊûú‰∏çÂèØÁî®ÔºåÂàô‰ºöË¢´ÈòªÂ°ûÔºå<strong>Âπ∂ÈáäÊîæÈîÅ</strong>„ÄÇ</li>
<li>Âú®Á¨¨2ÁÇπË¢´ÈòªÂ°ûÁöÑÁ∫øÁ®ã‰ºöË¢´Âî§ÈÜíÔºå‰ΩÜÊòØÂú®Âî§ÈÜí‰πãÂêéÔºå<strong>‰æùÁÑ∂ÈúÄË¶ÅÊãøÂà∞ÈîÅ</strong>ÊâçËÉΩÁªßÁª≠ÂæÄ‰∏ãÊâßË°åÔºåÂê¶ÂàôÔºåËá™ÊóãÊãøÈîÅÔºåÊãøÂà∞ÈîÅ‰∫ÜÂÜçwhileÂà§Êñ≠ÈòüÂàóÊòØÂê¶ÂèØÁî®ÔºàËøô‰πüÊòØ‰∏∫‰ªÄ‰πà‰∏çÁî®ifÂà§Êñ≠ÔºåËÄå‰ΩøÁî®whileÂà§Êñ≠ÁöÑÂéüÂõ†Ôºâ„ÄÇ</li>
</ol>
<h3 id="Á§∫‰æãÂíå‰ΩøÁî®Âú∫ÊôØ">Á§∫‰æãÂíå‰ΩøÁî®Âú∫ÊôØ</h3>
<h4 id="Áîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖÊ®°Âûã">Áîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖÊ®°Âûã</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">queueSize</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">ArrayBlockingQueue</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayBlockingQueue</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;(</span><span class="n">queueSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span>  <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Test</span> <span class="n">test</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Test</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Producer</span> <span class="n">producer</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="na">new</span> <span class="nf">Producer</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Consumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="na">new</span> <span class="nf">Consumer</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">producer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">consumer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">class</span> <span class="nc">Consumer</span> <span class="kd">extends</span> <span class="n">Thread</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">consume</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">consume</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;‰ªéÈòüÂàóÂèñËµ∞‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰Ωô&#34;</span><span class="o">+</span><span class="n">queue</span><span class="o">.</span><span class="na">size</span><span class="o">()+</span><span class="s">&#34;‰∏™ÂÖÉÁ¥†&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">class</span> <span class="nc">Producer</span> <span class="kd">extends</span> <span class="n">Thread</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">produce</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kt">void</span> <span class="nf">produce</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö&#34;</span><span class="o">+(</span><span class="n">queueSize</span><span class="o">-</span><span class="n">queue</span><span class="o">.</span><span class="na">size</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏ãÈù¢ÊòØËøô‰∏™‰æãÂ≠êÁöÑËæìÂá∫ÁâáÊÆµÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">‰ªéÈòüÂàóÂèñËµ∞‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰Ωô0‰∏™ÂÖÉÁ¥†
</span></span><span class="line"><span class="cl">‰ªéÈòüÂàóÂèñËµ∞‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰Ωô0‰∏™ÂÖÉÁ¥†
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö9
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö9
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö9
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö8
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö7
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö6
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö5
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö4
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö3
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö2
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö1
</span></span><span class="line"><span class="cl">ÂêëÈòüÂàóÂèñ‰∏≠ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰ΩôÁ©∫Èó¥Ôºö0
</span></span><span class="line"><span class="cl">‰ªéÈòüÂàóÂèñËµ∞‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰Ωô1‰∏™ÂÖÉÁ¥†
</span></span><span class="line"><span class="cl">‰ªéÈòüÂàóÂèñËµ∞‰∏Ä‰∏™ÂÖÉÁ¥†ÔºåÈòüÂàóÂâ©‰Ωô9‰∏™ÂÖÉÁ¥†
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≥®ÊÑèÔºåËøô‰∏™‰æãÂ≠ê‰∏≠ÁöÑËæìÂá∫ÁªìÊûúÁúãËµ∑Êù•ÂèØËÉΩÊúâÈóÆÈ¢òÔºåÊØîÂ¶ÇÊúâÂá†Ë°åÂú®ÊèíÂÖ•‰∏Ä‰∏™ÂÖÉÁ¥†‰πãÂêéÔºåÈòüÂàóÁöÑÂâ©‰ΩôÁ©∫Èó¥‰∏çÂèò„ÄÇËøôÊòØÁî±‰∫é<strong>System.out.printlnËØ≠Âè•Ê≤°ÊúâÈîÅ</strong>„ÄÇËÄÉËôëÂà∞ËøôÊ†∑ÁöÑÊÉÖÂÜµÔºöÁ∫øÁ®ã1Âú®ÊâßË°åÂÆåput/takeÊìç‰ΩúÂêéÁ´ãÂç≥Â§±ÂéªCPUÊó∂Èó¥ÁâáÔºåÁÑ∂ÂêéÂàáÊç¢Âà∞Á∫øÁ®ã2ÊâßË°åput/takeÊìç‰ΩúÔºåÊâßË°åÂÆåÊØïÂêéÂõûÂà∞Á∫øÁ®ã1ÁöÑSystem.out.printlnËØ≠Âè•Âπ∂ËæìÂá∫ÔºåÂèëÁé∞Ëøô‰∏™Êó∂ÂÄôÈòªÂ°ûÈòüÂàóÁöÑsizeÂ∑≤ÁªèË¢´Á∫øÁ®ã2ÊîπÂèò‰∫ÜÔºåÊâÄ‰ª•Ëøô‰∏™Êó∂ÂÄôËæìÂá∫ÁöÑsizeÂπ∂‰∏çÊòØÂΩìÊó∂Á∫øÁ®ã1ÊâßË°åÂÆåput/takeÊìç‰Ωú‰πãÂêéÈòªÂ°ûÈòüÂàóÁöÑsizeÔºå‰ΩÜÂèØ‰ª•Á°Æ‰øùÁöÑÊòØsize‰∏ç‰ºöË∂ÖËøá10‰∏™„ÄÇÂÆûÈôÖ‰∏ä‰ΩøÁî®ÈòªÂ°ûÈòüÂàóÊòØÊ≤°ÊúâÈóÆÈ¢òÁöÑ„ÄÇ</p>
<h4 id="Á∫øÁ®ãÊ±†‰∏≠‰ΩøÁî®ÈòªÂ°ûÈòüÂàó">Á∫øÁ®ãÊ±†‰∏≠‰ΩøÁî®ÈòªÂ°ûÈòüÂàó</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"> <span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                           <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                           <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                           <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">,</span> <span class="n">maximumPoolSize</span><span class="o">,</span> <span class="n">keepAliveTime</span><span class="o">,</span> <span class="n">unit</span><span class="o">,</span> <span class="n">workQueue</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">             <span class="n">Executors</span><span class="o">.</span><span class="na">defaultThreadFactory</span><span class="o">(),</span> <span class="n">defaultHandler</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Java‰∏≠ÁöÑÁ∫øÁ®ãÊ±†Â∞±ÊòØ‰ΩøÁî®ÈòªÂ°ûÈòüÂàóÂÆûÁé∞ÁöÑÔºåÊàë‰ª¨Âú®‰∫ÜËß£ÈòªÂ°ûÈòüÂàó‰πãÂêéÔºåÊó†ËÆ∫ÊòØ‰ΩøÁî®ExecutorsÁ±ª‰∏≠Â∑≤ÁªèÊèê‰æõÁöÑÁ∫øÁ®ãÊ±†ÔºåËøòÊòØËá™Â∑±ÈÄöËøáThreadPoolExecutorÂÆûÁé∞Á∫øÁ®ãÊ±†ÔºåÈÉΩ‰ºöÊõ¥Âä†ÂæóÂøÉÂ∫îÊâãÔºåÊÉ≥Ë¶Å‰∫ÜËß£Á∫øÁ®ãÊ±†ÁöÑÂêåÂ≠¶ÔºåÂèØ‰ª•ÁúãÔºöÁ∫øÁ®ãÊ±†ÂéüÁêÜ„ÄÇ</p>
<blockquote>
<p>Ê≥®Ôºö‰∏äÈù¢ÊèêÂà∞‰∫ÜÁîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖÊ®°ÂºèÔºåÂ§ßÂÆ∂ÂèØ‰ª•ÂèÇËÄÉ<a class="link" href="http://note.youdao.com/noteshare?id=b4babef5d090f87cea8a97632f380c00"  target="_blank" rel="noopener"
    >Áîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖÊ®°Âûã</a>ÔºåÂèØ‰ª•Êõ¥Â•ΩÁöÑÁêÜËß£ÈòªÂ°ûÈòüÂàó„ÄÇ</p>
</blockquote>
<h2 id="ÈîÅÊé•Âè£ÂíåÁ±ª">ÈîÅÊé•Âè£ÂíåÁ±ª</h2>
<p>ÂâçÈù¢Êàë‰ª¨‰ªãÁªç‰∫ÜJavaÂéüÁîüÁöÑÈîÅ‚Äî‚ÄîÂü∫‰∫éÂØπË±°ÁöÑÈîÅÔºåÂÆÉ‰∏ÄËà¨ÊòØÈÖçÂêàsynchronizedÂÖ≥ÈîÆÂ≠óÊù•‰ΩøÁî®ÁöÑ„ÄÇÂÆûÈôÖ‰∏äÔºåJavaÂú®<code>java.util.concurrent.locks</code>ÂåÖ‰∏ãÔºåËøò‰∏∫Êàë‰ª¨Êèê‰æõ‰∫ÜÂá†‰∏™ÂÖ≥‰∫éÈîÅÁöÑÁ±ªÂíåÊé•Âè£„ÄÇÂÆÉ‰ª¨ÊúâÊõ¥Âº∫Â§ßÁöÑÂäüËÉΩÊàñÊõ¥È´òÁöÑÊÄßËÉΩ„ÄÇ</p>
<h3 id="synchronizedÁöÑ‰∏çË∂≥‰πãÂ§Ñ">synchronizedÁöÑ‰∏çË∂≥‰πãÂ§Ñ</h3>
<p>Êàë‰ª¨ÂÖàÊù•ÁúãÁúã<code>synchronized</code>Êúâ‰ªÄ‰πà‰∏çË∂≥‰πãÂ§Ñ„ÄÇ</p>
<ul>
<li>Â¶ÇÊûú‰∏¥ÁïåÂå∫ÊòØÂè™ËØªÊìç‰ΩúÔºåÂÖ∂ÂÆûÂèØ‰ª•Â§öÁ∫øÁ®ã‰∏ÄËµ∑ÊâßË°åÔºå‰ΩÜ‰ΩøÁî®synchronizedÁöÑËØùÔºå<strong>Âêå‰∏ÄÊó∂Èó¥Âè™ËÉΩÊúâ‰∏Ä‰∏™Á∫øÁ®ãÊâßË°å</strong>„ÄÇ</li>
<li>synchronizedÊó†Ê≥ïÁü•ÈÅìÁ∫øÁ®ãÊúâÊ≤°ÊúâÊàêÂäüËé∑ÂèñÂà∞ÈîÅ</li>
<li>‰ΩøÁî®synchronizedÔºåÂ¶ÇÊûú‰∏¥ÁïåÂå∫Âõ†‰∏∫IOÊàñËÄÖsleepÊñπÊ≥ïÁ≠âÂéüÂõ†ÈòªÂ°û‰∫ÜÔºåËÄåÂΩìÂâçÁ∫øÁ®ãÂèàÊ≤°ÊúâÈáäÊîæÈîÅÔºåÂ∞±‰ºöÂØºËá¥<strong>ÊâÄÊúâÁ∫øÁ®ãÁ≠âÂæÖ</strong>„ÄÇ</li>
</ul>
<p>ËÄåËøô‰∫õÈÉΩÊòØlocksÂåÖ‰∏ãÁöÑÈîÅÂèØ‰ª•Ëß£ÂÜ≥ÁöÑ„ÄÇ</p>
<h3 id="ÈîÅÁöÑÂá†ÁßçÂàÜÁ±ª">ÈîÅÁöÑÂá†ÁßçÂàÜÁ±ª</h3>
<p>ÈîÅÂèØ‰ª•Ê†πÊçÆ‰ª•‰∏ãÂá†ÁßçÊñπÂºèÊù•ËøõË°åÂàÜÁ±ªÔºå‰∏ãÈù¢Êàë‰ª¨ÈÄê‰∏Ä‰ªãÁªç„ÄÇ</p>
<h4 id="ÂèØÈáçÂÖ•ÈîÅÂíåÈùûÂèØÈáçÂÖ•ÈîÅ">ÂèØÈáçÂÖ•ÈîÅÂíåÈùûÂèØÈáçÂÖ•ÈîÅ</h4>
<p>ÊâÄË∞ìÈáçÂÖ•ÈîÅÔºåÈ°æÂêçÊÄù‰πâ„ÄÇÂ∞±ÊòØÊîØÊåÅÈáçÊñ∞ËøõÂÖ•ÁöÑÈîÅÔºå‰πüÂ∞±ÊòØËØ¥Ëøô‰∏™ÈîÅÊîØÊåÅ‰∏Ä‰∏™<strong>Á∫øÁ®ãÂØπËµÑÊ∫êÈáçÂ§çÂä†ÈîÅ</strong>„ÄÇ</p>
<p>synchronizedÂÖ≥ÈîÆÂ≠óÂ∞±ÊòØ‰ΩøÁî®ÁöÑÈáçÂÖ•ÈîÅ„ÄÇÊØîÂ¶ÇËØ¥Ôºå‰Ω†Âú®‰∏Ä‰∏™synchronizedÂÆû‰æãÊñπÊ≥ïÈáåÈù¢Ë∞ÉÁî®Âè¶‰∏Ä‰∏™Êú¨ÂÆû‰æãÁöÑsynchronizedÂÆû‰æãÊñπÊ≥ïÔºåÂÆÉÂèØ‰ª•ÈáçÊñ∞ËøõÂÖ•Ëøô‰∏™ÈîÅÔºå‰∏ç‰ºöÂá∫Áé∞‰ªª‰ΩïÂºÇÂ∏∏„ÄÇ</p>
<p>Â¶ÇÊûúÊàë‰ª¨Ëá™Â∑±Âú®ÁªßÊâøAQSÂÆûÁé∞ÂêåÊ≠•Âô®ÁöÑÊó∂ÂÄôÔºåÊ≤°ÊúâËÄÉËôëÂà∞Âç†ÊúâÈîÅÁöÑÁ∫øÁ®ãÂÜçÊ¨°Ëé∑ÂèñÈîÅÁöÑÂú∫ÊôØÔºåÂèØËÉΩÂ∞±‰ºöÂØºËá¥Á∫øÁ®ãÈòªÂ°ûÔºåÈÇ£Ëøô‰∏™Â∞±ÊòØ‰∏Ä‰∏™‚ÄúÈùûÂèØÈáçÂÖ•ÈîÅ‚Äù„ÄÇ</p>
<p><code>ReentrantLock</code>ÁöÑ‰∏≠ÊñáÊÑèÊÄùÂ∞±ÊòØÂèØÈáçÂÖ•ÈîÅ„ÄÇ‰πüÊòØÊú¨ÊñáÂêéÁª≠Ë¶Å‰ªãÁªçÁöÑÈáçÁÇπÁ±ª„ÄÇ</p>
<h4 id="ÂÖ¨Âπ≥ÈîÅ‰∏éÈùûÂÖ¨Âπ≥ÈîÅ">ÂÖ¨Âπ≥ÈîÅ‰∏éÈùûÂÖ¨Âπ≥ÈîÅ</h4>
<p>ËøôÈáåÁöÑ‚ÄúÂÖ¨Âπ≥‚ÄùÔºåÂÖ∂ÂÆûÈÄö‰øóÊÑè‰πâÊù•ËØ¥Â∞±ÊòØ‚ÄúÂÖàÊù•ÂêéÂà∞‚ÄùÔºå‰πüÂ∞±ÊòØFIFO„ÄÇÂ¶ÇÊûúÂØπ‰∏Ä‰∏™ÈîÅÊù•ËØ¥ÔºåÂÖàÂØπÈîÅËé∑ÂèñËØ∑Ê±ÇÁöÑÁ∫øÁ®ã‰∏ÄÂÆö‰ºöÂÖàË¢´Êª°Ë∂≥ÔºåÂêéÂØπÈîÅËé∑ÂèñËØ∑Ê±ÇÁöÑÁ∫øÁ®ãÂêéË¢´Êª°Ë∂≥ÔºåÈÇ£Ëøô‰∏™ÈîÅÂ∞±ÊòØÂÖ¨Âπ≥ÁöÑ„ÄÇÂèç‰πãÔºåÈÇ£Â∞±ÊòØ‰∏çÂÖ¨Âπ≥ÁöÑ„ÄÇ</p>
<p>‰∏ÄËà¨ÊÉÖÂÜµ‰∏ãÔºå<strong>ÈùûÂÖ¨Âπ≥ÈîÅËÉΩÊèêÂçá‰∏ÄÂÆöÁöÑÊïàÁéá„ÄÇ‰ΩÜÊòØÈùûÂÖ¨Âπ≥ÈîÅÂèØËÉΩ‰ºöÂèëÁîüÁ∫øÁ®ãÈ••È•øÔºàÊúâ‰∏Ä‰∫õÁ∫øÁ®ãÈïøÊó∂Èó¥Âæó‰∏çÂà∞ÈîÅÔºâÁöÑÊÉÖÂÜµ</strong>„ÄÇÊâÄ‰ª•Ë¶ÅÊ†πÊçÆÂÆûÈôÖÁöÑÈúÄÊ±ÇÊù•ÈÄâÊã©ÈùûÂÖ¨Âπ≥ÈîÅÂíåÂÖ¨Âπ≥ÈîÅ„ÄÇ</p>
<p>ReentrantLockÊîØÊåÅÈùûÂÖ¨Âπ≥ÈîÅÂíåÂÖ¨Âπ≥ÈîÅ‰∏§Áßç„ÄÇ</p>
<h4 id="ËØªÂÜôÈîÅÂíåÊéíÂÆÉÈîÅ">ËØªÂÜôÈîÅÂíåÊéíÂÆÉÈîÅ</h4>
<p>Êàë‰ª¨ÂâçÈù¢ËÆ≤Âà∞ÁöÑsynchronizedÁî®ÁöÑÈîÅÂíåReentrantLockÔºåÂÖ∂ÂÆûÈÉΩÊòØ‚ÄúÊéíÂÆÉÈîÅ‚Äù„ÄÇ‰πüÂ∞±ÊòØËØ¥ÔºåËøô‰∫õÈîÅÂú®Âêå‰∏ÄÊó∂ÂàªÂè™ÂÖÅËÆ∏‰∏Ä‰∏™Á∫øÁ®ãËøõË°åËÆøÈóÆ„ÄÇ</p>
<p>ËÄåËØªÂÜôÈîÅÂèØ‰ª•Âú®Âêå‰∏ÄÊó∂ÂàªÂÖÅËÆ∏Â§ö‰∏™ËØªÁ∫øÁ®ãËÆøÈóÆ„ÄÇJavaÊèê‰æõ‰∫ÜReentrantReadWriteLockÁ±ª‰Ωú‰∏∫ËØªÂÜôÈîÅÁöÑÈªòËÆ§ÂÆûÁé∞ÔºåÂÜÖÈÉ®Áª¥Êä§‰∫Ü‰∏§‰∏™ÈîÅÔºö‰∏Ä‰∏™ËØªÈîÅÔºå‰∏Ä‰∏™ÂÜôÈîÅ„ÄÇÈÄöËøáÂàÜÁ¶ªËØªÈîÅÂíåÂÜôÈîÅÔºå‰ΩøÂæóÂú®‚ÄúËØªÂ§öÂÜôÂ∞ë‚ÄùÁöÑÁéØÂ¢É‰∏ãÔºåÂ§ßÂ§ßÂú∞ÊèêÈ´ò‰∫ÜÊÄßËÉΩ„ÄÇ</p>
<blockquote>
<p>Ê≥®ÊÑèÔºåÂç≥‰ΩøÁî®ËØªÂÜôÈîÅÔºåÂú®ÂÜôÁ∫øÁ®ãËÆøÈóÆÊó∂ÔºåÊâÄÊúâÁöÑËØªÁ∫øÁ®ãÂíåÂÖ∂ÂÆÉÂÜôÁ∫øÁ®ãÂùáË¢´ÈòªÂ°û„ÄÇ</p>
</blockquote>
<p><strong>ÂèØËßÅÔºåÂè™ÊòØsynchronizedÊòØËøúËøú‰∏çËÉΩÊª°Ë∂≥Â§öÊ†∑ÂåñÁöÑ‰∏öÂä°ÂØπÈîÅÁöÑË¶ÅÊ±ÇÁöÑ</strong>„ÄÇÊé•‰∏ãÊù•Êàë‰ª¨‰ªãÁªç‰∏Ä‰∏ãJDK‰∏≠ÊúâÂÖ≥ÈîÅÁöÑ‰∏Ä‰∫õÊé•Âè£ÂíåÁ±ª„ÄÇ</p>
<h3 id="jdk‰∏≠ÊúâÂÖ≥ÈîÅÁöÑ‰∏Ä‰∫õÊé•Âè£ÂíåÁ±ª">JDK‰∏≠ÊúâÂÖ≥ÈîÅÁöÑ‰∏Ä‰∫õÊé•Âè£ÂíåÁ±ª</h3>
<p>‰ºóÊâÄÂë®Áü•ÔºåJDK‰∏≠ÂÖ≥‰∫éÂπ∂ÂèëÁöÑÁ±ªÂ§ßÂ§öÈÉΩÂú®<code>java.util.concurrent</code>Ôºà‰ª•‰∏ãÁÆÄÁß∞jucÔºâÂåÖ‰∏ã„ÄÇËÄåjuc.locksÂåÖÁúãÂêçÂ≠óÂ∞±Áü•ÈÅìÔºåÊòØÊèê‰æõ‰∫Ü‰∏Ä‰∫õÂπ∂ÂèëÈîÅÁöÑÂ∑•ÂÖ∑Á±ªÁöÑ„ÄÇÂâçÈù¢Êàë‰ª¨‰ªãÁªçÁöÑAQSÔºàAbstractQueuedSynchronizerÔºâÂ∞±ÊòØÂú®Ëøô‰∏™ÂåÖ‰∏ã„ÄÇ‰∏ãÈù¢ÂàÜÂà´‰ªãÁªç‰∏Ä‰∏ãËøô‰∏™ÂåÖ‰∏ãÁöÑÁ±ªÂíåÊé•Âè£‰ª•ÂèäÂÆÉ‰ª¨‰πãÈó¥ÁöÑÂÖ≥Á≥ª„ÄÇ</p>
<h4 id="ÊäΩË±°Á±ªaqsaqlsaos">ÊäΩË±°Á±ªAQS/AQLS/AOS</h4>
<p>Ëøô‰∏â‰∏™ÊäΩË±°Á±ªÊúâ‰∏ÄÂÆöÁöÑÂÖ≥Á≥ªÔºåÊâÄ‰ª•ËøôÈáåÊîæÂà∞‰∏ÄËµ∑ËÆ≤„ÄÇ</p>
<p>È¶ñÂÖàÊàë‰ª¨Áúã<strong>AQS</strong>ÔºàAbstractQueuedSynchronizerÔºâÔºå‰πãÂâç‰∏ìÈó®ÊúâÁ´†ËäÇ‰ªãÁªçËøô‰∏™Á±ªÔºåÂÆÉÊòØÂú®JDK 1.5 ÂèëÂ∏ÉÁöÑÔºåÊèê‰æõ‰∫Ü‰∏Ä‰∏™‚ÄúÈòüÂàóÂêåÊ≠•Âô®‚ÄùÁöÑÂü∫Êú¨ÂäüËÉΩÂÆûÁé∞„ÄÇËÄåAQSÈáåÈù¢ÁöÑ‚ÄúËµÑÊ∫ê‚ÄùÊòØÁî®‰∏Ä‰∏™<code>int</code>Á±ªÂûãÁöÑÊï∞ÊçÆÊù•Ë°®Á§∫ÁöÑÔºåÊúâÊó∂ÂÄôÊàë‰ª¨ÁöÑ‰∏öÂä°ÈúÄÊ±ÇËµÑÊ∫êÁöÑÊï∞ÈáèË∂ÖÂá∫‰∫Ü<code>int</code>ÁöÑËåÉÂõ¥ÔºåÊâÄ‰ª•Âú®JDK 1.6 ‰∏≠ÔºåÂ§ö‰∫Ü‰∏Ä‰∏™<strong>AQLS</strong>ÔºàAbstractQueuedLongSynchronizerÔºâ„ÄÇÂÆÉÁöÑ‰ª£Á†ÅË∑üAQSÂá†‰πé‰∏ÄÊ†∑ÔºåÂè™ÊòØÊääËµÑÊ∫êÁöÑÁ±ªÂûãÂèòÊàê‰∫Ü<code>long</code>Á±ªÂûã„ÄÇ</p>
<p>AQSÂíåAQLSÈÉΩÁªßÊâø‰∫Ü‰∏Ä‰∏™Á±ªÂè´<strong>AOS</strong>ÔºàAbstractOwnableSynchronizerÔºâ„ÄÇËøô‰∏™Á±ª‰πüÊòØÂú®JDK 1.6 ‰∏≠Âá∫Áé∞ÁöÑ„ÄÇËøô‰∏™Á±ªÂè™ÊúâÂá†Ë°åÁÆÄÂçïÁöÑ‰ª£Á†Å„ÄÇ‰ªéÊ∫êÁ†ÅÁ±ª‰∏äÁöÑÊ≥®ÈáäÂèØ‰ª•Áü•ÈÅìÔºåÂÆÉÊòØÁî®‰∫éË°®Á§∫ÈîÅ‰∏éÊåÅÊúâËÄÖ‰πãÈó¥ÁöÑÂÖ≥Á≥ªÔºàÁã¨Âç†Ê®°ÂºèÔºâ„ÄÇÂèØ‰ª•Áúã‰∏Ä‰∏ãÂÆÉÁöÑ‰∏ªË¶ÅÊñπÊ≥ïÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Áã¨Âç†Ê®°ÂºèÔºåÈîÅÁöÑÊåÅÊúâËÄÖ  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">transient</span> <span class="n">Thread</span> <span class="n">exclusiveOwnerThread</span><span class="o">;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ËÆæÁΩÆÈîÅÊåÅÊúâËÄÖ  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">protected</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">setExclusiveOwnerThread</span><span class="o">(</span><span class="n">Thread</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>  
</span></span><span class="line"><span class="cl">    <span class="n">exclusiveOwnerThread</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span>  
</span></span><span class="line"><span class="cl"><span class="o">}</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Ëé∑ÂèñÈîÅÁöÑÊåÅÊúâÁ∫øÁ®ã  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">protected</span> <span class="kd">final</span> <span class="n">Thread</span> <span class="nf">getExclusiveOwnerThread</span><span class="o">()</span> <span class="o">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">exclusiveOwnerThread</span><span class="o">;</span>  
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Êé•Âè£conditionlockreadwritelock">Êé•Âè£Condition/Lock/ReadWriteLock</h4>
<p>juc.locksÂåÖ‰∏ãÂÖ±Êúâ‰∏â‰∏™Êé•Âè£Ôºö<code>Condition</code>„ÄÅ<code>Lock</code>„ÄÅ<code>ReadWriteLock</code>„ÄÇÂÖ∂‰∏≠ÔºåLockÂíåReadWriteLock‰ªéÂêçÂ≠óÂ∞±ÂèØ‰ª•ÁúãÂæóÂá∫Êù•ÔºåÂàÜÂà´ÊòØÈîÅÂíåËØªÂÜôÈîÅÁöÑÊÑèÊÄù„ÄÇLockÊé•Âè£ÈáåÈù¢Êúâ‰∏Ä‰∫õËé∑ÂèñÈîÅÂíåÈáäÊîæÈîÅÁöÑÊñπÊ≥ïÂ£∞ÊòéÔºåËÄåReadWriteLockÈáåÈù¢Âè™Êúâ‰∏§‰∏™ÊñπÊ≥ïÔºåÂàÜÂà´ËøîÂõû‚ÄúËØªÈîÅ‚ÄùÂíå‚ÄúÂÜôÈîÅ‚ÄùÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ReadWriteLock</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Lock</span> <span class="nf">readLock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Lock</span> <span class="nf">writeLock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>LockÊé•Âè£‰∏≠Êúâ‰∏Ä‰∏™ÊñπÊ≥ïÊòØÂèØ‰ª•Ëé∑Âæó‰∏Ä‰∏™<code>Condition</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Condition</span> <span class="nf">newCondition</span><span class="o">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰πãÂâçÊàë‰ª¨ÊèêÂà∞‰∫ÜÊØè‰∏™ÂØπË±°ÈÉΩÂèØ‰ª•Áî®ÁªßÊâøËá™<code>Object</code>ÁöÑ<strong>wait/notify</strong>ÊñπÊ≥ïÊù•ÂÆûÁé∞<strong>Á≠âÂæÖ/ÈÄöÁü•Êú∫Âà∂</strong>„ÄÇËÄåConditionÊé•Âè£‰πüÊèê‰æõ‰∫ÜÁ±ª‰ººObjectÁõëËßÜÂô®ÁöÑÊñπÊ≥ïÔºåÈÄöËøá‰∏é<strong>Lock</strong>ÈÖçÂêàÊù•ÂÆûÁé∞Á≠âÂæÖ/ÈÄöÁü•Ê®°Âºè„ÄÇ</p>
<p>ÈÇ£‰∏∫‰ªÄ‰πàÊó¢ÁÑ∂ÊúâObjectÁöÑÁõëËßÜÂô®ÊñπÊ≥ï‰∫ÜÔºåËøòË¶ÅÁî®ConditionÂë¢ÔºüËøôÈáåÊúâ‰∏Ä‰∏™‰∫åËÄÖÁÆÄÂçïÁöÑÂØπÊØîÔºö</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>ÂØπÊØîÈ°π</th>
<th>ObjectÁõëËßÜÂô®</th>
<th>Condition</th>
</tr>
</thead>
<tbody>
<tr>
<td>ÂâçÁΩÆÊù°‰ª∂</td>
<td>Ëé∑ÂèñÂØπË±°ÁöÑÈîÅ</td>
<td>Ë∞ÉÁî®Lock.lockËé∑ÂèñÈîÅÔºåË∞ÉÁî®Lock.newConditionËé∑ÂèñConditionÂØπË±°</td>
</tr>
<tr>
<td>Ë∞ÉÁî®ÊñπÂºè</td>
<td>Áõ¥Êé•Ë∞ÉÁî®ÔºåÊØîÂ¶Çobject.notify()</td>
<td>Áõ¥Êé•Ë∞ÉÁî®ÔºåÊØîÂ¶Çcondition.await()</td>
</tr>
<tr>
<td>Á≠âÂæÖÈòüÂàóÁöÑ‰∏™Êï∞</td>
<td>‰∏Ä‰∏™</td>
<td>Â§ö‰∏™</td>
</tr>
<tr>
<td>ÂΩìÂâçÁ∫øÁ®ãÈáäÊîæÈîÅËøõÂÖ•Á≠âÂæÖÁä∂ÊÄÅ</td>
<td>ÊîØÊåÅ</td>
<td>ÊîØÊåÅ</td>
</tr>
<tr>
<td>ÂΩìÂâçÁ∫øÁ®ãÈáäÊîæÈîÅËøõÂÖ•Á≠âÂæÖÁä∂ÊÄÅÔºåÂú®Á≠âÂæÖÁä∂ÊÄÅ‰∏≠‰∏ç‰∏≠Êñ≠</td>
<td>‰∏çÊîØÊåÅ</td>
<td>ÊîØÊåÅ</td>
</tr>
<tr>
<td>ÂΩìÂâçÁ∫øÁ®ãÈáäÊîæÈîÅÂπ∂ËøõÂÖ•Ë∂ÖÊó∂Á≠âÂæÖÁä∂ÊÄÅ</td>
<td>ÊîØÊåÅ</td>
<td>ÊîØÊåÅ</td>
</tr>
<tr>
<td>ÂΩìÂâçÁ∫øÁ®ãÈáäÊîæÈîÅÂπ∂ËøõÂÖ•Á≠âÂæÖÁä∂ÊÄÅÁõ¥Âà∞Â∞ÜÊù•ÁöÑÊüê‰∏™Êó∂Èó¥</td>
<td>‰∏çÊîØÊåÅ</td>
<td>ÊîØÊåÅ</td>
</tr>
<tr>
<td>Âî§ÈÜíÁ≠âÂæÖÈòüÂàó‰∏≠ÁöÑ‰∏Ä‰∏™Á∫øÁ®ã</td>
<td>ÊîØÊåÅ</td>
<td>ÊîØÊåÅ</td>
</tr>
<tr>
<td>Âî§ÈÜíÁ≠âÂæÖÈòüÂàó‰∏≠ÁöÑÂÖ®ÈÉ®Á∫øÁ®ã</td>
<td>ÊîØÊåÅ</td>
<td>ÊîØÊåÅ</td>
</tr>
</tbody>
</table></div>
<p>ConditionÂíåObjectÁöÑwait/notifyÂü∫Êú¨Áõ∏‰ºº„ÄÇÂÖ∂‰∏≠ÔºåConditionÁöÑawaitÊñπÊ≥ïÂØπÂ∫îÁöÑÊòØObjectÁöÑwaitÊñπÊ≥ïÔºåËÄåConditionÁöÑ<strong>signal/signalAll</strong>ÊñπÊ≥ïÂàôÂØπÂ∫îObjectÁöÑnotify/notifyAll()„ÄÇ‰ΩÜConditionÁ±ª‰ºº‰∫éObjectÁöÑÁ≠âÂæÖ/ÈÄöÁü•Êú∫Âà∂ÁöÑÂä†Âº∫Áâà„ÄÇÊàë‰ª¨Êù•ÁúãÁúã‰∏ªË¶ÅÁöÑÊñπÊ≥ïÔºö</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>ÊñπÊ≥ïÂêçÁß∞</th>
<th>ÊèèËø∞</th>
</tr>
</thead>
<tbody>
<tr>
<td>await()</td>
<td>ÂΩìÂâçÁ∫øÁ®ãËøõÂÖ•Á≠âÂæÖÁä∂ÊÄÅÁõ¥Âà∞Ë¢´ÈÄöÁü•ÔºàsignalÔºâÊàñËÄÖ‰∏≠Êñ≠ÔºõÂΩìÂâçÁ∫øÁ®ãËøõÂÖ•ËøêË°åÁä∂ÊÄÅÂπ∂‰ªéawait()ÊñπÊ≥ïËøîÂõûÁöÑÂú∫ÊôØÂåÖÊã¨ÔºöÔºà1ÔºâÂÖ∂‰ªñÁ∫øÁ®ãË∞ÉÁî®Áõ∏ÂêåConditionÂØπË±°ÁöÑsignal/signalAllÊñπÊ≥ïÔºåÂπ∂‰∏îÂΩìÂâçÁ∫øÁ®ãË¢´Âî§ÈÜíÔºõÔºà2ÔºâÂÖ∂‰ªñÁ∫øÁ®ãË∞ÉÁî®interruptÊñπÊ≥ï‰∏≠Êñ≠ÂΩìÂâçÁ∫øÁ®ãÔºõ</td>
</tr>
<tr>
<td>awaitUninterruptibly()</td>
<td>ÂΩìÂâçÁ∫øÁ®ãËøõÂÖ•Á≠âÂæÖÁä∂ÊÄÅÁõ¥Âà∞Ë¢´ÈÄöÁü•ÔºåÂú®Ê≠§ËøáÁ®ã‰∏≠ÂØπ‰∏≠Êñ≠‰ø°Âè∑‰∏çÊïèÊÑüÔºå‰∏çÊîØÊåÅ‰∏≠Êñ≠ÂΩìÂâçÁ∫øÁ®ã</td>
</tr>
<tr>
<td>awaitNanos(long)</td>
<td>ÂΩìÂâçÁ∫øÁ®ãËøõÂÖ•Á≠âÂæÖÁä∂ÊÄÅÔºåÁõ¥Âà∞Ë¢´ÈÄöÁü•„ÄÅ‰∏≠Êñ≠ÊàñËÄÖË∂ÖÊó∂„ÄÇÂ¶ÇÊûúËøîÂõûÂÄºÂ∞è‰∫éÁ≠â‰∫é0ÔºåÂèØ‰ª•ËÆ§ÂÆöÂ∞±ÊòØË∂ÖÊó∂‰∫Ü</td>
</tr>
<tr>
<td>awaitUntil(Date)</td>
<td>ÂΩìÂâçÁ∫øÁ®ãËøõÂÖ•Á≠âÂæÖÁä∂ÊÄÅÔºåÁõ¥Âà∞Ë¢´ÈÄöÁü•„ÄÅ‰∏≠Êñ≠ÊàñËÄÖË∂ÖÊó∂„ÄÇÂ¶ÇÊûúÊ≤°Âà∞ÊåáÂÆöÊó∂Èó¥Ë¢´ÈÄöÁü•ÔºåÂàôËøîÂõûtrueÔºåÂê¶ÂàôËøîÂõûfalse</td>
</tr>
<tr>
<td>signal()</td>
<td>Âî§ÈÜí‰∏Ä‰∏™Á≠âÂæÖÂú®Condition‰∏äÁöÑÁ∫øÁ®ãÔºåË¢´Âî§ÈÜíÁöÑÁ∫øÁ®ãÂú®ÊñπÊ≥ïËøîÂõûÂâçÂøÖÈ°ªËé∑Âæó‰∏éConditionÂØπË±°ÂÖ≥ËÅîÁöÑÈîÅ</td>
</tr>
<tr>
<td>signalAll()</td>
<td>Âî§ÈÜíÊâÄÊúâÁ≠âÂæÖÂú®Condition‰∏äÁöÑÁ∫øÁ®ãÔºåËÉΩÂ§ü‰ªéawait()Á≠âÊñπÊ≥ïËøîÂõûÁöÑÁ∫øÁ®ãÂøÖÈ°ªÂÖàËé∑Âæó‰∏éConditionÂØπË±°ÂÖ≥ËÅîÁöÑÈîÅ</td>
</tr>
</tbody>
</table></div>
<h4 id="reentrantlock">ReentrantLock</h4>
<p>ReentrantLockÊòØ‰∏Ä‰∏™ÈùûÊäΩË±°Á±ªÔºåÂÆÉÊòØLockÊé•Âè£ÁöÑJDKÈªòËÆ§ÂÆûÁé∞ÔºåÂÆûÁé∞‰∫ÜÈîÅÁöÑÂü∫Êú¨ÂäüËÉΩ„ÄÇ‰ªéÂêçÂ≠ó‰∏äÁúãÔºåÂÆÉÊòØ‰∏Ä‰∏™‚ÄùÂèØÈáçÂÖ•‚ÄúÈîÅÔºå‰ªéÊ∫êÁ†Å‰∏äÁúãÔºåÂÆÉÂÜÖÈÉ®Êúâ‰∏Ä‰∏™ÊäΩË±°Á±ª<code>Sync</code>ÔºåÊòØÁªßÊâø‰∫ÜAQSÔºåËá™Â∑±ÂÆûÁé∞ÁöÑ‰∏Ä‰∏™ÂêåÊ≠•Âô®„ÄÇÂêåÊó∂ÔºåReentrantLockÂÜÖÈÉ®Êúâ‰∏§‰∏™ÈùûÊäΩË±°Á±ª<code>NonfairSync</code>Âíå<code>FairSync</code>ÔºåÂÆÉ‰ª¨ÈÉΩÁªßÊâø‰∫ÜSync„ÄÇ‰ªéÂêçÂ≠ó‰∏äÁúãÂæóÂá∫ÔºåÂàÜÂà´ÊòØ‚ÄùÈùûÂÖ¨Âπ≥ÂêåÊ≠•Âô®‚ÄúÂíå‚ÄùÂÖ¨Âπ≥ÂêåÊ≠•Âô®‚ÄúÁöÑÊÑèÊÄù„ÄÇËøôÊÑèÂë≥ÁùÄReentrantLockÂèØ‰ª•ÊîØÊåÅ‚ÄùÂÖ¨Âπ≥ÈîÅ‚ÄúÂíå‚ÄùÈùûÂÖ¨Âπ≥ÈîÅ‚Äú„ÄÇ</p>
<p>ÈÄöËøáÁúãËøô‰∏§‰∏™ÂêåÊ≠•Âô®ÁöÑÊ∫êÁ†ÅÂèØ‰ª•ÂèëÁé∞ÔºåÂÆÉ‰ª¨ÁöÑÂÆûÁé∞ÈÉΩÊòØ‚ÄùÁã¨Âç†‚ÄúÁöÑ„ÄÇÈÉΩË∞ÉÁî®‰∫ÜAOSÁöÑ<code>setExclusiveOwnerThread</code>ÊñπÊ≥ïÔºåÊâÄ‰ª•ReentrantLockÁöÑÈîÅÊòØ‚ÄùÁã¨Âç†‚ÄúÁöÑÔºå‰πüÂ∞±ÊòØËØ¥ÔºåÂÆÉÁöÑÈîÅÈÉΩÊòØ‚ÄùÊéí‰ªñÈîÅ‚ÄúÔºå‰∏çËÉΩÂÖ±‰∫´„ÄÇ</p>
<p>Âú®ReentrantLockÁöÑÊûÑÈÄ†ÊñπÊ≥ïÈáåÔºåÂèØ‰ª•‰º†ÂÖ•‰∏Ä‰∏™<code>boolean</code>Á±ªÂûãÁöÑÂèÇÊï∞ÔºåÊù•ÊåáÂÆöÂÆÉÊòØÂê¶ÊòØ‰∏Ä‰∏™ÂÖ¨Âπ≥ÈîÅÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÊòØÈùûÂÖ¨Âπ≥ÁöÑ„ÄÇËøô‰∏™ÂèÇÊï∞‰∏ÄÊó¶ÂÆû‰æãÂåñÂêéÂ∞±‰∏çËÉΩ‰øÆÊîπÔºåÂè™ËÉΩÈÄöËøá<code>isFair()</code>ÊñπÊ≥ïÊù•Êü•Áúã„ÄÇ</p>
<h4 id="reentrantreadwritelock">ReentrantReadWriteLock</h4>
<p>Ëøô‰∏™Á±ª‰πüÊòØ‰∏Ä‰∏™ÈùûÊäΩË±°Á±ªÔºåÂÆÉÊòØReadWriteLockÊé•Âè£ÁöÑJDKÈªòËÆ§ÂÆûÁé∞„ÄÇÂÆÉ‰∏éReentrantLockÁöÑÂäüËÉΩÁ±ª‰ººÔºåÂêåÊ†∑ÊòØÂèØÈáçÂÖ•ÁöÑÔºåÊîØÊåÅÈùûÂÖ¨Âπ≥ÈîÅÂíåÂÖ¨Âπ≥ÈîÅ„ÄÇ‰∏çÂêåÁöÑÊòØÔºåÂÆÉËøòÊîØÊåÅ‚ÄùËØªÂÜôÈîÅ‚Äú„ÄÇ</p>
<p>ReentrantReadWriteLockÂÜÖÈÉ®ÁöÑÁªìÊûÑÂ§ßÊ¶ÇÊòØËøôÊ†∑Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÂÜÖÈÉ®ÁªìÊûÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">final</span> <span class="n">ReentrantReadWriteLock</span><span class="o">.</span><span class="na">ReadLock</span> <span class="n">readerLock</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">final</span> <span class="n">ReentrantReadWriteLock</span><span class="o">.</span><span class="na">WriteLock</span> <span class="n">writerLock</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">final</span> <span class="n">Sync</span> <span class="n">sync</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">abstract</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Sync</span> <span class="kd">extends</span> <span class="n">AbstractQueuedSynchronizer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÖ∑‰ΩìÂÆûÁé∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">NonfairSync</span> <span class="kd">extends</span> <span class="n">Sync</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÖ∑‰ΩìÂÆûÁé∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FairSync</span> <span class="kd">extends</span> <span class="n">Sync</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÖ∑‰ΩìÂÆûÁé∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ReadLock</span> <span class="kd">implements</span> <span class="n">Lock</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">Serializable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Sync</span> <span class="n">sync</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="nf">ReadLock</span><span class="o">(</span><span class="n">ReentrantReadWriteLock</span> <span class="n">lock</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">sync</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">sync</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÖ∑‰ΩìÂÆûÁé∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">WriteLock</span> <span class="kd">implements</span> <span class="n">Lock</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">Serializable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Sync</span> <span class="n">sync</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="nf">WriteLock</span><span class="o">(</span><span class="n">ReentrantReadWriteLock</span> <span class="n">lock</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">sync</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">sync</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÖ∑‰ΩìÂÆûÁé∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ÊûÑÈÄ†ÊñπÊ≥ïÔºåÂàùÂßãÂåñ‰∏§‰∏™ÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="nf">ReentrantReadWriteLock</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">fair</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sync</span> <span class="o">=</span> <span class="n">fair</span> <span class="o">?</span> <span class="k">new</span> <span class="n">FairSync</span><span class="o">()</span> <span class="o">:</span> <span class="k">new</span> <span class="n">NonfairSync</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">readerLock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReadLock</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">writerLock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WriteLock</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Ëé∑ÂèñËØªÈîÅÂíåÂÜôÈîÅÁöÑÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="n">ReentrantReadWriteLock</span><span class="o">.</span><span class="na">WriteLock</span> <span class="nf">writeLock</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">writerLock</span><span class="o">;</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">ReentrantReadWriteLock</span><span class="o">.</span><span class="na">ReadLock</span>  <span class="nf">readLock</span><span class="o">()</span>  <span class="o">{</span> <span class="k">return</span> <span class="n">readerLock</span><span class="o">;</span> <span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÁúãÂà∞ÔºåÂÆÉÂêåÊ†∑ÊòØÂÜÖÈÉ®Áª¥Êä§‰∫Ü‰∏§‰∏™ÂêåÊ≠•Âô®„ÄÇ‰∏îÁª¥Êä§‰∫Ü‰∏§‰∏™LockÁöÑÂÆûÁé∞Á±ªReadLockÂíåWriteLock„ÄÇ‰ªéÊ∫êÁ†ÅÂèØ‰ª•ÂèëÁé∞ÔºåËøô‰∏§‰∏™ÂÜÖÈÉ®Á±ªÁî®ÁöÑÊòØÂ§ñÈÉ®Á±ªÁöÑÂêåÊ≠•Âô®„ÄÇ</p>
<p>ReentrantReadWriteLockÂÆûÁé∞‰∫ÜËØªÂÜôÈîÅÔºå‰ΩÜÂÆÉÊúâ‰∏Ä‰∏™Â∞èÂºäÁ´ØÔºåÂ∞±ÊòØÂú®‚ÄúÂÜô‚ÄùÊìç‰ΩúÁöÑÊó∂ÂÄôÔºåÂÖ∂ÂÆÉÁ∫øÁ®ã‰∏çËÉΩÂÜô‰πü‰∏çËÉΩËØª„ÄÇÊàë‰ª¨Áß∞ËøôÁßçÁé∞Ë±°‰∏∫‚ÄúÂÜôÈ••È•ø‚ÄùÔºåÂ∞ÜÂú®ÂêéÊñáÁöÑStampedLockÁ±ªÁªßÁª≠ËÆ®ËÆ∫Ëøô‰∏™ÈóÆÈ¢ò„ÄÇ</p>
<h4 id="stampedlock">StampedLock</h4>
<p><code>StampedLock</code>Á±ªÊòØÂú®Java 8 ÊâçÂèëÂ∏ÉÁöÑÔºå‰πüÊòØDoug LeaÂ§ßÁ•ûÊâÄÂÜôÔºåÊúâ‰∫∫Âè∑Áß∞ÂÆÉ‰∏∫ÈîÅÁöÑÊÄßËÉΩ‰πãÁéã„ÄÇÂÆÉÊ≤°ÊúâÂÆûÁé∞LockÊé•Âè£ÂíåReadWriteLockÊé•Âè£Ôºå‰ΩÜÂÆÉÂÖ∂ÂÆûÊòØÂÆûÁé∞‰∫Ü‚ÄúËØªÂÜôÈîÅ‚ÄùÁöÑÂäüËÉΩÔºåÂπ∂‰∏îÊÄßËÉΩÊØîReentrantReadWriteLockÊõ¥È´ò„ÄÇStampedLockËøòÊääËØªÈîÅÂàÜ‰∏∫‰∫Ü‚Äú‰πêËßÇËØªÈîÅ‚ÄùÂíå‚ÄúÊÇ≤ËßÇËØªÈîÅ‚Äù‰∏§Áßç„ÄÇ</p>
<p>ÂâçÈù¢ÊèêÂà∞‰∫ÜReentrantReadWriteLock‰ºöÂèëÁîü‚ÄúÂÜôÈ••È•ø‚ÄùÁöÑÁé∞Ë±°Ôºå‰ΩÜStampedLock‰∏ç‰ºö„ÄÇÂÆÉÊòØÊÄé‰πàÂÅöÂà∞ÁöÑÂë¢ÔºüÂÆÉÁöÑÊ†∏ÂøÉÊÄùÊÉ≥Âú®‰∫éÔºå<strong>Âú®ËØªÁöÑÊó∂ÂÄôÂ¶ÇÊûúÂèëÁîü‰∫ÜÂÜôÔºåÂ∫îËØ•ÈÄöËøáÈáçËØïÁöÑÊñπÂºèÊù•Ëé∑ÂèñÊñ∞ÁöÑÂÄºÔºåËÄå‰∏çÂ∫îËØ•ÈòªÂ°ûÂÜôÊìç‰Ωú„ÄÇËøôÁßçÊ®°Âºè‰πüÂ∞±ÊòØÂÖ∏ÂûãÁöÑÊó†ÈîÅÁºñÁ®ãÊÄùÊÉ≥ÔºåÂíåCASËá™ÊóãÁöÑÊÄùÊÉ≥‰∏ÄÊ†∑</strong>„ÄÇËøôÁßçÊìç‰ΩúÊñπÂºèÂÜ≥ÂÆö‰∫ÜStampedLockÂú®ËØªÁ∫øÁ®ãÈùûÂ∏∏Â§öËÄåÂÜôÁ∫øÁ®ãÈùûÂ∏∏Â∞ëÁöÑÂú∫ÊôØ‰∏ãÈùûÂ∏∏ÈÄÇÁî®ÔºåÂêåÊó∂ËøòÈÅøÂÖç‰∫ÜÂÜôÈ••È•øÊÉÖÂÜµÁöÑÂèëÁîü„ÄÇ</p>
<p>ËøôÈáåÁØáÂπÖÊúâÈôêÔºåÂ∞±‰∏ç‰ªãÁªçStampedLockÁöÑÊ∫êÁ†Å‰∫ÜÔºåÂè™ÊòØÂàÜÊûê‰∏Ä‰∏ãÂÆòÊñπÊèê‰æõÁöÑÁî®Ê≥ïÔºàÂú®JDKÊ∫êÁ†ÅÁ±ªÂ£∞ÊòéÁöÑ‰∏äÊñπÊàñJavadocÈáåÂèØ‰ª•ÊâæÂà∞Ôºâ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Point</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="kd">private</span> <span class="kt">double</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">   <span class="kd">private</span> <span class="kd">final</span> <span class="n">StampedLock</span> <span class="n">sl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StampedLock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">// ÂÜôÈîÅÁöÑ‰ΩøÁî®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="kt">void</span> <span class="nf">move</span><span class="o">(</span><span class="kt">double</span> <span class="n">deltaX</span><span class="o">,</span> <span class="kt">double</span> <span class="n">deltaY</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">     <span class="kt">long</span> <span class="n">stamp</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="na">writeLock</span><span class="o">();</span> <span class="c1">// Ëé∑ÂèñÂÜôÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">x</span> <span class="o">+=</span> <span class="n">deltaX</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">y</span> <span class="o">+=</span> <span class="n">deltaY</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">     <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">sl</span><span class="o">.</span><span class="na">unlockWrite</span><span class="o">(</span><span class="n">stamp</span><span class="o">);</span> <span class="c1">// ÈáäÊîæÂÜôÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="o">}</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">// ‰πêËßÇËØªÈîÅÁöÑ‰ΩøÁî®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="kt">double</span> <span class="nf">distanceFromOrigin</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">     <span class="kt">long</span> <span class="n">stamp</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="na">tryOptimisticRead</span><span class="o">();</span> <span class="c1">// Ëé∑Âèñ‰πêËßÇËØªÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="kt">double</span> <span class="n">currentX</span> <span class="o">=</span> <span class="n">x</span><span class="o">,</span> <span class="n">currentY</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">     <span class="k">if</span> <span class="o">(!</span><span class="n">sl</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">stamp</span><span class="o">))</span> <span class="o">{</span> <span class="c1">// //Ê£ÄÊü•‰πêËßÇËØªÈîÅÂêéÊòØÂê¶ÊúâÂÖ∂‰ªñÂÜôÈîÅÂèëÁîüÔºåÊúâÂàôËøîÂõûfalse
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">stamp</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="na">readLock</span><span class="o">();</span> <span class="c1">// Ëé∑Âèñ‰∏Ä‰∏™ÊÇ≤ËßÇËØªÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">currentX</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">currentY</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">           <span class="n">sl</span><span class="o">.</span><span class="na">unlockRead</span><span class="o">(</span><span class="n">stamp</span><span class="o">);</span> <span class="c1">// ÈáäÊîæÊÇ≤ËßÇËØªÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">}</span>
</span></span><span class="line"><span class="cl">     <span class="o">}</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">(</span><span class="n">currentX</span> <span class="o">*</span> <span class="n">currentX</span> <span class="o">+</span> <span class="n">currentY</span> <span class="o">*</span> <span class="n">currentY</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">// ÊÇ≤ËßÇËØªÈîÅ‰ª•ÂèäËØªÈîÅÂçáÁ∫ßÂÜôÈîÅÁöÑ‰ΩøÁî®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="kt">void</span> <span class="nf">moveIfAtOrigin</span><span class="o">(</span><span class="kt">double</span> <span class="n">newX</span><span class="o">,</span> <span class="kt">double</span> <span class="n">newY</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">     <span class="kt">long</span> <span class="n">stamp</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="na">readLock</span><span class="o">();</span> <span class="c1">// ÊÇ≤ËßÇËØªÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">while</span> <span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">0</span><span class="o">.</span><span class="na">0</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">==</span> <span class="n">0</span><span class="o">.</span><span class="na">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">         <span class="c1">// ËØªÈîÅÂ∞ùËØïËΩ¨Êç¢‰∏∫ÂÜôÈîÅÔºöËΩ¨Êç¢ÊàêÂäüÂêéÁõ∏ÂΩì‰∫éËé∑Âèñ‰∫ÜÂÜôÈîÅÔºåËΩ¨Êç¢Â§±Ë¥•Áõ∏ÂΩì‰∫éÊúâÂÜôÈîÅË¢´Âç†Áî®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>         <span class="kt">long</span> <span class="n">ws</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="na">tryConvertToWriteLock</span><span class="o">(</span><span class="n">stamp</span><span class="o">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">         <span class="k">if</span> <span class="o">(</span><span class="n">ws</span> <span class="o">!=</span> <span class="n">0L</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// Â¶ÇÊûúËΩ¨Êç¢ÊàêÂäü
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="n">stamp</span> <span class="o">=</span> <span class="n">ws</span><span class="o">;</span> <span class="c1">// ËØªÈîÅÁöÑÁ•®ÊçÆÊõ¥Êñ∞‰∏∫ÂÜôÈîÅÁöÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="n">x</span> <span class="o">=</span> <span class="n">newX</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">           <span class="n">y</span> <span class="o">=</span> <span class="n">newY</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">           <span class="k">break</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">         <span class="o">}</span>
</span></span><span class="line"><span class="cl">         <span class="k">else</span> <span class="o">{</span> <span class="c1">// Â¶ÇÊûúËΩ¨Êç¢Â§±Ë¥•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="n">sl</span><span class="o">.</span><span class="na">unlockRead</span><span class="o">(</span><span class="n">stamp</span><span class="o">);</span> <span class="c1">// ÈáäÊîæËØªÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>           <span class="n">stamp</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="na">writeLock</span><span class="o">();</span> <span class="c1">// Âº∫Âà∂Ëé∑ÂèñÂÜôÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>         <span class="o">}</span>
</span></span><span class="line"><span class="cl">       <span class="o">}</span>
</span></span><span class="line"><span class="cl">     <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="n">sl</span><span class="o">.</span><span class="na">unlock</span><span class="o">(</span><span class="n">stamp</span><span class="o">);</span> <span class="c1">// ÈáäÊîæÊâÄÊúâÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="o">}</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>‰πêËßÇËØªÈîÅÁöÑÊÑèÊÄùÂ∞±ÊòØÂÖàÂÅáÂÆöÂú®Ëøô‰∏™ÈîÅËé∑ÂèñÊúüÈó¥ÔºåÂÖ±‰∫´ÂèòÈáè‰∏ç‰ºöË¢´ÊîπÂèòÔºåÊó¢ÁÑ∂ÂÅáÂÆö‰∏ç‰ºöË¢´ÊîπÂèòÔºåÈÇ£Â∞±‰∏çÈúÄË¶Å‰∏äÈîÅ„ÄÇÂú®Ëé∑Âèñ‰πêËßÇËØªÈîÅ‰πãÂêéËøõË°å‰∫Ü‰∏Ä‰∫õÊìç‰ΩúÔºåÁÑ∂ÂêéÂèàË∞ÉÁî®‰∫ÜvalidateÊñπÊ≥ïÔºåËøô‰∏™ÊñπÊ≥ïÂ∞±ÊòØÁî®Êù•È™åËØÅtryOptimisticRead‰πãÂêéÔºåÊòØÂê¶ÊúâÂÜôÊìç‰ΩúÊâßË°åËøáÔºåÂ¶ÇÊûúÊúâÔºåÂàôËé∑Âèñ‰∏Ä‰∏™ÊÇ≤ËßÇËØªÈîÅÔºåËøôÈáåÁöÑÊÇ≤ËßÇËØªÈîÅÂíåReentrantReadWriteLock‰∏≠ÁöÑËØªÈîÅÁ±ª‰ººÔºå‰πüÊòØ‰∏™ÂÖ±‰∫´ÈîÅ„ÄÇ</p>
</blockquote>
<p>ÂèØ‰ª•ÁúãÂà∞ÔºåStampedLockËé∑ÂèñÈîÅ‰ºöËøîÂõû‰∏Ä‰∏™<code>long</code>Á±ªÂûãÁöÑÂèòÈáèÔºåÈáäÊîæÈîÅÁöÑÊó∂ÂÄôÂÜçÊääËøô‰∏™ÂèòÈáè‰º†ËøõÂéª„ÄÇÁÆÄÂçïÁúãÁúãÊ∫êÁ†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Áî®‰∫éÊìç‰ΩústateÂêéËé∑ÂèñstampÁöÑÂÄº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">LG_READERS</span> <span class="o">=</span> <span class="n">7</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">RUNIT</span> <span class="o">=</span> <span class="n">1L</span><span class="o">;</span>               <span class="c1">//0000 0000 0001
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">WBIT</span>  <span class="o">=</span> <span class="n">1L</span> <span class="o">&lt;&lt;</span> <span class="n">LG_READERS</span><span class="o">;</span> <span class="c1">//0000 1000 0000
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">RBITS</span> <span class="o">=</span> <span class="n">WBIT</span> <span class="o">-</span> <span class="n">1L</span><span class="o">;</span>        <span class="c1">//0000 0111 1111
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">RFULL</span> <span class="o">=</span> <span class="n">RBITS</span> <span class="o">-</span> <span class="n">1L</span><span class="o">;</span>       <span class="c1">//0000 0111 1110
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">ABITS</span> <span class="o">=</span> <span class="n">RBITS</span> <span class="o">|</span> <span class="n">WBIT</span><span class="o">;</span>     <span class="c1">//0000 1111 1111
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">SBITS</span> <span class="o">=</span> <span class="o">~</span><span class="n">RBITS</span><span class="o">;</span>           <span class="c1">//1111 1000 0000
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ÂàùÂßãÂåñÊó∂stateÁöÑÂÄº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">ORIGIN</span> <span class="o">=</span> <span class="n">WBIT</span> <span class="o">&lt;&lt;</span> <span class="n">1</span><span class="o">;</span>       <span class="c1">//0001 0000 0000
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ÈîÅÂÖ±‰∫´ÂèòÈáèstate
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">transient</span> <span class="kd">volatile</span> <span class="kt">long</span> <span class="n">state</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ËØªÈîÅÊ∫¢Âá∫Êó∂Áî®Êù•Â≠òÂÇ®Â§öÂá∫ÁöÑËØªÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">transient</span> <span class="kt">int</span> <span class="n">readerOverflow</span><span class="o">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>StampedLockÁî®Ëøô‰∏™longÁ±ªÂûãÁöÑÂèòÈáèÁöÑÂâç7‰ΩçÔºàLG_READERSÔºâÊù•Ë°®Á§∫ËØªÈîÅÔºåÊØèËé∑Âèñ‰∏Ä‰∏™ÊÇ≤ËßÇËØªÈîÅÔºåÂ∞±Âä†1ÔºàRUNITÔºâÔºåÊØèÈáäÊîæ‰∏Ä‰∏™ÊÇ≤ËßÇËØªÈîÅÔºåÂ∞±Âáè1„ÄÇËÄåÊÇ≤ËßÇËØªÈîÅÊúÄÂ§öÂè™ËÉΩË£Ö128‰∏™Ôºà7‰ΩçÈôêÂà∂ÔºâÔºåÂæàÂÆπÊòìÊ∫¢Âá∫ÔºåÊâÄ‰ª•Áî®‰∏Ä‰∏™intÁ±ªÂûãÁöÑÂèòÈáèÊù•Â≠òÂÇ®Ê∫¢Âá∫ÁöÑÊÇ≤ËßÇËØªÈîÅ„ÄÇ</p>
<p>ÂÜôÈîÅÁî®stateÂèòÈáèÂâ©‰∏ãÁöÑ‰ΩçÊù•Ë°®Á§∫ÔºåÊØèÊ¨°Ëé∑Âèñ‰∏Ä‰∏™ÂÜôÈîÅÔºåÂ∞±Âä†0000 1000 0000ÔºàWBITÔºâ„ÄÇÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºå<strong>ÂÜôÈîÅÂú®ÈáäÊîæÁöÑÊó∂ÂÄôÔºåÂπ∂‰∏çÊòØÂáèWBITÔºåËÄåÊòØÂÜçÂä†WBIT</strong>„ÄÇËøôÊòØ‰∏∫‰∫Ü<strong>ËÆ©ÊØèÊ¨°ÂÜôÈîÅÈÉΩÁïô‰∏ãÁóïËøπ</strong>ÔºåËß£ÂÜ≥CAS‰∏≠ÁöÑABAÈóÆÈ¢òÔºå‰πü‰∏∫<strong>‰πêËßÇÈîÅÊ£ÄÊü•ÂèòÂåñ</strong>validateÊñπÊ≥ïÊèê‰æõÂü∫Á°Ä„ÄÇ</p>
<p>‰πêËßÇËØªÈîÅÂ∞±ÊØîËæÉÁÆÄÂçï‰∫ÜÔºåÂπ∂Ê≤°ÊúâÁúüÊ≠£ÊîπÂèòstateÁöÑÂÄºÔºåËÄåÊòØÂú®Ëé∑ÂèñÈîÅÁöÑÊó∂ÂÄôËÆ∞ÂΩïstateÁöÑÂÜôÁä∂ÊÄÅÔºåÂú®Êìç‰ΩúÂÆåÊàêÂêéÂéªÊ£ÄÊü•stateÁöÑÂÜôÁä∂ÊÄÅÈÉ®ÂàÜÊòØÂê¶ÂèëÁîüÂèòÂåñÔºå‰∏äÊñáÊèêÂà∞‰∫ÜÔºåÊØèÊ¨°ÂÜôÈîÅÈÉΩ‰ºöÁïô‰∏ãÁóïËøπÔºå‰πüÊòØ‰∏∫‰∫ÜËøôÈáå‰πêËßÇÈîÅÊ£ÄÊü•ÂèòÂåñÊèê‰æõÊñπ‰æø„ÄÇ</p>
<p>ÊÄªÁöÑÊù•ËØ¥ÔºåStampedLockÁöÑÊÄßËÉΩÊòØÈùûÂ∏∏‰ºòÂºÇÁöÑÔºåÂü∫Êú¨‰∏äÂèØ‰ª•Âèñ‰ª£ReentrantReadWriteLockÁöÑ‰ΩúÁî®„ÄÇ</p>
<h2 id="Âπ∂ÂèëÂÆπÂô®ÈõÜÂêà">Âπ∂ÂèëÂÆπÂô®ÈõÜÂêà</h2>
<h3 id="ÂêåÊ≠•ÂÆπÂô®‰∏éÂπ∂ÂèëÂÆπÂô®">ÂêåÊ≠•ÂÆπÂô®‰∏éÂπ∂ÂèëÂÆπÂô®</h3>
<p>Êàë‰ª¨Áü•ÈÅìÂú®java.utilÂåÖ‰∏ãÊèê‰æõ‰∫Ü‰∏Ä‰∫õÂÆπÂô®Á±ªÔºåËÄåVectorÂíåHashtableÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂÆπÂô®Á±ªÔºå‰ΩÜÊòØËøô‰∫õÂÆπÂô®ÂÆûÁé∞ÂêåÊ≠•ÁöÑÊñπÂºèÊòØÈÄöËøáÂØπÊñπÊ≥ïÂä†ÈîÅ(sychronized)ÊñπÂºèÂÆûÁé∞ÁöÑÔºåËøôÊ†∑ËØªÂÜôÂùáÈúÄË¶ÅÈîÅÊìç‰ΩúÔºåÂØºËá¥ÊÄßËÉΩ‰Ωé‰∏ã„ÄÇ</p>
<p>ËÄåÂç≥‰ΩøÊòØVectorËøôÊ†∑Á∫øÁ®ãÂÆâÂÖ®ÁöÑÁ±ªÔºåÂú®Èù¢ÂØπÂ§öÁ∫øÁ®ã‰∏ãÁöÑÂ§çÂêàÊìç‰ΩúÁöÑÊó∂ÂÄô‰πüÊòØÈúÄË¶ÅÈÄöËøáÂÆ¢Êà∑Á´ØÂä†ÈîÅÁöÑÊñπÂºè‰øùËØÅÂéüÂ≠êÊÄß„ÄÇÂ¶Ç‰∏ãÈù¢‰æãÂ≠êËØ¥Êòé:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestVector</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">vector</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ÊñπÊ≥ï‰∏Ä
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span>  <span class="n">Object</span> <span class="nf">getLast</span><span class="o">(</span><span class="n">Vector</span> <span class="n">vector</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">lastIndex</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">vector</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">lastIndex</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ÊñπÊ≥ï‰∫å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span>  <span class="kt">void</span> <span class="nf">deleteLast</span><span class="o">(</span><span class="n">Vector</span> <span class="n">vector</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">lastIndex</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">vector</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">lastIndex</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ÊñπÊ≥ï‰∏â
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span>  <span class="n">Object</span> <span class="nf">getLastSysnchronized</span><span class="o">(</span><span class="n">Vector</span> <span class="n">vector</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">synchronized</span><span class="o">(</span><span class="n">vector</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">lastIndex</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">vector</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">lastIndex</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ÊñπÊ≥ïÂõõ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span>  <span class="kt">void</span> <span class="nf">deleteLastSysnchronized</span><span class="o">(</span><span class="n">Vector</span> <span class="n">vector</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">synchronized</span> <span class="o">(</span><span class="n">vector</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">lastIndex</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">vector</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">lastIndex</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Â¶ÇÊûúÊñπÊ≥ï‰∏ÄÂíåÊñπÊ≥ï‰∫å‰∏∫‰∏Ä‰∏™ÁªÑÂêàÁöÑËØù„ÄÇÈÇ£‰πàÂΩìÊñπÊ≥ï‰∏ÄËé∑ÂèñÂà∞‰∫Ü<code>vector</code>ÁöÑsize‰πãÂêéÔºåÊñπÊ≥ï‰∫åÂ∑≤ÁªèÊâßË°åÂÆåÊØïÔºåËøôÊ†∑Â∞±ÂØºËá¥Á®ãÂ∫èÁöÑÈîôËØØ„ÄÇ</p>
<p>Â¶ÇÊûúÊñπÊ≥ï‰∏â‰∏éÊñπÊ≥ïÂõõÁªÑÂêàÁöÑËØù„ÄÇÈÄöËøáÈîÅÊú∫Âà∂‰øùËØÅ‰∫ÜÂú®<code>vector</code>‰∏äÁöÑÊìç‰ΩúÁöÑÂéüÂ≠êÊÄß„ÄÇ</p>
<p>Âπ∂ÂèëÂÆπÂô®ÊòØJava 5 Êèê‰æõÁöÑÂú®Â§öÁ∫øÁ®ãÁºñÁ®ã‰∏ãÁî®‰∫é‰ª£ÊõøÂêåÊ≠•ÂÆπÂô®ÔºåÈíàÂØπ‰∏çÂêåÁöÑÂ∫îÁî®Âú∫ÊôØËøõË°åËÆæËÆ°ÔºåÊèêÈ´òÂÆπÂô®ÁöÑÂπ∂ÂèëËÆøÈóÆÊÄßÔºåÂêåÊó∂ÂÆö‰πâ‰∫ÜÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÂ§çÂêàÊìç‰Ωú„ÄÇ</p>
<h3 id="Âπ∂ÂèëÂÆπÂô®Á±ª‰ªãÁªç">Âπ∂ÂèëÂÆπÂô®Á±ª‰ªãÁªç</h3>
<p>Êï¥‰ΩìÊû∂ÊûÑ(Âàó‰∏æÂ∏∏Áî®ÁöÑÂÆπÂô®Á±ª)</p>
<p><img src="https://s2.loli.net/2021/12/26/DO2wfjlAIBdgWze.png"
	
	
	
	loading="lazy"
	
		alt="Âπ∂ÂèëÂÆπÂô®"
	
	
></p>
<p>ÂÖ∂‰∏≠ÔºåÈòªÂ°ûÈòüÂàóÔºàBlockingQueueÔºâÂú®Êúâ‰ªãÁªçÔºåCopyOnWriteÂÆπÂô®ÔºàCopyOnWritexxxÔºâÂú®Êúâ‰ªãÁªçÔºåËøôÈáå‰∏çÂÅöËøáÂ§ö‰ªãÁªç„ÄÇ</p>
<p>‰∏ãÈù¢ÂàÜÂà´‰ªãÁªç‰∏Ä‰∫õÂ∏∏Áî®ÁöÑÂπ∂ÂèëÂÆπÂô®Á±ªÂíåÊé•Âè£ÔºåÂõ†ÁØáÂπÖÂéüÂõ†ÔºåËøôÈáåÂè™‰ªãÁªçËøô‰∫õÁ±ªÁöÑÁî®ÈÄîÂíåÂü∫Êú¨ÁöÑÂéüÁêÜÔºå‰∏çÂÅöËøáÂ§öÁöÑÊ∫êÁ†ÅËß£Êûê„ÄÇ</p>
<h4 id="Âπ∂Âèëmap">Âπ∂ÂèëMap</h4>
<h5 id="concurrentmapÊé•Âè£">ConcurrentMapÊé•Âè£</h5>
<p>ConcurrentMapÊé•Âè£ÁªßÊâø‰∫ÜMapÊé•Âè£ÔºåÂú®MapÊé•Âè£ÁöÑÂü∫Á°Ä‰∏äÂèàÂÆö‰πâ‰∫ÜÂõõ‰∏™ÊñπÊ≥ïÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ConcurrentMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ÊèíÂÖ•ÂÖÉÁ¥†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">V</span> <span class="nf">putIfAbsent</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ÁßªÈô§ÂÖÉÁ¥†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">boolean</span> <span class="nf">remove</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ÊõøÊç¢ÂÖÉÁ¥†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">boolean</span> <span class="nf">replace</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">oldValue</span><span class="o">,</span> <span class="n">V</span> <span class="n">newValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//ÊõøÊç¢ÂÖÉÁ¥†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">V</span> <span class="nf">replace</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>**putIfAbsentÔºö**‰∏éÂéüÊúâputÊñπÊ≥ï‰∏çÂêåÁöÑÊòØÔºåputIfAbsentÊñπÊ≥ï‰∏≠Â¶ÇÊûúÊèíÂÖ•ÁöÑkeyÁõ∏ÂêåÔºåÂàô‰∏çÊõøÊç¢ÂéüÊúâÁöÑvalueÂÄºÔºõ</p>
<p>**removeÔºö**‰∏éÂéüÊúâremoveÊñπÊ≥ï‰∏çÂêåÁöÑÊòØÔºåÊñ∞removeÊñπÊ≥ï‰∏≠Â¢ûÂä†‰∫ÜÂØπvalueÁöÑÂà§Êñ≠ÔºåÂ¶ÇÊûúË¶ÅÂà†Èô§ÁöÑkey-value‰∏çËÉΩ‰∏éMap‰∏≠ÂéüÊúâÁöÑkey-valueÂØπÂ∫î‰∏äÔºåÂàô‰∏ç‰ºöÂà†Èô§ËØ•ÂÖÉÁ¥†;</p>
<p>**replace(K,V,V)Ôºö**Â¢ûÂä†‰∫ÜÂØπvalueÂÄºÁöÑÂà§Êñ≠ÔºåÂ¶ÇÊûúkey-oldValueËÉΩ‰∏éMap‰∏≠ÂéüÊúâÁöÑkey-valueÂØπÂ∫î‰∏äÔºåÊâçËøõË°åÊõøÊç¢Êìç‰ΩúÔºõ</p>
<p>**replace(K,V)Ôºö**‰∏é‰∏äÈù¢ÁöÑreplace‰∏çÂêåÁöÑÊòØÔºåÊ≠§replace‰∏ç‰ºöÂØπMap‰∏≠ÂéüÊúâÁöÑkey-valueËøõË°åÊØîËæÉÔºåÂ¶ÇÊûúkeyÂ≠òÂú®ÂàôÁõ¥Êé•ÊõøÊç¢Ôºõ</p>
<h5 id="concurrenthashmapÁ±ª">ConcurrentHashMapÁ±ª</h5>
<p>ConcurrentHashMapÂêåHashMap‰∏ÄÊ†∑‰πüÊòØÂü∫‰∫éÊï£ÂàóË°®ÁöÑmapÔºå‰ΩÜÊòØÂÆÉÊèê‰æõ‰∫Ü‰∏ÄÁßç‰∏éHashtableÂÆåÂÖ®‰∏çÂêåÁöÑÂä†ÈîÅÁ≠ñÁï•ÔºåÊèê‰æõÊõ¥È´òÊïàÁöÑÂπ∂ÂèëÊÄßÂíå‰º∏Áº©ÊÄß„ÄÇ</p>
<p>ConcurrentHashMapÂú®JDK 1.7 ÂíåJDK 1.8‰∏≠Êúâ‰∏Ä‰∫õÂå∫Âà´„ÄÇËøôÈáåÊàë‰ª¨ÂàÜÂºÄ‰ªãÁªç‰∏Ä‰∏ã„ÄÇ</p>
<p><strong>JDK 1.7</strong></p>
<p>ConcurrentHashMapÂú®JDK 1.7‰∏≠ÔºåÊèê‰æõ‰∫Ü‰∏ÄÁßçÁ≤íÂ∫¶Êõ¥ÁªÜÁöÑÂä†ÈîÅÊú∫Âà∂Êù•ÂÆûÁé∞Âú®Â§öÁ∫øÁ®ã‰∏ãÊõ¥È´òÁöÑÊÄßËÉΩÔºåËøôÁßçÊú∫Âà∂Âè´ÂàÜÊÆµÈîÅ(Lock Striping)„ÄÇ</p>
<p>Êèê‰æõÁöÑ‰ºòÁÇπÊòØÔºöÂú®Âπ∂ÂèëÁéØÂ¢É‰∏ãÂ∞ÜÂÆûÁé∞Êõ¥È´òÁöÑÂêûÂêêÈáèÔºåËÄåÂú®ÂçïÁ∫øÁ®ãÁéØÂ¢É‰∏ãÂè™ÊçüÂ§±ÈùûÂ∏∏Â∞èÁöÑÊÄßËÉΩ„ÄÇ</p>
<p>ÂèØ‰ª•ËøôÊ†∑ÁêÜËß£ÂàÜÊÆµÈîÅÔºåÂ∞±ÊòØ<strong>Â∞ÜÊï∞ÊçÆÂàÜÊÆµÔºåÂØπÊØè‰∏ÄÊÆµÊï∞ÊçÆÂàÜÈÖç‰∏ÄÊääÈîÅ</strong>„ÄÇÂΩì‰∏Ä‰∏™Á∫øÁ®ãÂç†Áî®ÈîÅËÆøÈóÆÂÖ∂‰∏≠‰∏Ä‰∏™ÊÆµÊï∞ÊçÆÁöÑÊó∂ÂÄôÔºåÂÖ∂‰ªñÊÆµÁöÑÊï∞ÊçÆ‰πüËÉΩË¢´ÂÖ∂‰ªñÁ∫øÁ®ãËÆøÈóÆ„ÄÇ</p>
<p>Êúâ‰∫õÊñπÊ≥ïÈúÄË¶ÅË∑®ÊÆµÔºåÊØîÂ¶Çsize()„ÄÅisEmpty()„ÄÅcontainsValue()ÔºåÂÆÉ‰ª¨ÂèØËÉΩÈúÄË¶ÅÈîÅÂÆöÊï¥‰∏™Ë°®ËÄå‰∏ç‰ªÖ‰ªÖÊòØÊüê‰∏™ÊÆµÔºåËøôÈúÄË¶ÅÊåâÈ°∫Â∫èÈîÅÂÆöÊâÄÊúâÊÆµÔºåÊìç‰ΩúÂÆåÊØïÂêéÔºåÂèàÊåâÈ°∫Â∫èÈáäÊîæÊâÄÊúâÊÆµÁöÑÈîÅ„ÄÇÂ¶Ç‰∏ãÂõæÔºö</p>
<p><img src="https://s2.loli.net/2021/12/26/oceRMVDx5QT6Pkf.png"
	
	
	
	loading="lazy"
	
		alt="ÂàÜÊÆµÈîÅÊú∫Âà∂"
	
	
></p>
<p>ConcurrentHashMapÊòØÁî±SegmentÊï∞ÁªÑÁªìÊûÑÂíåHashEntryÊï∞ÁªÑÁªìÊûÑÁªÑÊàê„ÄÇSegmentÊòØ‰∏ÄÁßçÂèØÈáçÂÖ•ÈîÅReentrantLockÔºåHashEntryÂàôÁî®‰∫éÂ≠òÂÇ®ÈîÆÂÄºÂØπÊï∞ÊçÆ„ÄÇ</p>
<p>‰∏Ä‰∏™ConcurrentHashMapÈáåÂåÖÂê´‰∏Ä‰∏™SegmentÊï∞ÁªÑÔºåSegmentÁöÑÁªìÊûÑÂíåHashMapÁ±ª‰ººÔºåÊòØ‰∏ÄÁßçÊï∞ÁªÑÂíåÈìæË°®ÁªìÊûÑÔºå ‰∏Ä‰∏™SegmentÈáåÂåÖÂê´‰∏Ä‰∏™HashEntryÊï∞ÁªÑÔºåÊØè‰∏™HashEntryÊòØ‰∏Ä‰∏™ÈìæË°®ÁªìÊûÑÁöÑÂÖÉÁ¥†Ôºå ÊØè‰∏™SegmentÂÆàÊä§ÁùÄ‰∏Ä‰∏™HashEntryÊï∞ÁªÑÈáåÁöÑÂÖÉÁ¥†ÔºåÂΩìÂØπHashEntryÊï∞ÁªÑÁöÑÊï∞ÊçÆËøõË°å‰øÆÊîπÊó∂ÔºåÂøÖÈ°ªÈ¶ñÂÖàËé∑ÂæóÂÆÉÂØπÂ∫îÁöÑSegmentÈîÅ„ÄÇ</p>
<p><strong>JDK 1.8</strong></p>
<p>ËÄåÂú®JDK 1.8‰∏≠ÔºåConcurrentHashMap‰∏ªË¶ÅÂÅö‰∫Ü‰∏§‰∏™‰ºòÂåñÔºö</p>
<ul>
<li>ÂêåHashMap‰∏ÄÊ†∑ÔºåÈìæË°®‰πü‰ºöÂú®ÈïøÂ∫¶ËææÂà∞8ÁöÑÊó∂ÂÄôËΩ¨Âåñ‰∏∫Á∫¢ÈªëÊ†ëÔºåËøôÊ†∑ÂèØ‰ª•ÊèêÂçáÂ§ßÈáèÂÜ≤Á™ÅÊó∂ÂÄôÁöÑÊü•ËØ¢ÊïàÁéáÔºõ</li>
<li>‰ª•Êüê‰∏™‰ΩçÁΩÆÁöÑÂ§¥ÁªìÁÇπÔºàÈìæË°®ÁöÑÂ§¥ÁªìÁÇπÊàñÁ∫¢ÈªëÊ†ëÁöÑrootÁªìÁÇπÔºâ‰∏∫ÈîÅÔºåÈÖçÂêàËá™Êóã+CASÈÅøÂÖç‰∏çÂøÖË¶ÅÁöÑÈîÅÂºÄÈîÄÔºåËøõ‰∏ÄÊ≠•ÊèêÂçáÂπ∂ÂèëÊÄßËÉΩ„ÄÇ</li>
</ul>
<h5 id="concurrentnavigablemapÊé•Âè£‰∏éconcurrentskiplistmapÁ±ª">ConcurrentNavigableMapÊé•Âè£‰∏éConcurrentSkipListMapÁ±ª</h5>
<p>ConcurrentNavigableMapÊé•Âè£ÁªßÊâø‰∫ÜNavigableMapÊé•Âè£ÔºåËøô‰∏™Êé•Âè£Êèê‰æõ‰∫ÜÈíàÂØπÁªôÂÆöÊêúÁ¥¢ÁõÆÊ†áËøîÂõûÊúÄÊé•ËøëÂåπÈÖçÈ°πÁöÑÂØºËà™ÊñπÊ≥ï„ÄÇ</p>
<p>ConcurrentNavigableMapÊé•Âè£ÁöÑ‰∏ªË¶ÅÂÆûÁé∞Á±ªÊòØConcurrentSkipListMapÁ±ª„ÄÇ‰ªéÂêçÂ≠ó‰∏äÊù•ÁúãÔºåÂÆÉÁöÑÂ∫ïÂ±Ç‰ΩøÁî®ÁöÑÊòØË∑≥Ë°®ÔºàSkipListÔºâÁöÑÊï∞ÊçÆÁªìÊûÑ„ÄÇÂÖ≥‰∫éË∑≥Ë°®ÁöÑÊï∞ÊçÆÁªìÊûÑËøôÈáå‰∏çÂÅöÂ§™Â§ö‰ªãÁªçÔºåÂÆÉÊòØ‰∏ÄÁßç‚ÄùÁ©∫Èó¥Êç¢Êó∂Èó¥‚ÄúÁöÑÊï∞ÊçÆÁªìÊûÑÔºåÂèØ‰ª•‰ΩøÁî®CASÊù•‰øùËØÅÂπ∂ÂèëÂÆâÂÖ®ÊÄß„ÄÇ</p>
<h4 id="Âπ∂Âèëqueue">Âπ∂ÂèëQueue</h4>
<p>JDKÂπ∂Ê≤°ÊúâÊèê‰æõÁ∫øÁ®ãÂÆâÂÖ®ÁöÑListÁ±ªÔºåÂõ†‰∏∫ÂØπListÊù•ËØ¥Ôºå<strong>ÂæàÈöæÂéªÂºÄÂèë‰∏Ä‰∏™ÈÄöÁî®Âπ∂‰∏îÊ≤°ÊúâÂπ∂ÂèëÁì∂È¢àÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÁöÑList</strong>„ÄÇÂõ†‰∏∫Âç≥‰ΩøÁÆÄÂçïÁöÑËØªÊìç‰ΩúÔºåÊãøcontains() ËøôÊ†∑‰∏Ä‰∏™Êìç‰ΩúÊù•ËØ¥ÔºåÂæàÈöæÊÉ≥Âà∞ÊêúÁ¥¢ÁöÑÊó∂ÂÄôÂ¶Ç‰ΩïÈÅøÂÖçÈîÅ‰ΩèÊï¥‰∏™list„ÄÇ</p>
<p>ÊâÄ‰ª•ÈÄÄ‰∏ÄÊ≠•ÔºåJDKÊèê‰æõ‰∫ÜÂØπÈòüÂàóÂíåÂèåÁ´ØÈòüÂàóÁöÑÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÁ±ªÔºöConcurrentLinkedQueueÂíåConcurrentLinkedDeque„ÄÇÂõ†‰∏∫ÈòüÂàóÁõ∏ÂØπ‰∫éListÊù•ËØ¥ÔºåÊúâÊõ¥Â§öÁöÑÈôêÂà∂„ÄÇËøô‰∏§‰∏™Á±ªÊòØ‰ΩøÁî®CASÊù•ÂÆûÁé∞Á∫øÁ®ãÂÆâÂÖ®ÁöÑ„ÄÇ</p>
<h4 id="Âπ∂Âèëset">Âπ∂ÂèëSet</h4>
<p>JDKÊèê‰æõ‰∫ÜConcurrentSkipListSetÔºåÊòØÁ∫øÁ®ãÂÆâÂÖ®ÁöÑÊúâÂ∫èÁöÑÈõÜÂêà„ÄÇÂ∫ïÂ±ÇÊòØ‰ΩøÁî®ConcurrentSkipListMapÂÆûÁé∞„ÄÇ</p>
<p>Ë∞∑Ê≠åÁöÑguavaÊ°ÜÊû∂ÂÆûÁé∞‰∫Ü‰∏Ä‰∏™Á∫øÁ®ãÂÆâÂÖ®ÁöÑConcurrentHashSetÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">Sets</span><span class="o">.</span><span class="na">newConcurrentHashSet</span><span class="o">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="copyonwriteÂÆπÂô®">CopyOnWriteÂÆπÂô®</h2>
<h3 id="‰ªÄ‰πàÊòØcopyonwriteÂÆπÂô®">‰ªÄ‰πàÊòØCopyOnWriteÂÆπÂô®</h3>
<p>Âú®ËØ¥Âà∞CopyOnWriteÂÆπÂô®‰πãÂâçÊàë‰ª¨ÂÖàÊù•Ë∞àË∞à‰ªÄ‰πàÊòØCopyOnWriteÊú∫Âà∂ÔºåCopyOnWriteÊòØËÆ°ÁÆóÊú∫ËÆæËÆ°È¢ÜÂüü‰∏≠ÁöÑ‰∏ÄÁßç‰ºòÂåñÁ≠ñÁï•Ôºå‰πüÊòØ‰∏ÄÁßçÂú®Âπ∂ÂèëÂú∫ÊôØ‰∏ãÂ∏∏Áî®ÁöÑËÆæËÆ°ÊÄùÊÉ≥‚Äî‚ÄîÂÜôÂÖ•Êó∂Â§çÂà∂ÊÄùÊÉ≥„ÄÇ</p>
<p>ÈÇ£‰ªÄ‰πàÊòØÂÜôÂÖ•Êó∂Â§çÂà∂ÊÄùÊÉ≥Âë¢ÔºüÂ∞±ÊòØÂΩìÊúâÂ§ö‰∏™Ë∞ÉÁî®ËÄÖÂêåÊó∂ÂéªËØ∑Ê±Ç‰∏Ä‰∏™ËµÑÊ∫êÊï∞ÊçÆÁöÑÊó∂ÂÄôÔºåÊúâ‰∏Ä‰∏™Ë∞ÉÁî®ËÄÖÂá∫‰∫éÊüê‰∫õÂéüÂõ†ÈúÄË¶ÅÂØπÂΩìÂâçÁöÑÊï∞ÊçÆÊ∫êËøõË°å‰øÆÊîπÔºåËøô‰∏™Êó∂ÂÄôÁ≥ªÁªüÂ∞Ü‰ºöÂ§çÂà∂‰∏Ä‰∏™ÂΩìÂâçÊï∞ÊçÆÊ∫êÁöÑÂâØÊú¨ÁªôË∞ÉÁî®ËÄÖ‰øÆÊîπ„ÄÇ</p>
<p>CopyOnWriteÂÆπÂô®Âç≥<strong>ÂÜôÊó∂Â§çÂà∂ÁöÑÂÆπÂô®</strong>,ÂΩìÊàë‰ª¨ÂæÄ‰∏Ä‰∏™ÂÆπÂô®‰∏≠Ê∑ªÂä†ÂÖÉÁ¥†ÁöÑÊó∂ÂÄôÔºå‰∏çÁõ¥Êé•ÂæÄÂÆπÂô®‰∏≠Ê∑ªÂä†ÔºåËÄåÊòØÂ∞ÜÂΩìÂâçÂÆπÂô®ËøõË°åcopyÔºåÂ§çÂà∂Âá∫Êù•‰∏Ä‰∏™Êñ∞ÁöÑÂÆπÂô®ÔºåÁÑ∂ÂêéÂêëÊñ∞ÂÆπÂô®‰∏≠Ê∑ªÂä†Êàë‰ª¨ÈúÄË¶ÅÁöÑÂÖÉÁ¥†ÔºåÊúÄÂêéÂ∞ÜÂéüÂÆπÂô®ÁöÑÂºïÁî®ÊåáÂêëÊñ∞ÂÆπÂô®„ÄÇ</p>
<p>ËøôÊ†∑ÂÅöÁöÑÂ•ΩÂ§ÑÂú®‰∫éÔºåÊàë‰ª¨ÂèØ‰ª•Âú®Âπ∂ÂèëÁöÑÂú∫ÊôØ‰∏ãÂØπÂÆπÂô®ËøõË°å&quot;ËØªÊìç‰Ωú&quot;ËÄå‰∏çÈúÄË¶Å&quot;Âä†ÈîÅ&quot;Ôºå‰ªéËÄåËææÂà∞ËØªÂÜôÂàÜÁ¶ªÁöÑÁõÆÁöÑ„ÄÇ‰ªéJDK 1.5 ÂºÄÂßãJavaÂπ∂ÂèëÂåÖÈáåÊèê‰æõ‰∫Ü‰∏§‰∏™‰ΩøÁî®CopyOnWriteÊú∫Âà∂ÂÆûÁé∞ÁöÑÂπ∂ÂèëÂÆπÂô® ÔºåÂàÜÂà´ÊòØCopyOnWriteArrayListÂíåCopyOnWriteArraySet „ÄÇÊàë‰ª¨ÁùÄÈáçÁªôÂ§ßÂÆ∂‰ªãÁªç‰∏Ä‰∏ãCopyOnWriteArrayList„ÄÇ</p>
<h3 id="copyonwritearraylist">CopyOnWriteArrayList</h3>
<p><strong>‰ºòÁÇπ</strong>Ôºö CopyOnWriteArrayListÁªèÂ∏∏Ë¢´Áî®‰∫é‚ÄúËØªÂ§öÂÜôÂ∞ë‚ÄùÁöÑÂπ∂ÂèëÂú∫ÊôØÔºåÊòØÂõ†‰∏∫CopyOnWriteArrayListÊó†ÈúÄ‰ªª‰ΩïÂêåÊ≠•Êé™ÊñΩÔºåÂ§ßÂ§ßÂ¢ûÂº∫‰∫ÜËØªÁöÑÊÄßËÉΩ„ÄÇÂú®Java‰∏≠ÈÅçÂéÜÁ∫øÁ®ãÈùûÂÆâÂÖ®ÁöÑList(Â¶ÇÔºöArrayListÂíå LinkedList)ÁöÑÊó∂ÂÄôÔºåËã•‰∏≠ÈÄîÊúâÂà´ÁöÑÁ∫øÁ®ãÂØπListÂÆπÂô®ËøõË°å‰øÆÊîπÔºåÈÇ£‰πà‰ºöÊäõÂá∫ConcurrentModificationExceptionÂºÇÂ∏∏„ÄÇCopyOnWriteArrayListÁî±‰∫éÂÖ∂&quot;ËØªÂÜôÂàÜÁ¶ª&quot;ÔºåÈÅçÂéÜÂíå‰øÆÊîπÊìç‰ΩúÂàÜÂà´‰ΩúÁî®Âú®‰∏çÂêåÁöÑListÂÆπÂô®ÔºåÊâÄ‰ª•Âú®‰ΩøÁî®Ëø≠‰ª£Âô®ÈÅçÂéÜÁöÑÊó∂ÂÄôÔºåÂàô‰∏ç‰ºöÊäõÂá∫ÂºÇÂ∏∏„ÄÇ</p>
<p><strong>Áº∫ÁÇπ</strong>Ôºö Á¨¨‰∏Ä‰∏™Áº∫ÁÇπÊòØCopyOnWriteArrayListÊØèÊ¨°ÊâßË°åÂÜôÊìç‰ΩúÈÉΩ‰ºöÂ∞ÜÂéüÂÆπÂô®ËøõË°åÊã∑Ë¥ù‰∏Ä‰ªΩÔºåÊï∞ÊçÆÈáèÂ§ßÁöÑÊó∂ÂÄôÔºåÂÜÖÂ≠ò‰ºöÂ≠òÂú®ËæÉÂ§ßÁöÑÂéãÂäõÔºåÂèØËÉΩ‰ºöÂºïËµ∑È¢ëÁπÅFull GCÔºàZGCÂõ†‰∏∫Ê≤°Êúâ‰ΩøÁî®Full GCÔºâ„ÄÇÊØîÂ¶ÇËøô‰∫õÂØπË±°Âç†Áî®ÁöÑÂÜÖÂ≠ò200MÂ∑¶Âè≥ÔºåÈÇ£‰πàÂÜçÂÜôÂÖ•100MÊï∞ÊçÆËøõÂéªÔºåÂÜÖÂ≠òÂ∞±‰ºöÂ§öÂç†Áî®300M„ÄÇ</p>
<p>Á¨¨‰∫å‰∏™Áº∫ÁÇπÊòØCopyOnWriteArrayListÁî±‰∫éÂÆûÁé∞ÁöÑÂéüÂõ†ÔºåÂÜôÂíåËØªÂàÜÂà´‰ΩúÁî®Âú®‰∏çÂêåÊñ∞ËÄÅÂÆπÂô®‰∏äÔºåÂú®ÂÜôÊìç‰ΩúÊâßË°åËøáÁ®ã‰∏≠ÔºåËØª‰∏ç‰ºöÈòªÂ°ûÔºå‰ΩÜËØªÂèñÂà∞ÁöÑÂç¥ÊòØËÄÅÂÆπÂô®ÁöÑÊï∞ÊçÆ„ÄÇ</p>
<p>Áé∞Âú®Êàë‰ª¨Êù•Áúã‰∏Ä‰∏ãCopyOnWriteArrayListÁöÑaddÊìç‰ΩúÊ∫êÁ†ÅÔºåÂÆÉÁöÑÈÄªËæëÂæàÊ∏ÖÊô∞ÔºåÂ∞±ÊòØÂÖàÊääÂéüÂÆπÂô®ËøõË°åcopyÔºåÁÑ∂ÂêéÂú®Êñ∞ÁöÑÂâØÊú¨‰∏äËøõË°å‚ÄúÂÜôÊìç‰Ωú‚ÄùÔºåÊúÄÂêéÂÜçÂàáÊç¢ÂºïÁî®ÔºåÂú®Ê≠§ËøáÁ®ã‰∏≠ÊòØÂä†‰∫ÜÈîÅÁöÑ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">add</span><span class="o">(</span><span class="n">E</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ReentrantLockÂä†ÈîÅÔºå‰øùËØÅÁ∫øÁ®ãÂÆâÂÖ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">final</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lock</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span><span class="o">[]</span> <span class="n">elements</span> <span class="o">=</span> <span class="n">getArray</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Êã∑Ë¥ùÂéüÂÆπÂô®ÔºåÈïøÂ∫¶‰∏∫ÂéüÂÆπÂô®ÈïøÂ∫¶Âä†‰∏Ä
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Object</span><span class="o">[]</span> <span class="n">newElements</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">len</span> <span class="o">+</span> <span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Âú®Êñ∞ÂâØÊú¨‰∏äÊâßË°åÊ∑ªÂä†Êìç‰Ωú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">newElements</span><span class="o">[</span><span class="n">len</span><span class="o">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Â∞ÜÂéüÂÆπÂô®ÂºïÁî®ÊåáÂêëÊñ∞ÂâØÊú¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">setArray</span><span class="o">(</span><span class="n">newElements</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Ëß£ÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨ÂÜçÊù•Áúã‰∏Ä‰∏ãremoveÊìç‰ΩúÁöÑÊ∫êÁ†ÅÔºåremoveÁöÑÈÄªËæëÊòØÂ∞ÜË¶ÅremoveÂÖÉÁ¥†‰πãÂ§ñÁöÑÂÖ∂‰ªñÂÖÉÁ¥†Êã∑Ë¥ùÂà∞Êñ∞ÁöÑÂâØÊú¨‰∏≠ÔºåÁÑ∂ÂêéÂÜçÂ∞ÜÂéüÂÆπÂô®ÁöÑÂºïÁî®ÊåáÂêëÊñ∞ÁöÑÂâØÊú¨‰∏≠ÔºåÂõ†‰∏∫removeÊìç‰Ωú‰πüÊòØ‚ÄúÂÜôÊìç‰Ωú‚ÄùÊâÄ‰ª•‰πüÊòØË¶ÅÂä†ÈîÅÁöÑ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">E</span> <span class="nf">remove</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Âä†ÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">final</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lock</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Object</span><span class="o">[]</span> <span class="n">elements</span> <span class="o">=</span> <span class="n">getArray</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">E</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">index</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">numMoved</span> <span class="o">=</span> <span class="n">len</span> <span class="o">-</span> <span class="n">index</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">numMoved</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Â¶ÇÊûúË¶ÅÂà†Èô§ÁöÑÊòØÂàóË°®Êú´Á´ØÊï∞ÊçÆÔºåÊã∑Ë¥ùÂâçlen-1‰∏™Êï∞ÊçÆÂà∞Êñ∞ÂâØÊú¨‰∏äÔºåÂÜçÂàáÊç¢ÂºïÁî®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">setArray</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">len</span> <span class="o">-</span> <span class="n">1</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Âê¶ÂàôÔºåÂ∞ÜË¶ÅÂà†Èô§ÂÖÉÁ¥†‰πãÂ§ñÁöÑÂÖ∂‰ªñÂÖÉÁ¥†Êã∑Ë¥ùÂà∞Êñ∞ÂâØÊú¨‰∏≠ÔºåÂπ∂ÂàáÊç¢ÂºïÁî®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Object</span><span class="o">[]</span> <span class="n">newElements</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">len</span> <span class="o">-</span> <span class="n">1</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">newElements</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">index</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">index</span> <span class="o">+</span> <span class="n">1</span><span class="o">,</span> <span class="n">newElements</span><span class="o">,</span> <span class="n">index</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                 <span class="n">numMoved</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">setArray</span><span class="o">(</span><span class="n">newElements</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Ëß£ÈîÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨ÂÜçÊù•ÁúãÁúãCopyOnWriteArrayListÊïàÁéáÊúÄÈ´òÁöÑËØªÊìç‰ΩúÁöÑÊ∫êÁ†Å</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">E</span> <span class="nf">get</span><span class="o">(</span><span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">get</span><span class="o">(</span><span class="n">getArray</span><span class="o">(),</span> <span class="n">index</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"> <span class="kd">private</span> <span class="n">E</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span><span class="o">[]</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="o">(</span><span class="n">E</span><span class="o">)</span> <span class="n">a</span><span class="o">[</span><span class="n">index</span><span class="o">];</span>
</span></span><span class="line"><span class="cl"> <span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Áî±‰∏äÂèØËßÅ‚ÄúËØªÊìç‰Ωú‚ÄùÊòØÊ≤°ÊúâÂä†ÈîÅÔºåÁõ¥Êé•ËØªÂèñ„ÄÇ</p>
<h3 id="copyonwriteÁöÑ‰∏öÂä°‰∏≠ÂÆûÁé∞">CopyOnWriteÁöÑ‰∏öÂä°‰∏≠ÂÆûÁé∞</h3>
<p>Êé•‰∏ãÊù•ÔºåÊàë‰ª¨ÁªìÂêàÂÖ∑‰Ωì‰∏öÂä°Âú∫ÊôØÊù•ÂÆûÁé∞‰∏Ä‰∏™CopyOnWriteMapÁöÑÂπ∂ÂèëÂÆπÂô®Âπ∂‰∏î‰ΩøÁî®ÂÆÉ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CopyOnWriteMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;,</span> <span class="n">Cloneable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">volatile</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">internalMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">CopyOnWriteMap</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">internalMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">newMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;(</span><span class="n">internalMap</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">V</span> <span class="n">val</span> <span class="o">=</span> <span class="n">newMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">internalMap</span> <span class="o">=</span> <span class="n">newMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">val</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">internalMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">putAll</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">K</span><span class="o">,</span> <span class="o">?</span> <span class="kd">extends</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">newData</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">newMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;(</span><span class="n">internalMap</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">newMap</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">newData</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">internalMap</span> <span class="o">=</span> <span class="n">newMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äÈù¢Â∞±ÊòØÂèÇËÄÉCopyOnWriteArrayListÂÆûÁé∞ÁöÑCopyOnWriteMapÔºåÊàë‰ª¨ÂèØ‰ª•Áî®Ëøô‰∏™ÂÆπÂô®Êù•ÂÅö‰ªÄ‰πàÂë¢ÔºüÁªìÂêàÊàë‰ª¨‰πãÂâçËØ¥ÁöÑCopyOnWriteÁöÑÂ§çÂà∂ÊÄùÊÉ≥ÔºåÂÆÉÊúÄÈÄÇÁî®‰∫é‚ÄúËØªÂ§öÂÜôÂ∞ë‚ÄùÁöÑÂπ∂ÂèëÂú∫ÊôØ„ÄÇ</p>
<p>**Âú∫ÊôØÔºö**ÂÅáÂ¶ÇÊàë‰ª¨Êúâ‰∏Ä‰∏™ÊêúÁ¥¢ÁöÑÁΩëÁ´ôÈúÄË¶ÅÂ±èËîΩ‰∏Ä‰∫õ‚ÄúÂÖ≥ÈîÆÂ≠ó‚ÄùÔºå‚ÄúÈªëÂêçÂçï‚ÄùÊØèÊôöÂÆöÊó∂Êõ¥Êñ∞ÔºåÊØèÂΩìÁî®Êà∑ÊêúÁ¥¢ÁöÑÊó∂ÂÄôÔºå‚ÄúÈªëÂêçÂçï‚Äù‰∏≠ÁöÑÂÖ≥ÈîÆÂ≠ó‰∏ç‰ºöÂá∫Áé∞Âú®ÊêúÁ¥¢ÁªìÊûúÂΩì‰∏≠ÔºåÂπ∂‰∏îÊèêÁ§∫Áî®Êà∑ÊïèÊÑüÂ≠ó„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÈªëÂêçÂçïÊúçÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlackListServiceImpl</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//„ÄÄÂáèÂ∞ëÊâ©ÂÆπÂºÄÈîÄ„ÄÇÊ†πÊçÆÂÆûÈôÖÈúÄË¶ÅÔºåÂàùÂßãÂåñCopyOnWriteMapÁöÑÂ§ßÂ∞èÔºåÈÅøÂÖçÂÜôÊó∂CopyOnWriteMapÊâ©ÂÆπÁöÑÂºÄÈîÄ„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kd">static</span> <span class="n">CopyOnWriteMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Boolean</span><span class="o">&gt;</span> <span class="n">blackListMap</span> <span class="o">=</span> 
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">CopyOnWriteMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Boolean</span><span class="o">&gt;(</span><span class="n">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isBlackList</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">blackListMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addBlackList</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">blackListMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">Boolean</span><span class="o">.</span><span class="na">TRUE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * ÊâπÈáèÊ∑ªÂä†ÈªëÂêçÂçï
</span></span></span><span class="line"><span class="cl"><span class="cm">     * (‰ΩøÁî®ÊâπÈáèÊ∑ªÂä†„ÄÇÂõ†‰∏∫ÊØèÊ¨°Ê∑ªÂä†ÔºåÂÆπÂô®ÊØèÊ¨°ÈÉΩ‰ºöËøõË°åÂ§çÂà∂ÔºåÊâÄ‰ª•ÂáèÂ∞ëÊ∑ªÂä†Ê¨°Êï∞ÔºåÂèØ‰ª•ÂáèÂ∞ëÂÆπÂô®ÁöÑÂ§çÂà∂Ê¨°Êï∞„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Â¶Ç‰ΩøÁî®‰∏äÈù¢‰ª£Á†ÅÈáåÁöÑaddBlackListÊñπÊ≥ï)
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param ids
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">addBlackList</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Boolean</span><span class="o">&gt;</span> <span class="n">ids</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">blackListMap</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">ids</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÈáåÈúÄË¶ÅÂêÑ‰ΩçÂ∞è‰ºô‰º¥ÁâπÂà´ÁâπÂà´Ê≥®ÊÑè‰∏Ä‰∏™ÈóÆÈ¢òÔºåÊ≠§Â§ÑÁöÑÂú∫ÊôØÊòØÊØèÊôöÂáåÊô®‚ÄúÈªëÂêçÂçï‚ÄùÂÆöÊó∂Êõ¥Êñ∞ÔºåÂéüÂõ†ÊòØCopyOnWriteÂÆπÂô®Êúâ<strong>Êï∞ÊçÆ‰∏ÄËá¥ÊÄß</strong>ÁöÑÈóÆÈ¢òÔºåÂÆÉÂè™ËÉΩ‰øùËØÅ<strong>ÊúÄÁªàÊï∞ÊçÆ‰∏ÄËá¥ÊÄß</strong>„ÄÇ</p>
<p>ÊâÄ‰ª•Â¶ÇÊûúÊàë‰ª¨Â∏åÊúõÂÜôÂÖ•ÁöÑÊï∞ÊçÆÈ©¨‰∏äËÉΩÂáÜÁ°ÆÂú∞ËØªÂèñÔºåËØ∑‰∏çË¶Å‰ΩøÁî®CopyOnWriteÂÆπÂô®„ÄÇ</p>
<h2 id="ÈÄö‰ø°Â∑•ÂÖ∑Á±ª">ÈÄö‰ø°Â∑•ÂÖ∑Á±ª</h2>
<p>JDK‰∏≠Êèê‰æõ‰∫Ü‰∏Ä‰∫õÂ∑•ÂÖ∑Á±ª‰ª•‰æõÂºÄÂèëËÄÖ‰ΩøÁî®„ÄÇËøôÊ†∑ÁöÑËØùÊàë‰ª¨Âú®ÈÅáÂà∞‰∏Ä‰∫õÂ∏∏ËßÅÁöÑÂ∫îÁî®Âú∫ÊôØÊó∂Â∞±ÂèØ‰ª•‰ΩøÁî®Ëøô‰∫õÂ∑•ÂÖ∑Á±ªÔºåËÄå‰∏çÁî®Ëá™Â∑±ÂÜçÈáçÂ§çÈÄ†ËΩÆÂ≠ê‰∫Ü„ÄÇ</p>
<p>ÂÆÉ‰ª¨ÈÉΩÂú®java.util.concurrentÂåÖ‰∏ã„ÄÇÂÖàÊÄª‰ΩìÊ¶ÇÊã¨‰∏Ä‰∏ãÈÉΩÊúâÂì™‰∫õÂ∑•ÂÖ∑Á±ªÔºåÂÆÉ‰ª¨Êúâ‰ªÄ‰πà‰ΩúÁî®ÔºåÁÑ∂ÂêéÂÜçÂàÜÂà´‰ªãÁªçÂÆÉ‰ª¨ÁöÑ‰∏ªË¶Å‰ΩøÁî®ÊñπÊ≥ïÂíåÂéüÁêÜ„ÄÇ</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Á±ª</th>
<th>‰ΩúÁî®</th>
</tr>
</thead>
<tbody>
<tr>
<td>Semaphore</td>
<td>ÈôêÂà∂Á∫øÁ®ãÁöÑÊï∞Èáè</td>
</tr>
<tr>
<td>Exchanger</td>
<td>‰∏§‰∏™Á∫øÁ®ã‰∫§Êç¢Êï∞ÊçÆ</td>
</tr>
<tr>
<td>CountDownLatch</td>
<td>Á∫øÁ®ãÁ≠âÂæÖÁõ¥Âà∞ËÆ°Êï∞Âô®Âáè‰∏∫0Êó∂ÂºÄÂßãÂ∑•‰Ωú</td>
</tr>
<tr>
<td>CyclicBarrier</td>
<td>‰ΩúÁî®Ë∑üCountDownLatchÁ±ª‰ººÔºå‰ΩÜÊòØÂèØ‰ª•ÈáçÂ§ç‰ΩøÁî®</td>
</tr>
<tr>
<td>Phaser</td>
<td>Â¢ûÂº∫ÁöÑCyclicBarrier</td>
</tr>
</tbody>
</table></div>
<p>‰∏ãÈù¢ÂàÜÂà´‰ªãÁªçËøôÂá†‰∏™Á±ª„ÄÇ</p>
<h3 id="semaphore">Semaphore</h3>
<h4 id="semaphore‰ªãÁªç">Semaphore‰ªãÁªç</h4>
<p>SemaphoreÁøªËØëËøáÊù•ÊòØ‰ø°Âè∑ÁöÑÊÑèÊÄù„ÄÇÈ°æÂêçÊÄù‰πâÔºåËøô‰∏™Â∑•ÂÖ∑Á±ªÊèê‰æõÁöÑÂäüËÉΩÂ∞±ÊòØÂ§ö‰∏™Á∫øÁ®ãÂΩºÊ≠§‚ÄúÊâì‰ø°Âè∑‚Äù„ÄÇËÄåËøô‰∏™‚Äú‰ø°Âè∑‚ÄùÊòØ‰∏Ä‰∏™<code>int</code>Á±ªÂûãÁöÑÊï∞ÊçÆÔºå‰πüÂèØ‰ª•ÁúãÊàêÊòØ‰∏ÄÁßç‚ÄúËµÑÊ∫ê‚Äù„ÄÇ</p>
<p>ÂèØ‰ª•Âú®ÊûÑÈÄ†ÂáΩÊï∞‰∏≠‰º†ÂÖ•ÂàùÂßãËµÑÊ∫êÊÄªÊï∞Ôºå‰ª•ÂèäÊòØÂê¶‰ΩøÁî®‚ÄúÂÖ¨Âπ≥‚ÄùÁöÑÂêåÊ≠•Âô®„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÊòØÈùûÂÖ¨Âπ≥ÁöÑ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÈªòËÆ§ÊÉÖÂÜµ‰∏ã‰ΩøÁî®ÈùûÂÖ¨Âπ≥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="nf">Semaphore</span><span class="o">(</span><span class="kt">int</span> <span class="n">permits</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sync</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NonfairSync</span><span class="o">(</span><span class="n">permits</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="nf">Semaphore</span><span class="o">(</span><span class="kt">int</span> <span class="n">permits</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">fair</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sync</span> <span class="o">=</span> <span class="n">fair</span> <span class="o">?</span> <span class="k">new</span> <span class="n">FairSync</span><span class="o">(</span><span class="n">permits</span><span class="o">)</span> <span class="o">:</span> <span class="k">new</span> <span class="n">NonfairSync</span><span class="o">(</span><span class="n">permits</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊúÄ‰∏ªË¶ÅÁöÑÊñπÊ≥ïÊòØacquireÊñπÊ≥ïÂíåreleaseÊñπÊ≥ï„ÄÇacquire()ÊñπÊ≥ï‰ºöÁî≥ËØ∑‰∏Ä‰∏™permitÔºåËÄåreleaseÊñπÊ≥ï‰ºöÈáäÊîæ‰∏Ä‰∏™permit„ÄÇÂΩìÁÑ∂Ôºå‰Ω†‰πüÂèØ‰ª•Áî≥ËØ∑Â§ö‰∏™acquire(int permits)ÊàñËÄÖÈáäÊîæÂ§ö‰∏™release(int permits)„ÄÇ</p>
<p>ÊØèÊ¨°acquireÔºåpermitsÂ∞±‰ºöÂáèÂ∞ë‰∏Ä‰∏™ÊàñËÄÖÂ§ö‰∏™„ÄÇÂ¶ÇÊûúÂáèÂ∞ëÂà∞‰∫Ü0ÔºåÂÜçÊúâÂÖ∂‰ªñÁ∫øÁ®ãÊù•acquireÔºåÈÇ£Â∞±Ë¶ÅÈòªÂ°ûËøô‰∏™Á∫øÁ®ãÁõ¥Âà∞ÊúâÂÖ∂ÂÆÉÁ∫øÁ®ãrelease permit‰∏∫Ê≠¢„ÄÇ</p>
<h4 id="semaphoreÊ°à‰æã">SemaphoreÊ°à‰æã</h4>
<p>SemaphoreÂæÄÂæÄÁî®‰∫éËµÑÊ∫êÊúâÈôêÁöÑÂú∫ÊôØ‰∏≠ÔºåÂéªÈôêÂà∂Á∫øÁ®ãÁöÑÊï∞Èáè„ÄÇ‰∏æ‰∏™‰æãÂ≠êÔºåÊàëÊÉ≥ÈôêÂà∂ÂêåÊó∂Âè™ËÉΩÊúâ3‰∏™Á∫øÁ®ãÂú®Â∑•‰ΩúÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SemaphoreDemo</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyThread</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kt">int</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">Semaphore</span> <span class="n">semaphore</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="nf">MyThread</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">,</span> <span class="n">Semaphore</span> <span class="n">semaphore</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">semaphore</span> <span class="o">=</span> <span class="n">semaphore</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">semaphore</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span> <span class="c1">// Ëé∑Âèñpermit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;ÂΩìÂâçÁ∫øÁ®ãÊòØ%d, ËøòÂâ©%d‰∏™ËµÑÊ∫êÔºåËøòÊúâ%d‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                        <span class="n">value</span><span class="o">,</span> <span class="n">semaphore</span><span class="o">.</span><span class="na">availablePermits</span><span class="o">(),</span> <span class="n">semaphore</span><span class="o">.</span><span class="na">getQueueLength</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// Áù°Áú†ÈöèÊú∫Êó∂Èó¥ÔºåÊâì‰π±ÈáäÊîæÈ°∫Â∫è
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span><span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">1000</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;Á∫øÁ®ã%dÈáäÊîæ‰∫ÜËµÑÊ∫ê&#34;</span><span class="o">,</span> <span class="n">value</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">finally</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">semaphore</span><span class="o">.</span><span class="na">release</span><span class="o">();</span> <span class="c1">// ÈáäÊîæpermit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Semaphore</span> <span class="n">semaphore</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Semaphore</span><span class="o">(</span><span class="n">3</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">MyThread</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">semaphore</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËæìÂá∫Ôºö</p>
<blockquote>
<p>ÂΩìÂâçÁ∫øÁ®ãÊòØ1, ËøòÂâ©2‰∏™ËµÑÊ∫êÔºåËøòÊúâ0‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ
ÂΩìÂâçÁ∫øÁ®ãÊòØ0, ËøòÂâ©1‰∏™ËµÑÊ∫êÔºåËøòÊúâ0‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ
ÂΩìÂâçÁ∫øÁ®ãÊòØ6, ËøòÂâ©0‰∏™ËµÑÊ∫êÔºåËøòÊúâ0‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ
Á∫øÁ®ã6ÈáäÊîæ‰∫ÜËµÑÊ∫ê
ÂΩìÂâçÁ∫øÁ®ãÊòØ2, ËøòÂâ©0‰∏™ËµÑÊ∫êÔºåËøòÊúâ6‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ
Á∫øÁ®ã2ÈáäÊîæ‰∫ÜËµÑÊ∫ê
ÂΩìÂâçÁ∫øÁ®ãÊòØ4, ËøòÂâ©0‰∏™ËµÑÊ∫êÔºåËøòÊúâ5‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ
Á∫øÁ®ã0ÈáäÊîæ‰∫ÜËµÑÊ∫ê
ÂΩìÂâçÁ∫øÁ®ãÊòØ7, ËøòÂâ©0‰∏™ËµÑÊ∫êÔºåËøòÊúâ4‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ
Á∫øÁ®ã1ÈáäÊîæ‰∫ÜËµÑÊ∫ê
ÂΩìÂâçÁ∫øÁ®ãÊòØ8, ËøòÂâ©0‰∏™ËµÑÊ∫êÔºåËøòÊúâ3‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ
Á∫øÁ®ã7ÈáäÊîæ‰∫ÜËµÑÊ∫ê
ÂΩìÂâçÁ∫øÁ®ãÊòØ5, ËøòÂâ©0‰∏™ËµÑÊ∫êÔºåËøòÊúâ2‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ
Á∫øÁ®ã4ÈáäÊîæ‰∫ÜËµÑÊ∫ê
ÂΩìÂâçÁ∫øÁ®ãÊòØ3, ËøòÂâ©0‰∏™ËµÑÊ∫êÔºåËøòÊúâ1‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ
Á∫øÁ®ã8ÈáäÊîæ‰∫ÜËµÑÊ∫ê
ÂΩìÂâçÁ∫øÁ®ãÊòØ9, ËøòÂâ©0‰∏™ËµÑÊ∫êÔºåËøòÊúâ0‰∏™Á∫øÁ®ãÂú®Á≠âÂæÖ
Á∫øÁ®ã9ÈáäÊîæ‰∫ÜËµÑÊ∫ê
Á∫øÁ®ã5ÈáäÊîæ‰∫ÜËµÑÊ∫ê
Á∫øÁ®ã3ÈáäÊîæ‰∫ÜËµÑÊ∫ê</p>
</blockquote>
<p>ÂèØ‰ª•ÁúãÂà∞ÔºåÂú®ËøôÊ¨°ËøêË°å‰∏≠ÔºåÊúÄÂºÄÂßãÊòØ1, 0, 6Ëøô‰∏â‰∏™Á∫øÁ®ãËé∑Âæó‰∫ÜËµÑÊ∫êÔºåËÄåÂÖ∂ÂÆÉÁ∫øÁ®ãËøõÂÖ•‰∫ÜÁ≠âÂæÖÈòüÂàó„ÄÇÁÑ∂ÂêéÂΩìÊüê‰∏™Á∫øÁ®ãÈáäÊîæËµÑÊ∫êÂêéÔºåÂ∞±‰ºöÊúâÁ≠âÂæÖÈòüÂàó‰∏≠ÁöÑÁ∫øÁ®ãËé∑ÂæóËµÑÊ∫ê„ÄÇ</p>
<p>ÂΩìÁÑ∂ÔºåSemaphoreÈªòËÆ§ÁöÑacquireÊñπÊ≥ïÊòØ‰ºöËÆ©Á∫øÁ®ãËøõÂÖ•Á≠âÂæÖÈòüÂàóÔºå‰∏î‰ºöÊäõÂá∫‰∏≠Êñ≠ÂºÇÂ∏∏„ÄÇ‰ΩÜÂÆÉËøòÊúâ‰∏Ä‰∫õÊñπÊ≥ïÂèØ‰ª•ÂøΩÁï•‰∏≠Êñ≠Êàñ‰∏çËøõÂÖ•ÈòªÂ°ûÈòüÂàóÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÂøΩÁï•‰∏≠Êñ≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">acquireUninterruptibly</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">acquireUninterruptibly</span><span class="o">(</span><span class="kt">int</span> <span class="n">permits</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ‰∏çËøõÂÖ•Á≠âÂæÖÈòüÂàóÔºåÂ∫ïÂ±Ç‰ΩøÁî®CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="n">tryAcquire</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">tryAcquire</span><span class="o">(</span><span class="kt">int</span> <span class="n">permits</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">tryAcquire</span><span class="o">(</span><span class="kt">int</span> <span class="n">permits</span><span class="o">,</span> <span class="kt">long</span> <span class="n">timeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">throws</span> <span class="n">InterruptedException</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">tryAcquire</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="semaphoreÂéüÁêÜ">SemaphoreÂéüÁêÜ</h4>
<p>SemaphoreÂÜÖÈÉ®Êúâ‰∏Ä‰∏™ÁªßÊâø‰∫ÜAQSÁöÑÂêåÊ≠•Âô®SyncÔºåÈáçÂÜô‰∫Ü<code>tryAcquireShared</code>ÊñπÊ≥ï„ÄÇÂú®Ëøô‰∏™ÊñπÊ≥ïÈáåÔºå‰ºöÂéªÂ∞ùËØïËé∑ÂèñËµÑÊ∫ê„ÄÇ</p>
<p>Â¶ÇÊûúËé∑ÂèñÂ§±Ë¥•ÔºàÊÉ≥Ë¶ÅÁöÑËµÑÊ∫êÊï∞ÈáèÂ∞è‰∫éÁõÆÂâçÂ∑≤ÊúâÁöÑËµÑÊ∫êÊï∞ÈáèÔºâÔºåÂ∞±‰ºöËøîÂõû‰∏Ä‰∏™Ë¥üÊï∞Ôºà‰ª£Ë°®Â∞ùËØïËé∑ÂèñËµÑÊ∫êÂ§±Ë¥•Ôºâ„ÄÇÁÑ∂ÂêéÂΩìÂâçÁ∫øÁ®ãÂ∞±‰ºöËøõÂÖ•AQSÁöÑÁ≠âÂæÖÈòüÂàó„ÄÇ</p>
<h3 id="exchanger">Exchanger</h3>
<p>ExchangerÁ±ªÁî®‰∫é‰∏§‰∏™Á∫øÁ®ã‰∫§Êç¢Êï∞ÊçÆ„ÄÇÂÆÉÊîØÊåÅÊ≥õÂûãÔºå‰πüÂ∞±ÊòØËØ¥‰Ω†ÂèØ‰ª•Âú®‰∏§‰∏™Á∫øÁ®ã‰πãÈó¥‰º†ÈÄÅ‰ªª‰ΩïÊï∞ÊçÆ„ÄÇÂÖàÊù•‰∏Ä‰∏™Ê°à‰æãÁúãÁúãÂ¶Ç‰Ωï‰ΩøÁî®ÔºåÊØîÂ¶Ç‰∏§‰∏™Á∫øÁ®ã‰πãÈó¥ÊÉ≥Ë¶Å‰º†ÈÄÅÂ≠óÁ¨¶‰∏≤Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExchangerDemo</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Exchanger</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">exchanger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Exchanger</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;ËøôÊòØÁ∫øÁ®ãAÔºåÂæóÂà∞‰∫ÜÂè¶‰∏Ä‰∏™Á∫øÁ®ãÁöÑÊï∞ÊçÆÔºö&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="o">+</span> <span class="n">exchanger</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="s">&#34;ËøôÊòØÊù•Ëá™Á∫øÁ®ãAÁöÑÊï∞ÊçÆ&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Ëøô‰∏™Êó∂ÂÄôÁ∫øÁ®ãAÊòØÈòªÂ°ûÁöÑÔºåÂú®Á≠âÂæÖÁ∫øÁ®ãBÁöÑÊï∞ÊçÆ&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;ËøôÊòØÁ∫øÁ®ãBÔºåÂæóÂà∞‰∫ÜÂè¶‰∏Ä‰∏™Á∫øÁ®ãÁöÑÊï∞ÊçÆÔºö&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="o">+</span> <span class="n">exchanger</span><span class="o">.</span><span class="na">exchange</span><span class="o">(</span><span class="s">&#34;ËøôÊòØÊù•Ëá™Á∫øÁ®ãBÁöÑÊï∞ÊçÆ&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËæìÂá∫Ôºö</p>
<blockquote>
<p>Ëøô‰∏™Êó∂ÂÄôÁ∫øÁ®ãAÊòØÈòªÂ°ûÁöÑÔºåÂú®Á≠âÂæÖÁ∫øÁ®ãBÁöÑÊï∞ÊçÆ
ËøôÊòØÁ∫øÁ®ãBÔºåÂæóÂà∞‰∫ÜÂè¶‰∏Ä‰∏™Á∫øÁ®ãÁöÑÊï∞ÊçÆÔºöËøôÊòØÊù•Ëá™Á∫øÁ®ãAÁöÑÊï∞ÊçÆ
ËøôÊòØÁ∫øÁ®ãAÔºåÂæóÂà∞‰∫ÜÂè¶‰∏Ä‰∏™Á∫øÁ®ãÁöÑÊï∞ÊçÆÔºöËøôÊòØÊù•Ëá™Á∫øÁ®ãBÁöÑÊï∞ÊçÆ</p>
</blockquote>
<p>ÂèØ‰ª•ÁúãÂà∞ÔºåÂΩì‰∏Ä‰∏™Á∫øÁ®ãË∞ÉÁî®exchangeÊñπÊ≥ïÂêéÔºåÂÆÉÊòØÂ§Ñ‰∫éÈòªÂ°ûÁä∂ÊÄÅÁöÑÔºåÂè™ÊúâÂΩìÂè¶‰∏Ä‰∏™Á∫øÁ®ã‰πüË∞ÉÁî®‰∫ÜexchangeÊñπÊ≥ïÔºåÂÆÉÊâç‰ºöÁªßÁª≠Âêë‰∏ãÊâßË°å„ÄÇÁúãÊ∫êÁ†ÅÂèØ‰ª•ÂèëÁé∞ÂÆÉÊòØ‰ΩøÁî®park/unparkÊù•ÂÆûÁé∞Á≠âÂæÖÁä∂ÊÄÅÁöÑÂàáÊç¢ÁöÑÔºå‰ΩÜÊòØÂú®‰ΩøÁî®park/unparkÊñπÊ≥ï‰πãÂâçÔºå‰ΩøÁî®‰∫ÜCASÊ£ÄÊü•Ôºå‰º∞ËÆ°ÊòØ‰∏∫‰∫ÜÊèêÈ´òÊÄßËÉΩ„ÄÇ</p>
<p>Exchanger‰∏ÄËà¨Áî®‰∫é‰∏§‰∏™Á∫øÁ®ã‰πãÈó¥Êõ¥Êñπ‰æøÂú∞Âú®ÂÜÖÂ≠ò‰∏≠‰∫§Êç¢Êï∞ÊçÆÔºåÂõ†‰∏∫ÂÖ∂ÊîØÊåÅÊ≥õÂûãÔºåÊâÄ‰ª•Êàë‰ª¨ÂèØ‰ª•‰º†Ëæì‰ªª‰ΩïÁöÑÊï∞ÊçÆÔºåÊØîÂ¶ÇIOÊµÅÊàñËÄÖIOÁºìÂ≠ò„ÄÇÊ†πÊçÆJDKÈáåÈù¢ÁöÑÊ≥®ÈáäÁöÑËØ¥Ê≥ïÔºåÂèØ‰ª•ÊÄªÁªì‰∏∫‰∏Ä‰∏ãÁâπÊÄßÔºö</p>
<ul>
<li>Ê≠§Á±ªÊèê‰æõÂØπÂ§ñÁöÑÊìç‰ΩúÊòØÂêåÊ≠•ÁöÑÔºõ</li>
<li>Áî®‰∫éÊàêÂØπÂá∫Áé∞ÁöÑÁ∫øÁ®ã‰πãÈó¥‰∫§Êç¢Êï∞ÊçÆÔºõ</li>
<li>ÂèØ‰ª•ËßÜ‰ΩúÂèåÂêëÁöÑÂêåÊ≠•ÈòüÂàóÔºõ</li>
<li>ÂèØÂ∫îÁî®‰∫éÂü∫Âõ†ÁÆóÊ≥ï„ÄÅÊµÅÊ∞¥Á∫øËÆæËÆ°Á≠âÂú∫ÊôØ„ÄÇ</li>
</ul>
<p>ExchangerÁ±ªËøòÊúâ‰∏Ä‰∏™ÊúâË∂ÖÊó∂ÂèÇÊï∞ÁöÑÊñπÊ≥ïÔºåÂ¶ÇÊûúÂú®ÊåáÂÆöÊó∂Èó¥ÂÜÖÊ≤°ÊúâÂè¶‰∏Ä‰∏™Á∫øÁ®ãË∞ÉÁî®exchangeÔºåÂ∞±‰ºöÊäõÂá∫‰∏Ä‰∏™Ë∂ÖÊó∂ÂºÇÂ∏∏„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">V</span> <span class="nf">exchange</span><span class="o">(</span><span class="n">V</span> <span class="n">x</span><span class="o">,</span> <span class="kt">long</span> <span class="n">timeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÇ£‰πàÈóÆÈ¢òÊù•‰∫ÜÔºåExchangerÂè™ËÉΩÊòØ‰∏§‰∏™Á∫øÁ®ã‰∫§Êç¢Êï∞ÊçÆÂêóÔºüÈÇ£‰∏â‰∏™Ë∞ÉÁî®Âêå‰∏Ä‰∏™ÂÆû‰æãÁöÑexchangeÊñπÊ≥ï‰ºöÂèëÁîü‰ªÄ‰πàÂë¢ÔºüÁ≠îÊ°àÊòØÂè™ÊúâÂâç‰∏§‰∏™Á∫øÁ®ã‰ºö‰∫§Êç¢Êï∞ÊçÆÔºåÁ¨¨‰∏â‰∏™Á∫øÁ®ã‰ºöËøõÂÖ•ÈòªÂ°ûÁä∂ÊÄÅ„ÄÇ</p>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåexchangeÊòØÂèØ‰ª•ÈáçÂ§ç‰ΩøÁî®ÁöÑ„ÄÇ‰πüÂ∞±ÊòØËØ¥„ÄÇ‰∏§‰∏™Á∫øÁ®ãÂèØ‰ª•‰ΩøÁî®ExchangerÂú®ÂÜÖÂ≠ò‰∏≠‰∏çÊñ≠Âú∞ÂÜç‰∫§Êç¢Êï∞ÊçÆ„ÄÇ</p>
<h3 id="countdownlatch">CountDownLatch</h3>
<h4 id="countdownlatch‰ªãÁªç">CountDownLatch‰ªãÁªç</h4>
<p>ÂÖàÊù•Ëß£ËØª‰∏Ä‰∏ãCountDownLatchËøô‰∏™Á±ªÂêçÂ≠óÁöÑÊÑè‰πâ„ÄÇCountDown‰ª£Ë°®ËÆ°Êï∞ÈÄíÂáèÔºåLatchÊòØ‚ÄúÈó®Èó©‚ÄùÁöÑÊÑèÊÄù„ÄÇ‰πüÊúâ‰∫∫ÊääÂÆÉÁß∞‰∏∫‚ÄúÂ±èÈöú‚Äù„ÄÇËÄåCountDownLatchËøô‰∏™Á±ªÁöÑ‰ΩúÁî®‰πüÂæàË¥¥ÂêàËøô‰∏™ÂêçÂ≠óÁöÑÊÑè‰πâÔºåÂÅáËÆæÊüê‰∏™Á∫øÁ®ãÂú®ÊâßË°å‰ªªÂä°‰πãÂâçÔºåÈúÄË¶ÅÁ≠âÂæÖÂÖ∂ÂÆÉÁ∫øÁ®ãÂÆåÊàê‰∏Ä‰∫õÂâçÁΩÆ‰ªªÂä°ÔºåÂøÖÈ°ªÁ≠âÊâÄÊúâÁöÑÂâçÁΩÆ‰ªªÂä°ÈÉΩÂÆåÊàêÔºåÊâçËÉΩÂºÄÂßãÊâßË°åÊú¨Á∫øÁ®ãÁöÑ‰ªªÂä°„ÄÇ</p>
<p>CountDownLatchÁöÑÊñπÊ≥ï‰πüÂæàÁÆÄÂçïÔºåÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÊûÑÈÄ†ÊñπÊ≥ïÔºö
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="nf">CountDownLatch</span><span class="o">(</span><span class="kt">int</span> <span class="n">count</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">await</span><span class="o">()</span> <span class="c1">// Á≠âÂæÖ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">await</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span> <span class="c1">// Ë∂ÖÊó∂Á≠âÂæÖ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">countDown</span><span class="o">()</span> <span class="c1">// count - 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">long</span> <span class="nf">getCount</span><span class="o">()</span> <span class="c1">// Ëé∑ÂèñÂΩìÂâçËøòÊúâÂ§öÂ∞ëcount
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="countdownlatchÊ°à‰æã">CountDownLatchÊ°à‰æã</h4>
<p>Êàë‰ª¨Áü•ÈÅìÔºåÁé©Ê∏∏ÊàèÁöÑÊó∂ÂÄôÔºåÂú®Ê∏∏ÊàèÁúüÊ≠£ÂºÄÂßã‰πãÂâçÔºå‰∏ÄËà¨‰ºöÁ≠âÂæÖ‰∏Ä‰∫õÂâçÁΩÆ‰ªªÂä°ÂÆåÊàêÔºåÊØîÂ¶Ç‚ÄúÂä†ËΩΩÂú∞ÂõæÊï∞ÊçÆ‚ÄùÔºå‚ÄúÂä†ËΩΩ‰∫∫Áâ©Ê®°Âûã‚ÄùÔºå‚ÄúÂä†ËΩΩËÉåÊôØÈü≥‰πê‚ÄùÁ≠âÁ≠â„ÄÇÂè™ÊúâÂΩìÊâÄÊúâÁöÑ‰∏úË•øÈÉΩÂä†ËΩΩÂÆåÊàêÂêéÔºåÁé©ÂÆ∂ÊâçËÉΩÁúüÊ≠£ËøõÂÖ•Ê∏∏Êàè„ÄÇ‰∏ãÈù¢Êàë‰ª¨Â∞±Êù•Ê®°Êãü‰∏Ä‰∏ãËøô‰∏™demo„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountDownLatchDemo</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÆö‰πâÂâçÁΩÆ‰ªªÂä°Á∫øÁ®ã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PreTaskThread</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">task</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">CountDownLatch</span> <span class="n">countDownLatch</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="nf">PreTaskThread</span><span class="o">(</span><span class="n">String</span> <span class="n">task</span><span class="o">,</span> <span class="n">CountDownLatch</span> <span class="n">countDownLatch</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">countDownLatch</span> <span class="o">=</span> <span class="n">countDownLatch</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">1000</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">task</span> <span class="o">+</span> <span class="s">&#34; - ‰ªªÂä°ÂÆåÊàê&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">countDownLatch</span><span class="o">.</span><span class="na">countDown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ÂÅáËÆæÊúâ‰∏â‰∏™Ê®°ÂùóÈúÄË¶ÅÂä†ËΩΩ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">CountDownLatch</span> <span class="n">countDownLatch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CountDownLatch</span><span class="o">(</span><span class="n">3</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ‰∏ª‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Á≠âÂæÖÊï∞ÊçÆÂä†ËΩΩ...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;ËøòÊúâ%d‰∏™ÂâçÁΩÆ‰ªªÂä°&#34;</span><span class="o">,</span> <span class="n">countDownLatch</span><span class="o">.</span><span class="na">getCount</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">                <span class="n">countDownLatch</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Êï∞ÊçÆÂä†ËΩΩÂÆåÊàêÔºåÊ≠£ÂºèÂºÄÂßãÊ∏∏ÊàèÔºÅ&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ÂâçÁΩÆ‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">PreTaskThread</span><span class="o">(</span><span class="s">&#34;Âä†ËΩΩÂú∞ÂõæÊï∞ÊçÆ&#34;</span><span class="o">,</span> <span class="n">countDownLatch</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">PreTaskThread</span><span class="o">(</span><span class="s">&#34;Âä†ËΩΩ‰∫∫Áâ©Ê®°Âûã&#34;</span><span class="o">,</span> <span class="n">countDownLatch</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">PreTaskThread</span><span class="o">(</span><span class="s">&#34;Âä†ËΩΩËÉåÊôØÈü≥‰πê&#34;</span><span class="o">,</span> <span class="n">countDownLatch</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËæìÂá∫Ôºö</p>
<blockquote>
<p>Á≠âÂæÖÊï∞ÊçÆÂä†ËΩΩ&hellip;
ËøòÊúâ3‰∏™ÂâçÁΩÆ‰ªªÂä°
Âä†ËΩΩ‰∫∫Áâ©Ê®°Âûã - ‰ªªÂä°ÂÆåÊàê
Âä†ËΩΩËÉåÊôØÈü≥‰πê - ‰ªªÂä°ÂÆåÊàê
Âä†ËΩΩÂú∞ÂõæÊï∞ÊçÆ - ‰ªªÂä°ÂÆåÊàê
Êï∞ÊçÆÂä†ËΩΩÂÆåÊàêÔºåÊ≠£ÂºèÂºÄÂßãÊ∏∏ÊàèÔºÅ</p>
</blockquote>
<h4 id="countdownlatchÂéüÁêÜ">CountDownLatchÂéüÁêÜ</h4>
<p>ÂÖ∂ÂÆûCountDownLatchÁ±ªÁöÑÂéüÁêÜÊå∫ÁÆÄÂçïÁöÑÔºåÂÜÖÈÉ®ÂêåÊ†∑ÊòØ‰∏Ä‰∏™ÁªßÊâø‰∫ÜAQSÁöÑÂÆûÁé∞Á±ªSyncÔºå‰∏îÂÆûÁé∞Ëµ∑Êù•ËøòÂæàÁÆÄÂçïÔºåÂèØËÉΩÊòØJDKÈáåÈù¢AQSÁöÑÂ≠êÁ±ª‰∏≠ÊúÄÁÆÄÂçïÁöÑÂÆûÁé∞‰∫ÜÔºåÊúâÂÖ¥Ë∂£ÁöÑËØªËÄÖÂèØ‰ª•ÂéªÁúãÁúãËøô‰∏™ÂÜÖÈÉ®Á±ªÁöÑÊ∫êÁ†Å„ÄÇ</p>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÊûÑÈÄ†Âô®‰∏≠ÁöÑ<strong>ËÆ°Êï∞ÂÄºÔºàcountÔºâÂÆûÈôÖ‰∏äÂ∞±ÊòØÈó≠ÈîÅÈúÄË¶ÅÁ≠âÂæÖÁöÑÁ∫øÁ®ãÊï∞Èáè</strong>„ÄÇËøô‰∏™ÂÄºÂè™ËÉΩË¢´ËÆæÁΩÆ‰∏ÄÊ¨°ÔºåËÄå‰∏îCountDownLatch<strong>Ê≤°ÊúâÊèê‰æõ‰ªª‰ΩïÊú∫Âà∂ÂéªÈáçÊñ∞ËÆæÁΩÆËøô‰∏™ËÆ°Êï∞ÂÄº</strong>„ÄÇ</p>
<h3 id="cyclicbarrier">CyclicBarrier</h3>
<h4 id="cyclicbarrier‰ªãÁªç">CyclicBarrier‰ªãÁªç</h4>
<p>CyclicBarrirer‰ªéÂêçÂ≠ó‰∏äÊù•ÁêÜËß£ÊòØ‚ÄúÂæ™ÁéØÁöÑÂ±èÈöú‚ÄùÁöÑÊÑèÊÄù„ÄÇÂâçÈù¢ÊèêÂà∞‰∫ÜCountDownLatch‰∏ÄÊó¶ËÆ°Êï∞ÂÄº<code>count</code>Ë¢´Èôç‰∏∫0ÂêéÔºåÂ∞±‰∏çËÉΩÂÜçÈáçÊñ∞ËÆæÁΩÆ‰∫ÜÔºåÂÆÉÂè™ËÉΩËµ∑‰∏ÄÊ¨°‚ÄúÂ±èÈöú‚ÄùÁöÑ‰ΩúÁî®„ÄÇËÄåCyclicBarrierÊã•ÊúâCountDownLatchÁöÑÊâÄÊúâÂäüËÉΩÔºåËøòÂèØ‰ª•‰ΩøÁî®<code>reset()</code>ÊñπÊ≥ïÈáçÁΩÆÂ±èÈöú„ÄÇ</p>
<h4 id="cyclicbarrier-barrierË¢´Á†¥Âùè">CyclicBarrier BarrierË¢´Á†¥Âùè</h4>
<p>Â¶ÇÊûúÂèÇ‰∏éËÄÖÔºàÁ∫øÁ®ãÔºâÂú®Á≠âÂæÖÁöÑËøáÁ®ã‰∏≠ÔºåBarrierË¢´Á†¥ÂùèÔºåÂ∞±‰ºöÊäõÂá∫BrokenBarrierException„ÄÇÂèØ‰ª•Áî®<code>isBroken()</code>ÊñπÊ≥ïÊ£ÄÊµãBarrierÊòØÂê¶Ë¢´Á†¥Âùè„ÄÇ</p>
<ol>
<li>Â¶ÇÊûúÊúâÁ∫øÁ®ãÂ∑≤ÁªèÂ§Ñ‰∫éÁ≠âÂæÖÁä∂ÊÄÅÔºåË∞ÉÁî®resetÊñπÊ≥ï‰ºöÂØºËá¥Â∑≤ÁªèÂú®Á≠âÂæÖÁöÑÁ∫øÁ®ãÂá∫Áé∞BrokenBarrierExceptionÂºÇÂ∏∏„ÄÇÂπ∂‰∏îÁî±‰∫éÂá∫Áé∞‰∫ÜBrokenBarrierExceptionÔºåÂ∞Ü‰ºöÂØºËá¥ÂßãÁªàÊó†Ê≥ïÁ≠âÂæÖ„ÄÇ</li>
<li>Â¶ÇÊûúÂú®Á≠âÂæÖÁöÑËøáÁ®ã‰∏≠ÔºåÁ∫øÁ®ãË¢´‰∏≠Êñ≠Ôºå‰ºöÊäõÂá∫InterruptedExceptionÂºÇÂ∏∏ÔºåÂπ∂‰∏îËøô‰∏™ÂºÇÂ∏∏‰ºö‰º†Êí≠Âà∞ÂÖ∂‰ªñÊâÄÊúâÁöÑÁ∫øÁ®ã„ÄÇ</li>
<li>Â¶ÇÊûúÂú®ÊâßË°åÂ±èÈöúÊìç‰ΩúËøáÁ®ã‰∏≠ÂèëÁîüÂºÇÂ∏∏ÔºåÂàôËØ•ÂºÇÂ∏∏Â∞Ü‰º†Êí≠Âà∞ÂΩìÂâçÁ∫øÁ®ã‰∏≠ÔºåÂÖ∂‰ªñÁ∫øÁ®ã‰ºöÊäõÂá∫BrokenBarrierExceptionÔºåÂ±èÈöúË¢´ÊçüÂùè„ÄÇ</li>
<li>Â¶ÇÊûúË∂ÖÂá∫ÊåáÂÆöÁöÑÁ≠âÂæÖÊó∂Èó¥ÔºåÂΩìÂâçÁ∫øÁ®ã‰ºöÊäõÂá∫ TimeoutException ÂºÇÂ∏∏ÔºåÂÖ∂‰ªñÁ∫øÁ®ã‰ºöÊäõÂá∫BrokenBarrierExceptionÂºÇÂ∏∏„ÄÇ</li>
</ol>
<h4 id="cyclicbarrierÊ°à‰æã">CyclicBarrierÊ°à‰æã</h4>
<p>Êàë‰ª¨ÂêåÊ†∑Áî®Áé©Ê∏∏ÊàèÁöÑ‰æãÂ≠ê„ÄÇÂ¶ÇÊûúÁé©‰∏Ä‰∏™Ê∏∏ÊàèÊúâÂ§ö‰∏™‚ÄúÂÖ≥Âç°‚ÄùÔºåÈÇ£‰ΩøÁî®CountDownLatchÊòæÁÑ∂‰∏çÂ§™ÂêàÈÄÇÔºåÈÇ£ÈúÄË¶Å‰∏∫ÊØè‰∏™ÂÖ≥Âç°ÈÉΩÂàõÂª∫‰∏Ä‰∏™ÂÆû‰æã„ÄÇÈÇ£Êàë‰ª¨ÂèØ‰ª•‰ΩøÁî®CyclicBarrierÊù•ÂÆûÁé∞ÊØè‰∏™ÂÖ≥Âç°ÁöÑÊï∞ÊçÆÂä†ËΩΩÁ≠âÂæÖÂäüËÉΩ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CyclicBarrierDemo</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PreTaskThread</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">task</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">CyclicBarrier</span> <span class="n">cyclicBarrier</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="nf">PreTaskThread</span><span class="o">(</span><span class="n">String</span> <span class="n">task</span><span class="o">,</span> <span class="n">CyclicBarrier</span> <span class="n">cyclicBarrier</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">cyclicBarrier</span> <span class="o">=</span> <span class="n">cyclicBarrier</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// ÂÅáËÆæÊÄªÂÖ±‰∏â‰∏™ÂÖ≥Âç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">4</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">1000</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;ÂÖ≥Âç°%dÁöÑ‰ªªÂä°%sÂÆåÊàê&#34;</span><span class="o">,</span> <span class="n">i</span><span class="o">,</span> <span class="n">task</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                    <span class="n">cyclicBarrier</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="o">|</span> <span class="n">BrokenBarrierException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">cyclicBarrier</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span> <span class="c1">// ÈáçÁΩÆÂ±èÈöú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">CyclicBarrier</span> <span class="n">cyclicBarrier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CyclicBarrier</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Êú¨ÂÖ≥Âç°ÊâÄÊúâÂâçÁΩÆ‰ªªÂä°ÂÆåÊàêÔºåÂºÄÂßãÊ∏∏Êàè...&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">PreTaskThread</span><span class="o">(</span><span class="s">&#34;Âä†ËΩΩÂú∞ÂõæÊï∞ÊçÆ&#34;</span><span class="o">,</span> <span class="n">cyclicBarrier</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">PreTaskThread</span><span class="o">(</span><span class="s">&#34;Âä†ËΩΩ‰∫∫Áâ©Ê®°Âûã&#34;</span><span class="o">,</span> <span class="n">cyclicBarrier</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">PreTaskThread</span><span class="o">(</span><span class="s">&#34;Âä†ËΩΩËÉåÊôØÈü≥‰πê&#34;</span><span class="o">,</span> <span class="n">cyclicBarrier</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËæìÂá∫Ôºö</p>
<blockquote>
<p>ÂÖ≥Âç°1ÁöÑ‰ªªÂä°Âä†ËΩΩÂú∞ÂõæÊï∞ÊçÆÂÆåÊàê
ÂÖ≥Âç°1ÁöÑ‰ªªÂä°Âä†ËΩΩËÉåÊôØÈü≥‰πêÂÆåÊàê
ÂÖ≥Âç°1ÁöÑ‰ªªÂä°Âä†ËΩΩ‰∫∫Áâ©Ê®°ÂûãÂÆåÊàê
Êú¨ÂÖ≥Âç°ÊâÄÊúâÂâçÁΩÆ‰ªªÂä°ÂÆåÊàêÔºåÂºÄÂßãÊ∏∏Êàè&hellip;
ÂÖ≥Âç°2ÁöÑ‰ªªÂä°Âä†ËΩΩÂú∞ÂõæÊï∞ÊçÆÂÆåÊàê
ÂÖ≥Âç°2ÁöÑ‰ªªÂä°Âä†ËΩΩËÉåÊôØÈü≥‰πêÂÆåÊàê
ÂÖ≥Âç°2ÁöÑ‰ªªÂä°Âä†ËΩΩ‰∫∫Áâ©Ê®°ÂûãÂÆåÊàê
Êú¨ÂÖ≥Âç°ÊâÄÊúâÂâçÁΩÆ‰ªªÂä°ÂÆåÊàêÔºåÂºÄÂßãÊ∏∏Êàè&hellip;
ÂÖ≥Âç°3ÁöÑ‰ªªÂä°Âä†ËΩΩ‰∫∫Áâ©Ê®°ÂûãÂÆåÊàê
ÂÖ≥Âç°3ÁöÑ‰ªªÂä°Âä†ËΩΩÂú∞ÂõæÊï∞ÊçÆÂÆåÊàê
ÂÖ≥Âç°3ÁöÑ‰ªªÂä°Âä†ËΩΩËÉåÊôØÈü≥‰πêÂÆåÊàê
Êú¨ÂÖ≥Âç°ÊâÄÊúâÂâçÁΩÆ‰ªªÂä°ÂÆåÊàêÔºåÂºÄÂßãÊ∏∏Êàè&hellip;</p>
</blockquote>
<p>Ê≥®ÊÑèËøôÈáåË∑üCountDownLatchÁöÑ‰ª£Á†ÅÊúâ‰∏Ä‰∫õ‰∏çÂêå„ÄÇCyclicBarrierÊ≤°ÊúâÂàÜ‰∏∫<code>await()</code>Âíå<code>countDown()</code>ÔºåËÄåÊòØÂè™ÊúâÂçïÁã¨ÁöÑ‰∏Ä‰∏™<code>await()</code>ÊñπÊ≥ï„ÄÇ</p>
<p>‰∏ÄÊó¶Ë∞ÉÁî®await()ÊñπÊ≥ïÁöÑÁ∫øÁ®ãÊï∞ÈáèÁ≠â‰∫éÊûÑÈÄ†ÊñπÊ≥ï‰∏≠‰º†ÂÖ•ÁöÑ‰ªªÂä°ÊÄªÈáèÔºàËøôÈáåÊòØ3ÔºâÔºåÂ∞±‰ª£Ë°®ËææÂà∞Â±èÈöú‰∫Ü„ÄÇCyclicBarrierÂÖÅËÆ∏Êàë‰ª¨Âú®ËææÂà∞Â±èÈöúÁöÑÊó∂ÂÄôÂèØ‰ª•ÊâßË°å‰∏Ä‰∏™‰ªªÂä°ÔºåÂèØ‰ª•Âú®ÊûÑÈÄ†ÊñπÊ≥ï‰º†ÂÖ•‰∏Ä‰∏™RunnableÁ±ªÂûãÁöÑÂØπË±°„ÄÇ‰∏äËø∞Ê°à‰æãÂ∞±ÊòØÂú®ËææÂà∞Â±èÈöúÊó∂ÔºåËæìÂá∫‚ÄúÊú¨ÂÖ≥Âç°ÊâÄÊúâÂâçÁΩÆ‰ªªÂä°ÂÆåÊàêÔºåÂºÄÂßãÊ∏∏Êàè&hellip;‚Äù„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÊûÑÈÄ†ÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="nf">CyclicBarrier</span><span class="o">(</span><span class="kt">int</span> <span class="n">parties</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">(</span><span class="n">parties</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="nf">CyclicBarrier</span><span class="o">(</span><span class="kt">int</span> <span class="n">parties</span><span class="o">,</span> <span class="n">Runnable</span> <span class="n">barrierAction</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÖ∑‰ΩìÂÆûÁé∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="cyclicbarrierÂéüÁêÜ">CyclicBarrierÂéüÁêÜ</h4>
<p>CyclicBarrierËôΩËØ¥ÂäüËÉΩ‰∏éCountDownLatchÁ±ª‰ººÔºå‰ΩÜÊòØÂÆûÁé∞ÂéüÁêÜÂç¥ÂÆåÂÖ®‰∏çÂêåÔºåCyclicBarrierÂÜÖÈÉ®‰ΩøÁî®ÁöÑÊòØLock + ConditionÂÆûÁé∞ÁöÑÁ≠âÂæÖ/ÈÄöÁü•Ê®°Âºè„ÄÇËØ¶ÊÉÖÂèØ‰ª•Êü•ÁúãËøô‰∏™ÊñπÊ≥ïÁöÑÊ∫êÁ†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">int</span> <span class="nf">dowait</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">timed</span><span class="o">,</span> <span class="kt">long</span> <span class="n">nanos</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="phaser">Phaser</h3>
<h4 id="phaser‰ªãÁªç">Phaser‰ªãÁªç</h4>
<p>PhaserËøô‰∏™ÂçïËØçÊòØ‚ÄúÁßªÁõ∏Âô®ÔºåÁõ∏‰ΩçÂô®‚ÄùÁöÑÊÑèÊÄùÔºàÂ•ΩÂêßÔºåÁ¨îËÄÖÂπ∂‰∏çÊáÇËøôÊòØ‰ªÄ‰πàÁé©ÊÑèÔºå‰∏ãÊñπËµÑÊñôÊù•Ëá™ÁôæÂ∫¶ÁôæÁßëÔºâ„ÄÇËøô‰∏™Á±ªÊòØ‰ªéJDK 1.7 ‰∏≠Âá∫Áé∞ÁöÑ„ÄÇ</p>
<blockquote>
<p>ÁßªÁõ∏Âô®ÔºàPhaserÔºâËÉΩÂ§üÂØπÊ≥¢ÁöÑÁõ∏‰ΩçËøõË°åË∞ÉÊï¥ÁöÑ‰∏ÄÁßçË£ÖÁΩÆ„ÄÇ‰ªª‰Ωï‰º†Ëæì‰ªãË¥®ÂØπÂú®ÂÖ∂‰∏≠‰º†ÂØºÁöÑÊ≥¢Âä®ÈÉΩ‰ºöÂºïÂÖ•Áõ∏ÁßªÔºåËøôÊòØÊó©ÊúüÊ®°ÊãüÁßªÁõ∏Âô®ÁöÑÂéüÁêÜÔºõÁé∞‰ª£ÁîµÂ≠êÊäÄÊúØÂèëÂ±ïÂêéÂà©Áî®A/D„ÄÅD/AËΩ¨Êç¢ÂÆûÁé∞‰∫ÜÊï∞Â≠óÁßªÁõ∏ÔºåÈ°æÂêçÊÄù‰πâÔºåÂÆÉÊòØ‰∏ÄÁßç‰∏çËøûÁª≠ÁöÑÁßªÁõ∏ÊäÄÊúØÔºå‰ΩÜÁâπÁÇπÊòØÁßªÁõ∏Á≤æÂ∫¶È´ò„ÄÇ ÁßªÁõ∏Âô®Âú®Èõ∑Ëææ„ÄÅÂØºÂºπÂßøÊÄÅÊéßÂà∂„ÄÅÂä†ÈÄüÂô®„ÄÅÈÄö‰ø°„ÄÅ‰ª™Âô®‰ª™Ë°®ÁîöËá≥‰∫éÈü≥‰πêÁ≠âÈ¢ÜÂüüÈÉΩÊúâÁùÄÂπøÊ≥õÁöÑÂ∫îÁî®</p>
</blockquote>
<p>PhaserÁ±ªÊúâÁÇπÂ§çÊùÇÔºåËøôÈáåÂè™‰ªãÁªç‰∏Ä‰∫õÂü∫Êú¨ÁöÑÁî®Ê≥ïÂíåÁü•ËØÜÁÇπ„ÄÇËØ¶ÊÉÖÂèØ‰ª•Êü•ÁúãJDKÊñáÊ°£ÔºåÊñáÊ°£ÈáåÊúâËøô‰∏™Á±ªÈùûÂ∏∏ËØ¶Â∞ΩÁöÑ‰ªãÁªç„ÄÇ</p>
<p>ÂâçÈù¢Êàë‰ª¨‰ªãÁªç‰∫ÜCyclicBarrierÔºåÂèØ‰ª•ÂèëÁé∞ÂÆÉÂú®ÊûÑÈÄ†ÊñπÊ≥ïÈáå‰º†ÂÖ•‚Äú‰ªªÂä°ÊÄªÈáè‚Äù<code>parties</code>‰πãÂêéÔºåÂ∞±‰∏çËÉΩ‰øÆÊîπËøô‰∏™ÂÄº‰∫ÜÔºåÂπ∂‰∏îÊØèÊ¨°Ë∞ÉÁî®<code>await()</code>ÊñπÊ≥ï‰πüÂè™ËÉΩÊ∂àËÄó‰∏Ä‰∏™<code>parties</code>ËÆ°Êï∞„ÄÇ‰ΩÜPhaserÂèØ‰ª•Âä®ÊÄÅÂú∞Ë∞ÉÊï¥‰ªªÂä°ÊÄªÈáèÔºÅ</p>
<p>ÂêçËØçËß£ÈáäÔºö</p>
<ul>
<li>partyÔºöÂØπÂ∫î‰∏Ä‰∏™Á∫øÁ®ãÔºåÊï∞ÈáèÂèØ‰ª•ÈÄöËøáregisterÊàñËÄÖÊûÑÈÄ†ÂèÇÊï∞‰º†ÂÖ•;</li>
<li>arriveÔºöÂØπÂ∫î‰∏Ä‰∏™partyÁöÑÁä∂ÊÄÅÔºåÂàùÂßãÊó∂ÊòØunarrivedÔºåÂΩìË∞ÉÁî®<code>arriveAndAwaitAdvance()</code>ÊàñËÄÖ <code>arriveAndDeregister()</code>ËøõÂÖ•arriveÁä∂ÊÄÅÔºåÂèØ‰ª•ÈÄöËøá<code>getUnarrivedParties()</code>Ëé∑ÂèñÂΩìÂâçÊú™Âà∞ËææÁöÑÊï∞Èáè;</li>
<li>registerÔºöÊ≥®ÂÜå‰∏Ä‰∏™partyÔºåÊØè‰∏ÄÈò∂ÊÆµÂøÖÈ°ªÊâÄÊúâÊ≥®ÂÜåÁöÑpartyÈÉΩÂà∞ËææÊâçËÉΩËøõÂÖ•‰∏ã‰∏ÄÈò∂ÊÆµ;</li>
<li>deRegisterÔºöÂáèÂ∞ë‰∏Ä‰∏™party„ÄÇ</li>
<li>phaseÔºöÈò∂ÊÆµÔºåÂΩìÊâÄÊúâÊ≥®ÂÜåÁöÑpartyÈÉΩarrive‰πãÂêéÔºåÂ∞Ü‰ºöË∞ÉÁî®PhaserÁöÑ<code>onAdvance()</code>ÊñπÊ≥ïÊù•Âà§Êñ≠ÊòØÂê¶Ë¶ÅËøõÂÖ•‰∏ã‰∏ÄÈò∂ÊÆµ„ÄÇ</li>
</ul>
<p>PhaserÁªàÊ≠¢ÁöÑ‰∏§ÁßçÈÄîÂæÑÔºåPhaserÁª¥Êä§ÁöÑÁ∫øÁ®ãÊâßË°åÂÆåÊØïÊàñËÄÖ<code>onAdvance()</code>ËøîÂõû<code>true</code> Ê≠§Â§ñPhaserËøòËÉΩÁª¥Êä§‰∏Ä‰∏™Ê†ëÁä∂ÁöÑÂ±ÇÁ∫ßÂÖ≥Á≥ªÔºåÊûÑÈÄ†ÁöÑÊó∂ÂÄônew Phaser(parentPhaser)ÔºåÂØπ‰∫éTaskÊâßË°åÊó∂Èó¥Áü≠ÁöÑÂú∫ÊôØÔºàÁ´û‰∫âÊøÄÁÉàÔºâÔºå‰πüÂ∞±ÊòØËØ¥ÊúâÂ§ßÈáèÁöÑ<strong>party</strong>, ÈÇ£ÂèØ‰ª•ÊääÊØè‰∏™PhaserÁöÑ‰ªªÂä°ÈáèËÆæÁΩÆËæÉÂ∞èÔºåÂ§ö‰∏™PhaserÂÖ±ÂêåÁªßÊâø‰∏Ä‰∏™Áà∂Phaser„ÄÇ</p>
<blockquote>
<p>Phasers with large numbers of parties that would otherwise experience heavy synchronization contention costs may instead be set up so that groups of sub-phasers share a common parent. This may greatly increase throughput even though it incurs greater per-operation overhead.</p>
<p>ÁøªËØëÔºöÂ¶ÇÊûúÊúâÂ§ßÈáèÁöÑpartyÔºåÈÇ£ËÆ∏Â§öÁ∫øÁ®ãÂèØËÉΩÂêåÊ≠•ÁöÑÁ´û‰∫âÊàêÊú¨ÊØîËæÉÈ´ò„ÄÇÊâÄ‰ª•ÂèØ‰ª•ÊãÜÂàÜÊàêÂ§ö‰∏™Â≠êPhaserÂÖ±‰∫´‰∏Ä‰∏™ÂÖ±ÂêåÁöÑÁà∂Phaser„ÄÇËøôÂèØËÉΩ‰ºöÂ§ßÂ§ßÂ¢ûÂä†ÂêûÂêêÈáèÔºåÂç≥‰ΩøÂÆÉ‰ºöÂ∏¶Êù•Êõ¥Â§öÁöÑÊØèÊ¨°Êìç‰ΩúÂºÄÈîÄ„ÄÇ</p>
</blockquote>
<h4 id="phaserÊ°à‰æã">PhaserÊ°à‰æã</h4>
<p>ËøòÊòØÊ∏∏ÊàèÁöÑÊ°à‰æã„ÄÇÂÅáËÆæÊàë‰ª¨Ê∏∏ÊàèÊúâ‰∏â‰∏™ÂÖ≥Âç°Ôºå‰ΩÜÂè™ÊúâÁ¨¨‰∏Ä‰∏™ÂÖ≥Âç°ÊúâÊñ∞ÊâãÊïôÁ®ãÔºåÈúÄË¶ÅÂä†ËΩΩÊñ∞ÊâãÊïôÁ®ãÊ®°Âùó„ÄÇ‰ΩÜÂêéÈù¢ÁöÑÁ¨¨‰∫å‰∏™ÂÖ≥Âç°ÂíåÁ¨¨‰∏â‰∏™ÂÖ≥Âç°ÈÉΩ‰∏çÈúÄË¶Å„ÄÇÊàë‰ª¨ÂèØ‰ª•Áî®PhaserÊù•ÂÅöËøô‰∏™ÈúÄÊ±Ç„ÄÇ</p>
<p>‰ª£Á†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PhaserDemo</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">PreTaskThread</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">task</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">Phaser</span> <span class="n">phaser</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="nf">PreTaskThread</span><span class="o">(</span><span class="n">String</span> <span class="n">task</span><span class="o">,</span> <span class="n">Phaser</span> <span class="n">phaser</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">phaser</span> <span class="o">=</span> <span class="n">phaser</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">4</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// Á¨¨‰∫åÊ¨°ÂÖ≥Âç°Ëµ∑‰∏çÂä†ËΩΩNPCÔºåË∑≥Ëøá
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">2</span> <span class="o">&amp;&amp;</span> <span class="s">&#34;Âä†ËΩΩÊñ∞ÊâãÊïôÁ®ã&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">task</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">1000</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;ÂÖ≥Âç°%dÔºåÈúÄË¶ÅÂä†ËΩΩ%d‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„Äê%s„Äë&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">i</span><span class="o">,</span> <span class="n">phaser</span><span class="o">.</span><span class="na">getRegisteredParties</span><span class="o">(),</span> <span class="n">task</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="c1">// ‰ªéÁ¨¨‰∫å‰∏™ÂÖ≥Âç°Ëµ∑Ôºå‰∏çÂä†ËΩΩNPC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">1</span> <span class="o">&amp;&amp;</span> <span class="s">&#34;Âä†ËΩΩÊñ∞ÊâãÊïôÁ®ã&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">task</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;‰∏ãÊ¨°ÂÖ≥Âç°ÁßªÈô§Âä†ËΩΩ„ÄêÊñ∞ÊâãÊïôÁ®ã„ÄëÊ®°Âùó&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                        <span class="n">phaser</span><span class="o">.</span><span class="na">arriveAndDeregister</span><span class="o">();</span> <span class="c1">// ÁßªÈô§‰∏Ä‰∏™Ê®°Âùó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">phaser</span><span class="o">.</span><span class="na">arriveAndAwaitAdvance</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Phaser</span> <span class="n">phaser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Phaser</span><span class="o">(</span><span class="n">4</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">onAdvance</span><span class="o">(</span><span class="kt">int</span> <span class="n">phase</span><span class="o">,</span> <span class="kt">int</span> <span class="n">registeredParties</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;Á¨¨%dÊ¨°ÂÖ≥Âç°ÂáÜÂ§áÂÆåÊàê&#34;</span><span class="o">,</span> <span class="n">phase</span> <span class="o">+</span> <span class="n">1</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">phase</span> <span class="o">==</span> <span class="n">3</span> <span class="o">||</span> <span class="n">registeredParties</span> <span class="o">==</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">PreTaskThread</span><span class="o">(</span><span class="s">&#34;Âä†ËΩΩÂú∞ÂõæÊï∞ÊçÆ&#34;</span><span class="o">,</span> <span class="n">phaser</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">PreTaskThread</span><span class="o">(</span><span class="s">&#34;Âä†ËΩΩ‰∫∫Áâ©Ê®°Âûã&#34;</span><span class="o">,</span> <span class="n">phaser</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">PreTaskThread</span><span class="o">(</span><span class="s">&#34;Âä†ËΩΩËÉåÊôØÈü≥‰πê&#34;</span><span class="o">,</span> <span class="n">phaser</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">PreTaskThread</span><span class="o">(</span><span class="s">&#34;Âä†ËΩΩÊñ∞ÊâãÊïôÁ®ã&#34;</span><span class="o">,</span> <span class="n">phaser</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËæìÂá∫Ôºö</p>
<blockquote>
<p>ÂÖ≥Âç°1ÔºåÈúÄË¶ÅÂä†ËΩΩ4‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„ÄêÂä†ËΩΩËÉåÊôØÈü≥‰πê„Äë
ÂÖ≥Âç°1ÔºåÈúÄË¶ÅÂä†ËΩΩ4‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„ÄêÂä†ËΩΩÊñ∞ÊâãÊïôÁ®ã„Äë
‰∏ãÊ¨°ÂÖ≥Âç°ÁßªÈô§Âä†ËΩΩ„ÄêÊñ∞ÊâãÊïôÁ®ã„ÄëÊ®°Âùó
ÂÖ≥Âç°1ÔºåÈúÄË¶ÅÂä†ËΩΩ3‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„ÄêÂä†ËΩΩÂú∞ÂõæÊï∞ÊçÆ„Äë
ÂÖ≥Âç°1ÔºåÈúÄË¶ÅÂä†ËΩΩ3‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„ÄêÂä†ËΩΩ‰∫∫Áâ©Ê®°Âûã„Äë
Á¨¨1Ê¨°ÂÖ≥Âç°ÂáÜÂ§áÂÆåÊàê
ÂÖ≥Âç°2ÔºåÈúÄË¶ÅÂä†ËΩΩ3‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„ÄêÂä†ËΩΩÂú∞ÂõæÊï∞ÊçÆ„Äë
ÂÖ≥Âç°2ÔºåÈúÄË¶ÅÂä†ËΩΩ3‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„ÄêÂä†ËΩΩËÉåÊôØÈü≥‰πê„Äë
ÂÖ≥Âç°2ÔºåÈúÄË¶ÅÂä†ËΩΩ3‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„ÄêÂä†ËΩΩ‰∫∫Áâ©Ê®°Âûã„Äë
Á¨¨2Ê¨°ÂÖ≥Âç°ÂáÜÂ§áÂÆåÊàê
ÂÖ≥Âç°3ÔºåÈúÄË¶ÅÂä†ËΩΩ3‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„ÄêÂä†ËΩΩ‰∫∫Áâ©Ê®°Âûã„Äë
ÂÖ≥Âç°3ÔºåÈúÄË¶ÅÂä†ËΩΩ3‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„ÄêÂä†ËΩΩÂú∞ÂõæÊï∞ÊçÆ„Äë
ÂÖ≥Âç°3ÔºåÈúÄË¶ÅÂä†ËΩΩ3‰∏™Ê®°ÂùóÔºåÂΩìÂâçÊ®°Âùó„ÄêÂä†ËΩΩËÉåÊôØÈü≥‰πê„Äë
Á¨¨3Ê¨°ÂÖ≥Âç°ÂáÜÂ§áÂÆåÊàê</p>
</blockquote>
<p>ËøôÈáåË¶ÅÊ≥®ÊÑèÂÖ≥Âç°1ÁöÑËæìÂá∫ÔºåÂú®‚ÄúÂä†ËΩΩÊñ∞ÊâãÊïôÁ®ã‚ÄùÁ∫øÁ®ã‰∏≠Ë∞ÉÁî®‰∫Ü<code>arriveAndDeregister()</code>ÂáèÂ∞ë‰∏Ä‰∏™party‰πãÂêéÔºåÂêéÈù¢ÁöÑÁ∫øÁ®ã‰ΩøÁî®<code>getRegisteredParties()</code>ÂæóÂà∞ÁöÑÊòØÂ∑≤ÁªèË¢´‰øÆÊîπÂêéÁöÑparties‰∫Ü„ÄÇ‰ΩÜÊòØÂΩìÂâçËøô‰∏™Èò∂ÊÆµ(phase)Ôºå‰ªçÁÑ∂ÊòØÈúÄË¶Å4‰∏™partiesÈÉΩarriveÊâçËß¶ÂèëÂ±èÈöúÁöÑ„ÄÇ‰ªé‰∏ã‰∏Ä‰∏™Èò∂ÊÆµÂºÄÂßãÔºåÊâçÈúÄË¶Å3‰∏™partiesÈÉΩarriveÂ∞±Ëß¶ÂèëÂ±èÈöú„ÄÇ</p>
<p>Âè¶Â§ñPhaserÁ±ªÁî®Êù•ÊéßÂà∂Êüê‰∏™Èò∂ÊÆµÁöÑÁ∫øÁ®ãÊï∞ÈáèÂæàÊúâÁî®Ôºå‰ΩÜÂÆÉÂπ∂Âú®ÊÑèËøô‰∏™Èò∂ÊÆµÂÖ∑‰ΩìÊúâÂì™‰∫õÁ∫øÁ®ãarriveÔºåÂè™Ë¶ÅËææÂà∞ÂÆÉÂΩìÂâçÈò∂ÊÆµÁöÑpartiesÂÄºÔºåÂ∞±Ëß¶ÂèëÂ±èÈöú„ÄÇÊâÄ‰ª•ÊàëËøôÈáåÁöÑÊ°à‰æãËôΩÁÑ∂Âà∂ÂÆö‰∫ÜÁâπÂÆöÁöÑÁ∫øÁ®ãÔºàÂä†ËΩΩÊñ∞ÊâãÊïôÁ®ãÔºâÊù•Êõ¥Áõ¥ËßÇÂú∞Ë°®Ëø∞PhaserÁöÑÂäüËÉΩÔºå‰ΩÜÊòØÂÖ∂ÂÆûPhaserÊòØÊ≤°ÊúâÂàÜËæ®ÂÖ∑‰ΩìÊòØÂì™‰∏™Á∫øÁ®ãÁöÑÂäüËÉΩÁöÑÔºåÂÆÉÂú®ÊÑèÁöÑÂè™ÊòØÊï∞ÈáèÔºåËøô‰∏ÄÁÇπÈúÄË¶ÅËØªËÄÖÊ≥®ÊÑè„ÄÇ</p>
<h4 id="phaserÂéüÁêÜ">PhaserÂéüÁêÜ</h4>
<p>PhaserÁ±ªÁöÑÂéüÁêÜÁõ∏ÊØîËµ∑Êù•Ë¶ÅÂ§çÊùÇÂæóÂ§ö„ÄÇÂÆÉÂÜÖÈÉ®‰ΩøÁî®‰∫Ü‰∏§‰∏™Âü∫‰∫éFork-JoinÊ°ÜÊû∂ÁöÑÂéüÂ≠êÁ±ªËæÖÂä©Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicReference</span><span class="o">&lt;</span><span class="n">QNode</span><span class="o">&gt;</span> <span class="n">evenQ</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicReference</span><span class="o">&lt;</span><span class="n">QNode</span><span class="o">&gt;</span> <span class="n">oddQ</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">QNode</span> <span class="kd">implements</span> <span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">ManagedBlocker</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÆûÁé∞‰ª£Á†Å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊúâÂÖ¥Ë∂£ÁöÑËØªËÄÖÂèØ‰ª•ÂéªÁúãÁúãJDKÊ∫ê‰ª£Á†ÅÔºåËøôÈáå‰∏çÂÅöËøáÂ§öÂèôËø∞„ÄÇ</p>
<p>ÊÄªÁöÑÊù•ËØ¥ÔºåCountDownLatchÔºåCyclicBarrierÔºåPhaserÊòØ‰∏Ä‰∏™ÊØî‰∏Ä‰∏™Âº∫Â§ßÔºå‰ΩÜ‰πü‰∏Ä‰∏™ÊØî‰∏Ä‰∏™Â§çÊùÇ„ÄÇÊ†πÊçÆËá™Â∑±ÁöÑ‰∏öÂä°ÈúÄÊ±ÇÂêàÁêÜÈÄâÊã©Âç≥ÂèØ„ÄÇ</p>
<h2 id="forkjoinÊ°ÜÊû∂">Fork/JoinÊ°ÜÊû∂</h2>
<h3 id="‰ªÄ‰πàÊòØforkjoin">‰ªÄ‰πàÊòØFork/Join</h3>
<p>Fork/JoinÊ°ÜÊû∂ÊòØ‰∏Ä‰∏™ÂÆûÁé∞‰∫ÜExecutorServiceÊé•Âè£ÁöÑÂ§öÁ∫øÁ®ãÂ§ÑÁêÜÂô®ÔºåÂÆÉ‰∏ì‰∏∫ÈÇ£‰∫õÂèØ‰ª•ÈÄöËøáÈÄíÂΩíÂàÜËß£ÊàêÊõ¥ÁªÜÂ∞èÁöÑ‰ªªÂä°ËÄåËÆæËÆ°ÔºåÊúÄÂ§ßÂåñÁöÑÂà©Áî®Â§öÊ†∏Â§ÑÁêÜÂô®Êù•ÊèêÈ´òÂ∫îÁî®Á®ãÂ∫èÁöÑÊÄßËÉΩ„ÄÇ</p>
<p>‰∏éÂÖ∂‰ªñExecutorServiceÁõ∏ÂÖ≥ÁöÑÂÆûÁé∞Áõ∏ÂêåÁöÑÊòØÔºåFork/JoinÊ°ÜÊû∂‰ºöÂ∞Ü‰ªªÂä°ÂàÜÈÖçÁªôÁ∫øÁ®ãÊ±†‰∏≠ÁöÑÁ∫øÁ®ã„ÄÇËÄå‰∏é‰πã‰∏çÂêåÁöÑÊòØÔºåFork/JoinÊ°ÜÊû∂Âú®ÊâßË°å‰ªªÂä°Êó∂‰ΩøÁî®‰∫Ü<strong>Â∑•‰ΩúÁ™ÉÂèñÁÆóÊ≥ï</strong>„ÄÇ</p>
<p><strong>fork</strong>Âú®Ëã±ÊñáÈáåÊúâÂàÜÂèâÁöÑÊÑèÊÄùÔºå<strong>join</strong>Âú®Ëã±ÊñáÈáåËøûÊé•„ÄÅÁªìÂêàÁöÑÊÑèÊÄù„ÄÇÈ°æÂêçÊÄù‰πâÔºåforkÂ∞±ÊòØË¶Å‰Ωø‰∏Ä‰∏™Â§ß‰ªªÂä°ÂàÜËß£ÊàêËã•Âπ≤‰∏™Â∞è‰ªªÂä°ÔºåËÄåjoinÂ∞±ÊòØÊúÄÂêéÂ∞ÜÂêÑ‰∏™Â∞è‰ªªÂä°ÁöÑÁªìÊûúÁªìÂêàËµ∑Êù•ÂæóÂà∞Â§ß‰ªªÂä°ÁöÑÁªìÊûú„ÄÇ</p>
<p>Fork/JoinÁöÑËøêË°åÊµÅÁ®ãÂ§ßËá¥Â¶Ç‰∏ãÊâÄÁ§∫Ôºö</p>
<p><img src="https://s2.loli.net/2021/12/26/c2N6MWCKJ7n8AZG.png"
	
	
	
	loading="lazy"
	
		alt="fork_joinÊµÅÁ®ãÂõæ"
	
	
></p>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºåÂõæÈáåÁöÑÊ¨°Á∫ßÂ≠ê‰ªªÂä°ÂèØ‰ª•‰∏ÄÁõ¥ÂàÜ‰∏ãÂéªÔºå‰∏ÄÁõ¥ÂàÜÂà∞Â≠ê‰ªªÂä°Ë∂≥Â§üÂ∞è‰∏∫Ê≠¢„ÄÇÁî®‰º™‰ª£Á†ÅÊù•Ë°®Á§∫Â¶Ç‰∏ãÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">solve(‰ªªÂä°):
</span></span><span class="line"><span class="cl">    if(‰ªªÂä°Â∑≤ÁªèÂàíÂàÜÂà∞Ë∂≥Â§üÂ∞è):
</span></span><span class="line"><span class="cl">        È°∫Â∫èÊâßË°å‰ªªÂä°
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        for(ÂàíÂàÜ‰ªªÂä°ÂæóÂà∞Â≠ê‰ªªÂä°)
</span></span><span class="line"><span class="cl">            solve(Â≠ê‰ªªÂä°)
</span></span><span class="line"><span class="cl">        ÁªìÂêàÊâÄÊúâÂ≠ê‰ªªÂä°ÁöÑÁªìÊûúÂà∞‰∏ä‰∏ÄÂ±ÇÂæ™ÁéØ
</span></span><span class="line"><span class="cl">        return ÊúÄÁªàÁªìÂêàÁöÑÁªìÊûú
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÄöËøá‰∏äÈù¢‰º™‰ª£Á†ÅÂèØ‰ª•ÁúãÂá∫ÔºåÊàë‰ª¨ÈÄöËøáÈÄíÂΩíÂµåÂ•óÁöÑËÆ°ÁÆóÂæóÂà∞ÊúÄÁªàÁªìÊûúÔºåËøôÈáåÊúâ‰ΩìÁé∞<strong>ÂàÜËÄåÊ≤ª‰πã(divide and conquer)</strong> ÁöÑÁÆóÊ≥ïÊÄùÊÉ≥„ÄÇ</p>
<h3 id="Â∑•‰ΩúÁ™ÉÂèñÁÆóÊ≥ï">Â∑•‰ΩúÁ™ÉÂèñÁÆóÊ≥ï</h3>
<p>Â∑•‰ΩúÁ™ÉÂèñÁÆóÊ≥ïÊåáÁöÑÊòØÂú®Â§öÁ∫øÁ®ãÊâßË°å‰∏çÂêå‰ªªÂä°ÈòüÂàóÁöÑËøáÁ®ã‰∏≠ÔºåÊüê‰∏™Á∫øÁ®ãÊâßË°åÂÆåËá™Â∑±ÈòüÂàóÁöÑ‰ªªÂä°Âêé‰ªéÂÖ∂‰ªñÁ∫øÁ®ãÁöÑ‰ªªÂä°ÈòüÂàóÈáåÁ™ÉÂèñ‰ªªÂä°Êù•ÊâßË°å„ÄÇ</p>
<p>Â∑•‰ΩúÁ™ÉÂèñÊµÅÁ®ãÂ¶Ç‰∏ãÂõæÊâÄÁ§∫Ôºö</p>
<p><img src="https://s2.loli.net/2021/12/26/mijuNPdBXpZaGLS.png"
	
	
	
	loading="lazy"
	
		alt="Â∑•‰ΩúÁ™ÉÂèñÁÆóÊ≥ïËøêË°åÊµÅÁ®ãÂõæ"
	
	
></p>
<p>ÂÄºÂæóÊ≥®ÊÑèÁöÑÊòØÔºåÂΩì‰∏Ä‰∏™Á∫øÁ®ãÁ™ÉÂèñÂè¶‰∏Ä‰∏™Á∫øÁ®ãÁöÑÊó∂ÂÄôÔºå‰∏∫‰∫ÜÂáèÂ∞ë‰∏§‰∏™‰ªªÂä°Á∫øÁ®ã‰πãÈó¥ÁöÑÁ´û‰∫âÔºåÊàë‰ª¨ÈÄöÂ∏∏‰ΩøÁî®<strong>ÂèåÁ´ØÈòüÂàó</strong>Êù•Â≠òÂÇ®‰ªªÂä°„ÄÇË¢´Á™ÉÂèñÁöÑ‰ªªÂä°Á∫øÁ®ãÈÉΩ‰ªéÂèåÁ´ØÈòüÂàóÁöÑ<strong>Â§¥ÈÉ®</strong>Êãø‰ªªÂä°ÊâßË°åÔºåËÄåÁ™ÉÂèñÂÖ∂‰ªñ‰ªªÂä°ÁöÑÁ∫øÁ®ã‰ªéÂèåÁ´ØÈòüÂàóÁöÑ<strong>Â∞æÈÉ®</strong>ÊâßË°å‰ªªÂä°„ÄÇ</p>
<p>Âè¶Â§ñÔºåÂΩì‰∏Ä‰∏™Á∫øÁ®ãÂú®Á™ÉÂèñ‰ªªÂä°Êó∂Ë¶ÅÊòØÊ≤°ÊúâÂÖ∂‰ªñÂèØÁî®ÁöÑ‰ªªÂä°‰∫ÜÔºåËøô‰∏™Á∫øÁ®ã‰ºöËøõÂÖ•<strong>ÈòªÂ°ûÁä∂ÊÄÅ</strong>‰ª•Á≠âÂæÖÂÜçÊ¨°‚ÄúÂ∑•‰Ωú‚Äù„ÄÇ</p>
<h3 id="forkjoinÁöÑÂÖ∑‰ΩìÂÆûÁé∞">Fork/JoinÁöÑÂÖ∑‰ΩìÂÆûÁé∞</h3>
<p>ÂâçÈù¢Êàë‰ª¨ËØ¥Fork/JoinÊ°ÜÊû∂ÁÆÄÂçïÊù•ËÆ≤Â∞±ÊòØÂØπ‰ªªÂä°ÁöÑÂàÜÂâ≤‰∏éÂ≠ê‰ªªÂä°ÁöÑÂêàÂπ∂ÔºåÊâÄ‰ª•Ë¶ÅÂÆûÁé∞Ëøô‰∏™Ê°ÜÊû∂ÔºåÂÖàÂæóÊúâ<strong>‰ªªÂä°</strong>„ÄÇÂú®Fork/JoinÊ°ÜÊû∂ÈáåÊèê‰æõ‰∫ÜÊäΩË±°Á±ª<code>ForkJoinTask</code>Êù•ÂÆûÁé∞‰ªªÂä°„ÄÇ</p>
<h4 id="forkjointask">ForkJoinTask</h4>
<p>ForkJoinTaskÊòØ‰∏Ä‰∏™Á±ª‰ººÊôÆÈÄöÁ∫øÁ®ãÁöÑÂÆû‰ΩìÔºå‰ΩÜÊòØÊØîÊôÆÈÄöÁ∫øÁ®ãËΩªÈáèÂæóÂ§ö„ÄÇ</p>
<p><strong>fork()ÊñπÊ≥ï</strong>:‰ΩøÁî®Á∫øÁ®ãÊ±†‰∏≠ÁöÑÁ©∫Èó≤Á∫øÁ®ãÂºÇÊ≠•Êèê‰∫§‰ªªÂä°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Êú¨ÊñáÊâÄÊúâ‰ª£Á†ÅÈÉΩÂºïËá™Java 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">final</span> <span class="n">ForkJoinTask</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">fork</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Thread</span> <span class="n">t</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ForkJoinWorkerThreadÊòØÊâßË°åForkJoinTaskÁöÑ‰∏ìÊúâÁ∫øÁ®ãÔºåÁî±ForkJoinPoolÁÆ°ÁêÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ÂÖàÂà§Êñ≠ÂΩìÂâçÁ∫øÁ®ãÊòØÂê¶ÊòØForkJoin‰∏ìÊúâÁ∫øÁ®ãÔºåÂ¶ÇÊûúÊòØÔºåÂàôÂ∞Ü‰ªªÂä°pushÂà∞ÂΩìÂâçÁ∫øÁ®ãÊâÄË¥üË¥£ÁöÑÈòüÂàóÈáåÂéª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">((</span><span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">())</span> <span class="k">instanceof</span> <span class="n">ForkJoinWorkerThread</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">((</span><span class="n">ForkJoinWorkerThread</span><span class="o">)</span><span class="n">t</span><span class="o">).</span><span class="na">workQueue</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">         <span class="c1">// Â¶ÇÊûú‰∏çÊòØÂàôÂ∞ÜÁ∫øÁ®ãÂä†ÂÖ•ÈòüÂàó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// Ê≤°ÊúâÊòæÂºèÂàõÂª∫ForkJoinPoolÁöÑÊó∂ÂÄôËµ∞ËøôÈáåÔºåÊèê‰∫§‰ªªÂä°Âà∞ÈªòËÆ§ÁöÑcommonÁ∫øÁ®ãÊ±†‰∏≠
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">externalPush</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂÖ∂ÂÆûfork()Âè™ÂÅö‰∫Ü‰∏Ä‰ª∂‰∫ãÔºåÈÇ£Â∞±ÊòØ<strong>Êää‰ªªÂä°Êé®ÂÖ•ÂΩìÂâçÂ∑•‰ΩúÁ∫øÁ®ãÁöÑÂ∑•‰ΩúÈòüÂàóÈáå</strong>„ÄÇ</p>
<p><strong>join()ÊñπÊ≥ï</strong>ÔºöÁ≠âÂæÖÂ§ÑÁêÜ‰ªªÂä°ÁöÑÁ∫øÁ®ãÂ§ÑÁêÜÂÆåÊØïÔºåËé∑ÂæóËøîÂõûÂÄº„ÄÇ</p>
<p>Êù•Áúã‰∏ãjoin()ÁöÑÊ∫êÁ†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">final</span> <span class="n">V</span> <span class="nf">join</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">s</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// doJoin()ÊñπÊ≥ïÊù•Ëé∑ÂèñÂΩìÂâç‰ªªÂä°ÁöÑÊâßË°åÁä∂ÊÄÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">((</span><span class="n">s</span> <span class="o">=</span> <span class="n">doJoin</span><span class="o">()</span> <span class="o">&amp;</span> <span class="n">DONE_MASK</span><span class="o">)</span> <span class="o">!=</span> <span class="n">NORMAL</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ‰ªªÂä°ÂºÇÂ∏∏ÔºåÊäõÂá∫ÂºÇÂ∏∏
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">reportException</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ‰ªªÂä°Ê≠£Â∏∏ÂÆåÊàêÔºåËé∑ÂèñËøîÂõûÂÄº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">getRawResult</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * doJoin()ÊñπÊ≥ïÁî®Êù•ËøîÂõûÂΩìÂâç‰ªªÂä°ÁöÑÊâßË°åÁä∂ÊÄÅ
</span></span></span><span class="line"><span class="cl"><span class="cm"> **/</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">int</span> <span class="nf">doJoin</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">s</span><span class="o">;</span> <span class="n">Thread</span> <span class="n">t</span><span class="o">;</span> <span class="n">ForkJoinWorkerThread</span> <span class="n">wt</span><span class="o">;</span> <span class="n">ForkJoinPool</span><span class="o">.</span><span class="na">WorkQueue</span> <span class="n">w</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÖàÂà§Êñ≠‰ªªÂä°ÊòØÂê¶ÊâßË°åÂÆåÊØïÔºåÊâßË°åÂÆåÊØïÁõ¥Êé•ËøîÂõûÁªìÊûúÔºàÊâßË°åÁä∂ÊÄÅÔºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="o">(</span><span class="n">s</span> <span class="o">=</span> <span class="n">status</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">s</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûúÊ≤°ÊúâÊâßË°åÂÆåÊØïÔºåÂÖàÂà§Êñ≠ÊòØÂê¶ÊòØForkJoinWorkThreadÁ∫øÁ®ã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">((</span><span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">())</span> <span class="k">instanceof</span> <span class="n">ForkJoinWorkerThread</span><span class="o">)</span> <span class="o">?</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Â¶ÇÊûúÊòØÔºåÂÖàÂà§Êñ≠‰ªªÂä°ÊòØÂê¶Â§Ñ‰∫éÂ∑•‰ΩúÈòüÂàóÈ°∂Á´ØÔºàÊÑèÂë≥ÁùÄ‰∏ã‰∏Ä‰∏™Â∞±ÊâßË°åÂÆÉÔºâ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// tryUnpush()ÊñπÊ≥ïÂà§Êñ≠‰ªªÂä°ÊòØÂê¶Â§Ñ‰∫éÂΩìÂâçÂ∑•‰ΩúÈòüÂàóÈ°∂Á´ØÔºåÊòØËøîÂõûtrue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// doExec()ÊñπÊ≥ïÊâßË°å‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">(</span><span class="n">w</span> <span class="o">=</span> <span class="o">(</span><span class="n">wt</span> <span class="o">=</span> <span class="o">(</span><span class="n">ForkJoinWorkerThread</span><span class="o">)</span><span class="n">t</span><span class="o">).</span><span class="na">workQueue</span><span class="o">).</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Â¶ÇÊûúÊòØÂ§Ñ‰∫éÈ°∂Á´ØÂπ∂‰∏î‰ªªÂä°ÊâßË°åÂÆåÊØïÔºåËøîÂõûÁªìÊûú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">tryUnpush</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">s</span> <span class="o">=</span> <span class="n">doExec</span><span class="o">())</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">s</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Â¶ÇÊûú‰∏çÂú®È°∂Á´ØÊàñËÄÖÂú®È°∂Á´ØÂç¥Ê≤°Êú™ÊâßË°åÂÆåÊØïÔºåÈÇ£Â∞±Ë∞ÉÁî®awitJoin()ÊâßË°å‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// awaitJoin()Ôºö‰ΩøÁî®Ëá™Êóã‰Ωø‰ªªÂä°ÊâßË°åÂÆåÊàêÔºåËøîÂõûÁªìÊûú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">wt</span><span class="o">.</span><span class="na">pool</span><span class="o">.</span><span class="na">awaitJoin</span><span class="o">(</span><span class="n">w</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="n">0L</span><span class="o">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûú‰∏çÊòØForkJoinWorkThreadÁ∫øÁ®ãÔºåÊâßË°åexternalAwaitDone()ËøîÂõû‰ªªÂä°ÁªìÊûú
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">externalAwaitDone</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨Âú®‰πãÂâç‰ªãÁªçËøáËØ¥Thread.join()‰ºö‰ΩøÁ∫øÁ®ãÈòªÂ°ûÔºåËÄåForkJoinPool.join()‰ºö‰ΩøÁ∫øÁ®ãÂÖç‰∫éÈòªÂ°ûÔºå‰∏ãÈù¢ÊòØForkJoinPool.join()ÁöÑÊµÅÁ®ãÂõæÔºö</p>
<p><img src="https://s2.loli.net/2021/12/26/S2M56Won7ZzusNb.png"
	
	
	
	loading="lazy"
	
		alt="joinÊµÅÁ®ãÂõæ"
	
	
></p>
<p><strong>RecursiveActionÂíåRecursiveTask</strong></p>
<p>ÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÔºåÂú®ÂàõÂª∫‰ªªÂä°ÁöÑÊó∂ÂÄôÊàë‰ª¨‰∏ÄËà¨‰∏çÁõ¥Êé•ÁªßÊâøForkJoinTaskÔºåËÄåÊòØÁªßÊâøÂÆÉÁöÑÂ≠êÁ±ª<strong>RecursiveAction</strong>Âíå<strong>RecursiveTask</strong>„ÄÇ</p>
<p>‰∏§‰∏™ÈÉΩÊòØForkJoinTaskÁöÑÂ≠êÁ±ªÔºå<strong>RecursiveActionÂèØ‰ª•ÁúãÂÅöÊòØÊó†ËøîÂõûÂÄºÁöÑForkJoinTaskÔºåRecursiveTaskÊòØÊúâËøîÂõûÂÄºÁöÑForkJoinTask</strong>„ÄÇ</p>
<p>Ê≠§Â§ñÔºå‰∏§‰∏™Â≠êÁ±ªÈÉΩÊúâÊâßË°å‰∏ªË¶ÅËÆ°ÁÆóÁöÑÊñπÊ≥ïcompute()ÔºåÂΩìÁÑ∂ÔºåRecursiveActionÁöÑcompute()ËøîÂõûvoidÔºåRecursiveTaskÁöÑcompute()ÊúâÂÖ∑‰ΩìÁöÑËøîÂõûÂÄº„ÄÇ</p>
<h4 id="forkjoinpool">ForkJoinPool</h4>
<p>ForkJoinPoolÊòØÁî®‰∫éÊâßË°åForkJoinTask‰ªªÂä°ÁöÑÊâßË°åÔºàÁ∫øÁ®ãÔºâÊ±†„ÄÇ</p>
<p>ForkJoinPoolÁÆ°ÁêÜÁùÄÊâßË°åÊ±†‰∏≠ÁöÑÁ∫øÁ®ãÂíå‰ªªÂä°ÈòüÂàóÔºåÊ≠§Â§ñÔºåÊâßË°åÊ±†ÊòØÂê¶ËøòÊé•Âèó‰ªªÂä°ÔºåÊòæÁ§∫Á∫øÁ®ãÁöÑËøêË°åÁä∂ÊÄÅ‰πüÊòØÂú®ËøôÈáåÂ§ÑÁêÜ„ÄÇ</p>
<p>Êàë‰ª¨Êù•Â§ßËá¥Áúã‰∏ãForkJoinPoolÁöÑÊ∫êÁ†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@sun.misc.Contended</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForkJoinPool</span> <span class="kd">extends</span> <span class="n">AbstractExecutorService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ‰ªªÂä°ÈòüÂàó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">volatile</span> <span class="n">WorkQueue</span><span class="o">[]</span> <span class="n">workQueues</span><span class="o">;</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Á∫øÁ®ãÁöÑËøêË°åÁä∂ÊÄÅ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">volatile</span> <span class="kt">int</span> <span class="n">runState</span><span class="o">;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂàõÂª∫ForkJoinWorkerThreadÁöÑÈªòËÆ§Â∑•ÂéÇÔºåÂèØ‰ª•ÈÄöËøáÊûÑÈÄ†ÂáΩÊï∞ÈáçÂÜô
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ForkJoinWorkerThreadFactory</span> <span class="n">defaultForkJoinWorkerThreadFactory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÖ¨Áî®ÁöÑÁ∫øÁ®ãÊ±†ÔºåÂÖ∂ËøêË°åÁä∂ÊÄÅ‰∏çÂèóshutdown()ÂíåshutdownNow()ÁöÑÂΩ±Âìç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">static</span> <span class="kd">final</span> <span class="n">ForkJoinPool</span> <span class="n">common</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ÁßÅÊúâÊûÑÈÄ†ÊñπÊ≥ïÔºåÊ≤°Êúâ‰ªª‰ΩïÂÆâÂÖ®Ê£ÄÊü•ÂíåÂèÇÊï∞Ê†°È™åÔºåÁî±makeCommonPoolÁõ¥Êé•Ë∞ÉÁî®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ÂÖ∂‰ªñÊûÑÈÄ†ÊñπÊ≥ïÈÉΩÊòØÊ∫êËá™‰∫éÊ≠§ÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// parallelism: Âπ∂Ë°åÂ∫¶Ôºå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ÈªòËÆ§Ë∞ÉÁî®java.lang.Runtime.availableProcessors() ÊñπÊ≥ïËøîÂõûÂèØÁî®Â§ÑÁêÜÂô®ÁöÑÊï∞Èáè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="nf">ForkJoinPool</span><span class="o">(</span><span class="kt">int</span> <span class="n">parallelism</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">ForkJoinWorkerThreadFactory</span> <span class="n">factory</span><span class="o">,</span> <span class="c1">// Â∑•‰ΩúÁ∫øÁ®ãÂ∑•ÂéÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                         <span class="n">UncaughtExceptionHandler</span> <span class="n">handler</span><span class="o">,</span> <span class="c1">// ÊãíÁªù‰ªªÂä°ÁöÑhandler
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                         <span class="kt">int</span> <span class="n">mode</span><span class="o">,</span> <span class="c1">// ÂêåÊ≠•Ê®°Âºè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                         <span class="n">String</span> <span class="n">workerNamePrefix</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// Á∫øÁ®ãÂêçprefix
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="o">.</span><span class="na">workerNamePrefix</span> <span class="o">=</span> <span class="n">workerNamePrefix</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">factory</span> <span class="o">=</span> <span class="n">factory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">ueh</span> <span class="o">=</span> <span class="n">handler</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">config</span> <span class="o">=</span> <span class="o">(</span><span class="n">parallelism</span> <span class="o">&amp;</span> <span class="n">SMASK</span><span class="o">)</span> <span class="o">|</span> <span class="n">mode</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">np</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)(-</span><span class="n">parallelism</span><span class="o">);</span> <span class="c1">// offset ctl counts
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">this</span><span class="o">.</span><span class="na">ctl</span> <span class="o">=</span> <span class="o">((</span><span class="n">np</span> <span class="o">&lt;&lt;</span> <span class="n">AC_SHIFT</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">AC_MASK</span><span class="o">)</span> <span class="o">|</span> <span class="o">((</span><span class="n">np</span> <span class="o">&lt;&lt;</span> <span class="n">TC_SHIFT</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">TC_MASK</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="workqueue">WorkQueue</h5>
<p>ÂèåÁ´ØÈòüÂàóÔºåForkJoinTaskÂ≠òÊîæÂú®ËøôÈáå„ÄÇ</p>
<p>ÂΩìÂ∑•‰ΩúÁ∫øÁ®ãÂú®Â§ÑÁêÜËá™Â∑±ÁöÑÂ∑•‰ΩúÈòüÂàóÊó∂Ôºå‰ºö‰ªéÈòüÂàóÈ¶ñÂèñ‰ªªÂä°Êù•ÊâßË°åÔºàFIFOÔºâÔºõÂ¶ÇÊûúÊòØÁ™ÉÂèñÂÖ∂‰ªñÈòüÂàóÁöÑ‰ªªÂä°Êó∂ÔºåÁ™ÉÂèñÁöÑ‰ªªÂä°‰Ωç‰∫éÊâÄÂ±û‰ªªÂä°ÈòüÂàóÁöÑÈòüÂ∞æÔºàLIFOÔºâ„ÄÇ</p>
<p>ForkJoinPool‰∏é‰º†ÁªüÁ∫øÁ®ãÊ±†ÊúÄÊòæËëóÁöÑÂå∫Âà´Â∞±ÊòØÂÆÉÁª¥Êä§‰∫Ü‰∏Ä‰∏™<strong>Â∑•‰ΩúÈòüÂàóÊï∞ÁªÑ</strong>Ôºàvolatile WorkQueue[] workQueuesÔºåForkJoinPool‰∏≠ÁöÑ<strong>ÊØè‰∏™Â∑•‰ΩúÁ∫øÁ®ãÈÉΩÁª¥Êä§ÁùÄ‰∏Ä‰∏™Â∑•‰ΩúÈòüÂàó</strong>Ôºâ„ÄÇ</p>
<h5 id="runstate">runState</h5>
<p>ForkJoinPoolÁöÑËøêË°åÁä∂ÊÄÅ„ÄÇ<strong>SHUTDOWN</strong>Áä∂ÊÄÅÁî®Ë¥üÊï∞Ë°®Á§∫ÔºåÂÖ∂‰ªñÁî®2ÁöÑÂπÇÊ¨°Ë°®Á§∫„ÄÇ</p>
<h4 id="forkjoinÁöÑ‰ΩøÁî®">Fork/JoinÁöÑ‰ΩøÁî®</h4>
<p>‰∏äÈù¢Êàë‰ª¨ËØ¥ForkJoinPoolË¥üË¥£ÁÆ°ÁêÜÁ∫øÁ®ãÂíå‰ªªÂä°ÔºåForkJoinTaskÂÆûÁé∞forkÂíåjoinÊìç‰ΩúÔºåÊâÄ‰ª•Ë¶Å‰ΩøÁî®Fork/JoinÊ°ÜÊû∂Â∞±Á¶ª‰∏çÂºÄËøô‰∏§‰∏™Á±ª‰∫ÜÔºåÂè™ÊòØÂú®ÂÆûÈôÖÂºÄÂèë‰∏≠Êàë‰ª¨Â∏∏Áî®ForkJoinTaskÁöÑÂ≠êÁ±ªRecursiveTask ÂíåRecursiveActionÊù•Êõø‰ª£ForkJoinTask„ÄÇ</p>
<p>‰∏ãÈù¢Êàë‰ª¨Áî®‰∏Ä‰∏™ËÆ°ÁÆóÊñêÊ≥¢ÈÇ£Â•ëÊï∞ÂàóÁ¨¨nÈ°πÁöÑ‰æãÂ≠êÊù•Áúã‰∏Ä‰∏ãFork/JoinÁöÑ‰ΩøÁî®Ôºö</p>
<blockquote>
<p>ÊñêÊ≥¢ÈÇ£Â•ëÊï∞ÂàóÊï∞ÂàóÊòØ‰∏Ä‰∏™Á∫øÊÄßÈÄíÊé®Êï∞ÂàóÔºå‰ªéÁ¨¨‰∏âÈ°πÂºÄÂßãÔºåÊØè‰∏ÄÈ°πÁöÑÂÄºÈÉΩÁ≠â‰∫éÂâç‰∏§È°π‰πãÂíåÔºö</p>
<p>1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89¬∑¬∑¬∑¬∑¬∑¬∑</p>
<p>Â¶ÇÊûúËÆæf(nÔºâ‰∏∫ËØ•Êï∞ÂàóÁöÑÁ¨¨nÈ°πÔºàn‚ààN*ÔºâÔºåÈÇ£‰πàÊúâÔºöf(n) = f(n-1) + f(n-2)„ÄÇ</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FibonacciTest</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">class</span> <span class="nc">Fibonacci</span> <span class="kd">extends</span> <span class="n">RecursiveTask</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="nf">Fibonacci</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ‰∏ªË¶ÅÁöÑÂÆûÁé∞ÈÄªËæëÈÉΩÂú®compute()Èáå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">protected</span> <span class="n">Integer</span> <span class="nf">compute</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// ËøôÈáåÂÖàÂÅáËÆæ n &gt;= 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">n</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// f(n-1)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Fibonacci</span> <span class="n">f1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Fibonacci</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">f1</span><span class="o">.</span><span class="na">fork</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// f(n-2)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Fibonacci</span> <span class="n">f2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Fibonacci</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">2</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">f2</span><span class="o">.</span><span class="na">fork</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// f(n) = f(n-1) + f(n-2)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">return</span> <span class="n">f1</span><span class="o">.</span><span class="na">join</span><span class="o">()</span> <span class="o">+</span> <span class="n">f2</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFib</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ExecutionException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ForkJoinPool</span> <span class="n">forkJoinPool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ForkJoinPool</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;CPUÊ†∏Êï∞Ôºö&#34;</span> <span class="o">+</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">availableProcessors</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Fibonacci</span> <span class="n">fibonacci</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Fibonacci</span><span class="o">(</span><span class="n">40</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">Future</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">forkJoinPool</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">fibonacci</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;ËÄóÊó∂Ôºö%d millis&#34;</span><span class="o">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äÈù¢‰æãÂ≠êÂú®Êú¨Êú∫ÁöÑËæìÂá∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">CPUÊ†∏Êï∞Ôºö4
</span></span><span class="line"><span class="cl">ËÆ°ÁÆóÁªìÊûúÔºö102334155
</span></span><span class="line"><span class="cl">ËÄóÊó∂Ôºö9490 millis
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºå‰∏äËø∞ËÆ°ÁÆóÊó∂Èó¥Â§çÊùÇÂ∫¶‰∏∫<code>O(2^n)</code>ÔºåÈöèÁùÄnÁöÑÂ¢ûÈïøËÆ°ÁÆóÊïàÁéá‰ºöË∂äÊù•Ë∂ä‰ΩéÔºåËøô‰πüÊòØ‰∏äÈù¢ÁöÑ‰æãÂ≠ê‰∏≠n‰∏çÊï¢ÂèñÂ§™Â§ßÁöÑÂéüÂõ†„ÄÇ</p>
<p>Ê≠§Â§ñÔºå‰πüÂπ∂‰∏çÊòØÊâÄÊúâÁöÑ‰ªªÂä°ÈÉΩÈÄÇÂêàFork/JoinÊ°ÜÊû∂ÔºåÊØîÂ¶Ç‰∏äÈù¢ÁöÑ‰æãÂ≠ê‰ªªÂä°ÂàíÂàÜËøá‰∫éÁªÜÂ∞èÂèçËÄå‰ΩìÁé∞‰∏çÂá∫ÊïàÁéáÔºå‰∏ãÈù¢Êàë‰ª¨ËØïËØïÁî®ÊôÆÈÄöÁöÑÈÄíÂΩíÊù•Ê±Çf(n)ÁöÑÂÄºÔºåÁúãÁúãÊòØ‰∏çÊòØË¶ÅÊØî‰ΩøÁî®Fork/JoinÂø´Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÊôÆÈÄöÈÄíÂΩíÔºåÂ§çÊùÇÂ∫¶‰∏∫O(2^n)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">plainRecursion</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">1</span> <span class="o">||</span> <span class="n">n</span> <span class="o">==</span> <span class="n">2</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">plainRecursion</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span><span class="n">1</span><span class="o">)</span> <span class="o">+</span> <span class="n">plainRecursion</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">2</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPlain</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">plainRecursion</span><span class="o">(</span><span class="n">40</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;ËÆ°ÁÆóÁªìÊûú:&#34;</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;ËÄóÊó∂Ôºö%d millis&#34;</span><span class="o">,</span>  <span class="n">end</span> <span class="o">-</span><span class="n">start</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊôÆÈÄöÈÄíÂΩíÁöÑ‰æãÂ≠êËæìÂá∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ËÆ°ÁÆóÁªìÊûú:102334155
</span></span><span class="line"><span class="cl">ËÄóÊó∂Ôºö436 millis
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÄöËøáËæìÂá∫ÂèØ‰ª•ÂæàÊòéÊòæÁöÑÁúãÂá∫Êù•Ôºå‰ΩøÁî®ÊôÆÈÄöÈÄíÂΩíÁöÑÊïàÁéáÈÉΩË¶ÅÊØî‰ΩøÁî®Fork/JoinÊ°ÜÊû∂Ë¶ÅÈ´òÂæàÂ§ö„ÄÇ</p>
<p>ËøôÈáåÊàë‰ª¨ÂÜçÁî®Âè¶‰∏ÄÁßçÊÄùË∑ØÊù•ËÆ°ÁÆóÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÈÄöËøáÂæ™ÁéØÊù•ËÆ°ÁÆóÔºåÂ§çÊùÇÂ∫¶‰∏∫O(n)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kt">int</span> <span class="nf">computeFibonacci</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÅáËÆæn &gt;= 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">n</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">first</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">second</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">third</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">3</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span> <span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Á¨¨‰∏â‰∏™Êï∞ÊòØÂâç‰∏§‰∏™Êï∞‰πãÂíå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">third</span> <span class="o">=</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Ââç‰∏§‰∏™Êï∞Âè≥Áßª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">first</span> <span class="o">=</span> <span class="n">second</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">second</span> <span class="o">=</span> <span class="n">third</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">third</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Test</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testComputeFibonacci</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">computeFibonacci</span><span class="o">(</span><span class="n">40</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;ËÆ°ÁÆóÁªìÊûú:&#34;</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;ËÄóÊó∂Ôºö%d millis&#34;</span><span class="o">,</span>  <span class="n">end</span> <span class="o">-</span><span class="n">start</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏äÈù¢‰æãÂ≠êÂú®Á¨îËÄÖÊâÄÁî®ÁîµËÑëÁöÑËæìÂá∫‰∏∫Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ËÆ°ÁÆóÁªìÊûú:102334155
</span></span><span class="line"><span class="cl">ËÄóÊó∂Ôºö0 millis
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÈáåËÄóÊó∂‰∏∫0‰∏ç‰ª£Ë°®Ê≤°ÊúâËÄóÊó∂ÔºåÊòØË°®ÊòéËøôÈáåËÆ°ÁÆóÁöÑËÄóÊó∂Âá†‰πéÂèØ‰ª•ÂøΩÁï•‰∏çËÆ°ÔºåÂ§ßÂÆ∂ÂèØ‰ª•Âú®Ëá™Â∑±ÁöÑÁîµËÑëËØïËØïÔºåÂç≥‰ΩøÊòØnÂèñÂ§ßÂæàÂ§öÈáèÁ∫ßÁöÑÊï∞ÊçÆÔºàÊ≥®ÊÑèintÊ∫¢Âá∫ÁöÑÈóÆÈ¢òÔºâËÄóÊó∂‰πüÊòØÂæàÁü≠ÁöÑÔºåÊàñËÄÖÂèØ‰ª•Áî®System.nanoTime()ÁªüËÆ°Á∫≥ÁßíÁöÑÊó∂Èó¥„ÄÇ</p>
<p>‰∏∫‰ªÄ‰πàÂú®ËøôÈáåÊôÆÈÄöÁöÑÈÄíÂΩíÊàñÂæ™ÁéØÊïàÁéáÊõ¥Âø´Âë¢ÔºüÂõ†‰∏∫Fork/JoinÊòØ‰ΩøÁî®Â§ö‰∏™Á∫øÁ®ãÂçè‰ΩúÊù•ËÆ°ÁÆóÁöÑÔºåÊâÄ‰ª•‰ºöÊúâÁ∫øÁ®ãÈÄö‰ø°ÂíåÁ∫øÁ®ãÂàáÊç¢ÁöÑÂºÄÈîÄ„ÄÇ</p>
<p>Â¶ÇÊûúË¶ÅËÆ°ÁÆóÁöÑ‰ªªÂä°ÊØîËæÉÁÆÄÂçïÔºàÊØîÂ¶ÇÊàë‰ª¨Ê°à‰æã‰∏≠ÁöÑÊñêÊ≥¢ÈÇ£Â•ëÊï∞ÂàóÔºâÔºåÈÇ£ÂΩìÁÑ∂ÊòØÁõ¥Êé•‰ΩøÁî®ÂçïÁ∫øÁ®ã‰ºöÊõ¥Âø´‰∏Ä‰∫õ„ÄÇ‰ΩÜÂ¶ÇÊûúË¶ÅËÆ°ÁÆóÁöÑ‰∏úË•øÊØîËæÉÂ§çÊùÇÔºåËÆ°ÁÆóÊú∫ÂèàÊòØÂ§öÊ†∏ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂ∞±ÂèØ‰ª•ÂÖÖÂàÜÂà©Áî®Â§öÊ†∏CPUÊù•ÊèêÈ´òËÆ°ÁÆóÈÄüÂ∫¶„ÄÇ</p>
<p>Âè¶Â§ñÔºåJava 8 StreamÁöÑÂπ∂Ë°åÊìç‰ΩúÂ∫ïÂ±ÇÂ∞±ÊòØÁî®Âà∞‰∫ÜFork/JoinÊ°ÜÊû∂Ôºå‰∏ã‰∏ÄÁ´†Êàë‰ª¨Â∞Ü‰ªéÊ∫êÁ†ÅÂèäÊ°à‰æã‰∏§ÊñπÈù¢‰ªãÁªçJava 8 StreamÁöÑÂπ∂Ë°åÊìç‰Ωú„ÄÇ</p>
<h2 id="java-8-streamÂπ∂Ë°åËÆ°ÁÆóÂéüÁêÜ">Java 8 StreamÂπ∂Ë°åËÆ°ÁÆóÂéüÁêÜ</h2>
<h3 id="java-8-streamÁÆÄ‰ªã">Java 8 StreamÁÆÄ‰ªã</h3>
<p>‰ªéJava 8 ÂºÄÂßãÔºåÊàë‰ª¨ÂèØ‰ª•‰ΩøÁî®<code>Stream</code>Êé•Âè£‰ª•Âèä<strong>lambdaË°®ËææÂºè</strong>ËøõË°å‚ÄúÊµÅÂºèËÆ°ÁÆó‚Äù„ÄÇÂÆÉÂèØ‰ª•ËÆ©Êàë‰ª¨ÂØπÈõÜÂêàÁöÑÊìç‰ΩúÊõ¥Âä†ÁÆÄÊ¥Å„ÄÅÊõ¥Âä†ÂèØËØª„ÄÅÊõ¥Âä†È´òÊïà„ÄÇ</p>
<p>StreamÊé•Âè£ÊúâÈùûÂ∏∏Â§öÁî®‰∫éÈõÜÂêàËÆ°ÁÆóÁöÑÊñπÊ≥ïÔºåÊØîÂ¶ÇÂà§Á©∫Êìç‰Ωúempty„ÄÅËøáÊª§Êìç‰Ωúfilter„ÄÅÊ±ÇÊúÄmaxÂÄº„ÄÅÊü•ÊâæÊìç‰ΩúfindFirstÂíåfindAnyÁ≠âÁ≠â„ÄÇ</p>
<h3 id="streamÂçïÁ∫øÁ®ã‰∏≤Ë°åËÆ°ÁÆó">StreamÂçïÁ∫øÁ®ã‰∏≤Ë°åËÆ°ÁÆó</h3>
<p>StreamÊé•Âè£ÈªòËÆ§ÊòØ‰ΩøÁî®‰∏≤Ë°åÁöÑÊñπÂºèÔºå‰πüÂ∞±ÊòØËØ¥Âú®‰∏Ä‰∏™Á∫øÁ®ãÈáåÊâßË°å„ÄÇ‰∏ãÈù¢‰∏æ‰∏Ä‰∏™‰æãÂ≠êÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StreamDemo</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">6</span><span class="o">,</span> <span class="n">7</span><span class="o">,</span> <span class="n">8</span><span class="o">,</span> <span class="n">9</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">reduce</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;%s: %d + %d = %d&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">})</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨Êù•ÁêÜËß£‰∏Ä‰∏ãËøô‰∏™ÊñπÊ≥ï„ÄÇÈ¶ñÂÖàÊàë‰ª¨Áî®Êï¥Êï∞1~9ÂàõÂª∫‰∫Ü‰∏Ä‰∏™<code>Stream</code>„ÄÇËøôÈáåÁöÑStream.of(T&hellip; values)ÊñπÊ≥ïÊòØStreamÊé•Âè£ÁöÑ‰∏Ä‰∏™ÈùôÊÄÅÊñπÊ≥ïÔºåÂÖ∂Â∫ïÂ±ÇË∞ÉÁî®ÁöÑÊòØArrays.stream(T[] array)ÊñπÊ≥ï„ÄÇ</p>
<p>ÁÑ∂ÂêéÊàë‰ª¨‰ΩøÁî®‰∫Ü<code>reduce</code>ÊñπÊ≥ïÊù•ËÆ°ÁÆóËøô‰∏™ÈõÜÂêàÁöÑÁ¥ØÂä†Âíå„ÄÇ<code>reduce</code>ÊñπÊ≥ïËøôÈáåÂÅöÁöÑÊòØÔºö‰ªéÂâç‰∏§‰∏™ÂÖÉÁ¥†ÂºÄÂßãÔºåËøõË°åÊüêÁßçÊìç‰ΩúÔºàÊàëËøôÈáåËøõË°åÁöÑÊòØÂä†Ê≥ïÊìç‰ΩúÔºâÂêéÔºåËøîÂõû‰∏Ä‰∏™ÁªìÊûúÔºåÁÑ∂ÂêéÂÜçÊãøËøô‰∏™ÁªìÊûúË∑üÁ¨¨‰∏â‰∏™ÂÖÉÁ¥†ÊâßË°åÂêåÊ†∑ÁöÑÊìç‰ΩúÔºå‰ª•Ê≠§Á±ªÊé®ÔºåÁõ¥Âà∞ÊúÄÂêéÁöÑ‰∏Ä‰∏™ÂÖÉÁ¥†„ÄÇ</p>
<p>Êàë‰ª¨Êù•ÊâìÂç∞‰∏Ä‰∏ãÂΩìÂâçËøô‰∏™reduceÊìç‰ΩúÁöÑÁ∫øÁ®ã‰ª•ÂèäÂÆÉ‰ª¨Ë¢´Êìç‰ΩúÁöÑÂÖÉÁ¥†ÂíåËøîÂõûÁöÑÁªìÊûú‰ª•ÂèäÊúÄÂêéÊâÄÊúâreduceÊñπÊ≥ïÁöÑÁªìÊûúÔºå‰πüÂ∞±‰ª£Ë°®ÁöÑÊòØÊï∞Â≠ó1Âà∞9ÁöÑÁ¥ØÂä†Âíå„ÄÇ</p>
<blockquote>
<p>main: 1 + 2 = 3
main: 3 + 3 = 6
main: 6 + 4 = 10
main: 10 + 5 = 15
main: 15 + 6 = 21
main: 21 + 7 = 28
main: 28 + 8 = 36
main: 36 + 9 = 45
45</p>
</blockquote>
<p>ÂèØ‰ª•ÁúãÂà∞ÔºåÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂÆÉÊòØÂú®‰∏Ä‰∏™ÂçïÁ∫øÁ®ãËøêË°åÁöÑÔºå‰πüÂ∞±ÊòØ<strong>main</strong>Á∫øÁ®ã„ÄÇÁÑ∂ÂêéÊØèÊ¨°reduceÊìç‰ΩúÈÉΩÊòØ‰∏≤Ë°åËµ∑Êù•ÁöÑÔºåÈ¶ñÂÖàËÆ°ÁÆóÂâç‰∏§‰∏™Êï∞Â≠óÁöÑÂíåÔºåÁÑ∂ÂêéÂÜçÂæÄÂêé‰æùÊ¨°ËÆ°ÁÆó„ÄÇ</p>
<h3 id="streamÂ§öÁ∫øÁ®ãÂπ∂Ë°åËÆ°ÁÆó">StreamÂ§öÁ∫øÁ®ãÂπ∂Ë°åËÆ°ÁÆó</h3>
<p>Êàë‰ª¨ÊÄùËÄÉ‰∏äÈù¢‰∏Ä‰∏™‰æãÂ≠êÔºåÊòØ‰∏çÊòØ‰∏ÄÂÆöË¶ÅÂú®ÂçïÁ∫øÁ®ãÈáåËøõË°å‰∏≤Ë°åÂú∞ËÆ°ÁÆóÂë¢ÔºüÂÅáÂ¶ÇÊàëÁöÑËÆ°ÁÆóÊú∫ÊòØ‰∏Ä‰∏™Â§öÊ†∏ËÆ°ÁÆóÊú∫ÔºåÊàë‰ª¨Âú®ÁêÜËÆ∫‰∏äËÉΩÂê¶Âà©Áî®Â§öÊ†∏Êù•ËøõË°åÂπ∂Ë°åËÆ°ÁÆóÔºåÊèêÈ´òËÆ°ÁÆóÊïàÁéáÂë¢Ôºü</p>
<p>ÂΩìÁÑ∂ÂèØ‰ª•ÔºåÊØîÂ¶ÇÊàë‰ª¨Âú®ËÆ°ÁÆóÂâç‰∏§‰∏™ÂÖÉÁ¥†1 + 2 = 3ÁöÑÊó∂ÂÄôÔºåÂÖ∂ÂÆûÊàë‰ª¨‰πüÂèØ‰ª•ÂêåÊó∂Âú®Âè¶‰∏Ä‰∏™Ê†∏ËÆ°ÁÆó 3 + 4 = 7„ÄÇÁÑ∂ÂêéÁ≠âÂÆÉ‰ª¨ÈÉΩËÆ°ÁÆóÂÆåÊàê‰πãÂêéÔºåÂÜçËÆ°ÁÆó 3 + 7 = 10ÁöÑÊìç‰Ωú„ÄÇ</p>
<p>ÊòØ‰∏çÊòØÂæàÁÜüÊÇâËøôÊ†∑ÁöÑÊìç‰ΩúÊâãÊ≥ïÔºüÊ≤°ÈîôÔºåÂÆÉÂ∞±ÊòØForkJoinÊ°ÜÊû∂ÁöÑÊÄùÊÉ≥„ÄÇ‰∏ãÈù¢Â∞èÂ∞èÂú∞‰øÆÊîπ‰∏Ä‰∏ã‰∏äÈù¢ÁöÑ‰ª£Á†ÅÔºåÂ¢ûÂä†‰∏ÄË°å‰ª£Á†ÅÔºå‰ΩøStream‰ΩøÁî®Â§öÁ∫øÁ®ãÊù•Âπ∂Ë°åËÆ°ÁÆóÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StreamParallelDemo</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">,</span> <span class="n">4</span><span class="o">,</span> <span class="n">5</span><span class="o">,</span> <span class="n">6</span><span class="o">,</span> <span class="n">7</span><span class="o">,</span> <span class="n">8</span><span class="o">,</span> <span class="n">9</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">parallel</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">reduce</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;%s: %d + %d = %d&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                            <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">})</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÁúãÂà∞Ôºå‰∏é‰∏ä‰∏Ä‰∏™Ê°à‰æãÁöÑ‰ª£Á†ÅÂè™Êúâ‰∏ÄÁÇπÁÇπÂå∫Âà´ÔºåÂ∞±ÊòØÂú®reduceÊñπÊ≥ïË¢´Ë∞ÉÁî®‰πãÂâçÔºåË∞ÉÁî®‰∫Üparallel()ÊñπÊ≥ï„ÄÇ‰∏ãÈù¢Êù•ÁúãÁúãËøô‰∏™ÊñπÊ≥ïÁöÑËæìÂá∫Ôºö</p>
<blockquote>
<p>ForkJoinPool.commonPool-worker-1: 3 + 4 = 7
ForkJoinPool.commonPool-worker-4: 8 + 9 = 17
ForkJoinPool.commonPool-worker-2: 5 + 6 = 11
ForkJoinPool.commonPool-worker-3: 1 + 2 = 3
ForkJoinPool.commonPool-worker-4: 7 + 17 = 24
ForkJoinPool.commonPool-worker-4: 11 + 24 = 35
ForkJoinPool.commonPool-worker-3: 3 + 7 = 10
ForkJoinPool.commonPool-worker-3: 10 + 35 = 45
45</p>
</blockquote>
<p>ÂèØ‰ª•ÂæàÊòéÊòæÂú∞ÁúãÂà∞ÔºåÂÆÉ‰ΩøÁî®ÁöÑÁ∫øÁ®ãÊòØ<code>ForkJoinPool</code>ÈáåÈù¢ÁöÑ<code>commonPool</code>ÈáåÈù¢ÁöÑ<strong>worker</strong>Á∫øÁ®ã„ÄÇÂπ∂‰∏îÂÆÉ‰ª¨ÊòØÂπ∂Ë°åËÆ°ÁÆóÁöÑÔºåÂπ∂‰∏çÊòØ‰∏≤Ë°åËÆ°ÁÆóÁöÑ„ÄÇ‰ΩÜÁî±‰∫éFork/JoinÊ°ÜÊû∂ÁöÑ‰ΩúÁî®ÔºåÂÆÉÊúÄÁªàËÉΩÂæàÂ•ΩÁöÑÂçèË∞ÉËÆ°ÁÆóÁªìÊûúÔºå‰ΩøÂæóËÆ°ÁÆóÁªìÊûúÂÆåÂÖ®Ê≠£Á°Æ„ÄÇ</p>
<p>Â¶ÇÊûúÊàë‰ª¨Áî®Fork/Join‰ª£Á†ÅÂéªÂÆûÁé∞ËøôÊ†∑‰∏Ä‰∏™ÂäüËÉΩÔºåÈÇ£Êó†ÁñëÊòØÈùûÂ∏∏Â§çÊùÇÁöÑ„ÄÇ‰ΩÜJava8Êèê‰æõ‰∫ÜÂπ∂Ë°åÂºèÁöÑÊµÅÂºèËÆ°ÁÆóÔºåÂ§ßÂ§ßÁÆÄÂåñ‰∫ÜÊàë‰ª¨ÁöÑ‰ª£Á†ÅÈáèÔºå‰ΩøÂæóÊàë‰ª¨Âè™ÈúÄË¶ÅÂÜôÂæàÂ∞ëÂæàÁÆÄÂçïÁöÑ‰ª£Á†ÅÂ∞±ÂèØ‰ª•Âà©Áî®ËÆ°ÁÆóÊú∫Â∫ïÂ±ÇÁöÑÂ§öÊ†∏ËµÑÊ∫ê„ÄÇ</p>
<h3 id="‰ªéÊ∫êÁ†ÅÁúãstreamÂπ∂Ë°åËÆ°ÁÆóÂéüÁêÜ">‰ªéÊ∫êÁ†ÅÁúãStreamÂπ∂Ë°åËÆ°ÁÆóÂéüÁêÜ</h3>
<p>‰∏äÈù¢Êàë‰ª¨ÈÄöËøáÂú®ÊéßÂà∂Âè∞ËæìÂá∫Á∫øÁ®ãÁöÑÂêçÂ≠óÔºåÁúãÂà∞‰∫ÜStreamÁöÑÂπ∂Ë°åËÆ°ÁÆóÂ∫ïÂ±ÇÂÖ∂ÂÆûÊòØ‰ΩøÁî®ÁöÑFork/JoinÊ°ÜÊû∂„ÄÇÈÇ£ÂÆÉÂà∞Â∫ïÊòØÂú®Âì™‰ΩøÁî®Fork/JoinÁöÑÂë¢ÔºüÊàë‰ª¨‰ªéÊ∫êÁ†Å‰∏äÊù•Ëß£Êûê‰∏Ä‰∏ã‰∏äËø∞Ê°à‰æã„ÄÇ</p>
<p><code>Stream.of</code>ÊñπÊ≥ïÂ∞±‰∏çËØ¥‰∫ÜÔºåÂÆÉÂè™ÊòØÁîüÊàê‰∏Ä‰∏™ÁÆÄÂçïÁöÑStream„ÄÇÂÖàÊù•ÁúãÁúã<code>parallel()</code>ÊñπÊ≥ïÁöÑÊ∫êÁ†Å„ÄÇËøôÈáåÁî±‰∫éÊàëÁöÑÊï∞ÊçÆÊòØ<code>int</code>Á±ªÂûãÁöÑÔºåÊâÄ‰ª•ÂÆÉÂÖ∂ÂÆûÊòØ‰ΩøÁî®ÁöÑ<code>BaseStream</code>Êé•Âè£ÁöÑ<code>parallel()</code>ÊñπÊ≥ï„ÄÇËÄå<code>BaseStream</code>Êé•Âè£ÁöÑJDKÂîØ‰∏ÄÂÆûÁé∞Á±ªÊòØ‰∏Ä‰∏™Âè´<code>AbstractPipeline</code>ÁöÑÁ±ª„ÄÇ‰∏ãÈù¢Êàë‰ª¨Êù•ÁúãÁúãËøô‰∏™Á±ªÁöÑ<code>parallel()</code>ÊñπÊ≥ïÁöÑ‰ª£Á†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">final</span> <span class="n">S</span> <span class="nf">parallel</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sourceStage</span><span class="o">.</span><span class="na">parallel</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">(</span><span class="n">S</span><span class="o">)</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ëøô‰∏™ÊñπÊ≥ïÂæàÁÆÄÂçïÔºåÂ∞±ÊòØÊää‰∏Ä‰∏™Ê†áËØÜ<code>sourceStage.parallel</code>ËÆæÁΩÆ‰∏∫<code>true</code>„ÄÇÁÑ∂ÂêéËøîÂõûÂÆû‰æãÊú¨Ë∫´„ÄÇ</p>
<p>Êé•ÁùÄÊàë‰ª¨ÂÜçÊù•Áúã<code>reduce</code>Ëøô‰∏™ÊñπÊ≥ïÁöÑÂÜÖÈÉ®ÂÆûÁé∞„ÄÇ</p>
<p>Stream.reduce()ÊñπÊ≥ïÁöÑÂÖ∑‰ΩìÂÆûÁé∞ÊòØ‰∫§Áªô‰∫Ü<code>ReferencePipeline</code>Ëøô‰∏™ÊäΩË±°Á±ªÔºåÂÆÉÊòØÁªßÊâø‰∫Ü<code>AbstractPipeline</code>Ëøô‰∏™Á±ªÁöÑ:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ReferencePipelineÊäΩË±°Á±ªÁöÑreduceÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">final</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">P_OUT</span><span class="o">&gt;</span> <span class="nf">reduce</span><span class="o">(</span><span class="n">BinaryOperator</span><span class="o">&lt;</span><span class="n">P_OUT</span><span class="o">&gt;</span> <span class="n">accumulator</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Ë∞ÉÁî®evaluateÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">evaluate</span><span class="o">(</span><span class="n">ReduceOps</span><span class="o">.</span><span class="na">makeRef</span><span class="o">(</span><span class="n">accumulator</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">final</span> <span class="o">&lt;</span><span class="n">R</span><span class="o">&gt;</span> <span class="n">R</span> <span class="nf">evaluate</span><span class="o">(</span><span class="n">TerminalOp</span><span class="o">&lt;</span><span class="n">E_OUT</span><span class="o">,</span> <span class="n">R</span><span class="o">&gt;</span> <span class="n">terminalOp</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">getOutputShape</span><span class="o">()</span> <span class="o">==</span> <span class="n">terminalOp</span><span class="o">.</span><span class="na">inputShape</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">linkedOrConsumed</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span><span class="n">MSG_STREAM_LINKED</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">linkedOrConsumed</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">isParallel</span><span class="o">()</span> <span class="c1">// Ë∞ÉÁî®isParallel()Âà§Êñ≠ÊòØÂê¶‰ΩøÁî®Âπ∂Ë°åÊ®°Âºè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">?</span> <span class="n">terminalOp</span><span class="o">.</span><span class="na">evaluateParallel</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">sourceSpliterator</span><span class="o">(</span><span class="n">terminalOp</span><span class="o">.</span><span class="na">getOpFlags</span><span class="o">()))</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="n">terminalOp</span><span class="o">.</span><span class="na">evaluateSequential</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">sourceSpliterator</span><span class="o">(</span><span class="n">terminalOp</span><span class="o">.</span><span class="na">getOpFlags</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">isParallel</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Ê†πÊçÆ‰πãÂâçÂú®parallel()ÊñπÊ≥ïËÆæÁΩÆÁöÑÈÇ£‰∏™flagÊù•Âà§Êñ≠„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">sourceStage</span><span class="o">.</span><span class="na">parallel</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ªéÂÆÉÁöÑÊ∫êÁ†ÅÂèØ‰ª•Áü•ÈÅìÔºåreduceÊñπÊ≥ïË∞ÉÁî®‰∫ÜevaluateÊñπÊ≥ïÔºåËÄåevaluateÊñπÊ≥ï‰ºöÂÖàÂéªÊ£ÄÊü•ÂΩìÂâçÁöÑflagÔºåÊòØÂê¶‰ΩøÁî®Âπ∂Ë°åÊ®°ÂºèÔºåÂ¶ÇÊûúÊòØÂàô‰ºöË∞ÉÁî®<code>evaluateParallel</code>ÊñπÊ≥ïÊâßË°åÂπ∂Ë°åËÆ°ÁÆóÔºåÂê¶ÂàôÔºå‰ºöË∞ÉÁî®<code>evaluateSequential</code>ÊñπÊ≥ïÊâßË°å‰∏≤Ë°åËÆ°ÁÆó„ÄÇ</p>
<p>ËøôÈáåÊàë‰ª¨ÂÜçÁúãÁúã<code>TerminalOp</code>ÔºàÊ≥®ÊÑèËøôÈáåÊòØÂ≠óÊØçl OÔºåËÄå‰∏çÊòØÊï∞Â≠ó1 0ÔºâÊé•Âè£ÁöÑ<code>evaluateParallel</code>ÊñπÊ≥ï„ÄÇ<code>TerminalOp</code>Êé•Âè£ÁöÑÂÆûÁé∞Á±ªÊúâËøôÊ†∑Âá†‰∏™ÂÜÖÈÉ®Á±ªÔºö</p>
<ul>
<li>java.util.stream.FindOps.FindOp</li>
<li>java.util.stream.ForEachOps.ForEachOp</li>
<li>java.util.stream.MatchOps.MatchOp</li>
<li>java.util.stream.ReduceOps.ReduceOp</li>
</ul>
<p>ÂèØ‰ª•ÁúãÂà∞ÔºåÂØπÂ∫îÁöÑÊòØStreamÁöÑÂá†Áßç‰∏ªË¶ÅÁöÑËÆ°ÁÆóÊìç‰Ωú„ÄÇÊàë‰ª¨ËøôÈáåÁöÑÁ§∫‰æã‰ª£Á†Å‰ΩøÁî®ÁöÑÊòØreduceËÆ°ÁÆóÔºåÈÇ£Êàë‰ª¨Â∞±ÁúãÁúãReduceOpÁ±ªÁöÑËøô‰∏™ÊñπÊ≥ïÁöÑÊ∫êÁ†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// java.util.stream.ReduceOps.ReduceOp.evaluateParallel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="o">&lt;</span><span class="n">P_IN</span><span class="o">&gt;</span> <span class="n">R</span> <span class="nf">evaluateParallel</span><span class="o">(</span><span class="n">PipelineHelper</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">helper</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                 <span class="n">Spliterator</span><span class="o">&lt;</span><span class="n">P_IN</span><span class="o">&gt;</span> <span class="n">spliterator</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">ReduceTask</span><span class="o">&lt;&gt;(</span><span class="k">this</span><span class="o">,</span> <span class="n">helper</span><span class="o">,</span> <span class="n">spliterator</span><span class="o">).</span><span class="na">invoke</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>evaluateParallelÊñπÊ≥ïÂàõÂª∫‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑReduceTaskÂÆû‰æãÔºåÂπ∂‰∏îË∞ÉÁî®‰∫Üinvoke()ÊñπÊ≥ïÂêéÂÜçË∞ÉÁî®get()ÊñπÊ≥ïÔºåÁÑ∂ÂêéËøîÂõûËøô‰∏™ÁªìÊûú„ÄÇÈÇ£Ëøô‰∏™ReduceTaskÊòØ‰ªÄ‰πàÂë¢ÔºüÂÆÉÁöÑinvokeÊñπÊ≥ïÂÜÖÈÉ®ÂèàÊòØ‰ªÄ‰πàÂë¢Ôºü</p>
<p>ËøΩÊ∫ØÊ∫êÁ†ÅÊàë‰ª¨ÂèØ‰ª•ÂèëÁé∞ÔºåReduceTaskÁ±ªÊòØReduceOpsÁ±ªÁöÑ‰∏Ä‰∏™ÂÜÖÈÉ®Á±ªÔºåÂÆÉÁªßÊâø‰∫ÜAbstractTaskÁ±ªÔºåËÄåAbstractTaskÁ±ªÂèàÁªßÊâø‰∫ÜCountedCompleterÁ±ªÔºåËÄåCountedCompleterÁ±ªÂèàÁªßÊâø‰∫ÜForkJoinTaskÁ±ªÔºÅ</p>
<p>ÂÆÉ‰ª¨ÁöÑÁªßÊâøÂÖ≥Á≥ªÂ¶Ç‰∏ãÔºö</p>
<blockquote>
<p>ReduceTask -&gt; AbstractTask -&gt; CountedCompleter -&gt; ForkJoinTask</p>
</blockquote>
<p>ËøôÈáåÁöÑReduceTaskÁöÑinvokeÊñπÊ≥ïÔºåÂÖ∂ÂÆûÊòØË∞ÉÁî®ÁöÑForkJoinTaskÁöÑinvokeÊñπÊ≥ïÔºå‰∏≠Èó¥‰∏âÂ±ÇÁªßÊâøÂπ∂Ê≤°ÊúâË¶ÜÁõñËøô‰∏™ÊñπÊ≥ïÁöÑÂÆûÁé∞„ÄÇ</p>
<p>ÊâÄ‰ª•ËøôÂ∞±‰ªéÊ∫êÁ†ÅÂ±ÇÈù¢Ëß£Èáä‰∫ÜStreamÂπ∂Ë°åÁöÑÂ∫ïÂ±ÇÂéüÁêÜÊòØ‰ΩøÁî®‰∫ÜFork/JoinÊ°ÜÊû∂„ÄÇ</p>
<p>ÈúÄË¶ÅÊ≥®ÊÑèÁöÑÊòØÔºå‰∏Ä‰∏™JavaËøõÁ®ãÁöÑStreamÂπ∂Ë°åËÆ°ÁÆó‰ªªÂä°ÈªòËÆ§ÂÖ±‰∫´Âêå‰∏Ä‰∏™Á∫øÁ®ãÊ±†ÔºåÂ¶ÇÊûúÈöèÊÑèÁöÑ‰ΩøÁî®Âπ∂Ë°åÁâπÊÄßÂèØËÉΩ‰ºöÂØºËá¥ÊñπÊ≥ïÁöÑÂêûÂêêÈáè‰∏ãÈôç„ÄÇÊàë‰ª¨ÂèØ‰ª•ÈÄöËøá‰∏ãÈù¢ËøôÁßçÊñπÂºèÊù•ËÆ©‰Ω†ÁöÑÊüê‰∏™Âπ∂Ë°åStream‰ΩøÁî®Ëá™ÂÆö‰πâÁöÑForkJoinÁ∫øÁ®ãÊ±†Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ForkJoinPool</span> <span class="n">customThreadPool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ForkJoinPool</span><span class="o">(</span><span class="n">4</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">actualTotal</span> <span class="o">=</span> <span class="n">customThreadPool</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">roster</span><span class="o">.</span><span class="na">parallelStream</span><span class="o">().</span><span class="na">reduce</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Integer</span><span class="o">::</span><span class="n">sum</span><span class="o">)).</span><span class="na">get</span><span class="o">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="streamÂπ∂Ë°åËÆ°ÁÆóÁöÑÊÄßËÉΩÊèêÂçá">StreamÂπ∂Ë°åËÆ°ÁÆóÁöÑÊÄßËÉΩÊèêÂçá</h3>
<p>Êàë‰ª¨ÂèØ‰ª•Âú®Êú¨Âú∞ÊµãËØï‰∏Ä‰∏ãÂ¶ÇÊûúÂú®Â§öÊ†∏ÊÉÖÂÜµ‰∏ãÔºåStreamÂπ∂Ë°åËÆ°ÁÆó‰ºöÁªôÊàë‰ª¨ÁöÑÁ®ãÂ∫èÂ∏¶Êù•Â§öÂ§ßÁöÑÊïàÁéá‰∏äÁöÑÊèêÂçá„ÄÇÁî®‰ª•‰∏ãÁ§∫‰æã‰ª£Á†ÅÊù•ËÆ°ÁÆó‰∏ÄÂçÉ‰∏á‰∏™ÈöèÊú∫Êï∞ÁöÑÂíåÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StreamParallelDemo</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;Êú¨ËÆ°ÁÆóÊú∫ÁöÑÊ†∏Êï∞Ôºö%d&#34;</span><span class="o">,</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">availableProcessors</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ‰∫ßÁîü100w‰∏™ÈöèÊú∫Êï∞(1 ~ 100)ÔºåÁªÑÊàêÂàóË°®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">1000_0000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">1000_0000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">100</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">prevTime</span> <span class="o">=</span> <span class="n">getCurrentTime</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">reduce</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">).</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;ÂçïÁ∫øÁ®ãËÆ°ÁÆóËÄóÊó∂Ôºö%d&#34;</span><span class="o">,</span> <span class="n">getCurrentTime</span><span class="o">()</span> <span class="o">-</span> <span class="n">prevTime</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">prevTime</span> <span class="o">=</span> <span class="n">getCurrentTime</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">parallel</span><span class="o">().</span><span class="na">reduce</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">).</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;Â§öÁ∫øÁ®ãËÆ°ÁÆóËÄóÊó∂Ôºö%d&#34;</span><span class="o">,</span> <span class="n">getCurrentTime</span><span class="o">()</span> <span class="o">-</span> <span class="n">prevTime</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">getCurrentTime</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËæìÂá∫Ôºö</p>
<blockquote>
<p>Êú¨ËÆ°ÁÆóÊú∫ÁöÑÊ†∏Êï∞Ôºö8
495156156
ÂçïÁ∫øÁ®ãËÆ°ÁÆóËÄóÊó∂Ôºö223
495156156
Â§öÁ∫øÁ®ãËÆ°ÁÆóËÄóÊó∂Ôºö95</p>
</blockquote>
<p>ÊâÄ‰ª•Âú®Â§öÊ†∏ÁöÑÊÉÖÂÜµ‰∏ãÔºå‰ΩøÁî®StreamÁöÑÂπ∂Ë°åËÆ°ÁÆóÁ°ÆÂÆûÊØî‰∏≤Ë°åËÆ°ÁÆóËÉΩÂ∏¶Êù•ÂæàÂ§ßÊïàÁéá‰∏äÁöÑÊèêÂçáÔºåÂπ∂‰∏î‰πüËÉΩ‰øùËØÅÁªìÊûúËÆ°ÁÆóÂÆåÂÖ®ÂáÜÁ°Æ„ÄÇ</p>
<p>Êú¨Êñá‰∏ÄÁõ¥Âú®Âº∫Ë∞ÉÁöÑ‚ÄúÂ§öÊ†∏‚ÄùÁöÑÊÉÖÂÜµ„ÄÇÂÖ∂ÂÆûÂèØ‰ª•ÁúãÂà∞ÔºåÊàëÁöÑÊú¨Âú∞ÁîµËÑëÊúâ8Ê†∏Ôºå‰ΩÜÂπ∂Ë°åËÆ°ÁÆóËÄóÊó∂Âπ∂‰∏çÊòØÂçïÁ∫øÁ®ãËÆ°ÁÆóËÄóÊó∂Èô§‰ª•8ÔºåÂõ†‰∏∫Á∫øÁ®ãÁöÑÂàõÂª∫„ÄÅÈîÄÊØÅ‰ª•ÂèäÁª¥Êä§Á∫øÁ®ã‰∏ä‰∏ãÊñáÁöÑÂàáÊç¢Á≠âÁ≠âÈÉΩÊúâ‰∏ÄÂÆöÁöÑÂºÄÈîÄ„ÄÇÊâÄ‰ª•Â¶ÇÊûú‰Ω†ÁöÑÊúçÂä°Âô®Âπ∂‰∏çÊòØÂ§öÊ†∏ÊúçÂä°Âô®ÔºåÈÇ£‰πüÊ≤°ÂøÖË¶ÅÁî®StreamÁöÑÂπ∂Ë°åËÆ°ÁÆó„ÄÇÂõ†‰∏∫Âú®ÂçïÊ†∏ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂæÄÂæÄStreamÁöÑ‰∏≤Ë°åËÆ°ÁÆóÊØîÂπ∂Ë°åËÆ°ÁÆóÊõ¥Âø´ÔºåÂõ†‰∏∫ÂÆÉ‰∏çÈúÄË¶ÅÁ∫øÁ®ãÂàáÊç¢ÁöÑÂºÄÈîÄ„ÄÇ</p>
<h2 id="ËÆ°Âàí‰ªªÂä°">ËÆ°Âàí‰ªªÂä°</h2>
<p>Ëá™JDK 1.5 ÂºÄÂßãÔºåJDKÊèê‰æõ‰∫Ü<code>ScheduledThreadPoolExecutor</code>Á±ªÁî®‰∫éËÆ°Âàí‰ªªÂä°ÔºàÂèàÁß∞ÂÆöÊó∂‰ªªÂä°ÔºâÔºåËøô‰∏™Á±ªÊúâ‰∏§‰∏™Áî®ÈÄîÔºö</p>
<ul>
<li>Âú®ÁªôÂÆöÁöÑÂª∂Ëøü‰πãÂêéËøêË°å‰ªªÂä°</li>
<li>Âë®ÊúüÊÄßÈáçÂ§çÊâßË°å‰ªªÂä°</li>
</ul>
<p>Âú®Ëøô‰πãÂâçÔºåÊòØ‰ΩøÁî®<code>Timer</code>Á±ªÊù•ÂÆåÊàêÂÆöÊó∂‰ªªÂä°ÁöÑÔºå‰ΩÜÊòØ<code>Timer</code>ÊúâÁº∫Èô∑Ôºö</p>
<ul>
<li>TimerÊòØ<strong>ÂçïÁ∫øÁ®ã</strong>Ê®°ÂºèÔºõ</li>
<li>Â¶ÇÊûúÂú®ÊâßË°å‰ªªÂä°ÊúüÈó¥Êüê‰∏™TimerTaskËÄóÊó∂ËæÉ‰πÖÔºåÈÇ£‰πàÂ∞±‰ºöÂΩ±ÂìçÂÖ∂ÂÆÉ‰ªªÂä°ÁöÑË∞ÉÂ∫¶Ôºõ</li>
<li>TimerÁöÑ‰ªªÂä°Ë∞ÉÂ∫¶ÊòØÂü∫‰∫éÁªùÂØπÊó∂Èó¥ÁöÑÔºåÂØπ<strong>Á≥ªÁªüÊó∂Èó¥</strong>ÊïèÊÑüÔºõ</li>
<li>Timer‰∏ç‰ºöÊçïËé∑ÊâßË°åTimerTaskÊó∂ÊâÄÊäõÂá∫ÁöÑ<strong>ÂºÇÂ∏∏</strong>ÔºåÁî±‰∫éTimerÊòØÂçïÁ∫øÁ®ãÔºåÊâÄ‰ª•‰∏ÄÊó¶Âá∫Áé∞ÂºÇÂ∏∏ÔºåÂàôÁ∫øÁ®ãÂ∞±‰ºöÁªàÊ≠¢ÔºåÂÖ∂‰ªñ‰ªªÂä°‰πüÂæó‰∏çÂà∞ÊâßË°å„ÄÇ</li>
</ul>
<p>ÊâÄ‰ª•JDK 1.5‰πãÂêéÔºåÂ§ßÂÆ∂Â∞±ÊëíÂºÉ<code>Timer</code>,‰ΩøÁî®<code>ScheduledThreadPoolExecutor</code>Âêß„ÄÇ</p>
<h3 id="‰ΩøÁî®Ê°à‰æã">‰ΩøÁî®Ê°à‰æã</h3>
<p>ÂÅáËÆæÊàëÊúâ‰∏Ä‰∏™ÈúÄÊ±ÇÔºåÊåáÂÆöÊó∂Èó¥ÁªôÂ§ßÂÆ∂ÂèëÈÄÅÊ∂àÊÅØ„ÄÇÈÇ£‰πàÊàë‰ª¨‰ºöÂ∞ÜÊ∂àÊÅØÔºàÂåÖÂê´ÂèëÈÄÅÊó∂Èó¥ÔºâÂ≠òÂÇ®Âú®Êï∞ÊçÆÂ∫ì‰∏≠ÔºåÁÑ∂ÂêéÊÉ≥Áî®‰∏Ä‰∏™ÂÆöÊó∂‰ªªÂä°ÔºåÊØèÈöî1ÁßíÊ£ÄÊü•Êï∞ÊçÆÂ∫ìÂú®ÂΩìÂâçÊó∂Èó¥ÊúâÊ≤°ÊúâÈúÄË¶ÅÂèëÈÄÅÁöÑÊ∂àÊÅØÔºåÈÇ£Ëøô‰∏™ËÆ°Âàí‰ªªÂä°ÊÄé‰πàÂÜôÔºü‰∏ãÈù¢ÊòØ‰∏Ä‰∏™Demo:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadPool</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ScheduledExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="k">new</span>
</span></span><span class="line"><span class="cl">        <span class="n">ScheduledThreadPoolExecutor</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">Executors</span><span class="o">.</span><span class="na">defaultThreadFactory</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">SimpleDateFormat</span> <span class="n">df</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Êñ∞Âª∫‰∏Ä‰∏™Âõ∫ÂÆöÂª∂ËøüÊó∂Èó¥ÁöÑËÆ°Âàí‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">executor</span><span class="o">.</span><span class="na">scheduleWithFixedDelay</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">haveMsgAtCurrentTime</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">df</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Â§ßÂÆ∂Ê≥®ÊÑè‰∫ÜÔºåÊàëË¶ÅÂèëÊ∂àÊÅØ‰∫Ü&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">},</span> <span class="n">1</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">haveMsgAtCurrentTime</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//Êü•ËØ¢Êï∞ÊçÆÂ∫ìÔºåÊúâÊ≤°ÊúâÂΩìÂâçÊó∂Èó¥ÈúÄË¶ÅÂèëÈÄÅÁöÑÊ∂àÊÅØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//ËøôÈáåÁúÅÁï•ÂÆûÁé∞ÔºåÁõ¥Êé•ËøîÂõûtrue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰∏ãÈù¢Êà™ÂèñÂâçÈù¢ÁöÑËæìÂá∫ÔºàËøô‰∏™demo‰ºö‰∏ÄÁõ¥ËøêË°å‰∏ãÂéªÔºâÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">2019</span><span class="o">-</span><span class="n">01</span><span class="o">-</span><span class="n">23</span> <span class="n">16</span><span class="o">:</span><span class="n">16</span><span class="o">:</span><span class="n">48</span>
</span></span><span class="line"><span class="cl"><span class="n">Â§ßÂÆ∂Ê≥®ÊÑè‰∫Ü</span><span class="err">Ôºå</span><span class="n">ÊàëË¶ÅÂèëÊ∂àÊÅØ‰∫Ü</span>
</span></span><span class="line"><span class="cl"><span class="n">2019</span><span class="o">-</span><span class="n">01</span><span class="o">-</span><span class="n">23</span> <span class="n">16</span><span class="o">:</span><span class="n">16</span><span class="o">:</span><span class="n">49</span>
</span></span><span class="line"><span class="cl"><span class="n">Â§ßÂÆ∂Ê≥®ÊÑè‰∫Ü</span><span class="err">Ôºå</span><span class="n">ÊàëË¶ÅÂèëÊ∂àÊÅØ‰∫Ü</span>
</span></span><span class="line"><span class="cl"><span class="n">2019</span><span class="o">-</span><span class="n">01</span><span class="o">-</span><span class="n">23</span> <span class="n">16</span><span class="o">:</span><span class="n">16</span><span class="o">:</span><span class="n">50</span>
</span></span><span class="line"><span class="cl"><span class="n">Â§ßÂÆ∂Ê≥®ÊÑè‰∫Ü</span><span class="err">Ôºå</span><span class="n">ÊàëË¶ÅÂèëÊ∂àÊÅØ‰∫Ü</span>
</span></span><span class="line"><span class="cl"><span class="n">2019</span><span class="o">-</span><span class="n">01</span><span class="o">-</span><span class="n">23</span> <span class="n">16</span><span class="o">:</span><span class="n">16</span><span class="o">:</span><span class="n">51</span>
</span></span><span class="line"><span class="cl"><span class="n">Â§ßÂÆ∂Ê≥®ÊÑè‰∫Ü</span><span class="err">Ôºå</span><span class="n">ÊàëË¶ÅÂèëÊ∂àÊÅØ‰∫Ü</span>
</span></span><span class="line"><span class="cl"><span class="n">2019</span><span class="o">-</span><span class="n">01</span><span class="o">-</span><span class="n">23</span> <span class="n">16</span><span class="o">:</span><span class="n">16</span><span class="o">:</span><span class="n">52</span>
</span></span><span class="line"><span class="cl"><span class="n">Â§ßÂÆ∂Ê≥®ÊÑè‰∫Ü</span><span class="err">Ôºå</span><span class="n">ÊàëË¶ÅÂèëÊ∂àÊÅØ‰∫Ü</span>
</span></span><span class="line"><span class="cl"><span class="n">2019</span><span class="o">-</span><span class="n">01</span><span class="o">-</span><span class="n">23</span> <span class="n">16</span><span class="o">:</span><span class="n">16</span><span class="o">:</span><span class="n">53</span>
</span></span><span class="line"><span class="cl"><span class="n">Â§ßÂÆ∂Ê≥®ÊÑè‰∫Ü</span><span class="err">Ôºå</span><span class="n">ÊàëË¶ÅÂèëÊ∂àÊÅØ‰∫Ü</span>
</span></span><span class="line"><span class="cl"><span class="n">2019</span><span class="o">-</span><span class="n">01</span><span class="o">-</span><span class="n">23</span> <span class="n">16</span><span class="o">:</span><span class="n">16</span><span class="o">:</span><span class="n">54</span>
</span></span><span class="line"><span class="cl"><span class="n">Â§ßÂÆ∂Ê≥®ÊÑè‰∫Ü</span><span class="err">Ôºå</span><span class="n">ÊàëË¶ÅÂèëÊ∂àÊÅØ‰∫Ü</span>
</span></span><span class="line"><span class="cl"><span class="n">2019</span><span class="o">-</span><span class="n">01</span><span class="o">-</span><span class="n">23</span> <span class="n">16</span><span class="o">:</span><span class="n">16</span><span class="o">:</span><span class="n">55</span>
</span></span><span class="line"><span class="cl"><span class="n">Â§ßÂÆ∂Ê≥®ÊÑè‰∫Ü</span><span class="err">Ôºå</span><span class="n">ÊàëË¶ÅÂèëÊ∂àÊÅØ‰∫Ü</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ËøôÂ∞±ÊòØ<code>ScheduledThreadPoolExecutor</code>ÁöÑ‰∏Ä‰∏™ÁÆÄÂçïËøêÁî®ÔºåÊÉ≥Ë¶ÅÁü•ÈÅìÂ••ÁßòÔºåÊé•‰∏ãÊù•ÁöÑ‰∏úË•øÈúÄË¶Å‰ªîÁªÜÁöÑÁúãÂì¶„ÄÇ</p>
<h3 id="Á±ªÁªìÊûÑ">Á±ªÁªìÊûÑ</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScheduledThreadPoolExecutor</span> <span class="kd">extends</span> <span class="n">ThreadPoolExecutor</span>
</span></span><span class="line"><span class="cl">    <span class="kd">implements</span> <span class="n">ScheduledExecutorService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ScheduledThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span><span class="n">ThreadFactory</span> <span class="n">threadFactory</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">         <span class="kd">super</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">NANOSECONDS</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">              <span class="k">new</span> <span class="n">DelayedWorkQueue</span><span class="o">(),</span> <span class="n">threadFactory</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//‚Ä¶‚Ä¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ScheduledThreadPoolExecutor</code>ÁªßÊâø‰∫Ü<code>ThreadPoolExecutor</code>ÔºåÂÆûÁé∞‰∫Ü<code>ScheduledExecutorService</code>„ÄÇ Á∫øÁ®ãÊ±†Âú®‰πãÂâçÁöÑÁ´†ËäÇ‰ªãÁªçËøá‰∫ÜÔºåÊàë‰ª¨ÂÖàÁúãÁúã<code>ScheduledExecutorService</code>„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ScheduledExecutorService</span> <span class="kd">extends</span> <span class="n">ExecutorService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">schedule</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">,</span><span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">ScheduledFuture</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">schedule</span><span class="o">(</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">callable</span><span class="o">,</span><span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">scheduleAtFixedRate</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                                  <span class="kt">long</span> <span class="n">initialDelay</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                                  <span class="kt">long</span> <span class="n">period</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                                  <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">scheduleWithFixedDelay</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                                     <span class="kt">long</span> <span class="n">initialDelay</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                                     <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                                     <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ScheduledExecutorService</code>ÂÆûÁé∞‰∫Ü<code>ExecutorService</code> ,Âπ∂Â¢ûÂä†Ëã•Âπ≤ÂÆöÊó∂Áõ∏ÂÖ≥ÁöÑÊé•Âè£„ÄÇ Ââç‰∏§‰∏™ÊñπÊ≥ïÁî®‰∫éÂçïÊ¨°Ë∞ÉÂ∫¶ÊâßË°å‰ªªÂä°ÔºåÂå∫Âà´ÊòØÊúâÊ≤°ÊúâËøîÂõûÂÄº„ÄÇ</p>
<p>ÈáçÁÇπÁêÜËß£‰∏Ä‰∏ãÂêéÈù¢‰∏§‰∏™ÊñπÊ≥ïÔºö</p>
<ul>
<li>
<p>scheduleAtFixedRate</p>
<p>ËØ•ÊñπÊ≥ïÂú®<code>initialDelay</code>Êó∂ÈïøÂêéÁ¨¨‰∏ÄÊ¨°ÊâßË°å‰ªªÂä°Ôºå‰ª•ÂêéÊØèÈöî<code>period</code>Êó∂ÈïøÔºåÂÜçÊ¨°ÊâßË°å‰ªªÂä°„ÄÇÊ≥®ÊÑèÔºåperiodÊòØ‰ªé<strong>‰ªªÂä°ÂºÄÂßãÊâßË°åÁÆóËµ∑</strong>ÁöÑ„ÄÇÂºÄÂßãÊâßË°å‰ªªÂä°ÂêéÔºåÂÆöÊó∂Âô®ÊØèÈöîperiodÊó∂Èïø<strong>Ê£ÄÊü•ËØ•‰ªªÂä°ÊòØÂê¶ÂÆåÊàê</strong>ÔºåÂ¶ÇÊûúÂÆåÊàêÂàôÂÜçÊ¨°ÂêØÂä®‰ªªÂä°ÔºåÂê¶ÂàôÁ≠âËØ•‰ªªÂä°ÁªìÊùüÂêéÊâçÂÜçÊ¨°ÂêØÂä®‰ªªÂä°„ÄÇ</p>
</li>
<li>
<p>scheduleWithFixDelay</p>
<p>ËØ•ÊñπÊ≥ïÂú®<code>initialDelay</code>Êó∂ÈïøÂêéÁ¨¨‰∏ÄÊ¨°ÊâßË°å‰ªªÂä°Ôºå‰ª•ÂêéÊØèÂΩì‰ªªÂä°ÊâßË°å<strong>ÂÆåÊàêÂêé</strong>ÔºåÁ≠âÂæÖ<code>delay</code>Êó∂ÈïøÔºåÂÜçÊ¨°ÊâßË°å‰ªªÂä°„ÄÇ</p>
</li>
</ul>
<h3 id="‰∏ªË¶ÅÊñπÊ≥ï‰ªãÁªç">‰∏ªË¶ÅÊñπÊ≥ï‰ªãÁªç</h3>
<h4 id="schedule">schedule</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// delayÊó∂ÈïøÂêéÊâßË°å‰ªªÂä°commandÔºåËØ•‰ªªÂä°Âè™ÊâßË°å‰∏ÄÊ¨°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">schedule</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">,</span> <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">command</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">unit</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">NullPointerException</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ËøôÈáåÁöÑdecorateTaskÊñπÊ≥ï‰ªÖ‰ªÖËøîÂõûÁ¨¨‰∫å‰∏™ÂèÇÊï∞
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">RunnableScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">decorateTask</span><span class="o">(</span><span class="n">command</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                           <span class="k">new</span> <span class="n">ScheduledFutureTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;(</span><span class="n">command</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">triggerTime</span><span class="o">(</span><span class="n">delay</span><span class="o">,</span><span class="n">unit</span><span class="o">)));</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Âª∂Êó∂ÊàñËÄÖÂë®ÊúüÊâßË°å‰ªªÂä°ÁöÑ‰∏ªË¶ÅÊñπÊ≥ï,Á®çÂêéÁªü‰∏ÄËØ¥Êòé
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">delayedExecute</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">t</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨ÂÖàÁúãÁúãÈáåÈù¢Ê∂âÂèäÂà∞ÁöÑÂá†‰∏™Á±ªÂíåÊé•Âè£<code>ScheduledFuture</code>„ÄÅ <code>RunnableScheduledFuture</code>„ÄÅ <code>ScheduledFutureTask</code>ÁöÑÂÖ≥Á≥ªÔºö</p>
<p><img src="http://concurrent.redspider.group/article/03/imgs/%E7%B1%BB%E5%9B%BE.jpg"
	
	
	
	loading="lazy"
	
		alt="Á±ªÂõæ"
	
	
></p>
<p>Êàë‰ª¨ÂÖàÁúãÁúãËøôÂá†‰∏™Êé•Âè£ÂíåÁ±ªÔºö</p>
<h5 id="delayedÊé•Âè£">DelayedÊé•Âè£</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÁªßÊâøComparableÊé•Âè£ÔºåË°®Á§∫ËØ•Á±ªÂØπË±°ÊîØÊåÅÊéíÂ∫è
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Delayed</span> <span class="kd">extends</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">Delayed</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ËøîÂõûËØ•ÂØπË±°Ââ©‰ΩôÊó∂Âª∂
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">long</span> <span class="nf">getDelay</span><span class="o">(</span><span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Delayed</code>Êé•Âè£ÂæàÁÆÄÂçïÔºåÁªßÊâø‰∫Ü<code>Comparable</code>Êé•Âè£ÔºåË°®Á§∫ÂØπË±°ÊòØÂèØ‰ª•ÊØîËæÉÊéíÂ∫èÁöÑ„ÄÇ</p>
<h5 id="scheduledfutureÊé•Âè£">ScheduledFutureÊé•Âè£</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ‰ªÖ‰ªÖÁªßÊâø‰∫ÜDelayedÂíåFutureÊé•Âè£ÔºåËá™Â∑±Ê≤°Êúâ‰ªª‰Ωï‰ª£Á†Å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ScheduledFuture</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Delayed</span><span class="o">,</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ê≤°ÊúâÊ∑ªÂä†ÂÖ∂‰ªñÊñπÊ≥ï„ÄÇ</p>
<h5 id="runnablescheduledfutureÊé•Âè£">RunnableScheduledFutureÊé•Âè£</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">RunnableScheduledFuture</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">RunnableFuture</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;,</span> <span class="n">ScheduledFuture</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>      
</span></span><span class="line"><span class="cl">    <span class="c1">// ÊòØÂê¶ÊòØÂë®Êúü‰ªªÂä°ÔºåÂë®Êúü‰ªªÂä°ÂèØË¢´Ë∞ÉÂ∫¶ËøêË°åÂ§öÊ¨°ÔºåÈùûÂë®Êúü‰ªªÂä°Âè™Ë¢´ËøêË°å‰∏ÄÊ¨°   
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">boolean</span> <span class="nf">isPeriodic</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="scheduledfuturetaskÁ±ª">ScheduledFutureTaskÁ±ª</h5>
<p>ÂõûÂà∞<code>schecule</code>ÊñπÊ≥ï‰∏≠ÔºåÂÆÉÂàõÂª∫‰∫Ü‰∏Ä‰∏™<code>ScheduledFutureTask</code>ÁöÑÂØπË±°ÔºåÁî±‰∏äÈù¢ÁöÑÂÖ≥Á≥ªÂõæÂèØÁü•Ôºå<code>ScheduledFutureTask</code>Áõ¥Êé•ÊàñËÄÖÈó¥Êé•ÂÆûÁé∞‰∫ÜÂæàÂ§öÊé•Âè£Ôºå‰∏ÄËµ∑ÁúãÁúã<code>ScheduledFutureTask</code>ÈáåÈù¢ÁöÑÂÆûÁé∞ÊñπÊ≥ïÂêß„ÄÇ</p>
<p><strong>ÊûÑÈÄ†ÊñπÊ≥ï</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ScheduledFutureTask</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">r</span><span class="o">,</span> <span class="n">V</span> <span class="n">result</span><span class="o">,</span> <span class="kt">long</span> <span class="n">ns</span><span class="o">,</span> <span class="kt">long</span> <span class="n">period</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Ë∞ÉÁî®Áà∂Á±ªFutureTaskÁöÑÊûÑÈÄ†ÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">super</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// timeË°®Á§∫‰ªªÂä°‰∏ãÊ¨°ÊâßË°åÁöÑÊó∂Èó¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="o">.</span><span class="na">time</span> <span class="o">=</span> <span class="n">ns</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Âë®Êúü‰ªªÂä°ÔºåÊ≠£Êï∞Ë°®Á§∫ÊåâÁÖßÂõ∫ÂÆöÈÄüÁéáÔºåË¥üÊï∞Ë°®Á§∫ÊåâÁÖßÂõ∫ÂÆöÊó∂Âª∂,0Ë°®Á§∫‰∏çÊòØÂë®Êúü‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="o">.</span><span class="na">period</span> <span class="o">=</span> <span class="n">period</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ‰ªªÂä°ÁöÑÁºñÂè∑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="o">.</span><span class="na">sequenceNumber</span> <span class="o">=</span> <span class="n">sequencer</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>DelayedÊé•Âè£ÁöÑÂÆûÁé∞</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ÂÆûÁé∞DelayedÊé•Âè£ÁöÑgetDelayÊñπÊ≥ïÔºåËøîÂõû‰ªªÂä°ÂºÄÂßãÊâßË°åÁöÑÂâ©‰ΩôÊó∂Èó¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">long</span> <span class="nf">getDelay</span><span class="o">(</span><span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">unit</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="n">time</span> <span class="o">-</span> <span class="n">now</span><span class="o">(),</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">NANOSECONDS</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ComparableÊé•Âè£ÁöÑÂÆûÁé∞</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ComparableÊé•Âè£ÁöÑcompareToÊñπÊ≥ïÔºåÊØîËæÉ‰∏§‰∏™‰ªªÂä°ÁöÑ‚ÄùÂ§ßÂ∞è‚Äù„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Delayed</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">other</span> <span class="o">==</span> <span class="k">this</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">other</span> <span class="k">instanceof</span> <span class="n">ScheduledFutureTask</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">ScheduledFutureTask</span><span class="o">&lt;?&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="n">ScheduledFutureTask</span><span class="o">&lt;?&gt;)</span><span class="n">other</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">      <span class="kt">long</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="na">time</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Â∞è‰∫é0ÔºåËØ¥ÊòéÂΩìÂâç‰ªªÂä°ÁöÑÊâßË°åÊó∂Èó¥ÁÇπÊó©‰∫éotherÔºåË¶ÅÊéíÂú®Âª∂Êó∂ÈòüÂàóotherÁöÑÂâçÈù¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="o">(</span><span class="n">diff</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">-</span><span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Â§ß‰∫é0ÔºåËØ¥ÊòéÂΩìÂâç‰ªªÂä°ÁöÑÊâßË°åÊó∂Èó¥ÁÇπÊôö‰∫éotherÔºåË¶ÅÊéíÂú®Âª∂Êó∂ÈòüÂàóotherÁöÑÂêéÈù¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Â¶ÇÊûú‰∏§‰∏™‰ªªÂä°ÁöÑÊâßË°åÊó∂Èó¥ÁÇπ‰∏ÄÊ†∑ÔºåÊØîËæÉ‰∏§‰∏™‰ªªÂä°ÁöÑÁºñÂè∑ÔºåÁºñÂè∑Â∞èÁöÑÊéíÂú®ÈòüÂàóÂâçÈù¢ÔºåÁºñÂè∑Â§ßÁöÑÊéíÂú®ÈòüÂàóÂêéÈù¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">sequenceNumber</span> <span class="o">&lt;</span> <span class="n">x</span><span class="o">.</span><span class="na">sequenceNumber</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">-</span><span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûú‰ªªÂä°Á±ªÂûã‰∏çÊòØScheduledFutureTaskÔºåÈÄöËøágetDelayÊñπÊ≥ïÊØîËæÉ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">long</span> <span class="n">d</span> <span class="o">=</span> <span class="o">(</span><span class="n">getDelay</span><span class="o">(</span><span class="n">TimeUnit</span><span class="o">.</span><span class="na">NANOSECONDS</span><span class="o">)</span> <span class="o">-</span>
</span></span><span class="line"><span class="cl">              <span class="n">other</span><span class="o">.</span><span class="na">getDelay</span><span class="o">(</span><span class="n">TimeUnit</span><span class="o">.</span><span class="na">NANOSECONDS</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">(</span><span class="n">d</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="o">((</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">?</span> <span class="o">-</span><span class="n">1</span> <span class="o">:</span> <span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>setNextRunTime</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ‰ªªÂä°ÊâßË°åÂÆåÂêéÔºåËÆæÁΩÆ‰∏ãÊ¨°ÊâßË°åÁöÑÊó∂Èó¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">setNextRunTime</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">p</span> <span class="o">=</span> <span class="n">period</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// p &gt; 0ÔºåËØ¥ÊòéÊòØÂõ∫ÂÆöÈÄüÁéáËøêË°åÁöÑ‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// Âú®ÂéüÊù•‰ªªÂä°ÂºÄÂßãÊâßË°åÊó∂Èó¥ÁöÑÂü∫Á°Ä‰∏äÂä†‰∏äpÂç≥ÂèØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">time</span> <span class="o">+=</span> <span class="n">p</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// p &lt; 0ÔºåËØ¥ÊòéÊòØÂõ∫ÂÆöÊó∂Âª∂ËøêË°åÁöÑ‰ªªÂä°Ôºå
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ‰∏ãÊ¨°ÊâßË°åÊó∂Èó¥Âú®ÂΩìÂâçÊó∂Èó¥(‰ªªÂä°ÊâßË°åÂÆåÊàêÁöÑÊó∂Èó¥)ÁöÑÂü∫Á°Ä‰∏äÂä†‰∏ä-pÁöÑÊó∂Èó¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="n">time</span> <span class="o">=</span> <span class="n">triggerTime</span><span class="o">(-</span><span class="n">p</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>RunnableÊé•Âè£ÂÆûÁé∞</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">boolean</span> <span class="n">periodic</span> <span class="o">=</span> <span class="n">isPeriodic</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Â¶ÇÊûúÂΩìÂâçÁä∂ÊÄÅ‰∏ã‰∏çËÉΩÊâßË°å‰ªªÂä°ÔºåÂàôÂèñÊ∂à‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(!</span><span class="n">canRunInCurrentRunState</span><span class="o">(</span><span class="n">periodic</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="n">cancel</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ‰∏çÊòØÂë®ÊúüÊÄß‰ªªÂä°ÔºåÊâßË°å‰∏ÄÊ¨°‰ªªÂä°Âç≥ÂèØÔºåË∞ÉÁî®Áà∂Á±ªÁöÑrunÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">else</span> <span class="k">if</span> <span class="o">(!</span><span class="n">periodic</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">ScheduledFutureTask</span><span class="o">.</span><span class="na">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÊòØÂë®ÊúüÊÄß‰ªªÂä°ÔºåË∞ÉÁî®FutureTaskÁöÑrunAndResetÊñπÊ≥ïÔºåÊñπÊ≥ïÊâßË°åÂÆåÊàêÂêé
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ÈáçÊñ∞ËÆæÁΩÆ‰ªªÂä°‰∏ã‰∏ÄÊ¨°ÊâßË°åÁöÑÊó∂Èó¥ÔºåÂπ∂Â∞ÜËØ•‰ªªÂä°ÈáçÊñ∞ÂÖ•ÈòüÔºåÁ≠âÂæÖÂÜçÊ¨°Ë¢´Ë∞ÉÂ∫¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ScheduledFutureTask</span><span class="o">.</span><span class="na">super</span><span class="o">.</span><span class="na">runAndReset</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">setNextRunTime</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">reExecutePeriodic</span><span class="o">(</span><span class="n">outerTask</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊÄªÁªì‰∏Ä‰∏ãrunÊñπÊ≥ïÁöÑÊâßË°åËøáÁ®ãÔºö</p>
<ol>
<li>Â¶ÇÊûúÂΩìÂâçÁ∫øÁ®ãÊ±†ËøêË°åÁä∂ÊÄÅ‰∏çÂèØ‰ª•ÊâßË°å‰ªªÂä°ÔºåÂèñÊ∂àËØ•‰ªªÂä°ÔºåÁÑ∂ÂêéÁõ¥Êé•ËøîÂõûÔºåÂê¶ÂàôÊâßË°åÊ≠•È™§2Ôºõ</li>
<li>Â¶ÇÊûú‰∏çÊòØÂë®ÊúüÊÄß‰ªªÂä°ÔºåË∞ÉÁî®FutureTask‰∏≠ÁöÑrunÊñπÊ≥ïÊâßË°åÔºå‰ºöËÆæÁΩÆÊâßË°åÁªìÊûúÔºåÁÑ∂ÂêéÁõ¥Êé•ËøîÂõûÔºåÂê¶ÂàôÊâßË°åÊ≠•È™§3Ôºõ</li>
<li>Â¶ÇÊûúÊòØÂë®ÊúüÊÄß‰ªªÂä°ÔºåË∞ÉÁî®FutureTask‰∏≠ÁöÑrunAndResetÊñπÊ≥ïÊâßË°åÔºå‰∏ç‰ºöËÆæÁΩÆÊâßË°åÁªìÊûúÔºåÁÑ∂ÂêéÁõ¥Êé•ËøîÂõûÔºåÂê¶ÂàôÊâßË°åÊ≠•È™§4ÂíåÊ≠•È™§5Ôºõ</li>
<li>ËÆ°ÁÆó‰∏ãÊ¨°ÊâßË°åËØ•‰ªªÂä°ÁöÑÂÖ∑‰ΩìÊó∂Èó¥Ôºõ</li>
<li>ÈáçÂ§çÊâßË°å‰ªªÂä°„ÄÇ</li>
</ol>
<p><code>runAndReset</code>ÊñπÊ≥ïÊòØ‰∏∫‰ªªÂä°Â§öÊ¨°ÊâßË°åËÄåËÆæËÆ°ÁöÑ„ÄÇ<code>runAndReset</code>ÊñπÊ≥ïÊâßË°åÂÆå‰ªªÂä°Âêé‰∏ç‰ºöËÆæÁΩÆ‰ªªÂä°ÁöÑÊâßË°åÁªìÊûúÔºå‰πü‰∏ç‰ºöÂéªÊõ¥Êñ∞‰ªªÂä°ÁöÑÁä∂ÊÄÅÔºåÁª¥ÊåÅ‰ªªÂä°ÁöÑÁä∂ÊÄÅ‰∏∫ÂàùÂßãÁä∂ÊÄÅÔºà<strong>NEW</strong>Áä∂ÊÄÅÔºâÔºåËøô‰πüÊòØËØ•ÊñπÊ≥ïÂíå<code>FutureTask</code>ÁöÑ<code>run</code>ÊñπÊ≥ïÁöÑÂå∫Âà´„ÄÇ</p>
<h4 id="scheduledatfixedrate">scheduledAtFixedRate</h4>
<p>Êàë‰ª¨Áúã‰∏Ä‰∏ã‰ª£Á†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Ê≥®ÊÑèÔºåÂõ∫ÂÆöÈÄüÁéáÂíåÂõ∫ÂÆöÊó∂Âª∂Ôºå‰º†ÂÖ•ÁöÑÂèÇÊï∞ÈÉΩÊòØRunnableÔºå‰πüÂ∞±ÊòØËØ¥ËøôÁßçÂÆöÊó∂‰ªªÂä°ÊòØÊ≤°ÊúâËøîÂõûÂÄºÁöÑ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">scheduleAtFixedRate</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                                  <span class="kt">long</span> <span class="n">initialDelay</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                                  <span class="kt">long</span> <span class="n">period</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                                  <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">command</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">unit</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="n">NullPointerException</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">period</span> <span class="o">&lt;=</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂàõÂª∫‰∏Ä‰∏™ÊúâÂàùÂßãÂª∂Êó∂ÂíåÂõ∫ÂÆöÂë®ÊúüÁöÑ‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ScheduledFutureTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="n">sft</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="n">ScheduledFutureTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;(</span><span class="n">command</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="kc">null</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="n">triggerTime</span><span class="o">(</span><span class="n">initialDelay</span><span class="o">,</span> <span class="n">unit</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">                                    <span class="n">unit</span><span class="o">.</span><span class="na">toNanos</span><span class="o">(</span><span class="n">period</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">RunnableScheduledFuture</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">decorateTask</span><span class="o">(</span><span class="n">command</span><span class="o">,</span> <span class="n">sft</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// outerTaskË°®Á§∫Â∞Ü‰ºöÈáçÊñ∞ÂÖ•ÈòüÁöÑ‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sft</span><span class="o">.</span><span class="na">outerTask</span> <span class="o">=</span> <span class="n">t</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Á®çÂêéËØ¥Êòé
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">delayedExecute</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">t</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>scheduleAtFixedRate</code>Ëøô‰∏™ÊñπÊ≥ïÂíå<code>schedule</code>Á±ª‰ººÔºå‰∏çÂêåÁÇπÊòØ<code>scheduleAtFixedRate</code>ÊñπÊ≥ïÂÜÖÈÉ®ÂàõÂª∫ÁöÑÊòØ<code>ScheduledFutureTask</code>ÔºåÂ∏¶ÊúâÂàùÂßãÂª∂Êó∂ÂíåÂõ∫ÂÆöÂë®ÊúüÁöÑ‰ªªÂä° „ÄÇ</p>
<h4 id="scheduledatfixeddelay">scheduledAtFixedDelay</h4>
<p><code>FixedDelay</code>‰πüÊòØÈÄöËøá<code>ScheduledFutureTask</code>‰ΩìÁé∞ÁöÑÔºåÂîØ‰∏Ä‰∏çÂêåÁöÑÂú∞ÊñπÂú®‰∫éÂàõÂª∫ÁöÑ<code>ScheduledFutureTask</code>‰∏çÂêå „ÄÇËøôÈáå‰∏çÂÜçÂ±ïÁ§∫Ê∫êÁ†Å„ÄÇ</p>
<h4 id="delayedexecute">delayedExecute</h4>
<p>ÂâçÈù¢ËÆ≤Âà∞ÁöÑ<code>schedule</code>„ÄÅ<code>scheduleAtFixedRate</code>Âíå<code>scheduleAtFixedDelay</code>ÊúÄÂêéÈÉΩË∞ÉÁî®‰∫Ü<code>delayedExecute</code>ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÊòØÂÆöÊó∂‰ªªÂä°ÊâßË°åÁöÑ‰∏ªË¶ÅÊñπÊ≥ï„ÄÇ ‰∏ÄËµ∑Êù•ÁúãÁúãÊ∫êÁ†ÅÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">delayedExecute</span><span class="o">(</span><span class="n">RunnableScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Á∫øÁ®ãÊ±†Â∑≤ÁªèÂÖ≥Èó≠ÔºåË∞ÉÁî®ÊãíÁªùÊâßË°åÂ§ÑÁêÜÂô®Â§ÑÁêÜ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">isShutdown</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">      <span class="n">reject</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Â∞Ü‰ªªÂä°Âä†ÂÖ•Âà∞Á≠âÂæÖÈòüÂàó
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">super</span><span class="o">.</span><span class="na">getQueue</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Á∫øÁ®ãÊ±†Â∑≤ÁªèÂÖ≥Èó≠Ôºå‰∏îÂΩìÂâçÁä∂ÊÄÅ‰∏çËÉΩËøêË°åËØ•‰ªªÂä°ÔºåÂ∞ÜËØ•‰ªªÂä°‰ªéÁ≠âÂæÖÈòüÂàóÁßªÈô§Âπ∂ÂèñÊ∂àËØ•‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="o">(</span><span class="n">isShutdown</span><span class="o">()</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">          <span class="o">!</span><span class="n">canRunInCurrentRunState</span><span class="o">(</span><span class="n">task</span><span class="o">.</span><span class="na">isPeriodic</span><span class="o">())</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">          <span class="n">remove</span><span class="o">(</span><span class="n">task</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">task</span><span class="o">.</span><span class="na">cancel</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Â¢ûÂä†‰∏Ä‰∏™workerÔºåÂ∞±ÁÆócorePoolSize=0‰πüË¶ÅÂ¢ûÂä†‰∏Ä‰∏™worker
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ensurePrestart</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>delayedExecute</code>ÊñπÊ≥ïÁöÑÈÄªËæë‰πüÂæàÁÆÄÂçïÔºå‰∏ªË¶ÅÂ∞±ÊòØÂ∞Ü‰ªªÂä°Ê∑ªÂä†Âà∞Á≠âÂæÖÈòüÂàóÔºåÁÑ∂ÂêéË∞ÉÁî®<code>ensurePrestart</code>ÊñπÊ≥ï„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">ensurePrestart</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">wc</span> <span class="o">=</span> <span class="n">workerCountOf</span><span class="o">(</span><span class="n">ctl</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">wc</span> <span class="o">&lt;</span> <span class="n">corePoolSize</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">addWorker</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">wc</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">addWorker</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>ensurePrestart</code>ÊñπÊ≥ï‰∏ªË¶ÅÊòØË∞ÉÁî®‰∫Ü<code>addWorker</code>ÔºåÁ∫øÁ®ãÊ±†‰∏≠ÁöÑÂ∑•‰ΩúÁ∫øÁ®ãÊòØÈÄöËøáËØ•ÊñπÊ≥ïÊù•ÂêØÂä®Âπ∂ÊâßË°å‰ªªÂä°ÁöÑ„ÄÇ ÂÖ∑‰ΩìÂèØ‰ª•Êü•ÁúãÂâçÈù¢ËÆ≤ÁöÑÁ∫øÁ®ãÊ±†Á´†ËäÇ„ÄÇ</p>
<p>ÂØπ‰∫é<code>ScheduledThreadPoolExecutor</code>Ôºå<code>worker</code>Ê∑ªÂä†Âà∞Á∫øÁ®ãÊ±†Âêé‰ºöÂú®Á≠âÂæÖÈòüÂàó‰∏äÁ≠âÂæÖËé∑Âèñ‰ªªÂä°ÔºåËøôÁÇπÊòØÂíå<code>ThreadPoolExecutor</code>‰∏ÄËá¥ÁöÑ„ÄÇ<strong>‰ΩÜÊòØworkerÊòØÊÄé‰πà‰ªéÁ≠âÂæÖÈòüÂàóÂèñÂÆöÊó∂‰ªªÂä°ÁöÑÔºü</strong></p>
<p>Âõ†‰∏∫<code>ScheduledThreadPoolExecutor</code>‰ΩøÁî®‰∫Ü<code>DelayedWorkQueue</code>‰øùÂ≠òÁ≠âÂæÖÁöÑ‰ªªÂä°ÔºåËØ•Á≠âÂæÖÈòüÂàóÈòüÈ¶ñÂ∫îËØ•‰øùÂ≠òÁöÑÊòØÊúÄËøëÂ∞ÜË¶ÅÊâßË°åÁöÑ‰ªªÂä°ÔºåÂ¶ÇÊûúÈòüÈ¶ñ‰ªªÂä°ÁöÑÂºÄÂßãÊâßË°åÊó∂Èó¥ËøòÊú™Âà∞Ôºå<code>worker</code>‰πüÂ∫îËØ•ÁªßÁª≠Á≠âÂæÖ„ÄÇ</p>
<h3 id="delayedworkqueue">DelayedWorkQueue</h3>
<p><code>ScheduledThreadPoolExecutor</code>‰ΩøÁî®‰∫Ü<code>DelayedWorkQueue</code>‰øùÂ≠òÁ≠âÂæÖÁöÑ‰ªªÂä°„ÄÇ</p>
<p>ËØ•Á≠âÂæÖÈòüÂàóÈòüÈ¶ñÂ∫îËØ•‰øùÂ≠òÁöÑÊòØ<strong>ÊúÄËøëÂ∞ÜË¶ÅÊâßË°åÁöÑ‰ªªÂä°</strong>ÔºåÊâÄ‰ª•<code>worker</code>Âè™ÂÖ≥ÂøÉÈòüÈ¶ñ‰ªªÂä°Âç≥ÂèØÔºåÂ¶ÇÊûúÈòüÈ¶ñ‰ªªÂä°ÁöÑÂºÄÂßãÊâßË°åÊó∂Èó¥ËøòÊú™Âà∞Ôºåworker‰πüÂ∫îËØ•ÁªßÁª≠Á≠âÂæÖ„ÄÇ</p>
<p>DelayedWorkQueueÊòØ‰∏Ä‰∏™Êó†Áïå‰ºòÂÖàÈòüÂàóÔºå‰ΩøÁî®Êï∞ÁªÑÂ≠òÂÇ®ÔºåÂ∫ïÂ±ÇÊòØ‰ΩøÁî®Â†ÜÁªìÊûÑÊù•ÂÆûÁé∞‰ºòÂÖàÈòüÂàóÁöÑÂäüËÉΩ„ÄÇÊàë‰ª¨ÂÖàÁúãÁúãDelayedWorkQueueÁöÑÂ£∞ÊòéÂíåÊàêÂëòÂèòÈáèÔºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">static</span> <span class="kd">class</span> <span class="nc">DelayedWorkQueue</span> <span class="kd">extends</span> <span class="n">AbstractQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">implements</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÈòüÂàóÂàùÂßãÂÆπÈáè
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">INITIAL_CAPACITY</span> <span class="o">=</span> <span class="n">16</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Êï∞ÁªÑÁî®Êù•Â≠òÂÇ®ÂÆöÊó∂‰ªªÂä°ÔºåÈÄöËøáÊï∞ÁªÑÂÆûÁé∞Â†ÜÊéíÂ∫è
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">RunnableScheduledFuture</span><span class="o">[]</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RunnableScheduledFuture</span><span class="o">[</span><span class="n">INITIAL_CAPACITY</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂΩìÂâçÂú®ÈòüÈ¶ñÁ≠âÂæÖÁöÑÁ∫øÁ®ã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">Thread</span> <span class="n">leader</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÈîÅÂíåÁõëËßÜÂô®ÔºåÁî®‰∫éleaderÁ∫øÁ®ã
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReentrantLock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Condition</span> <span class="n">available</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ÂÖ∂‰ªñ‰ª£Á†ÅÔºåÁï•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂΩì‰∏Ä‰∏™Á∫øÁ®ãÊàê‰∏∫leaderÔºåÂÆÉÂè™Ë¶ÅÁ≠âÂæÖÈòüÈ¶ñ‰ªªÂä°ÁöÑdelayÊó∂Èó¥Âç≥ÂèØÔºåÂÖ∂‰ªñÁ∫øÁ®ã‰ºöÊó†Êù°‰ª∂Á≠âÂæÖ„ÄÇleaderÂèñÂà∞‰ªªÂä°ËøîÂõûÂâçË¶ÅÈÄöÁü•ÂÖ∂‰ªñÁ∫øÁ®ãÔºåÁõ¥Âà∞ÊúâÁ∫øÁ®ãÊàê‰∏∫Êñ∞ÁöÑleader„ÄÇÊØèÂΩìÈòüÈ¶ñÁöÑÂÆöÊó∂‰ªªÂä°Ë¢´ÂÖ∂‰ªñÊõ¥Êó©ÈúÄË¶ÅÊâßË°åÁöÑ‰ªªÂä°ÊõøÊç¢Êó∂ÔºåleaderËÆæÁΩÆ‰∏∫nullÔºåÂÖ∂‰ªñÁ≠âÂæÖÁöÑÁ∫øÁ®ãÔºàË¢´ÂΩìÂâçleaderÈÄöÁü•ÔºâÂíåÂΩìÂâçÁöÑleaderÈáçÊñ∞Á´û‰∫âÊàê‰∏∫leader„ÄÇ</p>
<p>ÂêåÊó∂ÔºåÂÆö‰πâ‰∫ÜÈîÅlockÂíåÁõëËßÜÂô®availableÁî®‰∫éÁ∫øÁ®ãÁ´û‰∫âÊàê‰∏∫leader„ÄÇ</p>
<p>ÂΩì‰∏Ä‰∏™Êñ∞ÁöÑ‰ªªÂä°Êàê‰∏∫ÈòüÈ¶ñÔºåÊàñËÄÖÈúÄË¶ÅÊúâÊñ∞ÁöÑÁ∫øÁ®ãÊàê‰∏∫leaderÊó∂ÔºåavailableÁõëËßÜÂô®‰∏äÁöÑÁ∫øÁ®ãÂ∞Ü‰ºöË¢´ÈÄöÁü•ÔºåÁÑ∂ÂêéÁ´û‰∫âÊàê‰∏∫leaderÁ∫øÁ®ã„ÄÇ Êúâ‰∫õÁ±ª‰ºº‰∫éÁîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖÊ®°Âºè„ÄÇ</p>
<p>Êé•‰∏ãÊù•ÁúãÁúã<code>DelayedWorkQueue</code>‰∏≠Âá†‰∏™ÊØîËæÉÈáçË¶ÅÁöÑÊñπÊ≥ï</p>
<h4 id="take">take</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">RunnableScheduledFuture</span> <span class="nf">take</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lock</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">lock</span><span class="o">.</span><span class="na">lockInterruptibly</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="o">(;;)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ÂèñÂ†ÜÈ°∂ÁöÑ‰ªªÂä°ÔºåÂ†ÜÈ°∂ÊòØÊúÄËøëË¶ÅÊâßË°åÁöÑ‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">RunnableScheduledFuture</span> <span class="n">first</span> <span class="o">=</span> <span class="n">queue</span><span class="o">[</span><span class="n">0</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Â†ÜÈ°∂‰∏∫Á©∫ÔºåÁ∫øÁ®ãË¶ÅÂú®Êù°‰ª∂available‰∏äÁ≠âÂæÖ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">first</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="n">available</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// Â†ÜÈ°∂‰ªªÂä°ËøòË¶ÅÂ§öÈïøÊó∂Èó¥ÊâçËÉΩÊâßË°å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="kt">long</span> <span class="n">delay</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="na">getDelay</span><span class="o">(</span><span class="n">TimeUnit</span><span class="o">.</span><span class="na">NANOSECONDS</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// Â†ÜÈ°∂‰ªªÂä°Â∑≤ÁªèÂèØ‰ª•ÊâßË°å‰∫ÜÔºåfinishPoll‰ºöÈáçÊñ∞Ë∞ÉÊï¥Â†ÜÔºå‰ΩøÂÖ∂Êª°Ë∂≥ÊúÄÂ∞èÂ†ÜÁâπÊÄßÔºåËØ•ÊñπÊ≥ïËÆæÁΩÆ‰ªªÂä°Âú®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="c1">// Â†Ü‰∏≠ÁöÑindex‰∏∫-1Âπ∂ËøîÂõûËØ•‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">if</span> <span class="o">(</span><span class="n">delay</span> <span class="o">&lt;=</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">finishPoll</span><span class="o">(</span><span class="n">first</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// Â¶ÇÊûúleader‰∏ç‰∏∫Á©∫ÔºåËØ¥ÊòéÂ∑≤ÁªèÊúâÁ∫øÁ®ãÊàê‰∏∫leaderÂπ∂Á≠âÂæÖÂ†ÜÈ°∂‰ªªÂä°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="c1">// Âà∞ËææÊâßË°åÊó∂Èó¥ÔºåÊ≠§Êó∂ÔºåÂÖ∂‰ªñÁ∫øÁ®ãÈÉΩÈúÄË¶ÅÂú®availableÊù°‰ª∂‰∏äÁ≠âÂæÖ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">leader</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">available</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">          <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// leader‰∏∫Á©∫ÔºåÂΩìÂâçÁ∫øÁ®ãÊàê‰∏∫Êñ∞ÁöÑleader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Thread</span> <span class="n">thisThread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">leader</span> <span class="o">=</span> <span class="n">thisThread</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1">// ÂΩìÂâçÁ∫øÁ®ãÂ∑≤ÁªèÊàê‰∏∫leader‰∫ÜÔºåÂè™ÈúÄË¶ÅÁ≠âÂæÖÂ†ÜÈ°∂‰ªªÂä°Âà∞ËææÊâßË°åÊó∂Èó¥Âç≥ÂèØ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="n">available</span><span class="o">.</span><span class="na">awaitNanos</span><span class="o">(</span><span class="n">delay</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1">// ËøîÂõûÂ†ÜÈ°∂ÂÖÉÁ¥†‰πãÂâçÂ∞ÜleaderËÆæÁΩÆ‰∏∫Á©∫
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="k">if</span> <span class="o">(</span><span class="n">leader</span> <span class="o">==</span> <span class="n">thisThread</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">leader</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">          <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ÈÄöÁü•ÂÖ∂‰ªñÂú®availableÊù°‰ª∂Á≠âÂæÖÁöÑÁ∫øÁ®ãÔºåËøô‰∫õÁ∫øÁ®ãÂèØ‰ª•ÂéªÁ´û‰∫âÊàê‰∏∫Êñ∞ÁöÑleader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="o">(</span><span class="n">leader</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">queue</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">available</span><span class="o">.</span><span class="na">signal</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>take</code>ÊñπÊ≥ïÊòØ‰ªÄ‰πàÊó∂ÂÄôË∞ÉÁî®ÁöÑÂë¢ÔºüÂú®Á∫øÁ®ãÊ±†ÁöÑÁ´†ËäÇ‰∏≠Ôºå‰ªãÁªç‰∫Ü<code>getTask</code>ÊñπÊ≥ïÔºåÂ∑•‰ΩúÁ∫øÁ®ã‰ºöÂæ™ÁéØÂú∞‰ªé<code>workQueue</code>‰∏≠Âèñ‰ªªÂä°„ÄÇ‰ΩÜËÆ°Âàí‰ªªÂä°Âç¥‰∏çÂêåÔºåÂõ†‰∏∫Â¶ÇÊûú‰∏ÄÊó¶<code>getTask</code>ÊñπÊ≥ïÂèñÂá∫‰∫Ü‰ªªÂä°Â∞±ÂºÄÂßãÊâßË°å‰∫ÜÔºåËÄåËøôÊó∂ÂèØËÉΩËøòÊ≤°ÊúâÂà∞ÊâßË°åÁöÑÊó∂Èó¥ÔºåÊâÄ‰ª•Âú®<code>take</code>ÊñπÊ≥ï‰∏≠ÔºåË¶Å‰øùËØÅÂè™ÊúâÂú®Âà∞ÊåáÂÆöÁöÑÊâßË°åÊó∂Èó¥ÁöÑÊó∂ÂÄô‰ªªÂä°ÊâçÂèØ‰ª•Ë¢´ÂèñËµ∞„ÄÇ</p>
<p>ÊÄªÁªì‰∏Ä‰∏ãÊµÅÁ®ãÔºö</p>
<ol>
<li>Â¶ÇÊûúÂ†ÜÈ°∂ÂÖÉÁ¥†‰∏∫Á©∫ÔºåÂú®availableÊù°‰ª∂‰∏äÁ≠âÂæÖ„ÄÇ</li>
<li>Â¶ÇÊûúÂ†ÜÈ°∂‰ªªÂä°ÁöÑÊâßË°åÊó∂Èó¥Â∑≤Âà∞ÔºåÂ∞ÜÂ†ÜÈ°∂ÂÖÉÁ¥†ÊõøÊç¢‰∏∫Â†ÜÁöÑÊúÄÂêé‰∏Ä‰∏™ÂÖÉÁ¥†Âπ∂Ë∞ÉÊï¥Â†Ü‰ΩøÂÖ∂Êª°Ë∂≥<strong>ÊúÄÂ∞èÂ†Ü</strong>ÁâπÊÄßÔºåÂêåÊó∂ËÆæÁΩÆ‰ªªÂä°Âú®Â†Ü‰∏≠Á¥¢Âºï‰∏∫-1ÔºåËøîÂõûËØ•‰ªªÂä°„ÄÇ</li>
<li>Â¶ÇÊûúleader‰∏ç‰∏∫Á©∫ÔºåËØ¥ÊòéÂ∑≤ÁªèÊúâÁ∫øÁ®ãÊàê‰∏∫leader‰∫ÜÔºåÂÖ∂‰ªñÁ∫øÁ®ãÈÉΩË¶ÅÂú®availableÁõëËßÜÂô®‰∏äÁ≠âÂæÖ„ÄÇ</li>
<li>Â¶ÇÊûúleader‰∏∫Á©∫ÔºåÂΩìÂâçÁ∫øÁ®ãÊàê‰∏∫Êñ∞ÁöÑleaderÔºåÂπ∂Á≠âÂæÖÁõ¥Âà∞Â†ÜÈ°∂‰ªªÂä°ÊâßË°åÊó∂Èó¥Âà∞Ëææ„ÄÇ</li>
<li>takeÊñπÊ≥ïËøîÂõû‰πãÂâçÔºåÂ∞ÜleaderËÆæÁΩÆ‰∏∫Á©∫ÔºåÂπ∂ÈÄöÁü•ÂÖ∂‰ªñÁ∫øÁ®ã„ÄÇ</li>
</ol>
<p>ÂÜçÊù•ËØ¥‰∏Ä‰∏ãleaderÁöÑ‰ΩúÁî®ÔºåËøôÈáåÁöÑleaderÊòØ<strong>‰∏∫‰∫ÜÂáèÂ∞ë‰∏çÂøÖË¶ÅÁöÑÂÆöÊó∂Á≠âÂæÖ</strong>ÔºåÂΩì‰∏Ä‰∏™Á∫øÁ®ãÊàê‰∏∫leaderÊó∂ÔºåÂÆÉÂè™Á≠âÂæÖ‰∏ã‰∏Ä‰∏™ËäÇÁÇπÁöÑÊó∂Èó¥Èó¥ÈöîÔºå‰ΩÜÂÖ∂ÂÆÉÁ∫øÁ®ãÊó†ÈôêÊúüÁ≠âÂæÖ„ÄÇ leaderÁ∫øÁ®ãÂøÖÈ°ªÂú®‰ªé<code>take()</code>Êàñ<code>poll()</code>ËøîÂõû‰πãÂâçsignalÂÖ∂ÂÆÉÁ∫øÁ®ãÔºåÈô§ÈùûÂÖ∂‰ªñÁ∫øÁ®ãÊàê‰∏∫‰∫Üleader„ÄÇ</p>
<p>‰∏æ‰æãÊù•ËØ¥ÔºåÂ¶ÇÊûúÊ≤°ÊúâleaderÔºåÈÇ£‰πàÂú®ÊâßË°åtakeÊó∂ÔºåÈÉΩË¶ÅÊâßË°å<code>available.awaitNanos(delay)</code>ÔºåÂÅáËÆæÂΩìÂâçÁ∫øÁ®ãÊâßË°å‰∫ÜËØ•ÊÆµ‰ª£Á†ÅÔºåËøôÊó∂ËøòÊ≤°ÊúâsignalÔºåÁ¨¨‰∫å‰∏™Á∫øÁ®ã‰πüÊâßË°å‰∫ÜËØ•ÊÆµ‰ª£Á†ÅÔºåÂàôÁ¨¨‰∫å‰∏™Á∫øÁ®ã‰πüË¶ÅË¢´ÈòªÂ°û„ÄÇ‰ΩÜÂè™Êúâ‰∏Ä‰∏™Á∫øÁ®ãËøîÂõûÈòüÈ¶ñ‰ªªÂä°ÔºåÂÖ∂‰ªñÁöÑÁ∫øÁ®ãÂú®<code>awaitNanos(delay)</code>‰πãÂêéÔºåÁªßÁª≠ÊâßË°åforÂæ™ÁéØÔºåÂõ†‰∏∫ÈòüÈ¶ñ‰ªªÂä°Â∑≤ÁªèË¢´ËøîÂõû‰∫ÜÔºåÊâÄ‰ª•Ëøô‰∏™Êó∂ÂÄôÁöÑforÂæ™ÁéØÊãøÂà∞ÁöÑÈòüÈ¶ñ‰ªªÂä°ÊòØÊñ∞ÁöÑÔºåÂèàÈúÄË¶ÅÈáçÊñ∞Âà§Êñ≠Êó∂Èó¥ÔºåÂèàË¶ÅÁªßÁª≠ÈòªÂ°û„ÄÇ</p>
<p>ÊâÄ‰ª•Ôºå‰∏∫‰∫Ü‰∏çËÆ©Â§ö‰∏™Á∫øÁ®ãÈ¢ëÁπÅÁöÑÂÅöÊó†Áî®ÁöÑÂÆöÊó∂Á≠âÂæÖÔºåËøôÈáåÂ¢ûÂä†‰∫ÜleaderÔºåÂ¶ÇÊûúleader‰∏ç‰∏∫Á©∫ÔºåÂàôËØ¥ÊòéÈòüÂàó‰∏≠Á¨¨‰∏Ä‰∏™ËäÇÁÇπÂ∑≤ÁªèÂú®Á≠âÂæÖÂá∫ÈòüÔºåËøôÊó∂ÂÖ∂ÂÆÉÁöÑÁ∫øÁ®ã‰ºö‰∏ÄÁõ¥ÈòªÂ°ûÔºåÂáèÂ∞ë‰∫ÜÊó†Áî®ÁöÑÈòªÂ°ûÔºàÊ≥®ÊÑèÔºåÂú®<code>finally</code>‰∏≠Ë∞ÉÁî®‰∫Ü<code>signal()</code>Êù•Âî§ÈÜí‰∏Ä‰∏™Á∫øÁ®ãÔºåËÄå‰∏çÊòØ<code>signalAll()</code>Ôºâ„ÄÇ</p>
<h4 id="offer">offer</h4>
<p>ËØ•ÊñπÊ≥ïÂæÄÈòüÂàóÊèíÂÖ•‰∏Ä‰∏™ÂÄºÔºåËøîÂõûÊòØÂê¶ÊàêÂäüÊèíÂÖ• „ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">offer</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="n">NullPointerException</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">RunnableScheduledFuture</span> <span class="n">e</span> <span class="o">=</span> <span class="o">(</span><span class="n">RunnableScheduledFuture</span><span class="o">)</span><span class="n">x</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">final</span> <span class="n">ReentrantLock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lock</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ÈòüÂàóÂÖÉÁ¥†Â∑≤ÁªèÂ§ß‰∫éÁ≠â‰∫éÊï∞ÁªÑÁöÑÈïøÂ∫¶ÔºåÈúÄË¶ÅÊâ©ÂÆπÔºåÊñ∞Â†ÜÁöÑÂÆπÈáèÊòØÂéüÊù•Â†ÜÂÆπÈáèÁöÑ1.5ÂÄç
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">queue</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">grow</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Â†Ü‰∏≠ÂÖÉÁ¥†Â¢ûÂä†1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">size</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Ë∞ÉÊï¥Â†Ü
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">queue</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">setIndex</span><span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// Ë∞ÉÊï¥Â†ÜÔºå‰ΩøÁöÑÊª°Ë∂≥ÊúÄÂ∞èÂ†ÜÔºåÊØîËæÉÂ§ßÂ∞èÁöÑÊñπÂºèÂ∞±ÊòØ‰∏äÊñáÊèêÂà∞ÁöÑcompareToÊñπÊ≥ï
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">siftUp</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="o">(</span><span class="n">queue</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">==</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">leader</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ÈÄöÁü•ÂÖ∂‰ªñÂú®availableÊù°‰ª∂‰∏äÁ≠âÂæÖÁöÑÁ∫øÁ®ãÔºåËøô‰∫õÁ∫øÁ®ãÂèØ‰ª•Á´û‰∫âÊàê‰∏∫Êñ∞ÁöÑleader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">available</span><span class="o">.</span><span class="na">signal</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Âú®Â†Ü‰∏≠ÊèíÂÖ•‰∫Ü‰∏Ä‰∏™ËäÇÁÇπÔºåËøô‰∏™Êó∂ÂÄôÂ†ÜÊúâÂèØËÉΩ‰∏çÊª°Ë∂≥ÊúÄÂ∞èÂ†ÜÁöÑÂÆö‰πâÔºå<code>siftUp</code>Áî®‰∫éÂ∞ÜÂ†ÜË∞ÉÊï¥‰∏∫ÊúÄÂ∞èÂ†ÜÔºåËøôÂ±û‰∫éÊï∞ÊçÆÁªìÊûÑÁöÑÂü∫Êú¨ÂÜÖÂÆπÔºåÊú¨Êñá‰∏çÂÅö‰ªãÁªç„ÄÇ</p>
<h3 id="ÊÄªÁªì">ÊÄªÁªì</h3>
<p>ÂÜÖÈÉ®‰ΩøÁî®‰ºòÂåñÁöÑDelayQueueÊù•ÂÆûÁé∞ÔºåÁî±‰∫é‰ΩøÁî®ÈòüÂàóÊù•ÂÆûÁé∞ÂÆöÊó∂Âô®ÔºåÊúâÂá∫ÂÖ•ÈòüË∞ÉÊï¥Â†ÜÁ≠âÊìç‰ΩúÔºåÊâÄ‰ª•ÂÆöÊó∂Âπ∂‰∏çÊòØÈùûÂ∏∏ÈùûÂ∏∏Á≤æÁ°Æ„ÄÇ</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E5%B9%B6%E5%8F%91/">Âπ∂Âèë</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            ÊúÄÂêéÊõ¥Êñ∞‰∫é 2022Âπ¥3Êúà18Êó• 08:28 UTC
        </span>
    </section></footer>


    
</article>

    

    

<aside class="related-contents--wrapper">
    <h2 class="section-title">Áõ∏ÂÖ≥ÊñáÁ´†</h2>
    <div class="related-contents">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/posts/java%E5%B9%B6%E5%8F%91-%E5%8E%9F%E7%90%86%E7%AF%87/">
        
        
            <div class="article-image">
                
                    <img src="/13.jpg" loading="lazy" data-key="" data-hash="/13.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">JavaÂπ∂Âèë ÂéüÁêÜÁØá</h2>
        </div>
    </a>
</article>
            
                
<article class="has-image">
    <a href="/posts/java%E5%B9%B6%E5%8F%91-%E5%9F%BA%E7%A1%80%E7%AF%87/">
        
        
            <div class="article-image">
                
                    <img src="/12.jpg" loading="lazy" data-key="" data-hash="/12.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">JavaÂπ∂Âèë Âü∫Á°ÄÁØá</h2>
        </div>
    </a>
</article>
            
                
<article class="has-image">
    <a href="/posts/jvm-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/">
        
        
            <div class="article-image">
                
                    <img src="/17.jpg" loading="lazy" data-key="" data-hash="/17.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">JVM Â∫ïÂ±ÇÂéüÁêÜÁü•ËØÜÊÄªÁªì</h2>
        </div>
    </a>
</article>
            
                
<article class="has-image">
    <a href="/posts/concurrenthashmap%E6%BA%90%E7%A0%81-%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/">
        
        
            <div class="article-image">
                
                    <img src="/7.jpg" loading="lazy" data-key="" data-hash="/7.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">ConcurrentHashMapÊ∫êÁ†Å&#43;Â∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÂàÜÊûê</h2>
        </div>
    </a>
</article>
            
                
<article class="has-image">
    <a href="/posts/hashmap%E6%BA%90%E7%A0%81-%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/">
        
        
            <div class="article-image">
                
                    <img src="/9.jpg" loading="lazy" data-key="" data-hash="/9.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">HashMapÊ∫êÁ†Å&#43;Â∫ïÂ±ÇÊï∞ÊçÆÁªìÊûÑÂàÜÊûê</h2>
        </div>
    </a>
</article>
            
        </div>
    </div>
</aside>

     
    
        
    <script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
    .waline-container .vcount {
        color: var(--card-text-color-main);
    }
</style><script>
    
    new Waline({"dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/bilibili","https://cdn.jsdelivr.net/gh/walinejs/emojis/qq","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tieba","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/weibo","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/tw-emoji","https://cdn.jsdelivr.net/gh/walinejs/emojis@1.0.0/alus"],"lang":"zh-CN","locale":{"admin":"Admin"},"requiredMeta":["name","email","url"],"serverURL":"https://blog-api-2w7xkqg6y-ahaomin.vercel.app/","visitor":true});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 ahao&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.10.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#Á∫øÁ®ãÊ±†ÂéüÁêÜ">Á∫øÁ®ãÊ±†ÂéüÁêÜ</a>
      <ol>
        <li><a href="#‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®Á∫øÁ®ãÊ±†">‰∏∫‰ªÄ‰πàË¶Å‰ΩøÁî®Á∫øÁ®ãÊ±†</a></li>
        <li><a href="#Á∫øÁ®ãÊ±†ÁöÑÂéüÁêÜ">Á∫øÁ®ãÊ±†ÁöÑÂéüÁêÜ</a>
          <ol>
            <li><a href="#threadpoolexecutorÊèê‰æõÁöÑÊûÑÈÄ†ÊñπÊ≥ï">ThreadPoolExecutorÊèê‰æõÁöÑÊûÑÈÄ†ÊñπÊ≥ï</a></li>
            <li><a href="#threadpoolexecutorÁöÑÁ≠ñÁï•">ThreadPoolExecutorÁöÑÁ≠ñÁï•</a></li>
            <li><a href="#Á∫øÁ®ãÊ±†‰∏ªË¶ÅÁöÑ‰ªªÂä°Â§ÑÁêÜÊµÅÁ®ã">Á∫øÁ®ãÊ±†‰∏ªË¶ÅÁöÑ‰ªªÂä°Â§ÑÁêÜÊµÅÁ®ã</a></li>
            <li><a href="#threadpoolexecutorÂ¶Ç‰ΩïÂÅöÂà∞Á∫øÁ®ãÂ§çÁî®ÁöÑ">ThreadPoolExecutorÂ¶Ç‰ΩïÂÅöÂà∞Á∫øÁ®ãÂ§çÁî®ÁöÑÔºü</a></li>
          </ol>
        </li>
        <li><a href="#ÂõõÁßçÂ∏∏ËßÅÁöÑÁ∫øÁ®ãÊ±†">ÂõõÁßçÂ∏∏ËßÅÁöÑÁ∫øÁ®ãÊ±†</a>
          <ol>
            <li><a href="#newcachedthreadpool">newCachedThreadPool</a></li>
            <li><a href="#newfixedthreadpool">newFixedThreadPool</a></li>
            <li><a href="#newsinglethreadexecutor">newSingleThreadExecutor</a></li>
            <li><a href="#newscheduledthreadpool">newScheduledThreadPool</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#ÈòªÂ°ûÈòüÂàó">ÈòªÂ°ûÈòüÂàó</a>
      <ol>
        <li><a href="#ÈòªÂ°ûÈòüÂàóÁöÑÁî±Êù•">ÈòªÂ°ûÈòüÂàóÁöÑÁî±Êù•</a></li>
        <li><a href="#blockingqueueÁöÑÊìç‰ΩúÊñπÊ≥ï">BlockingQueueÁöÑÊìç‰ΩúÊñπÊ≥ï</a></li>
        <li><a href="#blockingqueueÁöÑÂÆûÁé∞Á±ª">BlockingQueueÁöÑÂÆûÁé∞Á±ª</a>
          <ol>
            <li><a href="#arrayblockingqueue"><strong>ArrayBlockingQueue</strong></a></li>
            <li><a href="#linkedblockingqueue"><strong>LinkedBlockingQueue</strong></a></li>
            <li><a href="#delayqueue"><strong>DelayQueue</strong></a></li>
            <li><a href="#priorityblockingqueue"><strong>PriorityBlockingQueue</strong></a></li>
            <li><a href="#synchronousqueue"><strong>SynchronousQueue</strong></a></li>
          </ol>
        </li>
        <li><a href="#ÈòªÂ°ûÈòüÂàóÁöÑÂéüÁêÜ">ÈòªÂ°ûÈòüÂàóÁöÑÂéüÁêÜ</a></li>
        <li><a href="#Á§∫‰æãÂíå‰ΩøÁî®Âú∫ÊôØ">Á§∫‰æãÂíå‰ΩøÁî®Âú∫ÊôØ</a>
          <ol>
            <li><a href="#Áîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖÊ®°Âûã">Áîü‰∫ßËÄÖ-Ê∂àË¥πËÄÖÊ®°Âûã</a></li>
            <li><a href="#Á∫øÁ®ãÊ±†‰∏≠‰ΩøÁî®ÈòªÂ°ûÈòüÂàó">Á∫øÁ®ãÊ±†‰∏≠‰ΩøÁî®ÈòªÂ°ûÈòüÂàó</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#ÈîÅÊé•Âè£ÂíåÁ±ª">ÈîÅÊé•Âè£ÂíåÁ±ª</a>
      <ol>
        <li><a href="#synchronizedÁöÑ‰∏çË∂≥‰πãÂ§Ñ">synchronizedÁöÑ‰∏çË∂≥‰πãÂ§Ñ</a></li>
        <li><a href="#ÈîÅÁöÑÂá†ÁßçÂàÜÁ±ª">ÈîÅÁöÑÂá†ÁßçÂàÜÁ±ª</a>
          <ol>
            <li><a href="#ÂèØÈáçÂÖ•ÈîÅÂíåÈùûÂèØÈáçÂÖ•ÈîÅ">ÂèØÈáçÂÖ•ÈîÅÂíåÈùûÂèØÈáçÂÖ•ÈîÅ</a></li>
            <li><a href="#ÂÖ¨Âπ≥ÈîÅ‰∏éÈùûÂÖ¨Âπ≥ÈîÅ">ÂÖ¨Âπ≥ÈîÅ‰∏éÈùûÂÖ¨Âπ≥ÈîÅ</a></li>
            <li><a href="#ËØªÂÜôÈîÅÂíåÊéíÂÆÉÈîÅ">ËØªÂÜôÈîÅÂíåÊéíÂÆÉÈîÅ</a></li>
          </ol>
        </li>
        <li><a href="#jdk‰∏≠ÊúâÂÖ≥ÈîÅÁöÑ‰∏Ä‰∫õÊé•Âè£ÂíåÁ±ª">JDK‰∏≠ÊúâÂÖ≥ÈîÅÁöÑ‰∏Ä‰∫õÊé•Âè£ÂíåÁ±ª</a>
          <ol>
            <li><a href="#ÊäΩË±°Á±ªaqsaqlsaos">ÊäΩË±°Á±ªAQS/AQLS/AOS</a></li>
            <li><a href="#Êé•Âè£conditionlockreadwritelock">Êé•Âè£Condition/Lock/ReadWriteLock</a></li>
            <li><a href="#reentrantlock">ReentrantLock</a></li>
            <li><a href="#reentrantreadwritelock">ReentrantReadWriteLock</a></li>
            <li><a href="#stampedlock">StampedLock</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#Âπ∂ÂèëÂÆπÂô®ÈõÜÂêà">Âπ∂ÂèëÂÆπÂô®ÈõÜÂêà</a>
      <ol>
        <li><a href="#ÂêåÊ≠•ÂÆπÂô®‰∏éÂπ∂ÂèëÂÆπÂô®">ÂêåÊ≠•ÂÆπÂô®‰∏éÂπ∂ÂèëÂÆπÂô®</a></li>
        <li><a href="#Âπ∂ÂèëÂÆπÂô®Á±ª‰ªãÁªç">Âπ∂ÂèëÂÆπÂô®Á±ª‰ªãÁªç</a>
          <ol>
            <li><a href="#Âπ∂Âèëmap">Âπ∂ÂèëMap</a></li>
            <li><a href="#Âπ∂Âèëqueue">Âπ∂ÂèëQueue</a></li>
            <li><a href="#Âπ∂Âèëset">Âπ∂ÂèëSet</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#copyonwriteÂÆπÂô®">CopyOnWriteÂÆπÂô®</a>
      <ol>
        <li><a href="#‰ªÄ‰πàÊòØcopyonwriteÂÆπÂô®">‰ªÄ‰πàÊòØCopyOnWriteÂÆπÂô®</a></li>
        <li><a href="#copyonwritearraylist">CopyOnWriteArrayList</a></li>
        <li><a href="#copyonwriteÁöÑ‰∏öÂä°‰∏≠ÂÆûÁé∞">CopyOnWriteÁöÑ‰∏öÂä°‰∏≠ÂÆûÁé∞</a></li>
      </ol>
    </li>
    <li><a href="#ÈÄö‰ø°Â∑•ÂÖ∑Á±ª">ÈÄö‰ø°Â∑•ÂÖ∑Á±ª</a>
      <ol>
        <li><a href="#semaphore">Semaphore</a>
          <ol>
            <li><a href="#semaphore‰ªãÁªç">Semaphore‰ªãÁªç</a></li>
            <li><a href="#semaphoreÊ°à‰æã">SemaphoreÊ°à‰æã</a></li>
            <li><a href="#semaphoreÂéüÁêÜ">SemaphoreÂéüÁêÜ</a></li>
          </ol>
        </li>
        <li><a href="#exchanger">Exchanger</a></li>
        <li><a href="#countdownlatch">CountDownLatch</a>
          <ol>
            <li><a href="#countdownlatch‰ªãÁªç">CountDownLatch‰ªãÁªç</a></li>
            <li><a href="#countdownlatchÊ°à‰æã">CountDownLatchÊ°à‰æã</a></li>
            <li><a href="#countdownlatchÂéüÁêÜ">CountDownLatchÂéüÁêÜ</a></li>
          </ol>
        </li>
        <li><a href="#cyclicbarrier">CyclicBarrier</a>
          <ol>
            <li><a href="#cyclicbarrier‰ªãÁªç">CyclicBarrier‰ªãÁªç</a></li>
            <li><a href="#cyclicbarrier-barrierË¢´Á†¥Âùè">CyclicBarrier BarrierË¢´Á†¥Âùè</a></li>
            <li><a href="#cyclicbarrierÊ°à‰æã">CyclicBarrierÊ°à‰æã</a></li>
            <li><a href="#cyclicbarrierÂéüÁêÜ">CyclicBarrierÂéüÁêÜ</a></li>
          </ol>
        </li>
        <li><a href="#phaser">Phaser</a>
          <ol>
            <li><a href="#phaser‰ªãÁªç">Phaser‰ªãÁªç</a></li>
            <li><a href="#phaserÊ°à‰æã">PhaserÊ°à‰æã</a></li>
            <li><a href="#phaserÂéüÁêÜ">PhaserÂéüÁêÜ</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#forkjoinÊ°ÜÊû∂">Fork/JoinÊ°ÜÊû∂</a>
      <ol>
        <li><a href="#‰ªÄ‰πàÊòØforkjoin">‰ªÄ‰πàÊòØFork/Join</a></li>
        <li><a href="#Â∑•‰ΩúÁ™ÉÂèñÁÆóÊ≥ï">Â∑•‰ΩúÁ™ÉÂèñÁÆóÊ≥ï</a></li>
        <li><a href="#forkjoinÁöÑÂÖ∑‰ΩìÂÆûÁé∞">Fork/JoinÁöÑÂÖ∑‰ΩìÂÆûÁé∞</a>
          <ol>
            <li><a href="#forkjointask">ForkJoinTask</a></li>
            <li><a href="#forkjoinpool">ForkJoinPool</a></li>
            <li><a href="#forkjoinÁöÑ‰ΩøÁî®">Fork/JoinÁöÑ‰ΩøÁî®</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#java-8-streamÂπ∂Ë°åËÆ°ÁÆóÂéüÁêÜ">Java 8 StreamÂπ∂Ë°åËÆ°ÁÆóÂéüÁêÜ</a>
      <ol>
        <li><a href="#java-8-streamÁÆÄ‰ªã">Java 8 StreamÁÆÄ‰ªã</a></li>
        <li><a href="#streamÂçïÁ∫øÁ®ã‰∏≤Ë°åËÆ°ÁÆó">StreamÂçïÁ∫øÁ®ã‰∏≤Ë°åËÆ°ÁÆó</a></li>
        <li><a href="#streamÂ§öÁ∫øÁ®ãÂπ∂Ë°åËÆ°ÁÆó">StreamÂ§öÁ∫øÁ®ãÂπ∂Ë°åËÆ°ÁÆó</a></li>
        <li><a href="#‰ªéÊ∫êÁ†ÅÁúãstreamÂπ∂Ë°åËÆ°ÁÆóÂéüÁêÜ">‰ªéÊ∫êÁ†ÅÁúãStreamÂπ∂Ë°åËÆ°ÁÆóÂéüÁêÜ</a></li>
        <li><a href="#streamÂπ∂Ë°åËÆ°ÁÆóÁöÑÊÄßËÉΩÊèêÂçá">StreamÂπ∂Ë°åËÆ°ÁÆóÁöÑÊÄßËÉΩÊèêÂçá</a></li>
      </ol>
    </li>
    <li><a href="#ËÆ°Âàí‰ªªÂä°">ËÆ°Âàí‰ªªÂä°</a>
      <ol>
        <li><a href="#‰ΩøÁî®Ê°à‰æã">‰ΩøÁî®Ê°à‰æã</a></li>
        <li><a href="#Á±ªÁªìÊûÑ">Á±ªÁªìÊûÑ</a></li>
        <li><a href="#‰∏ªË¶ÅÊñπÊ≥ï‰ªãÁªç">‰∏ªË¶ÅÊñπÊ≥ï‰ªãÁªç</a>
          <ol>
            <li><a href="#schedule">schedule</a></li>
            <li><a href="#scheduledatfixedrate">scheduledAtFixedRate</a></li>
            <li><a href="#scheduledatfixeddelay">scheduledAtFixedDelay</a></li>
            <li><a href="#delayedexecute">delayedExecute</a></li>
          </ol>
        </li>
        <li><a href="#delayedworkqueue">DelayedWorkQueue</a>
          <ol>
            <li><a href="#take">take</a></li>
            <li><a href="#offer">offer</a></li>
          </ol>
        </li>
        <li><a href="#ÊÄªÁªì">ÊÄªÁªì</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
